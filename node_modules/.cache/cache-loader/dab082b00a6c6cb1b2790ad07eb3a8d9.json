{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\user.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\user.ts","mtime":1614852211711},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvc2xpY2VkVG9BcnJheSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2FzeW5jVG9HZW5lcmF0b3IiOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKaW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQGJhYmVsL3J1bnRpbWUvcmVnZW5lcmF0b3IiOwovLyBAdHMtbm9jaGVjawppbXBvcnQgY29uZmlnIGZyb20gJ2FwcC1jb25maWcnOwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC9tb21lbnQnOwppbXBvcnQgeyBjb25zdGFudHMsIGV0aFRva2VuIH0gZnJvbSAnaGVscGVycyc7CmltcG9ydCByZXF1ZXN0IGZyb20gJ2NvbW1vbi91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IGFjdGlvbnMgZnJvbSAncmVkdXgvYWN0aW9ucyc7CmltcG9ydCB7IGdldFN0YXRlIH0gZnJvbSAncmVkdXgvY29yZSc7CmltcG9ydCByZWR1Y2VycyBmcm9tICdyZWR1eC9jb3JlL3JlZHVjZXJzJzsKaW1wb3J0ICogYXMgYmlwMzkgZnJvbSAnYmlwMzknOwppbXBvcnQgeyBnZXRBY3RpdmF0ZWRDdXJyZW5jaWVzIH0gZnJvbSAnaGVscGVycy91c2VyJzsKaW1wb3J0IGdldEN1cnJlbmN5S2V5IGZyb20gJ2hlbHBlcnMvZ2V0Q3VycmVuY3lLZXknOwppbXBvcnQgbWV0YW1hc2sgZnJvbSAnaGVscGVycy9tZXRhbWFzayc7CgovKg0KICDQmtC+0LPQtNCwINC00L7QsdCw0LLQu9GP0LXQvCByZWR1Y2Vycywg0LTQu9GPINGB0YLQsNGA0YvRhSDQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQuSDQvtC90Lgg0L3QtSDQuNC90LjRhtC40LDQu9C40LfQuNGA0L7QstCw0L3Riw0KICDQndGD0LbQvdC+INC/0YDQvtCy0LXRgNGP0YLRjCDQt9C90LDRh9C10L3QuNC1LCDQuCDQtdGB0LvQuCB1bmRlZmluZWQgLSDQuNC90LjRhtC40LDQu9C40LfQuNGA0L7QstCw0YLRjA0KKi8KdmFyIGluaXRSZWR1Y2VyU3RhdGUgPSBmdW5jdGlvbiBpbml0UmVkdWNlclN0YXRlKCkgewogIHZhciBfZ2V0U3RhdGUgPSBnZXRTdGF0ZSgpLAogICAgICBfZ2V0U3RhdGUkdXNlciA9IF9nZXRTdGF0ZS51c2VyLAogICAgICBhY3RpdmVDdXJyZW5jeSA9IF9nZXRTdGF0ZSR1c2VyLmFjdGl2ZUN1cnJlbmN5LAogICAgICBhY3RpdmVGaWF0ID0gX2dldFN0YXRlJHVzZXIuYWN0aXZlRmlhdDsKCiAgaWYgKCFhY3RpdmVDdXJyZW5jeSkgcmVkdWNlcnMudXNlci5zZXRBY3RpdmVDdXJyZW5jeSh7CiAgICBhY3RpdmVDdXJyZW5jeTogJ0JUQycKICB9KTsKICBpZiAoIWFjdGl2ZUZpYXQpIHJlZHVjZXJzLnVzZXIuc2V0QWN0aXZlRmlhdCh7CiAgICBhY3RpdmVGaWF0OiB3aW5kb3cuREVGQVVMVF9GSUFUIHx8ICdVU0QnCiAgfSk7Cn07Cgp2YXIgc2lnbl9idGNfbXVsdGlzaWcgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShidGNQcml2YXRlS2V5KSB7CiAgICB2YXIgYnRjTXVsdGlzaWdPd25lcktleSwgX2J0Y011bHRpc2lnUHJpdmF0ZUtleTsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBidGNNdWx0aXNpZ093bmVyS2V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uc3RhbnRzLnByaXZhdGVLZXlOYW1lcy5idGNNdWx0aXNpZ090aGVyT3duZXJLZXkpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBidGNNdWx0aXNpZ093bmVyS2V5ID0gSlNPTi5wYXJzZShidGNNdWx0aXNpZ093bmVyS2V5KTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkge30gLy9ACgoKICAgICAgICAgICAgX2J0Y011bHRpc2lnUHJpdmF0ZUtleSA9IGFjdGlvbnMuYnRjbXVsdGlzaWcubG9naW5fVVNFUihidGNQcml2YXRlS2V5LCBidGNNdWx0aXNpZ093bmVyS2V5KTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgIHJldHVybiBhY3Rpb25zLmJ0Y211bHRpc2lnLnNpZ25Ub1VzZXJNdWx0aXNpZygpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBzaWduX2J0Y19tdWx0aXNpZyhfeCkgewogICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgc2lnbl9idGNfMmZhID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihidGNQcml2YXRlS2V5KSB7CiAgICB2YXIgYnRjU01TU2VydmVyS2V5LCBidGNTbXNQdWJsaWNLZXlzLCBidGNTbXNNbmVtb25pY0tleSwgX2J0Y011bHRpc2lnU01TUHJpdmF0ZUtleTsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgYnRjU01TU2VydmVyS2V5ID0gY29uZmlnLnN3YXBDb250cmFjdC5wcm90ZWN0ZWRCdGNLZXk7CiAgICAgICAgICAgIGJ0Y1Ntc1B1YmxpY0tleXMgPSBbYnRjU01TU2VydmVyS2V5XTsKICAgICAgICAgICAgYnRjU21zTW5lbW9uaWNLZXkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmJ0Y1Ntc01uZW1vbmljS2V5KTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgYnRjU21zTW5lbW9uaWNLZXkgPSBKU09OLnBhcnNlKGJ0Y1Ntc01uZW1vbmljS2V5KTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChidGNTbXNNbmVtb25pY0tleSBpbnN0YW5jZW9mIEFycmF5ICYmIGJ0Y1Ntc01uZW1vbmljS2V5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBidGNTbXNQdWJsaWNLZXlzLnB1c2goYnRjU21zTW5lbW9uaWNLZXlbMF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfYnRjTXVsdGlzaWdTTVNQcml2YXRlS2V5ID0gYWN0aW9ucy5idGNtdWx0aXNpZy5sb2dpbl9TTVMoYnRjUHJpdmF0ZUtleSwgYnRjU21zUHVibGljS2V5cyk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMik7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gc2lnbl9idGNfMmZhKF94MikgewogICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIHNpZ25fYnRjX3BpbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoYnRjUHJpdmF0ZUtleSkgewogICAgdmFyIGJ0Y1BpblNlcnZlcktleSwgYnRjUGluUHVibGljS2V5cywgYnRjUGluTW5lbW9uaWNLZXksIF9idGNNdWx0aXNpZ1BpblByaXZhdGVLZXk7CgogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGJ0Y1BpblNlcnZlcktleSA9IGNvbmZpZy5zd2FwQ29udHJhY3QuYnRjUGluS2V5OwogICAgICAgICAgICBidGNQaW5QdWJsaWNLZXlzID0gW2J0Y1BpblNlcnZlcktleV07CiAgICAgICAgICAgIGJ0Y1Bpbk1uZW1vbmljS2V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uc3RhbnRzLnByaXZhdGVLZXlOYW1lcy5idGNQaW5NbmVtb25pY0tleSk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGJ0Y1Bpbk1uZW1vbmljS2V5ID0gSlNPTi5wYXJzZShidGNQaW5NbmVtb25pY0tleSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYnRjUGluTW5lbW9uaWNLZXkgaW5zdGFuY2VvZiBBcnJheSAmJiBidGNQaW5NbmVtb25pY0tleS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgYnRjUGluUHVibGljS2V5cy5wdXNoKGJ0Y1Bpbk1uZW1vbmljS2V5WzBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc29sZS5sb2coJ3NpZ24gdG8gYnRjIHBpbicsIGJ0Y1BpblB1YmxpY0tleXMpOwogICAgICAgICAgICBfYnRjTXVsdGlzaWdQaW5Qcml2YXRlS2V5ID0gYWN0aW9ucy5idGNtdWx0aXNpZy5sb2dpbl9QSU4oYnRjUHJpdmF0ZUtleSwgYnRjUGluUHVibGljS2V5cyk7CgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMyk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gc2lnbl9idGNfcGluKF94MykgewogICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIHNpZ24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmNCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIG1ldGFtYXNrLndlYjNjb25uZWN0Lm9uSW5pdCggLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgICAgICAgIHZhciBtbmVtb25pYywgbW5lbW9uaWNLZXlzLCBidGNOZXdTbXNNbmVtb25pY0tleSwgYnRjTmV3TXVsdGlzaWdPd25lcktleSwgYnRjUHJpdmF0ZUtleSwgYnRjTXVsdGlzaWdQcml2YXRlS2V5LCBldGhQcml2YXRlS2V5LCBnaG9zdFByaXZhdGVLZXksIG5leHRQcml2YXRlS2V5LCBfZXRoUHJpdmF0ZUtleSwgX2J0Y1ByaXZhdGVLZXksIF9naG9zdFByaXZhdGVLZXksIF9uZXh0UHJpdmF0ZUtleTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBpbml0UmVkdWNlclN0YXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICBtbmVtb25pYyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMudHdlbnR5d29yZHMpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmICghbW5lbW9uaWMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW5lbW9uaWMgPSBiaXAzOS5nZW5lcmF0ZU1uZW1vbmljKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMudHdlbnR5d29yZHMsIG1uZW1vbmljKTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBtbmVtb25pY0tleXMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ0YzogbG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uc3RhbnRzLnByaXZhdGVLZXlOYW1lcy5idGNNbmVtb25pYyksCiAgICAgICAgICAgICAgICAgICAgICAgIGJ0Y1NtczogbG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uc3RhbnRzLnByaXZhdGVLZXlOYW1lcy5idGNTbXNNbmVtb25pY0tleUdlbmVyYXRlZCksCiAgICAgICAgICAgICAgICAgICAgICAgIGV0aDogbG9jYWxTdG9yYWdlLmdldEl0ZW0oY29uc3RhbnRzLnByaXZhdGVLZXlOYW1lcy5ldGhNbmVtb25pYyksCiAgICAgICAgICAgICAgICAgICAgICAgIGdob3N0OiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmdob3N0TW5lbW9uaWMpLAogICAgICAgICAgICAgICAgICAgICAgICBuZXh0OiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLm5leHRNbmVtb25pYykKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYWN0aW9ucyB1c2VyIC0gc2lnbicsIG1uZW1vbmljS2V5cywgbW5lbW9uaWMpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChtbmVtb25pYyAhPT0gIi0iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vQAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1uZW1vbmljS2V5cy5idGMpIG1uZW1vbmljS2V5cy5idGMgPSBhY3Rpb25zLmJ0Yy5zd2VlcFRvTW5lbW9uaWMobW5lbW9uaWMpOyAvL0AKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbW5lbW9uaWNLZXlzLmV0aCkgbW5lbW9uaWNLZXlzLmV0aCA9IGFjdGlvbnMuZXRoLnN3ZWVwVG9NbmVtb25pYyhtbmVtb25pYyk7IC8vQAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtbmVtb25pY0tleXMuZ2hvc3QpIG1uZW1vbmljS2V5cy5naG9zdCA9IGFjdGlvbnMuZ2hvc3Quc3dlZXBUb01uZW1vbmljKG1uZW1vbmljKTsgLy9ACgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1uZW1vbmljS2V5cy5uZXh0KSBtbmVtb25pY0tleXMubmV4dCA9IGFjdGlvbnMubmV4dC5zd2VlcFRvTW5lbW9uaWMobW5lbW9uaWMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtbmVtb25pY0tleXMuYnRjU21zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbW5lbW9uaWNLZXlzLmJ0Y1NtcyA9IGFjdGlvbnMuYnRjbXVsdGlzaWcuZ2V0U21zS2V5RnJvbU1uZW1vbmljKG1uZW1vbmljKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmJ0Y1Ntc01uZW1vbmljS2V5R2VuZXJhdGVkLCBtbmVtb25pY0tleXMuYnRjU21zKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSAvLyBTd2VlcC1Td2l0Y2gKCgogICAgICAgICAgICAgICAgICAgICAgYnRjTmV3U21zTW5lbW9uaWNLZXkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmJ0Y1Ntc01uZW1vbmljS2V5TW5lbW9uaWMpOwoKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ0Y05ld1Ntc01uZW1vbmljS2V5ID0gSlNPTi5wYXJzZShidGNOZXdTbXNNbmVtb25pY0tleSk7CiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoYnRjTmV3U21zTW5lbW9uaWNLZXkgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY29uc3RhbnRzLnByaXZhdGVLZXlOYW1lcy5idGNTbXNNbmVtb25pY0tleU1uZW1vbmljLCBKU09OLnN0cmluZ2lmeShbXSkpOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGJ0Y05ld011bHRpc2lnT3duZXJLZXkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmJ0Y011bHRpc2lnT3RoZXJPd25lcktleU1uZW1vbmljKTsKCiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBidGNOZXdNdWx0aXNpZ093bmVyS2V5ID0gSlNPTi5wYXJzZShidGNOZXdNdWx0aXNpZ093bmVyS2V5KTsKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShidGNOZXdNdWx0aXNpZ093bmVyS2V5IGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMuYnRjTXVsdGlzaWdPdGhlck93bmVyS2V5TW5lbW9uaWMsIEpTT04uc3RyaW5naWZ5KFtdKSk7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgYnRjUHJpdmF0ZUtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMuYnRjKTsKICAgICAgICAgICAgICAgICAgICAgIGJ0Y011bHRpc2lnUHJpdmF0ZUtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMuYnRjTXVsdGlzaWcpOwogICAgICAgICAgICAgICAgICAgICAgZXRoUHJpdmF0ZUtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMuZXRoKTsKICAgICAgICAgICAgICAgICAgICAgIGdob3N0UHJpdmF0ZUtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMuZ2hvc3QpOwogICAgICAgICAgICAgICAgICAgICAgbmV4dFByaXZhdGVLZXkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLm5leHQpOwogICAgICAgICAgICAgICAgICAgICAgX2V0aFByaXZhdGVLZXkgPSBhY3Rpb25zLmV0aC5sb2dpbihldGhQcml2YXRlS2V5LCBtbmVtb25pYywgbW5lbW9uaWNLZXlzKTsKICAgICAgICAgICAgICAgICAgICAgIF9idGNQcml2YXRlS2V5ID0gYWN0aW9ucy5idGMubG9naW4oYnRjUHJpdmF0ZUtleSwgbW5lbW9uaWMsIG1uZW1vbmljS2V5cyk7CiAgICAgICAgICAgICAgICAgICAgICBfZ2hvc3RQcml2YXRlS2V5ID0gYWN0aW9ucy5naG9zdC5sb2dpbihnaG9zdFByaXZhdGVLZXksIG1uZW1vbmljLCBtbmVtb25pY0tleXMpOwogICAgICAgICAgICAgICAgICAgICAgX25leHRQcml2YXRlS2V5ID0gYWN0aW9ucy5uZXh0LmxvZ2luKG5leHRQcml2YXRlS2V5LCBtbmVtb25pYywgbW5lbW9uaWNLZXlzKTsgLy8gYnRjIG11bHRpc2lnIHdpdGggMmZhICgyb2YzKQoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbl9idGNfMmZhKF9idGNQcml2YXRlS2V5KTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbl9idGNfbXVsdGlzaWcoX2J0Y1ByaXZhdGVLZXkpOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduX2J0Y19waW4oX2J0Y1ByaXZhdGVLZXkpOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaW5zaWRlIGFjdGlvbnMudG9rZW4ubG9naW4gdG8gY2FsbCB3ZWIzLmV0aC5hY2NvdW50cy5wcml2YXRlS2V5VG9BY2NvdW50IHBhc3NpbmcgcHVibGljIGtleSBpbnN0ZWFkIG9mIHByaXZhdGUga2V5CiAgICAgICAgICAgICAgICAgICAgICAvLyB0aGVyZSB3aWxsIG5vdCBiZSBhbiBlcnJvciwgYnV0IHRoZSBhZGRyZXNzIHJldHVybmVkIHdpbGwgYmUgd3JvbmcKICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICghaXNFdGhLZXljaGFpbkFjdGl2YXRlZCkgewogICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoY29uZmlnLmVyYzIwKS5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnMudG9rZW4ubG9naW4oX2V0aFByaXZhdGVLZXksIGNvbmZpZy5lcmMyMFtuYW1lXS5hZGRyZXNzLCBuYW1lLCBjb25maWcuZXJjMjBbbmFtZV0uZGVjaW1hbHMsIGNvbmZpZy5lcmMyMFtuYW1lXS5mdWxsTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8gfQoKICAgICAgICAgICAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0VG9rZW5TaWduZWQodHJ1ZSk7IC8vIGNvbnN0IGdldFJlcHV0YXRpb24gPSBhY3Rpb25zLnVzZXIuZ2V0UmVwdXRhdGlvbigpCgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzMTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRSZXB1dGF0aW9uKCk7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICAgICAgICB9KSkpOwoKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIHNpZ24oKSB7CiAgICByZXR1cm4gX3JlZjQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgc2lnbl90b190b2tlbnMgPSBmdW5jdGlvbiBzaWduX3RvX3Rva2VucygpIHsKICB2YXIgZXRoUHJpdmF0ZUtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMuZXRoKTsKICBPYmplY3Qua2V5cyhjb25maWcuZXJjMjApLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgIGFjdGlvbnMudG9rZW4ubG9naW4oZXRoUHJpdmF0ZUtleSwgY29uZmlnLmVyYzIwW25hbWVdLmFkZHJlc3MsIG5hbWUsIGNvbmZpZy5lcmMyMFtuYW1lXS5kZWNpbWFscywgY29uZmlnLmVyYzIwW25hbWVdLmZ1bGxOYW1lKTsKICB9KTsKfTsKCnZhciBnZXRSZXB1dGF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgIHZhciBidGNSZXB1dGF0aW9uUHJvbWlzZSwgZXRoUmVwdXRhdGlvblByb21pc2UsIGdob3N0UmVwdXRhdGlvblByb21pc2UsIG5leHRSZXB1dGF0aW9uUHJvbWlzZTsKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBidGNSZXB1dGF0aW9uUHJvbWlzZSA9IGFjdGlvbnMuYnRjLmdldFJlcHV0YXRpb24oKTsKICAgICAgICAgICAgZXRoUmVwdXRhdGlvblByb21pc2UgPSBhY3Rpb25zLmV0aC5nZXRSZXB1dGF0aW9uKCk7CiAgICAgICAgICAgIGdob3N0UmVwdXRhdGlvblByb21pc2UgPSBhY3Rpb25zLmdob3N0LmdldFJlcHV0YXRpb24oKTsKICAgICAgICAgICAgbmV4dFJlcHV0YXRpb25Qcm9taXNlID0gYWN0aW9ucy5uZXh0LmdldFJlcHV0YXRpb24oKTsKICAgICAgICAgICAgUHJvbWlzZS5hbGwoW2J0Y1JlcHV0YXRpb25Qcm9taXNlLCBldGhSZXB1dGF0aW9uUHJvbWlzZSwgZ2hvc3RSZXB1dGF0aW9uUHJvbWlzZSwgbmV4dFJlcHV0YXRpb25Qcm9taXNlXSkudGhlbihmdW5jdGlvbiAoX3JlZjcpIHsKICAgICAgICAgICAgICB2YXIgX3JlZjggPSBfc2xpY2VkVG9BcnJheShfcmVmNywgNCksCiAgICAgICAgICAgICAgICAgIGJ0Y1JlcHV0YXRpb24gPSBfcmVmOFswXSwKICAgICAgICAgICAgICAgICAgZXRoUmVwdXRhdGlvbiA9IF9yZWY4WzFdLAogICAgICAgICAgICAgICAgICBnaG9zdFJlcHV0YXRpb24gPSBfcmVmOFsyXSwKICAgICAgICAgICAgICAgICAgbmV4dFJlcHV0YXRpb24gPSBfcmVmOFszXTsKCiAgICAgICAgICAgICAgdmFyIHRvdGFsUmVwdXRhdGlvbiA9IE51bWJlcihidGNSZXB1dGF0aW9uKSArIE51bWJlcihldGhSZXB1dGF0aW9uKSArIE51bWJlcihnaG9zdFJlcHV0YXRpb24pICsgTnVtYmVyKG5leHRSZXB1dGF0aW9uKTsKCiAgICAgICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIodG90YWxSZXB1dGF0aW9uKSkgewogICAgICAgICAgICAgICAgcmVkdWNlcnMucHVic3ViUm9vbS5zZXQoewogICAgICAgICAgICAgICAgICByZXB1dGF0aW9uOiB0b3RhbFJlcHV0YXRpb24KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZWR1Y2Vycy5wdWJzdWJSb29tLnNldCh7CiAgICAgICAgICAgICAgICAgIHJlcHV0YXRpb246IG51bGwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigidW5rbm93biByZXB1dGF0aW9uIiwgZXJyb3IpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU2KTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBnZXRSZXB1dGF0aW9uKCkgewogICAgcmV0dXJuIF9yZWY2LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIGdldEJhbGFuY2VzID0gZnVuY3Rpb24gZ2V0QmFsYW5jZXMoKSB7CiAgdmFyIF9nZXRTdGF0ZTIgPSBnZXRTdGF0ZSgpLAogICAgICBpc1Rva2VuU2lnbmVkID0gX2dldFN0YXRlMi51c2VyLmlzVG9rZW5TaWduZWQ7CgogIHJlZHVjZXJzLnVzZXIuc2V0SXNCYWxhbmNlRmV0Y2hpbmcoewogICAgaXNCYWxhbmNlRmV0Y2hpbmc6IHRydWUKICB9KTsKICByZXR1cm4gbmV3IFByb21pc2UoIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZjkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOShyZXNvbHZlKSB7CiAgICAgIHZhciBiYWxhbmNlczsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgYmFsYW5jZXMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG1ldGFtYXNrLmlzRW5hYmxlZCgpICYmIG1ldGFtYXNrLmlzQ29ubmVjdGVkKCkgPyBbewogICAgICAgICAgICAgICAgZnVuYzogbWV0YW1hc2suZ2V0QmFsYW5jZSwKICAgICAgICAgICAgICAgIG5hbWU6ICdtZXRhbWFzaycKICAgICAgICAgICAgICB9XSA6IFtdKSwgW3sKICAgICAgICAgICAgICAgIGZ1bmM6IGFjdGlvbnMuZXRoLmdldEJhbGFuY2UsCiAgICAgICAgICAgICAgICBuYW1lOiAnZXRoJwogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGZ1bmM6IGFjdGlvbnMuYnRjLmdldEJhbGFuY2UsCiAgICAgICAgICAgICAgICBuYW1lOiAnYnRjJwogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGZ1bmM6IGFjdGlvbnMuZ2hvc3QuZ2V0QmFsYW5jZSwKICAgICAgICAgICAgICAgIG5hbWU6ICdnaG9zdCcKICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBmdW5jOiBhY3Rpb25zLm5leHQuZ2V0QmFsYW5jZSwKICAgICAgICAgICAgICAgIG5hbWU6ICduZXh0JwogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGZ1bmM6IGFjdGlvbnMuYnRjbXVsdGlzaWcuZ2V0QmFsYW5jZSwKICAgICAgICAgICAgICAgIG5hbWU6ICdidGMtc21zJwogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGZ1bmM6IGFjdGlvbnMuYnRjbXVsdGlzaWcuZ2V0QmFsYW5jZVVzZXIsCiAgICAgICAgICAgICAgICBuYW1lOiAnYnRjLW1zLW1haW4nCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgZnVuYzogYWN0aW9ucy5idGNtdWx0aXNpZy5nZXRCYWxhbmNlUGluLAogICAgICAgICAgICAgICAgbmFtZTogJ2J0Yy1waW4nCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgZnVuYzogYWN0aW9ucy5idGNtdWx0aXNpZy5mZXRjaE11bHRpc2lnQmFsYW5jZXMsCiAgICAgICAgICAgICAgICBuYW1lOiAnYnRjLW1zJwogICAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgICBiYWxhbmNlcy5mb3JFYWNoKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF9yZWYxMCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KG9iaikgewogICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDcucHJldiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmouZnVuYygpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDcucHJldiA9IDU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ3LnQwID0gX2NvbnRleHQ3WyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWwgZmV0Y2ggYmFsYW5jZSBmb3InLCBvYmoubmFtZSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNywgbnVsbCwgW1swLCA1XV0pOwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3g1KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMTAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSgpKTsKCiAgICAgICAgICAgICAgaWYgKGlzVG9rZW5TaWduZWQpIHsKICAgICAgICAgICAgICAgIC8vIHdhaXQgdW50aWwgYWxsIHRva2VuIGRhdGEgaXMgbG9hZGVkIGFuZCB3aWxsIGJlIGluIHRoZSBzdG9yZQogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIC8vIGxvY2FsIHN0b3JhZ2UgZGF0YQogICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhjb25maWcuZXJjMjApLmZvckVhY2goIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxMSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgucHJldiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnMudG9rZW4uZ2V0QmFsYW5jZShuYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgucHJldiA9IDU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC50MCA9IF9jb250ZXh0OFsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbCBmZXRjaCBiYWxhbmNlIGZvciB0b2tlbicsIG5hbWUsIF9jb250ZXh0OC50MCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlOCwgbnVsbCwgW1swLCA1XV0pOwogICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDYpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMTEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KCkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZWR1Y2Vycy51c2VyLnNldElzQmFsYW5jZUZldGNoaW5nKHsKICAgICAgICAgICAgICAgIGlzQmFsYW5jZUZldGNoaW5nOiBmYWxzZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlOSk7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeDQpIHsKICAgICAgcmV0dXJuIF9yZWY5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKSk7Cn07Cgp2YXIgY3VzdG9tUmF0ZSA9IGZ1bmN0aW9uIGN1c3RvbVJhdGUoY3VyKSB7CiAgdmFyIHdUb2tlbnMgPSB3aW5kb3cud2lkZ2V0RVJDMjBUb2tlbnM7CiAgdmFyIGRhdGFvYmogPSB3VG9rZW5zICYmIE9iamVjdC5rZXlzKHdUb2tlbnMpLmZpbmQoZnVuY3Rpb24gKGVsKSB7CiAgICByZXR1cm4gZWwgPT09IGN1ci50b0xvd2VyQ2FzZSgpOwogIH0pOwogIHJldHVybiBkYXRhb2JqID8gKHdUb2tlbnNbZGF0YW9ial0gfHwgewogICAgY3VzdG9tRWN4Y2hhbmdlUmF0ZTogbnVsbAogIH0pLmN1c3RvbUVjeGNoYW5nZVJhdGUgOiBudWxsOwp9OwoKdmFyIGdldEV4Y2hhbmdlUmF0ZSA9IGZ1bmN0aW9uIGdldEV4Y2hhbmdlUmF0ZShzZWxsQ3VycmVuY3ksIGJ1eUN1cnJlbmN5KSB7CiAgdmFyIHNlbGxEYXRhUmF0ZSA9IGN1c3RvbVJhdGUoc2VsbEN1cnJlbmN5KTsKICB2YXIgYnV5RGF0YVJhdGUgPSBjdXN0b21SYXRlKGJ1eUN1cnJlbmN5KTsKCiAgdmFyIF9nZXRTdGF0ZTMgPSBnZXRTdGF0ZSgpLAogICAgICB1c2VyID0gX2dldFN0YXRlMy51c2VyOwoKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgaWYgKHNlbGxEYXRhUmF0ZSkgewogICAgICByZXNvbHZlKHNlbGxEYXRhUmF0ZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoYnV5RGF0YVJhdGUpIHsKICAgICAgcmVzb2x2ZSgxIC8gYnV5RGF0YVJhdGUpOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGRhdGFLZXkgPSBzZWxsQ3VycmVuY3kudG9Mb3dlckNhc2UoKTsKCiAgICBzd2l0Y2ggKHNlbGxDdXJyZW5jeS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgIGNhc2UgJ2J0YyAoc21zLXByb3RlY3RlZCknOgogICAgICBjYXNlICdidGMgKG11bHRpc2lnKSc6CiAgICAgIGNhc2UgJ2J0YyAocGluLXByb3RlY3RlZCknOgogICAgICAgIGRhdGFLZXkgPSAnYnRjJzsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICB9CgogICAgaWYgKHVzZXJbIiIuY29uY2F0KGRhdGFLZXksICJEYXRhIildICYmIHVzZXJbIiIuY29uY2F0KGRhdGFLZXksICJEYXRhIildLmluZm9BYm91dEN1cnJlbmN5ICYmIHVzZXJbIiIuY29uY2F0KGRhdGFLZXksICJEYXRhIildLmluZm9BYm91dEN1cnJlbmN5LnByaWNlX2ZpYXQgfHwgdXNlci50b2tlbnNEYXRhW2RhdGFLZXldICYmIHVzZXIudG9rZW5zRGF0YVtkYXRhS2V5XS5pbmZvQWJvdXRDdXJyZW5jeSAmJiB1c2VyLnRva2Vuc0RhdGFbZGF0YUtleV0uaW5mb0Fib3V0Q3VycmVuY3kucHJpY2VfZmlhdCkgewogICAgICB2YXIgY3VycmVuY3lEYXRhID0gdXNlci50b2tlbnNEYXRhW2RhdGFLZXldICYmIHVzZXIudG9rZW5zRGF0YVtkYXRhS2V5XS5pbmZvQWJvdXRDdXJyZW5jeSA/IHVzZXIudG9rZW5zRGF0YVtkYXRhS2V5XSA6IHVzZXJbIiIuY29uY2F0KGRhdGFLZXksICJEYXRhIildOwogICAgICByZXNvbHZlKGN1cnJlbmN5RGF0YS5pbmZvQWJvdXRDdXJyZW5jeS5wcmljZV9maWF0KTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc29sdmUoMSk7CiAgICB9CiAgfSk7Cn07Cgp2YXIgZ2V0RGVtb01vbmV5ID0gcHJvY2Vzcy5lbnYuTUFJTk5FVCA/IGZ1bmN0aW9uICgpIHt9IDogZnVuY3Rpb24gKCkgewogIC8vIGdvb2dlIGJpdGNvaW4gKG9yIHJvcHN0ZW4pIGZhdWNldAogIHJlcXVlc3QuZ2V0KCdodHRwczovL3N3YXAud3BtaXgubmV0L2RlbW9rZXlzLnBocCcsIHt9KS50aGVuKGZ1bmN0aW9uIChyKSB7CiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmNsZWFyKCk7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmJ0YywgclswXSk7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmV0aCwgclsxXSk7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmdob3N0LCByWzJdKTsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGNvbnN0YW50cy5wcml2YXRlS2V5TmFtZXMubmV4dCwgclszXSk7IC8vQAoKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGNvbnN0YW50cy5sb2NhbFN0b3JhZ2UuZGVtb01vbmV5UmVjZWl2ZWQsIHRydWUpOwogICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogIH0pOwp9OwoKdmFyIGdldEluZm9BYm91dEN1cnJlbmN5ID0gZnVuY3Rpb24gZ2V0SW5mb0Fib3V0Q3VycmVuY3koY3VycmVuY3lOYW1lcykgewogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICB2YXIgaGFzQ3VzdG9tUmF0ZSA9IGZ1bmN0aW9uIGhhc0N1c3RvbVJhdGUoY3VyKSB7CiAgICAgIHZhciBkYXRhb2JqID0gT2JqZWN0LmtleXMoY29uZmlnLmVyYzIwKS5maW5kKGZ1bmN0aW9uIChlbCkgewogICAgICAgIHJldHVybiBlbC50b0xvd2VyQ2FzZSgpID09PSBjdXIudG9Mb3dlckNhc2UoKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBkYXRhb2JqID8gKGNvbmZpZy5lcmMyMFtkYXRhb2JqXSB8fCB7CiAgICAgICAgY3VzdG9tRWN4Y2hhbmdlUmF0ZTogZmFsc2UKICAgICAgfSkuY3VzdG9tRWN4Y2hhbmdlUmF0ZSA6IGZhbHNlOwogICAgfTsKCiAgICB2YXIgdXJsID0gJ2h0dHBzOi8vbm94b24ud3BtaXgubmV0L2N1cnNBbGwucGhwJzsKICAgIHJlZHVjZXJzLnVzZXIuc2V0SXNGZXRjaGluZyh7CiAgICAgIGlzRmV0Y2hpbmc6IHRydWUKICAgIH0pOwogICAgdmFyIGZpYXQgPSBjb25maWcgJiYgY29uZmlnLm9wdHMgJiYgY29uZmlnLm9wdHMuYWN0aXZlRmlhdCA/IGNvbmZpZy5vcHRzLmFjdGl2ZUZpYXQgOiAiVVNEIjsKICAgIHJlcXVlc3QuZ2V0KHVybCwgewogICAgICBjYWNoZVJlc3BvbnNlOiA2MCAqIDYwICogMTAwMCwKICAgICAgLy8g0LrQtdGIIDEg0YfQsNGBCiAgICAgIHF1ZXJ5OiB7CiAgICAgICAgZmlhdDogZmlhdCwKICAgICAgICB0b2tlbnM6IGN1cnJlbmN5TmFtZXMuam9pbigiLCIpCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikgewogICAgICB2YXIgaW5mb0Fib3V0QlRDID0gYW5zd2VyLmRhdGEuZmlsdGVyKGZ1bmN0aW9uIChjdXJyZW5jeUluZm8pIHsKICAgICAgICBpZiAoY3VycmVuY3lJbmZvLnN5bWJvbC50b0xvd2VyQ2FzZSgpID09PSAnYnRjJykgcmV0dXJuIHRydWU7CiAgICAgIH0pOwogICAgICB2YXIgYnRjUHJpY2UgPSBpbmZvQWJvdXRCVEMgJiYgaW5mb0Fib3V0QlRDLmxlbmd0aCAmJiBpbmZvQWJvdXRCVENbMF0ucXVvdGUgJiYgaW5mb0Fib3V0QlRDWzBdLnF1b3RlW2ZpYXRdICYmIGluZm9BYm91dEJUQ1swXS5xdW90ZVtmaWF0XS5wcmljZSA/IGluZm9BYm91dEJUQ1swXS5xdW90ZVtmaWF0XS5wcmljZSA6IDcwMDA7CiAgICAgIGFuc3dlci5kYXRhLm1hcChmdW5jdGlvbiAoY3VycmVuY3lJbmZvSXRlbSkgewogICAgICAgIGlmIChjdXJyZW5jeU5hbWVzLmluY2x1ZGVzKGN1cnJlbmN5SW5mb0l0ZW0uc3ltYm9sKSkgewogICAgICAgICAgaWYgKGN1cnJlbmN5SW5mb0l0ZW0ucXVvdGUgJiYgY3VycmVuY3lJbmZvSXRlbS5xdW90ZVtmaWF0XSkgewogICAgICAgICAgICB2YXIgcHJpY2VJbkJ0YyA9IGN1cnJlbmN5SW5mb0l0ZW0ucXVvdGVbZmlhdF0ucHJpY2UgLyBidGNQcmljZTsKICAgICAgICAgICAgdmFyIG93blByaWNlID0gaGFzQ3VzdG9tUmF0ZShjdXJyZW5jeUluZm9JdGVtLnN5bWJvbCk7CgogICAgICAgICAgICB2YXIgY3VycmVuY3lJbmZvID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBjdXJyZW5jeUluZm9JdGVtLnF1b3RlW2ZpYXRdKSwge30sIHsKICAgICAgICAgICAgICBwcmljZV9maWF0OiBvd25QcmljZSA/IG93blByaWNlIDogY3VycmVuY3lJbmZvSXRlbS5xdW90ZVtmaWF0XS5wcmljZSwKICAgICAgICAgICAgICBwcmljZV9idGM6IHByaWNlSW5CdGMKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbmN5SW5mb0l0ZW0uc3ltYm9sKSB7CiAgICAgICAgICAgICAgY2FzZSAnQlRDJzoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRDdXJyZW5jeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2J0Y0RhdGEnLAogICAgICAgICAgICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5OiBjdXJyZW5jeUluZm8KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0SW5mb0Fib3V0Q3VycmVuY3koewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdidGNNbmVtb25pY0RhdGEnLAogICAgICAgICAgICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5OiBjdXJyZW5jeUluZm8KICAgICAgICAgICAgICAgICAgfSk7IC8vIFN3ZWVwIChmb3IgZnV0dXJlKQoKICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRDdXJyZW5jeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2J0Y011bHRpc2lnU01TRGF0YScsCiAgICAgICAgICAgICAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3k6IGN1cnJlbmN5SW5mbwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRDdXJyZW5jeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2J0Y011bHRpc2lnVXNlckRhdGEnLAogICAgICAgICAgICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5OiBjdXJyZW5jeUluZm8KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0SW5mb0Fib3V0Q3VycmVuY3koewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdidGNNdWx0aXNpZ0cyRkFEYXRhJywKICAgICAgICAgICAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeTogY3VycmVuY3lJbmZvCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZWR1Y2Vycy51c2VyLnNldEluZm9BYm91dEN1cnJlbmN5KHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnYnRjTXVsdGlzaWdQaW5EYXRhJywKICAgICAgICAgICAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeTogY3VycmVuY3lJbmZvCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAnRVRIJzoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRDdXJyZW5jeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2V0aERhdGEnLAogICAgICAgICAgICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5OiBjdXJyZW5jeUluZm8KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0SW5mb0Fib3V0Q3VycmVuY3koewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdldGhNbmVtb25pY0RhdGEnLAogICAgICAgICAgICAgICAgICAgIGluZm9BYm91dEN1cnJlbmN5OiBjdXJyZW5jeUluZm8KICAgICAgICAgICAgICAgICAgfSk7IC8vIFN3ZWVwIChmb3IgZnV0dXJlKQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgJ0dIT1NUJzoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRDdXJyZW5jeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2dob3N0RGF0YScsCiAgICAgICAgICAgICAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3k6IGN1cnJlbmN5SW5mbwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRDdXJyZW5jeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2dob3N0TW5lbW9uaWNEYXRhJywKICAgICAgICAgICAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeTogY3VycmVuY3lJbmZvCiAgICAgICAgICAgICAgICAgIH0pOyAvLyBTd2VlcCAoZm9yIGZ1dHVyZSkKCiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlICdORVhUJzoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRDdXJyZW5jeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ25leHREYXRhJywKICAgICAgICAgICAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeTogY3VycmVuY3lJbmZvCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZWR1Y2Vycy51c2VyLnNldEluZm9BYm91dEN1cnJlbmN5KHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbmV4dE1uZW1vbmljRGF0YScsCiAgICAgICAgICAgICAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3k6IGN1cnJlbmN5SW5mbwogICAgICAgICAgICAgICAgICB9KTsgLy8gU3dlZXAgKGZvciBmdXR1cmUpCgogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaWYgKGV0aFRva2VuLmlzRXRoVG9rZW4oewogICAgICAgICAgICAgICAgICAgIG5hbWU6IGN1cnJlbmN5SW5mb0l0ZW0uc3ltYm9sCiAgICAgICAgICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRJbmZvQWJvdXRUb2tlbih7CiAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjdXJyZW5jeUluZm9JdGVtLnN5bWJvbC50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgaW5mb0Fib3V0Q3VycmVuY3k6IGN1cnJlbmN5SW5mbwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0SW5mb0Fib3V0Q3VycmVuY3koewogICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiIuY29uY2F0KGN1cnJlbmN5SW5mb0l0ZW0uc3ltYm9sLnRvTG93ZXJDYXNlKCksICJEYXRhIiksCiAgICAgICAgICAgICAgICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeTogY3VycmVuY3lJbmZvCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlcnJvcikgewogICAgICByZWplY3QoZXJyb3IpOwogICAgfSlbImZpbmFsbHkiXShmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiByZWR1Y2Vycy51c2VyLnNldElzRmV0Y2hpbmcoewogICAgICAgIGlzRmV0Y2hpbmc6IGZhbHNlCiAgICAgIH0pOwogICAgfSk7CiAgfSk7Cn07Cgp2YXIgY2xlYXJUcmFuc2FjdGlvbnMgPSBmdW5jdGlvbiBjbGVhclRyYW5zYWN0aW9ucygpIHsKICByZWR1Y2Vycy5oaXN0b3J5LnNldFRyYW5zYWN0aW9ucyhbXSk7Cn07Cgp2YXIgbWVyZ2VUcmFuc2FjdGlvbnMgPSBmdW5jdGlvbiBtZXJnZVRyYW5zYWN0aW9ucyhtZXJnZVR4cykgewogIHZhciBfcmVmMTI7CgogIHZhciBfZ2V0U3RhdGU0ID0gZ2V0U3RhdGUoKSwKICAgICAgdHJhbnNhY3Rpb25zID0gX2dldFN0YXRlNC5oaXN0b3J5LnRyYW5zYWN0aW9uczsKCiAgdmFyIGRhdGEgPSAoX3JlZjEyID0gW10pLmNvbmNhdC5hcHBseShfcmVmMTIsIFt0cmFuc2FjdGlvbnNdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkobWVyZ2VUeHMpKSkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgcmV0dXJuIGIuZGF0ZSAtIGEuZGF0ZTsKICB9KS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgIHJldHVybiBpdGVtOwogIH0pOwoKICByZWR1Y2Vycy5oaXN0b3J5LnNldFRyYW5zYWN0aW9ucyhkYXRhKTsKfTsKCnZhciBwdWxsVHJhbnNhY3Rpb25zID0gZnVuY3Rpb24gcHVsbFRyYW5zYWN0aW9ucyh0cmFuc2FjdGlvbnMpIHsKICB2YXIgX3JlZjEzOwoKICB2YXIgZGF0YSA9IChfcmVmMTMgPSBbXSkuY29uY2F0LmFwcGx5KF9yZWYxMywgW1tdXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRyYW5zYWN0aW9ucykpKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICByZXR1cm4gYi5kYXRlIC0gYS5kYXRlOwogIH0pLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIGl0ZW07CiAgfSk7CgogIHJlZHVjZXJzLmhpc3Rvcnkuc2V0VHJhbnNhY3Rpb25zKGRhdGEpOwp9OwoKdmFyIHB1bGxBY3RpdmVDdXJyZW5jeSA9IGZ1bmN0aW9uIHB1bGxBY3RpdmVDdXJyZW5jeShjdXJyZW5jeSkgewogIHJlZHVjZXJzLnVzZXIuc2V0QWN0aXZlQ3VycmVuY3koewogICAgYWN0aXZlQ3VycmVuY3k6IGN1cnJlbmN5CiAgfSk7Cn07Cgp2YXIgZGVsYXkgPSBmdW5jdGlvbiBkZWxheShtcykgewogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gcmVzb2x2ZSh0cnVlKTsKICAgIH0sIG1zKTsKICB9KTsKfTsKCnZhciBmZXRjaE11bHRpc2lnU3RhdHVzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjE0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKCkgewogICAgdmFyIF9nZXRTdGF0ZTUsIF9nZXRTdGF0ZTUkdXNlciRidGNNdSwgbWFpbkFkZHJlc3MsIHdhbGxldHM7CgogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfZ2V0U3RhdGU1ID0gZ2V0U3RhdGUoKSwgX2dldFN0YXRlNSR1c2VyJGJ0Y011ID0gX2dldFN0YXRlNS51c2VyLmJ0Y011bHRpc2lnVXNlckRhdGEsIG1haW5BZGRyZXNzID0gX2dldFN0YXRlNSR1c2VyJGJ0Y011LmFkZHJlc3MsIHdhbGxldHMgPSBfZ2V0U3RhdGU1JHVzZXIkYnRjTXUud2FsbGV0czsKICAgICAgICAgICAgYWN0aW9ucy5tdWx0aXNpZ1R4LmZldGNoKG1haW5BZGRyZXNzKTsKCiAgICAgICAgICAgIGlmICh3YWxsZXRzICYmIHdhbGxldHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgd2FsbGV0cy5tYXAoZnVuY3Rpb24gKF9yZWYxNSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzID0gX3JlZjE1LmFkZHJlc3M7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAocmVzb2x2ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbnMubXVsdGlzaWdUeC5mZXRjaChhZGRyZXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTEwKTsKICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDcpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZjE2LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KCkpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTExKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBmZXRjaE11bHRpc2lnU3RhdHVzKCkgewogICAgcmV0dXJuIF9yZWYxNC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKCnZhciBzZXRUcmFuc2FjdGlvbnMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMTcgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoKSB7CiAgICB2YXIgb2JqQ3VycmVuY3ksCiAgICAgICAgaXNCdGNTd2VlcGVkLAogICAgICAgIGlzRXRoU3dlZXBlZCwKICAgICAgICBpc0dob3N0U3dlZXBlZCwKICAgICAgICBpc05leHRTd2VlcGVkLAogICAgICAgIF9nZXRTdGF0ZTYsCiAgICAgICAgaGlkZGVuQ29pbnNMaXN0LAogICAgICAgIGVuYWJsZWRDdXJyZW5jaWVzLAogICAgICAgIGZldGNoVHhzUHJvbWlzZXMsCiAgICAgICAgZXJjMjAsCiAgICAgICAgX2FyZ3MxMiA9IGFyZ3VtZW50czsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQxMikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIG9iakN1cnJlbmN5ID0gX2FyZ3MxMi5sZW5ndGggPiAwICYmIF9hcmdzMTJbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTJbMF0gOiBudWxsOwoKICAgICAgICAgICAgLyogDQogICAgICAgICAgICAgIG9iakN1cnJlbmN5ID0gew0KICAgICAgICAgICAgICAgIGN1cnJlbmN5OiB7DQogICAgICAgICAgICAgICAgICBpc0JhbGFuY2VGZXRjaGVkOiBib29sDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAiR0hPU1QiLA0KICAgICAgICAgICAgICAiTkVYVCINCiAgICAgICAgICAgICAgIkVUSCINCiAgICAgICAgICAgICAgIkJUQyINCiAgICAgICAgICAgICAgIkJUQyAoU01TLVByb3RlY3RlZCkiDQogICAgICAgICAgICAgICJCVEMgKFBJTi1Qcm90ZWN0ZWQpIg0KICAgICAgICAgICAgICAiQlRDIChHb29nbGUgMkZBKSINCiAgICAgICAgICAgICAgIkJUQyAoTXVsdGlzaWcpIg0KICAgICAgICAgICAgICAiVVNEVCIsDQogICAgICAgICAgICAgICJFVEgiDQogICAgICAgICAgICAqLwogICAgICAgICAgICBpc0J0Y1N3ZWVwZWQgPSBhY3Rpb25zLmJ0Yy5pc1N3ZWVwZWQoKTsKICAgICAgICAgICAgaXNFdGhTd2VlcGVkID0gYWN0aW9ucy5ldGguaXNTd2VlcGVkKCk7CiAgICAgICAgICAgIGlzR2hvc3RTd2VlcGVkID0gYWN0aW9ucy5naG9zdC5pc1N3ZWVwZWQoKTsKICAgICAgICAgICAgaXNOZXh0U3dlZXBlZCA9IGFjdGlvbnMubmV4dC5pc1N3ZWVwZWQoKTsKICAgICAgICAgICAgX2dldFN0YXRlNiA9IGdldFN0YXRlKCksIGhpZGRlbkNvaW5zTGlzdCA9IF9nZXRTdGF0ZTYuY29yZS5oaWRkZW5Db2luc0xpc3Q7CiAgICAgICAgICAgIGVuYWJsZWRDdXJyZW5jaWVzID0gZ2V0QWN0aXZhdGVkQ3VycmVuY2llcygpOwogICAgICAgICAgICAvKg0KICAgICAgICAgICAgICBmZXRjaGluZyBwZW5naW5nIGJ0Yy1tcyB0eHMNCiAgICAgICAgICAgICovCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGNsZWFyVHJhbnNhY3Rpb25zKCk7CiAgICAgICAgICAgICAgZmV0Y2hUeHNQcm9taXNlcyA9IFthY3Rpb25zLmJ0Yy5nZXRUcmFuc2FjdGlvbigpXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGlzQnRjU3dlZXBlZCA/IFtdIDogW2FjdGlvbnMuYnRjLmdldFRyYW5zYWN0aW9uKGFjdGlvbnMuYnRjLmdldFN3ZWVwQWRkcmVzcygpKV0pLCBbYWN0aW9ucy5idGNtdWx0aXNpZy5nZXRUcmFuc2FjdGlvblNNUygpLCBhY3Rpb25zLmJ0Y211bHRpc2lnLmdldFRyYW5zYWN0aW9uUElOKCksIGFjdGlvbnMuYnRjbXVsdGlzaWcuZ2V0VHJhbnNhY3Rpb25Vc2VyKCksIGFjdGlvbnMuZXRoLmdldFRyYW5zYWN0aW9uKCldLCBfdG9Db25zdW1hYmxlQXJyYXkobWV0YW1hc2suaXNFbmFibGVkKCkgJiYgbWV0YW1hc2suaXNDb25uZWN0ZWQoKSA/IFthY3Rpb25zLmV0aC5nZXRUcmFuc2FjdGlvbihtZXRhbWFzay5nZXRBZGRyZXNzKCkpXSA6IFtdKSwgX3RvQ29uc3VtYWJsZUFycmF5KGlzRXRoU3dlZXBlZCA/IFtdIDogW2FjdGlvbnMuZXRoLmdldFRyYW5zYWN0aW9uKGFjdGlvbnMuZXRoLmdldFN3ZWVwQWRkcmVzcygpKV0pLCBfdG9Db25zdW1hYmxlQXJyYXkob2JqQ3VycmVuY3kgJiYgb2JqQ3VycmVuY3lbJ0dIT1NUJ10gPyBbYWN0aW9ucy5naG9zdC5nZXRUcmFuc2FjdGlvbigpXSA6IFtdKSwgX3RvQ29uc3VtYWJsZUFycmF5KG9iakN1cnJlbmN5ICYmIG9iakN1cnJlbmN5WydORVhUJ10gPyBbYWN0aW9ucy5uZXh0LmdldFRyYW5zYWN0aW9uKCldIDogW10pKTsKICAgICAgICAgICAgICBlcmMyMCA9IE9iamVjdC5rZXlzKGNvbmZpZy5lcmMyMCkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhaGlkZGVuQ29pbnNMaXN0LmluY2x1ZGVzKGtleS50b1VwcGVyQ2FzZSgpKSAmJiBlbmFibGVkQ3VycmVuY2llcy5pbmNsdWRlcyhrZXkudG9VcHBlckNhc2UoKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgZmV0Y2hUeHNQcm9taXNlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eFByb21pc2UpIHsKICAgICAgICAgICAgICAgIHR4UHJvbWlzZS50aGVuKGZ1bmN0aW9uICh0eExpc3QpIHsKICAgICAgICAgICAgICAgICAgbWVyZ2VUcmFuc2FjdGlvbnModHhMaXN0KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGVyYzIwLm1hcChmdW5jdGlvbiAobmFtZSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGRlbGF5KDY1MCAqIGluZGV4KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgYWN0aW9ucy50b2tlbi5nZXRUcmFuc2FjdGlvbihudWxsLCBuYW1lKS50aGVuKGZ1bmN0aW9uIChlcmNUeHMpIHsKICAgICAgICAgICAgICAgICAgICBtZXJnZVRyYW5zYWN0aW9ucyhlcmNUeHMpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2dldFRyYW5zRXJyb3I6ICcsIGVycm9yKTsKICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUxMik7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gc2V0VHJhbnNhY3Rpb25zKCkgewogICAgcmV0dXJuIF9yZWYxNy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKCnZhciBnZXRUZXh0ID0gZnVuY3Rpb24gZ2V0VGV4dCgpIHsKICB2YXIgX2dldFN0YXRlNyA9IGdldFN0YXRlKCksCiAgICAgIF9nZXRTdGF0ZTckdXNlciA9IF9nZXRTdGF0ZTcudXNlciwKICAgICAgZXRoRGF0YSA9IF9nZXRTdGF0ZTckdXNlci5ldGhEYXRhLAogICAgICBidGNEYXRhID0gX2dldFN0YXRlNyR1c2VyLmJ0Y0RhdGEsCiAgICAgIGdob3N0RGF0YSA9IF9nZXRTdGF0ZTckdXNlci5naG9zdERhdGEsCiAgICAgIG5leHREYXRhID0gX2dldFN0YXRlNyR1c2VyLm5leHREYXRhOwoKICB2YXIgdGV4dCA9ICJcbiAgWW91IHdpbGwgbmVlZCB0aGlzIGluc3RydWN0aW9uIG9ubHkgaW4gY2FzZSBvZiBlbWVyZ2VuY3kgKGlmIHlvdSBsb3N0IHlvdXIga2V5cykgXHJcblxuICBwbGVhc2UgZG8gTk9UIHdhc3RlIHlvdXIgdGltZSBhbmQgZ28gYmFjayB0byBzd2FwLm9ubGluZVxyXG5cbiAgXHJcblxuICBcclxuXG4gIFxyXG5cbiAgXHJcblxuIi5jb25jYXQod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLCAiIGVtZXJnZW5jeSBvbmx5IGluc3RydWN0aW9uXG5cclxuXG4jRVRIRVJFVU1cblxyXG5cbkV0aGVyZXVtIGFkZHJlc3M6ICIpLmNvbmNhdChldGhEYXRhLmFkZHJlc3MsICIgIFxyXG5cblByaXZhdGUga2V5OiAiKS5jb25jYXQoZXRoRGF0YS5wcml2YXRlS2V5LCAiXHJcblxuXHJcblxuSG93IHRvIGFjY2VzcyB0b2tlbnMgYW5kIGV0aGVyczogXHJcblxuMS4gR28gaGVyZSBodHRwczovL3d3dy5teWV0aGVyd2FsbGV0LmNvbS8jc2VuZC10cmFuc2FjdGlvbiBcclxuXG4yLiBTZWxlY3QgJ1ByaXZhdGUga2V5J1xyXG5cbjMuIHBhc3RlIHByaXZhdGUga2V5IHRvIGlucHV0IGFuZCBjbGljayBcInVubG9ja1wiXHJcblxuXHJcblxuIyBCSVRDT0lOXHJcblxuXHJcblxuQml0Y29pbiBhZGRyZXNzOiAiKS5jb25jYXQoYnRjRGF0YS5hZGRyZXNzLCAiXHJcblxuUHJpdmF0ZSBrZXk6ICIpLmNvbmNhdChidGNEYXRhLnByaXZhdGVLZXksICJcclxuXG5cclxuXG4xLiBHbyB0byBibG9ja2NoYWluLmluZm9cclxuXG4yLiBsb2dpblxyXG5cbjMuIEdvIHRvIHNldHRpbmdzID4gYWRkcmVzc2VzID4gaW1wb3J0XHJcblxuNC4gcGFzdGUgcHJpdmF0ZSBrZXkgYW5kIGNsaWNrIFwiT2tcIlxyXG5cblxyXG5cbiMgR0hPU1RcclxuXG5cclxuXG5HaG9zdCBhZGRyZXNzOiAiKS5jb25jYXQoZ2hvc3REYXRhLmFkZHJlc3MsICJcclxuXG5Qcml2YXRlIGtleTogIikuY29uY2F0KGdob3N0RGF0YS5wcml2YXRlS2V5LCAiXHJcblxuXHJcblxuIyBORVhUXHJcblxuXHJcblxuTmV4dCBhZGRyZXNzOiAiKS5jb25jYXQobmV4dERhdGEuYWRkcmVzcywgIlxyXG5cblByaXZhdGUga2V5OiAiKS5jb25jYXQobmV4dERhdGEucHJpdmF0ZUtleSwgIlxyXG5cblxyXG5cbiogV2UgZG9uJ3Qgc3RvcmUgeW91ciBwcml2YXRlIGtleXMgYW5kIHdpbGwgbm90IGJlIGFibGUgdG8gcmVzdG9yZSB0aGVtIVxuXHJcblxuIik7CiAgcmV0dXJuIHRleHQ7Cn07CgpleHBvcnQgdmFyIGdldFdpdGhkcmF3V2FsbGV0ID0gZnVuY3Rpb24gZ2V0V2l0aGRyYXdXYWxsZXQoY3VycmVuY3ksIGFkZHIpIHsKICB2YXIgbmVlZFR5cGUgPSBnZXRDdXJyZW5jeUtleShjdXJyZW5jeSwgdHJ1ZSkudG9VcHBlckNhc2UoKTsKICB2YXIgZmlsdGVyZWQgPSBhY3Rpb25zLmNvcmUuZ2V0V2FsbGV0cyh7fSkuZmlsdGVyKGZ1bmN0aW9uICh3YWxsZXQpIHsKICAgIHZhciB3YWxsZXRUeXBlID0gZ2V0Q3VycmVuY3lLZXkod2FsbGV0LmN1cnJlbmN5LCB0cnVlKS50b1VwcGVyQ2FzZSgpOwogICAgcmV0dXJuIHdhbGxldFR5cGUgPT09IG5lZWRUeXBlICYmIGFkZHIgPT09IHdhbGxldC5hZGRyZXNzIHx8ICFhZGRyICYmIHdhbGxldFR5cGUgPT09IG5lZWRUeXBlOwogIH0pOwogIHJldHVybiBmaWx0ZXJlZC5sZW5ndGggPyBmaWx0ZXJlZFswXSA6IGZhbHNlOwp9OwpleHBvcnQgdmFyIGlzT3duZXIgPSBmdW5jdGlvbiBpc093bmVyKGFkZHIsIGN1cnJlbmN5KSB7CiAgaWYgKGV0aFRva2VuLmlzRXRoVG9rZW4oewogICAgbmFtZTogY3VycmVuY3kKICB9KSkgewogICAgaWYgKGFjdGlvbnMuZXRoLmdldEFsbE15QWRkcmVzc2VzKCkuaW5kZXhPZihhZGRyLnRvTG93ZXJDYXNlKCkpICE9PSAtMSkgcmV0dXJuIHRydWU7CgogICAgdmFyIF9nZXRTdGF0ZTggPSBnZXRTdGF0ZSgpLAogICAgICAgIF9hZGRyZXNzID0gX2dldFN0YXRlOC51c2VyLmV0aERhdGEuYWRkcmVzczsKCiAgICByZXR1cm4gYWRkciA9PT0gX2FkZHJlc3M7CiAgfQoKICBpZiAoYWN0aW9ucy5idGMuZ2V0QWxsTXlBZGRyZXNzZXMoKS5pbmRleE9mKGFkZHIudG9Mb3dlckNhc2UoKSkgIT09IC0xKSByZXR1cm4gdHJ1ZTsKICBpZiAoYWN0aW9ucy5naG9zdC5nZXRBbGxNeUFkZHJlc3NlcygpLmluZGV4T2YoYWRkci50b0xvd2VyQ2FzZSgpKSAhPT0gLTEpIHJldHVybiB0cnVlOwogIGlmIChhY3Rpb25zLm5leHQuZ2V0QWxsTXlBZGRyZXNzZXMoKS5pbmRleE9mKGFkZHIudG9Mb3dlckNhc2UoKSkgIT09IC0xKSByZXR1cm4gdHJ1ZTsKICBpZiAoYWN0aW9ucy5ldGguZ2V0QWxsTXlBZGRyZXNzZXMoKS5pbmRleE9mKGFkZHIudG9Mb3dlckNhc2UoKSkgIT09IC0xKSByZXR1cm4gdHJ1ZTsKICBpZiAobWV0YW1hc2sgJiYgbWV0YW1hc2suaXNFbmFibGVkKCkgJiYgbWV0YW1hc2suaXNDb25uZWN0ZWQoKSAmJiBtZXRhbWFzay5nZXRBZGRyZXNzKCkudG9Mb3dlckNhc2UoKSA9PSBhZGRyLnRvTG93ZXJDYXNlKCkpIHJldHVybiB0cnVlOwogIHZhciBuYW1lID0gIiIuY29uY2F0KGN1cnJlbmN5LnRvTG93ZXJDYXNlKCksICJEYXRhIik7CgogIHZhciBfZ2V0U3RhdGU5ID0gZ2V0U3RhdGUoKSwKICAgICAgdXNlciA9IF9nZXRTdGF0ZTkudXNlcjsKCiAgaWYgKCF1c2VyW25hbWVdKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB2YXIgYWRkcmVzcyA9IHVzZXJbbmFtZV0uYWRkcmVzczsKCiAgaWYgKCFhZGRyZXNzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gYWRkciA9PT0gYWRkcmVzczsKfTsKCnZhciBkb3dubG9hZFByaXZhdGVLZXlzID0gZnVuY3Rpb24gZG93bmxvYWRQcml2YXRlS2V5cygpIHsKICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICB2YXIgdGV4dCA9IGdldFRleHQoKTsKICB2YXIgbWVzc2FnZSA9ICdDaGVjayB5b3VyIGJyb3dzZXIgZG93bmxvYWRzJzsKICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsICJkYXRhOnRleHQvcGxhaW5jaGFyc2V0PXV0Zi04LCIuY29uY2F0KGVuY29kZVVSSUNvbXBvbmVudCh0ZXh0KSkpOwogIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsICIiLmNvbmNhdCh3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUsICJfa2V5c18iKS5jb25jYXQobW9tZW50KCkuZm9ybWF0KCdERC5NTS5ZWVlZJyksICIudHh0IikpOwogIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpOwogIGVsZW1lbnQuY2xpY2soKTsKICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW1lbnQpOwogIGFjdGlvbnMubm90aWZpY2F0aW9ucy5zaG93KGNvbnN0YW50cy5ub3RpZmljYXRpb25zLk1lc3NhZ2UsIHsKICAgIG1lc3NhZ2U6IG1lc3NhZ2UKICB9KTsgLy9ACgogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGNvbnN0YW50cy5sb2NhbFN0b3JhZ2UucHJpdmF0ZUtleXNTYXZlZCwgdHJ1ZSk7Cn07Cgp3aW5kb3cuZG93bmxvYWRQcml2YXRlS2V5cyA9IGRvd25sb2FkUHJpdmF0ZUtleXM7Cgp2YXIgZ2V0QXV0aERhdGEgPSBmdW5jdGlvbiBnZXRBdXRoRGF0YShuYW1lKSB7CiAgdmFyIF9nZXRTdGF0ZTEwID0gZ2V0U3RhdGUoKSwKICAgICAgdXNlciA9IF9nZXRTdGF0ZTEwLnVzZXI7CgogIHJldHVybiB1c2VyWyIiLmNvbmNhdChuYW1lLCAiRGF0YSIpXTsKfTsgLy8gY29uc3QgYWRkTWVzc2FnaW5nVG9rZW4gPSAodG9rZW4pID0+IHsKLy8gICBjb25zb2xlLmxvZygiQWRkZWQgZmlyZWJhc2UgdG9rZW4gdG8gcmVkdXggc3RvcmU6ICIsIHRva2VuKQovLyAgIHJlZHVjZXJzLnVzZXIuYWRkTWVzc2FnaW5nVG9rZW4oeyB0b2tlbiB9KQovLyB9CgoKZXhwb3J0IGRlZmF1bHQgewogIHNpZ246IHNpZ24sCiAgc2lnbl9idGNfMmZhOiBzaWduX2J0Y18yZmEsCiAgc2lnbl9idGNfcGluOiBzaWduX2J0Y19waW4sCiAgc2lnbl9idGNfbXVsdGlzaWc6IHNpZ25fYnRjX211bHRpc2lnLAogIHNpZ25fdG9fdG9rZW5zOiBzaWduX3RvX3Rva2VucywKICBnZXRCYWxhbmNlczogZ2V0QmFsYW5jZXMsCiAgZ2V0RGVtb01vbmV5OiBnZXREZW1vTW9uZXksCiAgc2V0VHJhbnNhY3Rpb25zOiBzZXRUcmFuc2FjdGlvbnMsCiAgZG93bmxvYWRQcml2YXRlS2V5czogZG93bmxvYWRQcml2YXRlS2V5cywKICBnZXRUZXh0OiBnZXRUZXh0LAogIGlzT3duZXI6IGlzT3duZXIsCiAgZ2V0RXhjaGFuZ2VSYXRlOiBnZXRFeGNoYW5nZVJhdGUsCiAgZ2V0UmVwdXRhdGlvbjogZ2V0UmVwdXRhdGlvbiwKICBnZXRJbmZvQWJvdXRDdXJyZW5jeTogZ2V0SW5mb0Fib3V0Q3VycmVuY3ksCiAgZ2V0QXV0aERhdGE6IGdldEF1dGhEYXRhLAogIGdldFdpdGhkcmF3V2FsbGV0OiBnZXRXaXRoZHJhd1dhbGxldCwKICBmZXRjaE11bHRpc2lnU3RhdHVzOiBmZXRjaE11bHRpc2lnU3RhdHVzLAogIHB1bGxBY3RpdmVDdXJyZW5jeTogcHVsbEFjdGl2ZUN1cnJlbmN5IC8vIGFkZE1lc3NhZ2luZ1Rva2VuLAoKfTs="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/redux/actions/user.ts"],"names":["config","moment","constants","ethToken","request","actions","getState","reducers","bip39","getActivatedCurrencies","getCurrencyKey","metamask","initReducerState","user","activeCurrency","activeFiat","setActiveCurrency","setActiveFiat","window","DEFAULT_FIAT","sign_btc_multisig","btcPrivateKey","btcMultisigOwnerKey","localStorage","getItem","privateKeyNames","btcMultisigOtherOwnerKey","JSON","parse","e","_btcMultisigPrivateKey","btcmultisig","login_USER","signToUserMultisig","sign_btc_2fa","btcSMSServerKey","swapContract","protectedBtcKey","btcSmsPublicKeys","btcSmsMnemonicKey","console","error","Array","length","push","_btcMultisigSMSPrivateKey","login_SMS","sign_btc_pin","btcPinServerKey","btcPinKey","btcPinPublicKeys","btcPinMnemonicKey","log","_btcMultisigPinPrivateKey","login_PIN","sign","web3connect","onInit","mnemonic","twentywords","generateMnemonic","setItem","mnemonicKeys","btc","btcMnemonic","btcSms","btcSmsMnemonicKeyGenerated","eth","ethMnemonic","ghost","ghostMnemonic","next","nextMnemonic","sweepToMnemonic","getSmsKeyFromMnemonic","btcNewSmsMnemonicKey","btcSmsMnemonicKeyMnemonic","stringify","btcNewMultisigOwnerKey","btcMultisigOtherOwnerKeyMnemonic","btcMultisigPrivateKey","btcMultisig","ethPrivateKey","ghostPrivateKey","nextPrivateKey","_ethPrivateKey","login","_btcPrivateKey","_ghostPrivateKey","_nextPrivateKey","Object","keys","erc20","forEach","name","token","address","decimals","fullName","setTokenSigned","getReputation","sign_to_tokens","btcReputationPromise","ethReputationPromise","ghostReputationPromise","nextReputationPromise","Promise","all","then","btcReputation","ethReputation","ghostReputation","nextReputation","totalReputation","Number","isInteger","pubsubRoom","set","reputation","getBalances","isTokenSigned","setIsBalanceFetching","isBalanceFetching","resolve","balances","isEnabled","isConnected","func","getBalance","getBalanceUser","getBalancePin","fetchMultisigBalances","obj","setTimeout","customRate","cur","wTokens","widgetERC20Tokens","dataobj","find","el","toLowerCase","customEcxchangeRate","getExchangeRate","sellCurrency","buyCurrency","sellDataRate","buyDataRate","reject","dataKey","infoAboutCurrency","price_fiat","tokensData","currencyData","getDemoMoney","process","env","MAINNET","get","r","clear","demoMoneyReceived","location","reload","getInfoAboutCurrency","currencyNames","hasCustomRate","url","setIsFetching","isFetching","fiat","opts","cacheResponse","query","tokens","join","answer","infoAboutBTC","data","filter","currencyInfo","symbol","btcPrice","quote","price","map","currencyInfoItem","includes","priceInBtc","ownPrice","price_btc","setInfoAboutCurrency","isEthToken","setInfoAboutToken","clearTransactions","history","setTransactions","mergeTransactions","mergeTxs","transactions","concat","sort","a","b","date","item","pullTransactions","pullActiveCurrency","currency","delay","ms","fetchMultisigStatus","btcMultisigUserData","mainAddress","wallets","multisigTx","fetch","index","objCurrency","isBtcSweeped","isSweeped","isEthSweeped","isGhostSweeped","isNextSweeped","hiddenCoinsList","core","enabledCurrencies","fetchTxsPromises","getTransaction","getSweepAddress","getTransactionSMS","getTransactionPIN","getTransactionUser","getAddress","key","toUpperCase","txPromise","txList","ercTxs","getText","ethData","btcData","ghostData","nextData","text","hostname","privateKey","getWithdrawWallet","addr","needType","filtered","getWallets","wallet","walletType","isOwner","getAllMyAddresses","indexOf","downloadPrivateKeys","element","document","createElement","message","setAttribute","encodeURIComponent","format","style","display","body","appendChild","click","removeChild","notifications","show","Message","privateKeysSaved","getAuthData"],"mappings":";;;;;;;;;;AAAA;AACA,OAAOA,MAAP,MAAmB,YAAnB;AACA,OAAOC,MAAP,MAAmB,eAAnB;AACA,SAASC,SAAT,EAAoBC,QAApB,QAAoC,SAApC;AACA,OAAOC,OAAP,MAAoB,sBAApB;AAEA,OAAOC,OAAP,MAAoB,eAApB;AACA,SAASC,QAAT,QAAyB,YAAzB;AAEA,OAAOC,QAAP,MAAqB,qBAArB;AACA,OAAO,KAAKC,KAAZ,MAAuB,OAAvB;AAEA,SAASC,sBAAT,QAAuC,cAAvC;AACA,OAAOC,cAAP,MAA2B,wBAA3B;AACA,OAAOC,QAAP,MAAqB,kBAArB;;AAKA;AACA;AACA;AACA;AACA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAM;AAAA,kBAMzBN,QAAQ,EANiB;AAAA,iCAE3BO,IAF2B;AAAA,MAGzBC,cAHyB,kBAGzBA,cAHyB;AAAA,MAIzBC,UAJyB,kBAIzBA,UAJyB;;AAQ7B,MAAI,CAACD,cAAL,EAAqBP,QAAQ,CAACM,IAAT,CAAcG,iBAAd,CAAgC;AAAEF,IAAAA,cAAc,EAAE;AAAlB,GAAhC;AACrB,MAAI,CAACC,UAAL,EAAiBR,QAAQ,CAACM,IAAT,CAAcI,aAAd,CAA4B;AAAEF,IAAAA,UAAU,EAAEG,MAAM,CAACC,YAAP,IAAuB;AAArC,GAA5B;AAClB,CAVD;;AAYA,IAAMC,iBAAiB;AAAA,sEAAG,iBAAOC,aAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AACpBC,YAAAA,mBADoB,GACEC,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0BC,wBAA/C,CADF;;AAExB,gBAAI;AAAEJ,cAAAA,mBAAmB,GAAGK,IAAI,CAACC,KAAL,CAAWN,mBAAX,CAAtB;AAAuD,aAA7D,CAA8D,OAAOO,CAAP,EAAU,CAAG,CAFnD,CAGxB;;;AACMC,YAAAA,sBAJkB,GAIOzB,OAAO,CAAC0B,WAAR,CAAoBC,UAApB,CAA+BX,aAA/B,EAA8CC,mBAA9C,CAJP;AAAA;AAAA,mBAKlBjB,OAAO,CAAC0B,WAAR,CAAoBE,kBAApB,EALkB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAjBb,iBAAiB;AAAA;AAAA;AAAA,GAAvB;;AASA,IAAMc,YAAY;AAAA,uEAAG,kBAAOb,aAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AACbc,YAAAA,eADa,GACKnC,MAAM,CAACoC,YAAP,CAAoBC,eADzB;AAEfC,YAAAA,gBAFe,GAEI,CAACH,eAAD,CAFJ;AAGfI,YAAAA,iBAHe,GAGkBhB,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0Bc,iBAA/C,CAHlB;;AAKnB,gBAAI;AACFA,cAAAA,iBAAiB,GAAGZ,IAAI,CAACC,KAAL,CAAWW,iBAAX,CAApB;AACD,aAFD,CAEE,OAAOV,CAAP,EAAU;AACVW,cAAAA,OAAO,CAACC,KAAR,CAAcZ,CAAd;AACD;;AAED,gBAAIU,iBAAiB,YAAYG,KAA7B,IAAsCH,iBAAiB,CAACI,MAAlB,GAA2B,CAArE,EAAwE;AACtEL,cAAAA,gBAAgB,CAACM,IAAjB,CAAsBL,iBAAiB,CAAC,CAAD,CAAvC;AACD;;AACKM,YAAAA,yBAda,GAcexC,OAAO,CAAC0B,WAAR,CAAoBe,SAApB,CAA8BzB,aAA9B,EAA6CiB,gBAA7C,CAdf;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAZJ,YAAY;AAAA;AAAA;AAAA,GAAlB;;AAiBA,IAAMa,YAAY;AAAA,uEAAG,kBAAO1B,aAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AACb2B,YAAAA,eADa,GACKhD,MAAM,CAACoC,YAAP,CAAoBa,SADzB;AAEfC,YAAAA,gBAFe,GAEI,CAACF,eAAD,CAFJ;AAGfG,YAAAA,iBAHe,GAGkB5B,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B0B,iBAA/C,CAHlB;;AAKnB,gBAAI;AACFA,cAAAA,iBAAiB,GAAGxB,IAAI,CAACC,KAAL,CAAWuB,iBAAX,CAApB;AACD,aAFD,CAEE,OAAOtB,CAAP,EAAU;AACVW,cAAAA,OAAO,CAACC,KAAR,CAAcZ,CAAd;AACD;;AAED,gBAAIsB,iBAAiB,YAAYT,KAA7B,IAAsCS,iBAAiB,CAACR,MAAlB,GAA2B,CAArE,EAAwE;AACtEO,cAAAA,gBAAgB,CAACN,IAAjB,CAAsBO,iBAAiB,CAAC,CAAD,CAAvC;AACD;;AAEDX,YAAAA,OAAO,CAACY,GAAR,CAAY,iBAAZ,EAA+BF,gBAA/B;AACMG,YAAAA,yBAhBa,GAgBehD,OAAO,CAAC0B,WAAR,CAAoBuB,SAApB,CAA8BjC,aAA9B,EAA6C6B,gBAA7C,CAhBf;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAZH,YAAY;AAAA;AAAA;AAAA,GAAlB;;AAmBA,IAAMQ,IAAI;AAAA,uEAAG;AAAA;AAAA;AAAA;AAAA;AACX5C,YAAAA,QAAQ,CAAC6C,WAAT,CAAqBC,MAArB,wEAA6B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAC3B7C,sBAAAA,gBAAgB;AAEZ8C,sBAAAA,QAHuB,GAGZnC,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0BkC,WAA/C,CAHY;;AAK3B,0BAAI,CAACD,QAAL,EAAe;AACbA,wBAAAA,QAAQ,GAAGlD,KAAK,CAACoD,gBAAN,EAAX;AACArC,wBAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0BkC,WAA/C,EAA4DD,QAA5D;AACD;;AAEKI,sBAAAA,YAVqB,GAUN;AACnBC,wBAAAA,GAAG,EAAExC,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0BuC,WAA/C,CADc;AAEnBC,wBAAAA,MAAM,EAAE1C,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0ByC,0BAA/C,CAFW;AAGnBC,wBAAAA,GAAG,EAAE5C,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B2C,WAA/C,CAHc;AAInBC,wBAAAA,KAAK,EAAE9C,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B6C,aAA/C,CAJY;AAKnBC,wBAAAA,IAAI,EAAEhD,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B+C,YAA/C;AALa,uBAVM;AAiB3BhC,sBAAAA,OAAO,CAACY,GAAR,CAAY,qBAAZ,EAAmCU,YAAnC,EAAiDJ,QAAjD;;AACA,0BAAIA,QAAQ,QAAZ,EAAsB;AACpB;AACA,4BAAI,CAACI,YAAY,CAACC,GAAlB,EAAuBD,YAAY,CAACC,GAAb,GAAmB1D,OAAO,CAAC0D,GAAR,CAAYU,eAAZ,CAA4Bf,QAA5B,CAAnB,CAFH,CAGpB;;AACA,4BAAI,CAACI,YAAY,CAACK,GAAlB,EAAuBL,YAAY,CAACK,GAAb,GAAmB9D,OAAO,CAAC8D,GAAR,CAAYM,eAAZ,CAA4Bf,QAA5B,CAAnB,CAJH,CAKpB;;AACA,4BAAI,CAACI,YAAY,CAACO,KAAlB,EAAyBP,YAAY,CAACO,KAAb,GAAqBhE,OAAO,CAACgE,KAAR,CAAcI,eAAd,CAA8Bf,QAA9B,CAArB,CANL,CAOlB;;AACF,4BAAI,CAACI,YAAY,CAACS,IAAlB,EAAwBT,YAAY,CAACS,IAAb,GAAoBlE,OAAO,CAACkE,IAAR,CAAaE,eAAb,CAA6Bf,QAA7B,CAApB;;AACxB,4BAAI,CAACI,YAAY,CAACG,MAAlB,EAA0B;AACxBH,0BAAAA,YAAY,CAACG,MAAb,GAAsB5D,OAAO,CAAC0B,WAAR,CAAoB2C,qBAApB,CAA0ChB,QAA1C,CAAtB;AACAnC,0BAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0ByC,0BAA/C,EAA2EJ,YAAY,CAACG,MAAxF;AACD;AACF,uBA/B0B,CAgC3B;;;AACIU,sBAAAA,oBAjCuB,GAiCapD,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0BmD,yBAA/C,CAjCb;;AAmC3B,0BAAI;AACFD,wBAAAA,oBAAoB,GAAGhD,IAAI,CAACC,KAAL,CAAW+C,oBAAX,CAAvB;AACD,uBAFD,CAEE,OAAO9C,CAAP,EAAU;AACVW,wBAAAA,OAAO,CAACC,KAAR,CAAcZ,CAAd;AACD;;AAED,0BAAI,EAAE8C,oBAAoB,YAAYjC,KAAlC,CAAJ,EAA8C;AAC5CnB,wBAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0BmD,yBAA/C,EAA0EjD,IAAI,CAACkD,SAAL,CAAe,EAAf,CAA1E;AACD;;AAEGC,sBAAAA,sBA7CuB,GA6CevD,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0BsD,gCAA/C,CA7Cf;;AA+C3B,0BAAI;AACFD,wBAAAA,sBAAsB,GAAGnD,IAAI,CAACC,KAAL,CAAWkD,sBAAX,CAAzB;AACD,uBAFD,CAEE,OAAOjD,CAAP,EAAU;AACVW,wBAAAA,OAAO,CAACC,KAAR,CAAcZ,CAAd;AACD;;AAED,0BAAI,EAAEiD,sBAAsB,YAAYpC,KAApC,CAAJ,EAAgD;AAC9CnB,wBAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0BsD,gCAA/C,EAAiFpD,IAAI,CAACkD,SAAL,CAAe,EAAf,CAAjF;AACD;;AAEKxD,sBAAAA,aAzDqB,GAyDLE,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0BsC,GAA/C,CAzDK;AA0DrBiB,sBAAAA,qBA1DqB,GA0DGzD,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0BwD,WAA/C,CA1DH;AA2DrBC,sBAAAA,aA3DqB,GA2DL3D,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B0C,GAA/C,CA3DK;AA4DrBgB,sBAAAA,eA5DqB,GA4DH5D,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B4C,KAA/C,CA5DG;AA6DrBe,sBAAAA,cA7DqB,GA6DJ7D,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B8C,IAA/C,CA7DI;AAgErBc,sBAAAA,cAhEqB,GAgEJhF,OAAO,CAAC8D,GAAR,CAAYmB,KAAZ,CAAkBJ,aAAlB,EAAiCxB,QAAjC,EAA2CI,YAA3C,CAhEI;AAiErByB,sBAAAA,cAjEqB,GAiEJlF,OAAO,CAAC0D,GAAR,CAAYuB,KAAZ,CAAkBjE,aAAlB,EAAiCqC,QAAjC,EAA2CI,YAA3C,CAjEI;AAkErB0B,sBAAAA,gBAlEqB,GAkEFnF,OAAO,CAACgE,KAAR,CAAciB,KAAd,CAAoBH,eAApB,EAAqCzB,QAArC,EAA+CI,YAA/C,CAlEE;AAmErB2B,sBAAAA,eAnEqB,GAmEHpF,OAAO,CAACkE,IAAR,CAAae,KAAb,CAAmBF,cAAnB,EAAmC1B,QAAnC,EAA6CI,YAA7C,CAnEG,EAqE3B;;AArE2B;AAAA,6BAsErB5B,YAAY,CAACqD,cAAD,CAtES;;AAAA;AAAA;AAAA,6BAyErBnE,iBAAiB,CAACmE,cAAD,CAzEI;;AAAA;AAAA;AAAA,6BA4ErBxC,YAAY,CAACwC,cAAD,CA5ES;;AAAA;AA8E3B;AACA;AACA;AACAG,sBAAAA,MAAM,CAACC,IAAP,CAAY3F,MAAM,CAAC4F,KAAnB,EACGC,OADH,CACW,UAAAC,IAAI,EAAI;AACfzF,wBAAAA,OAAO,CAAC0F,KAAR,CAAcT,KAAd,CAAoBD,cAApB,EAAoCrF,MAAM,CAAC4F,KAAP,CAAaE,IAAb,EAAmBE,OAAvD,EAAgEF,IAAhE,EAAsE9F,MAAM,CAAC4F,KAAP,CAAaE,IAAb,EAAmBG,QAAzF,EAAmGjG,MAAM,CAAC4F,KAAP,CAAaE,IAAb,EAAmBI,QAAtH;AACD,uBAHH,EAjF2B,CAqF3B;;AACA3F,sBAAAA,QAAQ,CAACM,IAAT,CAAcsF,cAAd,CAA6B,IAA7B,EAtF2B,CAwF3B;;AAxF2B;AAAA,6BA0FrBC,aAAa,EA1FQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAA7B;;AADW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAJ7C,IAAI;AAAA;AAAA;AAAA,GAAV;;AA+FA,IAAM8C,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAC3B,MAAMnB,aAAa,GAAG3D,YAAY,CAACC,OAAb,CAAqBtB,SAAS,CAACuB,eAAV,CAA0B0C,GAA/C,CAAtB;AACAuB,EAAAA,MAAM,CAACC,IAAP,CAAY3F,MAAM,CAAC4F,KAAnB,EACGC,OADH,CACW,UAAAC,IAAI,EAAI;AACfzF,IAAAA,OAAO,CAAC0F,KAAR,CAAcT,KAAd,CAAoBJ,aAApB,EAAmClF,MAAM,CAAC4F,KAAP,CAAaE,IAAb,EAAmBE,OAAtD,EAA+DF,IAA/D,EAAqE9F,MAAM,CAAC4F,KAAP,CAAaE,IAAb,EAAmBG,QAAxF,EAAkGjG,MAAM,CAAC4F,KAAP,CAAaE,IAAb,EAAmBI,QAArH;AACD,GAHH;AAID,CAND;;AAQA,IAAME,aAAa;AAAA,uEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAEdE,YAAAA,oBAFc,GAESjG,OAAO,CAAC0D,GAAR,CAAYqC,aAAZ,EAFT;AAGdG,YAAAA,oBAHc,GAGSlG,OAAO,CAAC8D,GAAR,CAAYiC,aAAZ,EAHT;AAIdI,YAAAA,sBAJc,GAIWnG,OAAO,CAACgE,KAAR,CAAc+B,aAAd,EAJX;AAKdK,YAAAA,qBALc,GAKUpG,OAAO,CAACkE,IAAR,CAAa6B,aAAb,EALV;AAOpBM,YAAAA,OAAO,CAACC,GAAR,CAAY,CACVL,oBADU,EAEVC,oBAFU,EAGVC,sBAHU,EAIVC,qBAJU,CAAZ,EAMGG,IANH,CAMQ,iBAAqE;AAAA;AAAA,kBAAnEC,aAAmE;AAAA,kBAApDC,aAAoD;AAAA,kBAArCC,eAAqC;AAAA,kBAApBC,cAAoB;;AACzE,kBAAMC,eAAe,GAAGC,MAAM,CAACL,aAAD,CAAN,GAAwBK,MAAM,CAACJ,aAAD,CAA9B,GAAgDI,MAAM,CAACH,eAAD,CAAtD,GAA0EG,MAAM,CAACF,cAAD,CAAxG;;AAEA,kBAAIE,MAAM,CAACC,SAAP,CAAiBF,eAAjB,CAAJ,EAAuC;AACrC1G,gBAAAA,QAAQ,CAAC6G,UAAT,CAAoBC,GAApB,CAAwB;AAAEC,kBAAAA,UAAU,EAAEL;AAAd,iBAAxB;AACD,eAFD,MAEO;AACL1G,gBAAAA,QAAQ,CAAC6G,UAAT,CAAoBC,GAApB,CAAwB;AAAEC,kBAAAA,UAAU,EAAE;AAAd,iBAAxB;AACD;AACF,aAdH,WAeS,UAAC7E,KAAD,EAAW;AAChBD,cAAAA,OAAO,CAACC,KAAR,uBAAoCA,KAApC;AACD,aAjBH;;AAPoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAb2D,aAAa;AAAA;AAAA;AAAA,GAAnB;;AA4BA,IAAMmB,WAAW,GAAG,SAAdA,WAAc,GAAM;AAAA,mBAKpBjH,QAAQ,EALY;AAAA,MAGpBkH,aAHoB,cAEtB3G,IAFsB,CAGpB2G,aAHoB;;AAOxBjH,EAAAA,QAAQ,CAACM,IAAT,CAAc4G,oBAAd,CAAmC;AAAEC,IAAAA,iBAAiB,EAAE;AAArB,GAAnC;AAEA,SAAO,IAAIhB,OAAJ;AAAA,yEAAY,kBAAOiB,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACXC,cAAAA,QADW,gCAEXjH,QAAQ,CAACkH,SAAT,MAAwBlH,QAAQ,CAACmH,WAAT,EAAzB,GACC,CAAE;AAAEC,gBAAAA,IAAI,EAAEpH,QAAQ,CAACqH,UAAjB;AAA6BlC,gBAAAA,IAAI,EAAE;AAAnC,eAAF,CADD,GAEC,EAJW,IAKf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAAC8D,GAAR,CAAY6D,UAApB;AAAgClC,gBAAAA,IAAI,EAAE;AAAtC,eALe,EAMf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAAC0D,GAAR,CAAYiE,UAApB;AAAgClC,gBAAAA,IAAI,EAAE;AAAtC,eANe,EAOf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAACgE,KAAR,CAAc2D,UAAtB;AAAkClC,gBAAAA,IAAI,EAAE;AAAxC,eAPe,EAQf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAACkE,IAAR,CAAayD,UAArB;AAAiClC,gBAAAA,IAAI,EAAE;AAAvC,eARe,EASf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAAC0B,WAAR,CAAoBiG,UAA5B;AAAwClC,gBAAAA,IAAI,EAAE;AAA9C,eATe,EAUf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAAC0B,WAAR,CAAoBkG,cAA5B;AAA4CnC,gBAAAA,IAAI,EAAE;AAAlD,eAVe,EAWf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAAC0B,WAAR,CAAoBmG,aAA5B;AAA2CpC,gBAAAA,IAAI,EAAE;AAAjD,eAXe,EAYf;AAAEiC,gBAAAA,IAAI,EAAE1H,OAAO,CAAC0B,WAAR,CAAoBoG,qBAA5B;AAAmDrC,gBAAAA,IAAI,EAAE;AAAzD,eAZe;AAejB8B,cAAAA,QAAQ,CAAC/B,OAAT;AAAA,sFAAiB,kBAAOuC,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAEPA,GAAG,CAACL,IAAJ,EAFO;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAIbvF,0BAAAA,OAAO,CAACC,KAAR,CAAc,wBAAd,EAAwC2F,GAAG,CAACtC,IAA5C;;AAJa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAjB;;AAAA;AAAA;AAAA;AAAA;;AAQA,kBAAI0B,aAAJ,EAAmB;AACjB;AACAa,gBAAAA,UAAU,CAAC,YAAM;AACf;AACA3C,kBAAAA,MAAM,CAACC,IAAP,CAAY3F,MAAM,CAAC4F,KAAnB,EACGC,OADH;AAAA,0FACW,kBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAECzF,OAAO,CAAC0F,KAAR,CAAciC,UAAd,CAAyBlC,IAAzB,CAFD;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAKLtD,8BAAAA,OAAO,CAACC,KAAR,CAAc,8BAAd,EAA8CqD,IAA9C;;AALK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADX;;AAAA;AAAA;AAAA;AAAA;AASD,iBAXS,CAAV;AAYD;;AAEDvF,cAAAA,QAAQ,CAACM,IAAT,CAAc4G,oBAAd,CAAmC;AAAEC,gBAAAA,iBAAiB,EAAE;AAArB,eAAnC;AACAC,cAAAA,OAAO,CAAC,IAAD,CAAP;;AAxCiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAZ;;AAAA;AAAA;AAAA;AAAA,MAAP;AA0CD,CAnDD;;AAqDA,IAAMW,UAAU,GAAG,SAAbA,UAAa,CAACC,GAAD,EAAS;AAC1B,MAAMC,OAAO,GAAGtH,MAAM,CAACuH,iBAAvB;AAEA,MAAMC,OAAO,GAAGF,OAAO,IAAI9C,MAAM,CAACC,IAAP,CAAY6C,OAAZ,EAAqBG,IAArB,CAA0B,UAAAC,EAAE;AAAA,WAAIA,EAAE,KAAKL,GAAG,CAACM,WAAJ,EAAX;AAAA,GAA5B,CAA3B;AACA,SAAOH,OAAO,GAAG,CAACF,OAAO,CAACE,OAAD,CAAP,IAAoB;AAAEI,IAAAA,mBAAmB,EAAE;AAAvB,GAArB,EAAoDA,mBAAvD,GAA6E,IAA3F;AACD,CALD;;AAOA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,YAAD,EAAeC,WAAf,EAAgD;AACtE,MAAMC,YAAY,GAAGZ,UAAU,CAACU,YAAD,CAA/B;AACA,MAAMG,WAAW,GAAGb,UAAU,CAACW,WAAD,CAA9B;;AAFsE,mBAMlE3I,QAAQ,EAN0D;AAAA,MAKpEO,IALoE,cAKpEA,IALoE;;AAQtE,SAAO,IAAI6F,OAAJ,CAAY,UAACiB,OAAD,EAAUyB,MAAV,EAAqB;AAEtC,QAAIF,YAAJ,EAAkB;AAChBvB,MAAAA,OAAO,CAACuB,YAAD,CAAP;AACA;AACD;;AAED,QAAIC,WAAJ,EAAiB;AACfxB,MAAAA,OAAO,CAAC,IAAIwB,WAAL,CAAP;AACA;AACD;;AAED,QAAIE,OAAO,GAAGL,YAAY,CAACH,WAAb,EAAd;;AACA,YAAQG,YAAY,CAACH,WAAb,EAAR;AACE,WAAK,qBAAL;AACA,WAAK,gBAAL;AACA,WAAK,qBAAL;AACEQ,QAAAA,OAAO,GAAG,KAAV;AACA;;AACF;AANF;;AASA,QAAKxI,IAAI,WAAIwI,OAAJ,UAAJ,IACAxI,IAAI,WAAIwI,OAAJ,UAAJ,CAAuBC,iBADvB,IAEAzI,IAAI,WAAIwI,OAAJ,UAAJ,CAAuBC,iBAAvB,CAAyCC,UAF1C,IAIA1I,IAAI,CAAC2I,UAAL,CAAgBH,OAAhB,KACGxI,IAAI,CAAC2I,UAAL,CAAgBH,OAAhB,EAAyBC,iBAD5B,IAEGzI,IAAI,CAAC2I,UAAL,CAAgBH,OAAhB,EAAyBC,iBAAzB,CAA2CC,UANlD,EAQE;AACA,UAAME,YAAY,GAAI5I,IAAI,CAAC2I,UAAL,CAAgBH,OAAhB,KAA4BxI,IAAI,CAAC2I,UAAL,CAAgBH,OAAhB,EAAyBC,iBAAtD,GACjBzI,IAAI,CAAC2I,UAAL,CAAgBH,OAAhB,CADiB,GAEjBxI,IAAI,WAAIwI,OAAJ,UAFR;AAIA1B,MAAAA,OAAO,CAAC8B,YAAY,CAACH,iBAAb,CAA+BC,UAAhC,CAAP;AACD,KAdD,MAcO;AACL5B,MAAAA,OAAO,CAAC,CAAD,CAAP;AACD;AACF,GAvCM,CAAP;AAwCD,CAhDD;;AAkDA,IAAM+B,YAAY,GAAGC,OAAO,CAACC,GAAR,CAAYC,OAAZ,GAAsB,YAAM,CAAG,CAA/B,GAAkC,YAAM;AAC3D;AACAzJ,EAAAA,OAAO,CAAC0J,GAAR,CAAY,qCAAZ,EAAmD,EAAnD,EACGlD,IADH,CACQ,UAACmD,CAAD,EAAO;AACX7I,IAAAA,MAAM,CAACK,YAAP,CAAoByI,KAApB;AACAzI,IAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0BsC,GAA/C,EAAoDgG,CAAC,CAAC,CAAD,CAArD;AACAxI,IAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0B0C,GAA/C,EAAoD4F,CAAC,CAAC,CAAD,CAArD;AACAxI,IAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0B4C,KAA/C,EAAsD0F,CAAC,CAAC,CAAD,CAAvD;AACAxI,IAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACuB,eAAV,CAA0B8C,IAA/C,EAAqDwF,CAAC,CAAC,CAAD,CAAtD,EALW,CAMX;;AACAxI,IAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACqB,YAAV,CAAuB0I,iBAA5C,EAA+D,IAA/D;AACA/I,IAAAA,MAAM,CAACgJ,QAAP,CAAgBC,MAAhB;AACD,GAVH;AAWD,CAbD;;AAgBA,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,aAAD;AAAA,SAE3B,IAAI3D,OAAJ,CAAY,UAACiB,OAAD,EAAUyB,MAAV,EAAqB;AAE/B,QAAMkB,aAAa,GAAG,SAAhBA,aAAgB,CAAC/B,GAAD,EAAS;AAC7B,UAAMG,OAAO,GAAGhD,MAAM,CAACC,IAAP,CAAY3F,MAAM,CAAC4F,KAAnB,EAA0B+C,IAA1B,CAA+B,UAAAC,EAAE;AAAA,eAAIA,EAAE,CAACC,WAAH,OAAqBN,GAAG,CAACM,WAAJ,EAAzB;AAAA,OAAjC,CAAhB;AACA,aAAOH,OAAO,GAAG,CAAC1I,MAAM,CAAC4F,KAAP,CAAa8C,OAAb,KAAyB;AAAEI,QAAAA,mBAAmB,EAAE;AAAvB,OAA1B,EAA0DA,mBAA7D,GAAmF,KAAjG;AACD,KAHD;;AAKA,QAAMyB,GAAG,GAAG,qCAAZ;AACAhK,IAAAA,QAAQ,CAACM,IAAT,CAAc2J,aAAd,CAA4B;AAAEC,MAAAA,UAAU,EAAE;AAAd,KAA5B;AAEA,QAAMC,IAAI,GAAI1K,MAAM,IAAIA,MAAM,CAAC2K,IAAjB,IAAyB3K,MAAM,CAAC2K,IAAP,CAAY5J,UAAtC,GAAoDf,MAAM,CAAC2K,IAAP,CAAY5J,UAAhE,QAAb;AAEAX,IAAAA,OAAO,CAAC0J,GAAR,CAAYS,GAAZ,EAAiB;AACfK,MAAAA,aAAa,EAAE,KAAK,EAAL,GAAU,IADV;AACgB;AAC/BC,MAAAA,KAAK,EAAE;AACLH,QAAAA,IAAI,EAAJA,IADK;AAELI,QAAAA,MAAM,EAAET,aAAa,CAACU,IAAd;AAFH;AAFQ,KAAjB,EAMGnE,IANH,CAMQ,UAACoE,MAAD,EAAiB;AACvB,UAAIC,YAAY,GAAGD,MAAM,CAACE,IAAP,CAAYC,MAAZ,CAAmB,UAAAC,YAAY,EAAI;AACpD,YAAIA,YAAY,CAACC,MAAb,CAAoBxC,WAApB,OAAsC,KAA1C,EAAiD,OAAO,IAAP;AAClD,OAFkB,CAAnB;AAIA,UAAMyC,QAAQ,GACZL,YAAY,IACTA,YAAY,CAACtI,MADhB,IAEGsI,YAAY,CAAC,CAAD,CAAZ,CAAgBM,KAFnB,IAGGN,YAAY,CAAC,CAAD,CAAZ,CAAgBM,KAAhB,CAAsBb,IAAtB,CAHH,IAIGO,YAAY,CAAC,CAAD,CAAZ,CAAgBM,KAAhB,CAAsBb,IAAtB,EAA4Bc,KALhB,GAMbP,YAAY,CAAC,CAAD,CAAZ,CAAgBM,KAAhB,CAAsBb,IAAtB,EAA4Bc,KANf,GAMuB,IANxC;AAQAR,MAAAA,MAAM,CAACE,IAAP,CAAYO,GAAZ,CAAgB,UAAAC,gBAAgB,EAAI;AAClC,YAAIrB,aAAa,CAACsB,QAAd,CAAuBD,gBAAgB,CAACL,MAAxC,CAAJ,EAAqD;AACnD,cAAIK,gBAAgB,CAACH,KAAjB,IAA0BG,gBAAgB,CAACH,KAAjB,CAAuBb,IAAvB,CAA9B,EAA4D;AAC1D,gBAAMkB,UAAU,GAAGF,gBAAgB,CAACH,KAAjB,CAAuBb,IAAvB,EAA6Bc,KAA7B,GAAqCF,QAAxD;AACA,gBAAMO,QAAQ,GAAGvB,aAAa,CAACoB,gBAAgB,CAACL,MAAlB,CAA9B;;AAEA,gBAAMD,YAAY,mCACbM,gBAAgB,CAACH,KAAjB,CAAuBb,IAAvB,CADa;AAEhBnB,cAAAA,UAAU,EAAGsC,QAAD,GAAaA,QAAb,GAAwBH,gBAAgB,CAACH,KAAjB,CAAuBb,IAAvB,EAA6Bc,KAFjD;AAGhBM,cAAAA,SAAS,EAAEF;AAHK,cAAlB;;AAMA,oBAAQF,gBAAgB,CAACL,MAAzB;AACE,mBAAK,KAAL;AAAY;AACV9K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,SAAR;AAAmBwD,oBAAAA,iBAAiB,EAAE8B;AAAtC,mBAAnC;AACA7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,iBAAR;AAA2BwD,oBAAAA,iBAAiB,EAAE8B;AAA9C,mBAAnC,EAFU,CAEuF;;AACjG7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,oBAAR;AAA8BwD,oBAAAA,iBAAiB,EAAE8B;AAAjD,mBAAnC;AACA7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,qBAAR;AAA+BwD,oBAAAA,iBAAiB,EAAE8B;AAAlD,mBAAnC;AACA7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,qBAAR;AAA+BwD,oBAAAA,iBAAiB,EAAE8B;AAAlD,mBAAnC;AACA7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,oBAAR;AAA8BwD,oBAAAA,iBAAiB,EAAE8B;AAAjD,mBAAnC;AACA;AACD;;AACD,mBAAK,KAAL;AAAY;AACV7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,SAAR;AAAmBwD,oBAAAA,iBAAiB,EAAE8B;AAAtC,mBAAnC;AACA7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,iBAAR;AAA2BwD,oBAAAA,iBAAiB,EAAE8B;AAA9C,mBAAnC,EAFU,CAEuF;;AACjG;AACD;;AACD,mBAAK,OAAL;AAAc;AACZ7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,WAAR;AAAqBwD,oBAAAA,iBAAiB,EAAE8B;AAAxC,mBAAnC;AACA7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,mBAAR;AAA6BwD,oBAAAA,iBAAiB,EAAE8B;AAAhD,mBAAnC,EAFY,CAEuF;;AACnG;AACD;;AACD,mBAAK,MAAL;AAAa;AACX7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,UAAR;AAAoBwD,oBAAAA,iBAAiB,EAAE8B;AAAvC,mBAAnC;AACA7K,kBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,oBAAAA,IAAI,EAAE,kBAAR;AAA4BwD,oBAAAA,iBAAiB,EAAE8B;AAA/C,mBAAnC,EAFW,CAEuF;;AAClG;AACD;;AACD;AAAS;AACP,sBAAIjL,QAAQ,CAAC6L,UAAT,CAAoB;AAAElG,oBAAAA,IAAI,EAAE4F,gBAAgB,CAACL;AAAzB,mBAApB,CAAJ,EAA4D;AAC1D9K,oBAAAA,QAAQ,CAACM,IAAT,CAAcoL,iBAAd,CAAgC;AAAEnG,sBAAAA,IAAI,EAAE4F,gBAAgB,CAACL,MAAjB,CAAwBxC,WAAxB,EAAR;AAA+CS,sBAAAA,iBAAiB,EAAE8B;AAAlE,qBAAhC;AACD,mBAFD,MAEO;AACL7K,oBAAAA,QAAQ,CAACM,IAAT,CAAckL,oBAAd,CAAmC;AAAEjG,sBAAAA,IAAI,YAAK4F,gBAAgB,CAACL,MAAjB,CAAwBxC,WAAxB,EAAL,SAAN;AAAwDS,sBAAAA,iBAAiB,EAAE8B;AAA3E,qBAAnC;AACD;;AACD;AACD;AAhCH;AAkCD;AACF;AACF,OAhDD;AAiDAzD,MAAAA,OAAO,CAAC,IAAD,CAAP;AACD,KArED,WAqES,UAAClF,KAAD,EAAW;AAClB2G,MAAAA,MAAM,CAAC3G,KAAD,CAAN;AACD,KAvED,aAuEW;AAAA,aAAMlC,QAAQ,CAACM,IAAT,CAAc2J,aAAd,CAA4B;AAAEC,QAAAA,UAAU,EAAE;AAAd,OAA5B,CAAN;AAAA,KAvEX;AAwED,GApFD,CAF2B;AAAA,CAA7B;;AAyFA,IAAMyB,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9B3L,EAAAA,QAAQ,CAAC4L,OAAT,CAAiBC,eAAjB,CAAiC,EAAjC;AACD,CAFD;;AAIA,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,QAAD,EAAqB;AAAA;;AAAA,mBAKzChM,QAAQ,EALiC;AAAA,MAGzCiM,YAHyC,cAE3CJ,OAF2C,CAGzCI,YAHyC;;AAM7C,MAAIrB,IAAI,GAAG,cAAGsB,MAAH,gBAAUD,YAAV,4BAA2BD,QAA3B,IAAqCG,IAArC,CAA0C,UAACC,CAAD,EAAIC,CAAJ;AAAA,WAAUA,CAAC,CAACC,IAAF,GAASF,CAAC,CAACE,IAArB;AAAA,GAA1C,EAAqEzB,MAArE,CAA4E,UAAC0B,IAAD;AAAA,WAAUA,IAAV;AAAA,GAA5E,CAAX;;AACAtM,EAAAA,QAAQ,CAAC4L,OAAT,CAAiBC,eAAjB,CAAiClB,IAAjC;AACD,CARD;;AAUA,IAAM4B,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAAP,YAAY,EAAI;AAAA;;AACvC,MAAIrB,IAAI,GAAG,cAAGsB,MAAH,gBAAU,EAAV,4BAAiBD,YAAjB,IAA+BE,IAA/B,CAAoC,UAACC,CAAD,EAAIC,CAAJ;AAAA,WAAUA,CAAC,CAACC,IAAF,GAASF,CAAC,CAACE,IAArB;AAAA,GAApC,EAA+DzB,MAA/D,CAAsE,UAAC0B,IAAD;AAAA,WAAUA,IAAV;AAAA,GAAtE,CAAX;;AACAtM,EAAAA,QAAQ,CAAC4L,OAAT,CAAiBC,eAAjB,CAAiClB,IAAjC;AACD,CAHD;;AAKA,IAAM6B,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,QAAD,EAAc;AACvCzM,EAAAA,QAAQ,CAACM,IAAT,CAAcG,iBAAd,CAAgC;AAAEF,IAAAA,cAAc,EAAEkM;AAAlB,GAAhC;AACD,CAFD;;AAIA,IAAMC,KAAK,GAAG,SAARA,KAAQ,CAACC,EAAD;AAAA,SAAQ,IAAIxG,OAAJ,CAAY,UAAAiB,OAAO;AAAA,WAAIU,UAAU,CAAC;AAAA,aAAMV,OAAO,CAAC,IAAD,CAAb;AAAA,KAAD,EAAsBuF,EAAtB,CAAd;AAAA,GAAnB,CAAR;AAAA,CAAd;;AAEA,IAAMC,mBAAmB;AAAA,wEAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,yBAQtB7M,QAAQ,EARc,qCAExBO,IAFwB,CAGtBuM,mBAHsB,EAIXC,WAJW,yBAIpBrH,OAJoB,EAKpBsH,OALoB,yBAKpBA,OALoB;AAU1BjN,YAAAA,OAAO,CAACkN,UAAR,CAAmBC,KAAnB,CAAyBH,WAAzB;;AACA,gBAAIC,OAAO,IAAIA,OAAO,CAAC3K,MAAvB,EAA+B;AAC7B2K,cAAAA,OAAO,CAAC7B,GAAR,CAAY,kBAAcgC,KAAd;AAAA,oBAAGzH,OAAH,UAAGA,OAAH;AAAA,uBAAwB,IAAIU,OAAJ;AAAA,wFAAY,mBAAOiB,OAAP;AAAA;AAAA;AAAA;AAAA;AAC9CtH,4BAAAA,OAAO,CAACkN,UAAR,CAAmBC,KAAnB,CAAyBxH,OAAzB;AACA2B,4BAAAA,OAAO,CAAC,IAAD,CAAP;;AAF8C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAZ;;AAAA;AAAA;AAAA;AAAA,oBAAxB;AAAA,eAAZ;AAID;;AAhByB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAnBwF,mBAAmB;AAAA;AAAA;AAAA,GAAzB;;AAmBA,IAAMf,eAAe;AAAA,wEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAOsB,YAAAA,WAAP,iEAAqB,IAArB;;AACtB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEQC,YAAAA,YApBgB,GAoBDtN,OAAO,CAAC0D,GAAR,CAAY6J,SAAZ,EApBC;AAqBhBC,YAAAA,YArBgB,GAqBDxN,OAAO,CAAC8D,GAAR,CAAYyJ,SAAZ,EArBC;AAsBhBE,YAAAA,cAtBgB,GAsBCzN,OAAO,CAACgE,KAAR,CAAcuJ,SAAd,EAtBD;AAuBhBG,YAAAA,aAvBgB,GAuBA1N,OAAO,CAACkE,IAAR,CAAaqJ,SAAb,EAvBA;AAAA,yBA2BlBtN,QAAQ,EA3BU,EA0BZ0N,eA1BY,cA0BpBC,IA1BoB,CA0BZD,eA1BY;AA4BhBE,YAAAA,iBA5BgB,GA4BIzN,sBAAsB,EA5B1B;AA8BtB;AACF;AACA;;AAEE,gBAAI;AACFyL,cAAAA,iBAAiB;AAEXiC,cAAAA,gBAHJ,IAIA9N,OAAO,CAAC0D,GAAR,CAAYqK,cAAZ,EAJA,4BAKIT,YAAD,GAAiB,EAAjB,GAAsB,CAACtN,OAAO,CAAC0D,GAAR,CAAYqK,cAAZ,CAA2B/N,OAAO,CAAC0D,GAAR,CAAYsK,eAAZ,EAA3B,CAAD,CALzB,IAMAhO,OAAO,CAAC0B,WAAR,CAAoBuM,iBAApB,EANA,EAOAjO,OAAO,CAAC0B,WAAR,CAAoBwM,iBAApB,EAPA,EAQAlO,OAAO,CAAC0B,WAAR,CAAoByM,kBAApB,EARA,EASAnO,OAAO,CAAC8D,GAAR,CAAYiK,cAAZ,EATA,sBAUIzN,QAAQ,CAACkH,SAAT,MAAwBlH,QAAQ,CAACmH,WAAT,EAAzB,GAAmD,CAACzH,OAAO,CAAC8D,GAAR,CAAYiK,cAAZ,CAA2BzN,QAAQ,CAAC8N,UAAT,EAA3B,CAAD,CAAnD,GAAyG,EAV5G,sBAWIZ,YAAD,GAAiB,EAAjB,GAAsB,CAACxN,OAAO,CAAC8D,GAAR,CAAYiK,cAAZ,CAA2B/N,OAAO,CAAC8D,GAAR,CAAYkK,eAAZ,EAA3B,CAAD,CAXzB,sBAYGX,WAAW,IAAIA,WAAW,CAAC,OAAD,CAA1B,GAAsC,CAACrN,OAAO,CAACgE,KAAR,CAAc+J,cAAd,EAAD,CAAtC,GAAyE,EAZ5E,sBAaGV,WAAW,IAAIA,WAAW,CAAC,MAAD,CAA1B,GAAqC,CAACrN,OAAO,CAACkE,IAAR,CAAa6J,cAAb,EAAD,CAArC,GAAuE,EAb1E;AAgBIxI,cAAAA,KAhBJ,GAgBYF,MAAM,CAACC,IAAP,CAAY3F,MAAM,CAAC4F,KAAnB,EACXuF,MADW,CACJ,UAACuD,GAAD;AAAA,uBAAS,CAACV,eAAe,CAACrC,QAAhB,CAAyB+C,GAAG,CAACC,WAAJ,EAAzB,CAAD,IAAgDT,iBAAiB,CAACvC,QAAlB,CAA2B+C,GAAG,CAACC,WAAJ,EAA3B,CAAzD;AAAA,eADI,CAhBZ;AAmBFR,cAAAA,gBAAgB,CAACtI,OAAjB,CAAyB,UAAC+I,SAAD,EAA+B;AACtDA,gBAAAA,SAAS,CAAChI,IAAV,CAAe,UAACiI,MAAD,EAAmB;AAChCxC,kBAAAA,iBAAiB,CAACwC,MAAD,CAAjB;AACD,iBAFD;AAGD,eAJD;AAKAjJ,cAAAA,KAAK,CAAC6F,GAAN,CAAU,UAAC3F,IAAD,EAAO2H,KAAP,EAAiB;AACzBR,gBAAAA,KAAK,CAAC,MAAMQ,KAAP,CAAL,CAAmB7G,IAAnB,CAAwB,YAAM;AAC5BvG,kBAAAA,OAAO,CAAC0F,KAAR,CAAcqI,cAAd,CAA6B,IAA7B,EAAmCtI,IAAnC,EAAyCc,IAAzC,CAA8C,UAACkI,MAAD,EAAmB;AAC/DzC,oBAAAA,iBAAiB,CAACyC,MAAD,CAAjB;AACD,mBAFD;AAGD,iBAJD;AAKD,eAND;AAOD,aA/BD,CA+BE,OAAOrM,KAAP,EAAc;AACdD,cAAAA,OAAO,CAACC,KAAR,CAAc,iBAAd,EAAiCA,KAAjC;AACD;;AAnEqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAf2J,eAAe;AAAA;AAAA;AAAA,GAArB;;AAsEA,IAAM2C,OAAO,GAAG,SAAVA,OAAU,GAAM;AAAA,mBACwCzO,QAAQ,EADhD;AAAA,mCACZO,IADY;AAAA,MACJmO,OADI,mBACJA,OADI;AAAA,MACKC,OADL,mBACKA,OADL;AAAA,MACcC,SADd,mBACcA,SADd;AAAA,MACyBC,QADzB,mBACyBA,QADzB;;AAIpB,MAAIC,IAAI,wMAORlO,MAAM,CAACgJ,QAAP,CAAgBmF,QAPR,mFAWUL,OAAO,CAAChJ,OAXlB,kCAYKgJ,OAAO,CAACM,UAZb,kQAqBSL,OAAO,CAACjJ,OArBjB,gCAsBKiJ,OAAO,CAACK,UAtBb,oMA+BOJ,SAAS,CAAClJ,OA/BjB,gCAgCKkJ,SAAS,CAACI,UAhCf,yDAoCMH,QAAQ,CAACnJ,OApCf,gCAqCKmJ,QAAQ,CAACG,UArCd,iGAAR;AA2CA,SAAOF,IAAP;AACD,CAhDD;;AAkDA,OAAO,IAAMG,iBAAiB,GAAG,SAApBA,iBAAoB,CAACvC,QAAD,EAAWwC,IAAX,EAAoB;AACnD,MAAMC,QAAQ,GAAG/O,cAAc,CAACsM,QAAD,EAAW,IAAX,CAAd,CAA+B2B,WAA/B,EAAjB;AAEA,MAAMe,QAAQ,GAAGrP,OAAO,CAAC4N,IAAR,CAAa0B,UAAb,CAAwB,EAAxB,EAA4BxE,MAA5B,CAAmC,UAACyE,MAAD,EAAY;AAC9D,QAAMC,UAAU,GAAGnP,cAAc,CAACkP,MAAM,CAAC5C,QAAR,EAAkB,IAAlB,CAAd,CAAsC2B,WAAtC,EAAnB;AAEA,WAAQkB,UAAU,KAAKJ,QAAf,IAA2BD,IAAI,KAAKI,MAAM,CAAC5J,OAA5C,IAAyD,CAACwJ,IAAD,IAAUK,UAAU,KAAKJ,QAAzF;AACD,GAJgB,CAAjB;AAMA,SAAQC,QAAQ,CAAC/M,MAAV,GAAoB+M,QAAQ,CAAC,CAAD,CAA5B,GAAkC,KAAzC;AACD,CAVM;AAYP,OAAO,IAAMI,OAAO,GAAG,SAAVA,OAAU,CAACN,IAAD,EAAOxC,QAAP,EAAoB;AACzC,MAAI7M,QAAQ,CAAC6L,UAAT,CAAoB;AAAElG,IAAAA,IAAI,EAAEkH;AAAR,GAApB,CAAJ,EAA6C;AAC3C,QAAI3M,OAAO,CAAC8D,GAAR,CAAY4L,iBAAZ,GAAgCC,OAAhC,CAAwCR,IAAI,CAAC3G,WAAL,EAAxC,MAAgE,CAAC,CAArE,EAAwE,OAAO,IAAP;;AAD7B,qBAQvCvI,QAAQ,EAR+B;AAAA,QAKrC0F,QALqC,cAGzCnF,IAHyC,CAIvCmO,OAJuC,CAKrChJ,OALqC;;AAU3C,WAAOwJ,IAAI,KAAKxJ,QAAhB;AACD;;AAED,MAAI3F,OAAO,CAAC0D,GAAR,CAAYgM,iBAAZ,GAAgCC,OAAhC,CAAwCR,IAAI,CAAC3G,WAAL,EAAxC,MAAgE,CAAC,CAArE,EAAwE,OAAO,IAAP;AACxE,MAAIxI,OAAO,CAACgE,KAAR,CAAc0L,iBAAd,GAAkCC,OAAlC,CAA0CR,IAAI,CAAC3G,WAAL,EAA1C,MAAkE,CAAC,CAAvE,EAA0E,OAAO,IAAP;AAC1E,MAAIxI,OAAO,CAACkE,IAAR,CAAawL,iBAAb,GAAiCC,OAAjC,CAAyCR,IAAI,CAAC3G,WAAL,EAAzC,MAAiE,CAAC,CAAtE,EAAyE,OAAO,IAAP;AACzE,MAAIxI,OAAO,CAAC8D,GAAR,CAAY4L,iBAAZ,GAAgCC,OAAhC,CAAwCR,IAAI,CAAC3G,WAAL,EAAxC,MAAgE,CAAC,CAArE,EAAwE,OAAO,IAAP;AAExE,MAAIlI,QAAQ,IACPA,QAAQ,CAACkH,SAAT,EADD,IAEClH,QAAQ,CAACmH,WAAT,EAFD,IAGCnH,QAAQ,CAAC8N,UAAT,GAAsB5F,WAAtB,MAAuC2G,IAAI,CAAC3G,WAAL,EAH5C,EAIE,OAAO,IAAP;AAEF,MAAM/C,IAAI,aAAMkH,QAAQ,CAACnE,WAAT,EAAN,SAAV;;AAzByC,mBA0BxBvI,QAAQ,EA1BgB;AAAA,MA0BjCO,IA1BiC,cA0BjCA,IA1BiC;;AA4BzC,MAAI,CAACA,IAAI,CAACiF,IAAD,CAAT,EAAiB;AACf,WAAO,KAAP;AACD;;AA9BwC,MAgCjCE,OAhCiC,GAgCrBnF,IAAI,CAACiF,IAAD,CAhCiB,CAgCjCE,OAhCiC;;AAkCzC,MAAI,CAACA,OAAL,EAAc;AACZ,WAAO,KAAP;AACD;;AAED,SAAOwJ,IAAI,KAAKxJ,OAAhB;AACD,CAvCM;;AA0CP,IAAMiK,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;AAChC,MAAMC,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAhB;AACA,MAAMhB,IAAI,GAAGL,OAAO,EAApB;AACA,MAAMsB,OAAO,GAAG,8BAAhB;AAEAH,EAAAA,OAAO,CAACI,YAAR,CAAqB,MAArB,yCAA6DC,kBAAkB,CAACnB,IAAD,CAA/E;AACAc,EAAAA,OAAO,CAACI,YAAR,CAAqB,UAArB,YAAoCpP,MAAM,CAACgJ,QAAP,CAAgBmF,QAApD,mBAAqEpP,MAAM,GAAGuQ,MAAT,CAAgB,YAAhB,CAArE;AAEAN,EAAAA,OAAO,CAACO,KAAR,CAAcC,OAAd,GAAwB,MAAxB;AACAP,EAAAA,QAAQ,CAACQ,IAAT,CAAcC,WAAd,CAA0BV,OAA1B;AACAA,EAAAA,OAAO,CAACW,KAAR;AACAV,EAAAA,QAAQ,CAACQ,IAAT,CAAcG,WAAd,CAA0BZ,OAA1B;AAEA7P,EAAAA,OAAO,CAAC0Q,aAAR,CAAsBC,IAAtB,CAA2B9Q,SAAS,CAAC6Q,aAAV,CAAwBE,OAAnD,EAA4D;AAC1DZ,IAAAA,OAAO,EAAPA;AAD0D,GAA5D,EAbgC,CAgBhC;;AACA9O,EAAAA,YAAY,CAACsC,OAAb,CAAqB3D,SAAS,CAACqB,YAAV,CAAuB2P,gBAA5C,EAA8D,IAA9D;AACD,CAlBD;;AAoBAhQ,MAAM,CAAC+O,mBAAP,GAA6BA,mBAA7B;;AAEA,IAAMkB,WAAW,GAAG,SAAdA,WAAc,CAACrL,IAAD,EAAU;AAAA,oBACXxF,QAAQ,EADG;AAAA,MACpBO,IADoB,eACpBA,IADoB;;AAE5B,SAAOA,IAAI,WAAIiF,IAAJ,UAAX;AACD,CAHD,C,CAKA;AACA;AACA;AACA;;;AAEA,eAAe;AACbvC,EAAAA,IAAI,EAAJA,IADa;AAEbrB,EAAAA,YAAY,EAAZA,YAFa;AAGba,EAAAA,YAAY,EAAZA,YAHa;AAIb3B,EAAAA,iBAAiB,EAAjBA,iBAJa;AAKbiF,EAAAA,cAAc,EAAdA,cALa;AAMbkB,EAAAA,WAAW,EAAXA,WANa;AAObmC,EAAAA,YAAY,EAAZA,YAPa;AAQb0C,EAAAA,eAAe,EAAfA,eARa;AASb6D,EAAAA,mBAAmB,EAAnBA,mBATa;AAUblB,EAAAA,OAAO,EAAPA,OAVa;AAWbe,EAAAA,OAAO,EAAPA,OAXa;AAYb/G,EAAAA,eAAe,EAAfA,eAZa;AAab3C,EAAAA,aAAa,EAAbA,aAba;AAcbgE,EAAAA,oBAAoB,EAApBA,oBAda;AAeb+G,EAAAA,WAAW,EAAXA,WAfa;AAgBb5B,EAAAA,iBAAiB,EAAjBA,iBAhBa;AAiBbpC,EAAAA,mBAAmB,EAAnBA,mBAjBa;AAkBbJ,EAAAA,kBAAkB,EAAlBA,kBAlBa,CAmBb;;AAnBa,CAAf","sourcesContent":["// @ts-nocheck\r\nimport config from 'app-config'\r\nimport moment from 'moment/moment'\r\nimport { constants, ethToken } from 'helpers'\r\nimport request from 'common/utils/request'\r\n\r\nimport actions from 'redux/actions'\r\nimport { getState } from 'redux/core'\r\n\r\nimport reducers from 'redux/core/reducers'\r\nimport * as bip39 from 'bip39'\r\n\r\nimport { getActivatedCurrencies } from 'helpers/user'\r\nimport getCurrencyKey from 'helpers/getCurrencyKey'\r\nimport metamask from 'helpers/metamask'\r\n\r\nimport { MnemonicKey } from './types'\r\n\r\n\r\n/*\r\n    reducers,      \r\n    ,   undefined - \r\n*/\r\nconst initReducerState = () => {\r\n  const {\r\n    user: {\r\n      activeCurrency,\r\n      activeFiat,\r\n    },\r\n  } = getState()\r\n\r\n  if (!activeCurrency) reducers.user.setActiveCurrency({ activeCurrency: 'BTC' })\r\n  if (!activeFiat) reducers.user.setActiveFiat({ activeFiat: window.DEFAULT_FIAT || 'USD' })\r\n}\r\n\r\nconst sign_btc_multisig = async (btcPrivateKey) => {\r\n  let btcMultisigOwnerKey = localStorage.getItem(constants.privateKeyNames.btcMultisigOtherOwnerKey)\r\n  try { btcMultisigOwnerKey = JSON.parse(btcMultisigOwnerKey) } catch (e) { }\r\n  //@\r\n  const _btcMultisigPrivateKey = actions.btcmultisig.login_USER(btcPrivateKey, btcMultisigOwnerKey)\r\n  await actions.btcmultisig.signToUserMultisig()\r\n}\r\n\r\n\r\nconst sign_btc_2fa = async (btcPrivateKey) => {\r\n  const btcSMSServerKey = config.swapContract.protectedBtcKey\r\n  let btcSmsPublicKeys = [btcSMSServerKey]\r\n  let btcSmsMnemonicKey: MnemonicKey = localStorage.getItem(constants.privateKeyNames.btcSmsMnemonicKey)\r\n  \r\n  try { \r\n    btcSmsMnemonicKey = JSON.parse(btcSmsMnemonicKey) \r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n\r\n  if (btcSmsMnemonicKey instanceof Array && btcSmsMnemonicKey.length > 0) {\r\n    btcSmsPublicKeys.push(btcSmsMnemonicKey[0])\r\n  }\r\n  const _btcMultisigSMSPrivateKey = actions.btcmultisig.login_SMS(btcPrivateKey, btcSmsPublicKeys)\r\n}\r\n\r\nconst sign_btc_pin = async (btcPrivateKey) => {\r\n  const btcPinServerKey = config.swapContract.btcPinKey\r\n  let btcPinPublicKeys = [btcPinServerKey]\r\n  let btcPinMnemonicKey: MnemonicKey = localStorage.getItem(constants.privateKeyNames.btcPinMnemonicKey)\r\n  \r\n  try { \r\n    btcPinMnemonicKey = JSON.parse(btcPinMnemonicKey) \r\n  } catch (e) {\r\n    console.error(e)\r\n  }\r\n\r\n  if (btcPinMnemonicKey instanceof Array && btcPinMnemonicKey.length > 0) {\r\n    btcPinPublicKeys.push(btcPinMnemonicKey[0])\r\n  }\r\n\r\n  console.log('sign to btc pin', btcPinPublicKeys)\r\n  const _btcMultisigPinPrivateKey = actions.btcmultisig.login_PIN(btcPrivateKey, btcPinPublicKeys)\r\n}\r\n\r\nconst sign = async () => {\r\n  metamask.web3connect.onInit( async () => {\r\n    initReducerState()\r\n\r\n    let mnemonic = localStorage.getItem(constants.privateKeyNames.twentywords)\r\n\r\n    if (!mnemonic) {\r\n      mnemonic = bip39.generateMnemonic()\r\n      localStorage.setItem(constants.privateKeyNames.twentywords, mnemonic)\r\n    }\r\n\r\n    const mnemonicKeys = {\r\n      btc: localStorage.getItem(constants.privateKeyNames.btcMnemonic),\r\n      btcSms: localStorage.getItem(constants.privateKeyNames.btcSmsMnemonicKeyGenerated),\r\n      eth: localStorage.getItem(constants.privateKeyNames.ethMnemonic),\r\n      ghost: localStorage.getItem(constants.privateKeyNames.ghostMnemonic),\r\n      next: localStorage.getItem(constants.privateKeyNames.nextMnemonic),\r\n    }\r\n    console.log('actions user - sign', mnemonicKeys, mnemonic)\r\n    if (mnemonic !== `-`) {\r\n      //@\r\n      if (!mnemonicKeys.btc) mnemonicKeys.btc = actions.btc.sweepToMnemonic(mnemonic)\r\n      //@\r\n      if (!mnemonicKeys.eth) mnemonicKeys.eth = actions.eth.sweepToMnemonic(mnemonic)\r\n      //@\r\n      if (!mnemonicKeys.ghost) mnemonicKeys.ghost = actions.ghost.sweepToMnemonic(mnemonic)\r\n        //@\r\n      if (!mnemonicKeys.next) mnemonicKeys.next = actions.next.sweepToMnemonic(mnemonic)\r\n      if (!mnemonicKeys.btcSms) {\r\n        mnemonicKeys.btcSms = actions.btcmultisig.getSmsKeyFromMnemonic(mnemonic)\r\n        localStorage.setItem(constants.privateKeyNames.btcSmsMnemonicKeyGenerated, mnemonicKeys.btcSms)\r\n      }\r\n    }\r\n    // Sweep-Switch\r\n    let btcNewSmsMnemonicKey: MnemonicKey = localStorage.getItem(constants.privateKeyNames.btcSmsMnemonicKeyMnemonic)\r\n    \r\n    try { \r\n      btcNewSmsMnemonicKey = JSON.parse(btcNewSmsMnemonicKey) \r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n\r\n    if (!(btcNewSmsMnemonicKey instanceof Array)) {\r\n      localStorage.setItem(constants.privateKeyNames.btcSmsMnemonicKeyMnemonic, JSON.stringify([]))\r\n    }\r\n\r\n    let btcNewMultisigOwnerKey: MnemonicKey = localStorage.getItem(constants.privateKeyNames.btcMultisigOtherOwnerKeyMnemonic)\r\n    \r\n    try { \r\n      btcNewMultisigOwnerKey = JSON.parse(btcNewMultisigOwnerKey) \r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n\r\n    if (!(btcNewMultisigOwnerKey instanceof Array)) {\r\n      localStorage.setItem(constants.privateKeyNames.btcMultisigOtherOwnerKeyMnemonic, JSON.stringify([]))\r\n    }\r\n\r\n    const btcPrivateKey = localStorage.getItem(constants.privateKeyNames.btc)\r\n    const btcMultisigPrivateKey = localStorage.getItem(constants.privateKeyNames.btcMultisig)\r\n    const ethPrivateKey = localStorage.getItem(constants.privateKeyNames.eth)\r\n    const ghostPrivateKey = localStorage.getItem(constants.privateKeyNames.ghost)\r\n    const nextPrivateKey = localStorage.getItem(constants.privateKeyNames.next)\r\n\r\n\r\n    const _ethPrivateKey = actions.eth.login(ethPrivateKey, mnemonic, mnemonicKeys)\r\n    const _btcPrivateKey = actions.btc.login(btcPrivateKey, mnemonic, mnemonicKeys)\r\n    const _ghostPrivateKey = actions.ghost.login(ghostPrivateKey, mnemonic, mnemonicKeys)\r\n    const _nextPrivateKey = actions.next.login(nextPrivateKey, mnemonic, mnemonicKeys)\r\n\r\n    // btc multisig with 2fa (2of3)\r\n    await sign_btc_2fa(_btcPrivateKey)\r\n\r\n    // btc multisig 2of2 user manual sign\r\n    await sign_btc_multisig(_btcPrivateKey)\r\n\r\n    // btc multisig with pin protect (2of3)\r\n    await sign_btc_pin(_btcPrivateKey)\r\n\r\n    // if inside actions.token.login to call web3.eth.accounts.privateKeyToAccount passing public key instead of private key\r\n    // there will not be an error, but the address returned will be wrong\r\n    // if (!isEthKeychainActivated) {\r\n    Object.keys(config.erc20)\r\n      .forEach(name => {\r\n        actions.token.login(_ethPrivateKey, config.erc20[name].address, name, config.erc20[name].decimals, config.erc20[name].fullName)\r\n      })\r\n    // }\r\n    reducers.user.setTokenSigned(true)\r\n\r\n    // const getReputation = actions.user.getReputation()\r\n\r\n    await getReputation()\r\n  })\r\n}\r\n\r\nconst sign_to_tokens = () => {\r\n  const ethPrivateKey = localStorage.getItem(constants.privateKeyNames.eth)\r\n  Object.keys(config.erc20)\r\n    .forEach(name => {\r\n      actions.token.login(ethPrivateKey, config.erc20[name].address, name, config.erc20[name].decimals, config.erc20[name].fullName)\r\n    })\r\n}\r\n\r\nconst getReputation = async () => {\r\n\r\n  const btcReputationPromise = actions.btc.getReputation()\r\n  const ethReputationPromise = actions.eth.getReputation()\r\n  const ghostReputationPromise = actions.ghost.getReputation()\r\n  const nextReputationPromise = actions.next.getReputation()\r\n\r\n  Promise.all([\r\n    btcReputationPromise,\r\n    ethReputationPromise,\r\n    ghostReputationPromise,\r\n    nextReputationPromise,\r\n  ])\r\n    .then(([btcReputation, ethReputation, ghostReputation, nextReputation]) => {\r\n      const totalReputation = Number(btcReputation) + Number(ethReputation) + Number(ghostReputation) + Number(nextReputation)\r\n\r\n      if (Number.isInteger(totalReputation)) {\r\n        reducers.pubsubRoom.set({ reputation: totalReputation })\r\n      } else {\r\n        reducers.pubsubRoom.set({ reputation: null })\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      console.error(`unknown reputation`, error)\r\n    })\r\n}\r\n\r\n\r\nconst getBalances = () => {\r\n  const {\r\n    user: {\r\n      isTokenSigned,\r\n    },\r\n  } = getState()\r\n\r\n  reducers.user.setIsBalanceFetching({ isBalanceFetching: true })\r\n\r\n  return new Promise(async (resolve) => {\r\n    const balances = [\r\n      ...(metamask.isEnabled() && metamask.isConnected())\r\n        ? [ { func: metamask.getBalance, name: 'metamask' } ]\r\n        : [],\r\n      { func: actions.eth.getBalance, name: 'eth' },\r\n      { func: actions.btc.getBalance, name: 'btc' },\r\n      { func: actions.ghost.getBalance, name: 'ghost' },\r\n      { func: actions.next.getBalance, name: 'next' },\r\n      { func: actions.btcmultisig.getBalance, name: 'btc-sms' },\r\n      { func: actions.btcmultisig.getBalanceUser, name: 'btc-ms-main' },\r\n      { func: actions.btcmultisig.getBalancePin, name: 'btc-pin' },\r\n      { func: actions.btcmultisig.fetchMultisigBalances, name: 'btc-ms' }\r\n    ]\r\n\r\n    balances.forEach(async (obj) => {\r\n      try {\r\n        await obj.func()\r\n      } catch (e) {\r\n        console.error('Fail fetch balance for', obj.name)\r\n      }\r\n    })\r\n\r\n    if (isTokenSigned) {\r\n      // wait until all token data is loaded and will be in the store\r\n      setTimeout(() => {\r\n        // local storage data\r\n        Object.keys(config.erc20)\r\n          .forEach(async (name) => {\r\n            try {\r\n              await actions.token.getBalance(name)\r\n              \r\n            } catch (e) {\r\n              console.error('Fail fetch balance for token', name, e)\r\n            }\r\n          })\r\n      })\r\n    }\r\n\r\n    reducers.user.setIsBalanceFetching({ isBalanceFetching: false })\r\n    resolve(true)\r\n  })\r\n}\r\n\r\nconst customRate = (cur) => {\r\n  const wTokens = window.widgetERC20Tokens\r\n\r\n  const dataobj = wTokens && Object.keys(wTokens).find(el => el === cur.toLowerCase())\r\n  return dataobj ? (wTokens[dataobj] || { customEcxchangeRate: null }).customEcxchangeRate : null\r\n}\r\n\r\nconst getExchangeRate = (sellCurrency, buyCurrency): Promise<number> => {\r\n  const sellDataRate = customRate(sellCurrency)\r\n  const buyDataRate = customRate(buyCurrency)\r\n\r\n  const {\r\n    user,\r\n  } = getState()\r\n\r\n  return new Promise((resolve, reject) => {\r\n\r\n    if (sellDataRate) {\r\n      resolve(sellDataRate)\r\n      return\r\n    }\r\n\r\n    if (buyDataRate) {\r\n      resolve(1 / buyDataRate)\r\n      return\r\n    }\r\n\r\n    let dataKey = sellCurrency.toLowerCase()\r\n    switch (sellCurrency.toLowerCase()) {\r\n      case 'btc (sms-protected)':\r\n      case 'btc (multisig)':\r\n      case 'btc (pin-protected)':\r\n        dataKey = 'btc'\r\n        break\r\n      default:\r\n    }\r\n\r\n    if ((user[`${dataKey}Data`]\r\n      && user[`${dataKey}Data`].infoAboutCurrency\r\n      && user[`${dataKey}Data`].infoAboutCurrency.price_fiat\r\n    ) || (\r\n        user.tokensData[dataKey]\r\n        && user.tokensData[dataKey].infoAboutCurrency\r\n        && user.tokensData[dataKey].infoAboutCurrency.price_fiat\r\n      )\r\n    ) {\r\n      const currencyData = (user.tokensData[dataKey] && user.tokensData[dataKey].infoAboutCurrency)\r\n        ? user.tokensData[dataKey]\r\n        : user[`${dataKey}Data`]\r\n\r\n      resolve(currencyData.infoAboutCurrency.price_fiat)\r\n    } else {\r\n      resolve(1)\r\n    }\r\n  })\r\n}\r\n\r\nconst getDemoMoney = process.env.MAINNET ? () => { } : () => {\r\n  // googe bitcoin (or ropsten) faucet\r\n  request.get('https://swap.wpmix.net/demokeys.php', {})\r\n    .then((r) => {\r\n      window.localStorage.clear()\r\n      localStorage.setItem(constants.privateKeyNames.btc, r[0])\r\n      localStorage.setItem(constants.privateKeyNames.eth, r[1])\r\n      localStorage.setItem(constants.privateKeyNames.ghost, r[2])\r\n      localStorage.setItem(constants.privateKeyNames.next, r[3])\r\n      //@\r\n      localStorage.setItem(constants.localStorage.demoMoneyReceived, true)\r\n      window.location.reload()\r\n    })\r\n}\r\n\r\n\r\nconst getInfoAboutCurrency = (currencyNames) =>\r\n\r\n  new Promise((resolve, reject) => {\r\n\r\n    const hasCustomRate = (cur) => {\r\n      const dataobj = Object.keys(config.erc20).find(el => el.toLowerCase() === cur.toLowerCase())\r\n      return dataobj ? (config.erc20[dataobj] || { customEcxchangeRate: false }).customEcxchangeRate : false\r\n    }\r\n\r\n    const url = 'https://noxon.wpmix.net/cursAll.php'\r\n    reducers.user.setIsFetching({ isFetching: true })\r\n\r\n    const fiat = (config && config.opts && config.opts.activeFiat) ? config.opts.activeFiat : `USD`\r\n\r\n    request.get(url, {\r\n      cacheResponse: 60 * 60 * 1000, //  1 \r\n      query: {\r\n        fiat,\r\n        tokens: currencyNames.join(`,`),\r\n      }\r\n    }).then((answer: any) => {\r\n      let infoAboutBTC = answer.data.filter(currencyInfo => {\r\n        if (currencyInfo.symbol.toLowerCase() === 'btc') return true\r\n      })\r\n\r\n      const btcPrice = (\r\n        infoAboutBTC\r\n        && infoAboutBTC.length\r\n        && infoAboutBTC[0].quote\r\n        && infoAboutBTC[0].quote[fiat]\r\n        && infoAboutBTC[0].quote[fiat].price\r\n      ) ? infoAboutBTC[0].quote[fiat].price : 7000\r\n\r\n      answer.data.map(currencyInfoItem => {\r\n        if (currencyNames.includes(currencyInfoItem.symbol)) {\r\n          if (currencyInfoItem.quote && currencyInfoItem.quote[fiat]) {\r\n            const priceInBtc = currencyInfoItem.quote[fiat].price / btcPrice\r\n            const ownPrice = hasCustomRate(currencyInfoItem.symbol)\r\n\r\n            const currencyInfo = {\r\n              ...currencyInfoItem.quote[fiat],\r\n              price_fiat: (ownPrice) ? ownPrice : currencyInfoItem.quote[fiat].price,\r\n              price_btc: priceInBtc,\r\n            }\r\n\r\n            switch (currencyInfoItem.symbol) {\r\n              case 'BTC': {\r\n                reducers.user.setInfoAboutCurrency({ name: 'btcData', infoAboutCurrency: currencyInfo })\r\n                reducers.user.setInfoAboutCurrency({ name: 'btcMnemonicData', infoAboutCurrency: currencyInfo }) // Sweep (for future)\r\n                reducers.user.setInfoAboutCurrency({ name: 'btcMultisigSMSData', infoAboutCurrency: currencyInfo })\r\n                reducers.user.setInfoAboutCurrency({ name: 'btcMultisigUserData', infoAboutCurrency: currencyInfo })\r\n                reducers.user.setInfoAboutCurrency({ name: 'btcMultisigG2FAData', infoAboutCurrency: currencyInfo })\r\n                reducers.user.setInfoAboutCurrency({ name: 'btcMultisigPinData', infoAboutCurrency: currencyInfo })\r\n                break\r\n              }\r\n              case 'ETH': {\r\n                reducers.user.setInfoAboutCurrency({ name: 'ethData', infoAboutCurrency: currencyInfo })\r\n                reducers.user.setInfoAboutCurrency({ name: 'ethMnemonicData', infoAboutCurrency: currencyInfo }) // Sweep (for future)\r\n                break\r\n              }\r\n              case 'GHOST': {\r\n                reducers.user.setInfoAboutCurrency({ name: 'ghostData', infoAboutCurrency: currencyInfo })\r\n                reducers.user.setInfoAboutCurrency({ name: 'ghostMnemonicData', infoAboutCurrency: currencyInfo }) // Sweep (for future)\r\n                break\r\n              }\r\n              case 'NEXT': {\r\n                reducers.user.setInfoAboutCurrency({ name: 'nextData', infoAboutCurrency: currencyInfo })\r\n                reducers.user.setInfoAboutCurrency({ name: 'nextMnemonicData', infoAboutCurrency: currencyInfo }) // Sweep (for future)\r\n                break\r\n              }\r\n              default: {\r\n                if (ethToken.isEthToken({ name: currencyInfoItem.symbol })) {\r\n                  reducers.user.setInfoAboutToken({ name: currencyInfoItem.symbol.toLowerCase(), infoAboutCurrency: currencyInfo })\r\n                } else {\r\n                  reducers.user.setInfoAboutCurrency({ name: `${currencyInfoItem.symbol.toLowerCase()}Data`, infoAboutCurrency: currencyInfo })\r\n                }\r\n                break\r\n              }\r\n            }\r\n          }\r\n        }\r\n      })\r\n      resolve(true)\r\n    }).catch((error) => {\r\n      reject(error)\r\n    }).finally(() => reducers.user.setIsFetching({ isFetching: false }))\r\n  })\r\n\r\n\r\nconst clearTransactions = () => {\r\n  reducers.history.setTransactions([])\r\n}\r\n\r\nconst mergeTransactions = (mergeTxs: any[]) => {\r\n  const {\r\n    history: {\r\n      transactions,\r\n    },\r\n  } = getState()\r\n  let data = [].concat(transactions, ...mergeTxs).sort((a, b) => b.date - a.date).filter((item) => item)\r\n  reducers.history.setTransactions(data)\r\n}\r\n\r\nconst pullTransactions = transactions => {\r\n  let data = [].concat([], ...transactions).sort((a, b) => b.date - a.date).filter((item) => item)\r\n  reducers.history.setTransactions(data)\r\n}\r\n\r\nconst pullActiveCurrency = (currency) => {\r\n  reducers.user.setActiveCurrency({ activeCurrency: currency })\r\n}\r\n\r\nconst delay = (ms) => new Promise(resolve => setTimeout(() => resolve(true), ms))\r\n\r\nconst fetchMultisigStatus = async () => {\r\n  const {\r\n    user: {\r\n      btcMultisigUserData: {\r\n        address: mainAddress,\r\n        wallets,\r\n      },\r\n    },\r\n  } = getState()\r\n\r\n  actions.multisigTx.fetch(mainAddress)\r\n  if (wallets && wallets.length) {\r\n    wallets.map(({ address }, index) => new Promise(async (resolve) => {\r\n      actions.multisigTx.fetch(address)\r\n      resolve(true)\r\n    }))\r\n  }\r\n}\r\n\r\nconst setTransactions = async (objCurrency = null) => {\r\n  /* \r\n    objCurrency = {\r\n      currency: {\r\n        isBalanceFetched: bool\r\n      }\r\n    }\r\n    \r\n    \"GHOST\",\r\n    \"NEXT\"\r\n    \"ETH\"\r\n    \"BTC\"\r\n    \"BTC (SMS-Protected)\"\r\n    \"BTC (PIN-Protected)\"\r\n    \"BTC (Google 2FA)\"\r\n    \"BTC (Multisig)\"\r\n    \"USDT\",\r\n    \"ETH\"\r\n  */\r\n\r\n  const isBtcSweeped = actions.btc.isSweeped()\r\n  const isEthSweeped = actions.eth.isSweeped()\r\n  const isGhostSweeped = actions.ghost.isSweeped()\r\n  const isNextSweeped = actions.next.isSweeped()\r\n\r\n  const {\r\n    core: { hiddenCoinsList },\r\n  } = getState()\r\n  const enabledCurrencies = getActivatedCurrencies()\r\n\r\n  /*\r\n    fetching penging btc-ms txs\r\n  */\r\n\r\n  try {\r\n    clearTransactions()\r\n\r\n    const fetchTxsPromises = [\r\n      actions.btc.getTransaction(),\r\n      ...(isBtcSweeped) ? [] : [actions.btc.getTransaction(actions.btc.getSweepAddress())],\r\n      actions.btcmultisig.getTransactionSMS(),\r\n      actions.btcmultisig.getTransactionPIN(),\r\n      actions.btcmultisig.getTransactionUser(),\r\n      actions.eth.getTransaction(),\r\n      ...(metamask.isEnabled() && metamask.isConnected()) ? [actions.eth.getTransaction(metamask.getAddress())] : [],\r\n      ...(isEthSweeped) ? [] : [actions.eth.getTransaction(actions.eth.getSweepAddress())],\r\n      ...objCurrency && objCurrency['GHOST'] ? [actions.ghost.getTransaction()] : [],\r\n      ...objCurrency && objCurrency['NEXT'] ? [actions.next.getTransaction()] : [],\r\n    ]\r\n    \r\n    const erc20 = Object.keys(config.erc20)\r\n      .filter((key) => !hiddenCoinsList.includes(key.toUpperCase()) && enabledCurrencies.includes(key.toUpperCase()))\r\n\r\n    fetchTxsPromises.forEach((txPromise: Promise<any[]>) => {\r\n      txPromise.then((txList: any[]) => {\r\n        mergeTransactions(txList)\r\n      })\r\n    })\r\n    erc20.map((name, index) => {\r\n      delay(650 * index).then(() => {\r\n        actions.token.getTransaction(null, name).then((ercTxs: any[]) => {\r\n          mergeTransactions(ercTxs)\r\n        })\r\n      })\r\n    })\r\n  } catch (error) {\r\n    console.error('getTransError: ', error)\r\n  }\r\n}\r\n\r\nconst getText = () => {\r\n  const { user: { ethData, btcData, ghostData, nextData } } = getState()\r\n\r\n\r\n  let text = `\r\n  You will need this instruction only in case of emergency (if you lost your keys) \\r\\n\r\n  please do NOT waste your time and go back to swap.online\\r\\n\r\n  \\r\\n\r\n  \\r\\n\r\n  \\r\\n\r\n  \\r\\n\r\n${window.location.hostname} emergency only instruction\r\n\\r\\n\r\n#ETHEREUM\r\n\\r\\n\r\nEthereum address: ${ethData.address}  \\r\\n\r\nPrivate key: ${ethData.privateKey}\\r\\n\r\n\\r\\n\r\nHow to access tokens and ethers: \\r\\n\r\n1. Go here https://www.myetherwallet.com/#send-transaction \\r\\n\r\n2. Select 'Private key'\\r\\n\r\n3. paste private key to input and click \"unlock\"\\r\\n\r\n\\r\\n\r\n# BITCOIN\\r\\n\r\n\\r\\n\r\nBitcoin address: ${btcData.address}\\r\\n\r\nPrivate key: ${btcData.privateKey}\\r\\n\r\n\\r\\n\r\n1. Go to blockchain.info\\r\\n\r\n2. login\\r\\n\r\n3. Go to settings > addresses > import\\r\\n\r\n4. paste private key and click \"Ok\"\\r\\n\r\n\\r\\n\r\n# GHOST\\r\\n\r\n\\r\\n\r\nGhost address: ${ghostData.address}\\r\\n\r\nPrivate key: ${ghostData.privateKey}\\r\\n\r\n\\r\\n\r\n# NEXT\\r\\n\r\n\\r\\n\r\nNext address: ${nextData.address}\\r\\n\r\nPrivate key: ${nextData.privateKey}\\r\\n\r\n\\r\\n\r\n* We don\\'t store your private keys and will not be able to restore them!\r\n\\r\\n\r\n`\r\n\r\n  return text\r\n}\r\n\r\nexport const getWithdrawWallet = (currency, addr) => {\r\n  const needType = getCurrencyKey(currency, true).toUpperCase()\r\n\r\n  const filtered = actions.core.getWallets({}).filter((wallet) => {\r\n    const walletType = getCurrencyKey(wallet.currency, true).toUpperCase()\r\n\r\n    return (walletType === needType && addr === wallet.address) || (!addr && (walletType === needType))\r\n  })\r\n\r\n  return (filtered.length) ? filtered[0] : false\r\n}\r\n\r\nexport const isOwner = (addr, currency) => {\r\n  if (ethToken.isEthToken({ name: currency })) {\r\n    if (actions.eth.getAllMyAddresses().indexOf(addr.toLowerCase()) !== -1) return true\r\n    const {\r\n      user: {\r\n        ethData: {\r\n          address,\r\n        },\r\n      },\r\n    } = getState()\r\n\r\n    return addr === address\r\n  }\r\n\r\n  if (actions.btc.getAllMyAddresses().indexOf(addr.toLowerCase()) !== -1) return true\r\n  if (actions.ghost.getAllMyAddresses().indexOf(addr.toLowerCase()) !== -1) return true\r\n  if (actions.next.getAllMyAddresses().indexOf(addr.toLowerCase()) !== -1) return true\r\n  if (actions.eth.getAllMyAddresses().indexOf(addr.toLowerCase()) !== -1) return true\r\n\r\n  if (metamask\r\n    && metamask.isEnabled()\r\n    && metamask.isConnected()\r\n    && metamask.getAddress().toLowerCase() == addr.toLowerCase()\r\n  ) return true\r\n\r\n  const name = `${currency.toLowerCase()}Data`\r\n  const { user } = getState()\r\n\r\n  if (!user[name]) {\r\n    return false\r\n  }\r\n\r\n  const { address } = user[name]\r\n\r\n  if (!address) {\r\n    return false\r\n  }\r\n\r\n  return addr === address\r\n}\r\n\r\n\r\nconst downloadPrivateKeys = () => {\r\n  const element = document.createElement('a')\r\n  const text = getText()\r\n  const message = 'Check your browser downloads'\r\n\r\n  element.setAttribute('href', `data:text/plaincharset=utf-8,${encodeURIComponent(text)}`)\r\n  element.setAttribute('download', `${window.location.hostname}_keys_${moment().format('DD.MM.YYYY')}.txt`)\r\n\r\n  element.style.display = 'none'\r\n  document.body.appendChild(element)\r\n  element.click()\r\n  document.body.removeChild(element)\r\n\r\n  actions.notifications.show(constants.notifications.Message, {\r\n    message,\r\n  })\r\n  //@\r\n  localStorage.setItem(constants.localStorage.privateKeysSaved, true)\r\n}\r\n\r\nwindow.downloadPrivateKeys = downloadPrivateKeys\r\n\r\nconst getAuthData = (name) => {\r\n  const { user } = getState()\r\n  return user[`${name}Data`]\r\n}\r\n\r\n// const addMessagingToken = (token) => {\r\n//   console.log(\"Added firebase token to redux store: \", token)\r\n//   reducers.user.addMessagingToken({ token })\r\n// }\r\n\r\nexport default {\r\n  sign,\r\n  sign_btc_2fa,\r\n  sign_btc_pin,\r\n  sign_btc_multisig,\r\n  sign_to_tokens,\r\n  getBalances,\r\n  getDemoMoney,\r\n  setTransactions,\r\n  downloadPrivateKeys,\r\n  getText,\r\n  isOwner,\r\n  getExchangeRate,\r\n  getReputation,\r\n  getInfoAboutCurrency,\r\n  getAuthData,\r\n  getWithdrawWallet,\r\n  fetchMultisigStatus,\r\n  pullActiveCurrency,\r\n  // addMessagingToken,\r\n}\r\n"]}]}