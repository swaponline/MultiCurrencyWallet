{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\token.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\token.ts","mtime":1614852129388},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eSI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCi8vIEB0cy1ub2NoZWNrCmltcG9ydCBFUkMyMF9BQkkgZnJvbSAnaHVtYW4tc3RhbmRhcmQtdG9rZW4tYWJpJzsKaW1wb3J0IGhlbHBlcnMsIHsgYXBpTG9vcGVyLCBjb25zdGFudHMsIGNhY2hlU3RvcmFnZUdldCwgY2FjaGVTdG9yYWdlU2V0IH0gZnJvbSAnaGVscGVycyc7CmltcG9ydCB7IGdldFN0YXRlIH0gZnJvbSAncmVkdXgvY29yZSc7CmltcG9ydCBhY3Rpb25zIGZyb20gJ3JlZHV4L2FjdGlvbnMnOwppbXBvcnQgeyB3ZWIzIH0gZnJvbSAnaGVscGVycy93ZWIzJzsKaW1wb3J0IHJlZHVjZXJzIGZyb20gJ3JlZHV4L2NvcmUvcmVkdWNlcnMnOwppbXBvcnQgY29uZmlnIGZyb20gJ2hlbHBlcnMvZXh0ZXJuYWxDb25maWcnOwppbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnOwppbXBvcnQgSW5wdXREYXRhRGVjb2RlciBmcm9tICdldGhlcmV1bS1pbnB1dC1kYXRhLWRlY29kZXInOwppbXBvcnQgbWV0YW1hc2sgZnJvbSAnaGVscGVycy9tZXRhbWFzayc7CnZhciBoYXNBZG1pbkZlZSA9IGNvbmZpZyAmJiBjb25maWcub3B0cyAmJiBjb25maWcub3B0cy5mZWUgJiYgY29uZmlnLm9wdHMuZmVlLmVyYzIwICYmIGNvbmZpZy5vcHRzLmZlZS5lcmMyMC5mZWUgJiYgY29uZmlnLm9wdHMuZmVlLmVyYzIwLmFkZHJlc3MgJiYgY29uZmlnLm9wdHMuZmVlLmVyYzIwLm1pbiA/IGNvbmZpZy5vcHRzLmZlZS5lcmMyMCA6IGZhbHNlOwp2YXIgZXJjMjBEZWNvZGVyID0gbmV3IElucHV0RGF0YURlY29kZXIoRVJDMjBfQUJJKTsKCnZhciBBZGRDdXN0b21FUkMyMCA9IGZ1bmN0aW9uIEFkZEN1c3RvbUVSQzIwKGNvbnRyYWN0LCBzeW1ib2wsIGRlY2ltYWxzKSB7CiAgdmFyIGNvbmZpZ1N0b3JhZ2UgPSBwcm9jZXNzLmVudi5NQUlOTkVUID8gJ21haW5uZXQnIDogJ3Rlc3RuZXQnOwogIHZhciB0b2tlbnNJbmZvID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMubG9jYWxTdG9yYWdlLmN1c3RvbUVSQykpOwoKICBpZiAoIXRva2Vuc0luZm8pIHsKICAgIHRva2Vuc0luZm8gPSB7CiAgICAgIG1haW5uZXQ6IHt9LAogICAgICB0ZXN0bmV0OiB7fQogICAgfTsKICB9CgogIHRva2Vuc0luZm9bY29uZmlnU3RvcmFnZV1bY29udHJhY3RdID0gewogICAgYWRkcmVzczogY29udHJhY3QsCiAgICBzeW1ib2w6IHN5bWJvbCwKICAgIGRlY2ltYWxzOiBkZWNpbWFscwogIH07CiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY29uc3RhbnRzLmxvY2FsU3RvcmFnZS5jdXN0b21FUkMsIEpTT04uc3RyaW5naWZ5KHRva2Vuc0luZm8pKTsKfTsKCnZhciBHZXRDdXN0cm9tRVJDMjAgPSBmdW5jdGlvbiBHZXRDdXN0cm9tRVJDMjAoKSB7CiAgdmFyIGNvbmZpZ1N0b3JhZ2UgPSBwcm9jZXNzLmVudi5NQUlOTkVUID8gJ21haW5uZXQnIDogJ3Rlc3RuZXQnOwogIHZhciB0b2tlbnNJbmZvID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjb25zdGFudHMubG9jYWxTdG9yYWdlLmN1c3RvbUVSQykpOwogIGlmICghdG9rZW5zSW5mbyB8fCAhdG9rZW5zSW5mb1tjb25maWdTdG9yYWdlXSkgcmV0dXJuIHt9OwogIHJldHVybiB0b2tlbnNJbmZvW2NvbmZpZ1N0b3JhZ2VdOwp9OwoKdmFyIGxvZ2luID0gZnVuY3Rpb24gbG9naW4ocHJpdmF0ZUtleSwgY29udHJhY3RBZGRyZXNzLCBuYW1lQ29udHJhY3QsIGRlY2ltYWxzLCBmdWxsTmFtZSkgewogIHZhciBkYXRhOwoKICBpZiAocHJpdmF0ZUtleSkgewogICAgZGF0YSA9IHdlYjMuZXRoLmFjY291bnRzLnByaXZhdGVLZXlUb0FjY291bnQocHJpdmF0ZUtleSk7CiAgfSBlbHNlIHsKICAgIGNvbnNvbGUuaW5mbygnQ3JlYXRlZCBhY2NvdW50IEVUSCBUb2tlbiAuLi4nKTsKICAgIGRhdGEgPSB3ZWIzLmV0aC5hY2NvdW50cy5jcmVhdGUoKTsKICAgIHdlYjMuZXRoLmFjY291bnRzLndhbGxldC5hZGQoZGF0YSk7CiAgfQoKICB3ZWIzLmV0aC5hY2NvdW50cy53YWxsZXQuYWRkKGRhdGEucHJpdmF0ZUtleSk7CiAgY29uc29sZS5pbmZvKCdMb2dnZWQgaW4gd2l0aCBFVEggVG9rZW4nLCBkYXRhKTsKICBzZXR1cENvbnRyYWN0KGRhdGEuYWRkcmVzcywgY29udHJhY3RBZGRyZXNzLCBuYW1lQ29udHJhY3QsIGRlY2ltYWxzLCBmdWxsTmFtZSk7Cn07Cgp2YXIgc2V0dXBDb250cmFjdCA9IGZ1bmN0aW9uIHNldHVwQ29udHJhY3QoZXRoQWRkcmVzcywgY29udHJhY3RBZGRyZXNzLCBuYW1lQ29udHJhY3QsIGRlY2ltYWxzLCBmdWxsTmFtZSkgewogIC8vQAogIGNvbnNvbGUubG9nKCdzZXR1cCBjb250cmFjdCcsIHdlYjMsIHdlYjMuaXNNZXRhbWFzayk7CgogIGlmICghd2ViMy5ldGguYWNjb3VudHMud2FsbGV0W2V0aEFkZHJlc3NdKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3dlYjMgZG9lcyBub3QgaGF2ZSBnaXZlbiBhZGRyZXNzJyk7CiAgfQoKICB2YXIgaXNTd2VlcGVkID0gYWN0aW9ucy5ldGguaXNTd2VlcGVkKCk7CiAgdmFyIGRhdGEgPSB7CiAgICBhZGRyZXNzOiBldGhBZGRyZXNzLAogICAgYmFsYW5jZTogMCwKICAgIG5hbWU6IG5hbWVDb250cmFjdC50b0xvd2VyQ2FzZSgpLAogICAgZnVsbE5hbWU6IGZ1bGxOYW1lLAogICAgY3VycmVuY3k6IG5hbWVDb250cmFjdC50b1VwcGVyQ2FzZSgpLAogICAgY29udHJhY3RBZGRyZXNzOiBjb250cmFjdEFkZHJlc3MsCiAgICBkZWNpbWFsczogZGVjaW1hbHMsCiAgICBjdXJyZW5jeVJhdGU6IDEsCiAgICBpc01uZW1vbmljOiBpc1N3ZWVwZWQsCiAgICBpc01ldGFtYXNrOiBmYWxzZSwKICAgIGlzRVJDMjA6IHRydWUKICB9OwoKICBpZiAobWV0YW1hc2suaXNFbmFibGVkKCkgJiYgbWV0YW1hc2suaXNDb25uZWN0ZWQoKSkgewogICAgZGF0YSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgZGF0YSksIHt9LCB7CiAgICAgIGFkZHJlc3M6IG1ldGFtYXNrLmdldEFkZHJlc3MoKSwKICAgICAgaXNNZXRhbWFzazogdHJ1ZSwKICAgICAgLy9ACiAgICAgIGlzQ29ubmVjdGVkOiB0cnVlCiAgICB9KTsKICB9CgogIHJlZHVjZXJzLnVzZXIuc2V0VG9rZW5BdXRoRGF0YSh7CiAgICBuYW1lOiBkYXRhLm5hbWUsCiAgICBkYXRhOiBkYXRhCiAgfSk7Cn07Cgp2YXIgZ2V0QmFsYW5jZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGN1cnJlbmN5KSB7CiAgICB2YXIgX2dldFN0YXRlLCB0b2tlbnNEYXRhLCBfdG9rZW5zRGF0YSRjdXJyZW5jeSQsIGludGVybmFsQWRkcmVzcywgY29udHJhY3RBZGRyZXNzLCBkZWNpbWFscywgbmFtZSwgYWRkcmVzcywgYmFsYW5jZUluQ2FjaGUsIEVSQzIwLCByZXN1bHQsIGFtb3VudDsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBpZiAoIShjdXJyZW5jeSA9PT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIF9nZXRTdGF0ZSA9IGdldFN0YXRlKCksIHRva2Vuc0RhdGEgPSBfZ2V0U3RhdGUudXNlci50b2tlbnNEYXRhOwogICAgICAgICAgICBfdG9rZW5zRGF0YSRjdXJyZW5jeSQgPSB0b2tlbnNEYXRhW2N1cnJlbmN5LnRvTG93ZXJDYXNlKCldLCBpbnRlcm5hbEFkZHJlc3MgPSBfdG9rZW5zRGF0YSRjdXJyZW5jeSQuYWRkcmVzcywgY29udHJhY3RBZGRyZXNzID0gX3Rva2Vuc0RhdGEkY3VycmVuY3kkLmNvbnRyYWN0QWRkcmVzcywgZGVjaW1hbHMgPSBfdG9rZW5zRGF0YSRjdXJyZW5jeSQuZGVjaW1hbHMsIG5hbWUgPSBfdG9rZW5zRGF0YSRjdXJyZW5jeSQubmFtZTsKICAgICAgICAgICAgYWRkcmVzcyA9IG1ldGFtYXNrLmlzQ29ubmVjdGVkKCkgPyBtZXRhbWFzay5nZXRBZGRyZXNzKCkgOiBmYWxzZSB8fCBpbnRlcm5hbEFkZHJlc3M7CiAgICAgICAgICAgIGJhbGFuY2VJbkNhY2hlID0gY2FjaGVTdG9yYWdlR2V0KCdjdXJyZW5jeUJhbGFuY2VzJywgInRva2VuXyIuY29uY2F0KGN1cnJlbmN5LCAiXyIpLmNvbmNhdChhZGRyZXNzKSk7CgogICAgICAgICAgICBpZiAoIShiYWxhbmNlSW5DYWNoZSAhPT0gZmFsc2UpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0VG9rZW5CYWxhbmNlKHsKICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgIGFtb3VudDogYmFsYW5jZUluQ2FjaGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGJhbGFuY2VJbkNhY2hlKTsKCiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIEVSQzIwID0gbmV3IHdlYjMuZXRoLkNvbnRyYWN0KEVSQzIwX0FCSSwgY29udHJhY3RBZGRyZXNzKTsKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDEwOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgIHJldHVybiBFUkMyMC5tZXRob2RzLmJhbGFuY2VPZihhZGRyZXNzKS5jYWxsKCk7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgYW1vdW50ID0gbmV3IEJpZ051bWJlcihTdHJpbmcocmVzdWx0KSkuZGl2aWRlZEJ5KG5ldyBCaWdOdW1iZXIoU3RyaW5nKDEwKSkucG93KGRlY2ltYWxzKSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgcmVkdWNlcnMudXNlci5zZXRUb2tlbkJhbGFuY2UoewogICAgICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNhY2hlU3RvcmFnZVNldCgnY3VycmVuY3lCYWxhbmNlcycsICJ0b2tlbl8iLmNvbmNhdChjdXJyZW5jeSwgIl8iKS5jb25jYXQoYWRkcmVzcyksIGFtb3VudCwgNjApOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBhbW91bnQpOwoKICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyMDsKICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgxMCk7CiAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0VG9rZW5CYWxhbmNlRXJyb3IoewogICAgICAgICAgICAgIG5hbWU6IG5hbWUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzEwLCAyMF1dKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBnZXRCYWxhbmNlKF94KSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKCnZhciBmZXRjaEJhbGFuY2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGFkZHJlc3MsIGNvbnRyYWN0QWRkcmVzcywgZGVjaW1hbHMpIHsKICAgIHZhciBFUkMyMCwgcmVzdWx0LCBhbW91bnQ7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgRVJDMjAgPSBuZXcgd2ViMy5ldGguQ29udHJhY3QoRVJDMjBfQUJJLCBjb250cmFjdEFkZHJlc3MpOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBFUkMyMC5tZXRob2RzLmJhbGFuY2VPZihhZGRyZXNzKS5jYWxsKCk7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgYW1vdW50ID0gbmV3IEJpZ051bWJlcihTdHJpbmcocmVzdWx0KSkuZGl2aWRlZEJ5KG5ldyBCaWdOdW1iZXIoU3RyaW5nKDEwKSkucG93KGRlY2ltYWxzKSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGFtb3VudCk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMik7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gZmV0Y2hCYWxhbmNlKF94MiwgX3gzLCBfeDQpIHsKICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKCnZhciBnZXRUcmFuc2FjdGlvbiA9IGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uKG93bkFkZHJlc3MsIG93blR5cGUpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgIHZhciBfZ2V0U3RhdGUyID0gZ2V0U3RhdGUoKSwKICAgICAgICB0b2tlbnNEYXRhID0gX2dldFN0YXRlMi51c2VyLnRva2Vuc0RhdGE7CgogICAgaWYgKG93blR5cGUgPT09IHVuZGVmaW5lZCkgewogICAgICBjb25zb2xlLndhcm4oJ2dldFRyYW5zYWN0aW9uIC0gdG9rZW4gdHlwZSBub3QgZGVmZmluZWQnLCBvd25BZGRyZXNzLCBvd25UeXBlKTsKICAgICAgcmVzb2x2ZShbXSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgX3Rva2Vuc0RhdGEkb3duVHlwZSR0ID0gdG9rZW5zRGF0YVtvd25UeXBlLnRvTG93ZXJDYXNlKCldLAogICAgICAgIGFkZHJlc3MgPSBfdG9rZW5zRGF0YSRvd25UeXBlJHQuYWRkcmVzcywKICAgICAgICBjb250cmFjdEFkZHJlc3MgPSBfdG9rZW5zRGF0YSRvd25UeXBlJHQuY29udHJhY3RBZGRyZXNzOwogICAgY29uc29sZS5sb2coJ2N1cnJlbmN5JywgYWRkcmVzcywgY29udHJhY3RBZGRyZXNzKTsKICAgIHZhciB1cmwgPSBbIj9tb2R1bGU9YWNjb3VudCZhY3Rpb249dG9rZW50eCIsICImY29udHJhY3RhZGRyZXNzPSIuY29uY2F0KGNvbnRyYWN0QWRkcmVzcyksICImYWRkcmVzcz0iLmNvbmNhdChvd25BZGRyZXNzIHx8IGFkZHJlc3MpLCAiJnN0YXJ0YmxvY2s9MCZlbmRibG9jaz05OTk5OTk5OSIsICImc29ydD1hc2MmYXBpa2V5PSIuY29uY2F0KGNvbmZpZy5hcGkuZXRoZXJzY2FuX0FwaUtleSldLmpvaW4oJycpOwogICAgcmV0dXJuIGFwaUxvb3Blci5nZXQoJ2V0aGVyc2NhbicsIHVybCwgey8vIEBUb0RvIC0gbWF5IGJlIG5lZWQgY2FjaGUgb3IgdXNlIGluIG1lbW9yeSBjYWNoZQogICAgICAvLyBjYWNoZVJlc3BvbnNlOiA2MCAqIDEwMDAKICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICB2YXIgdHJhbnNhY3Rpb25zID0gcmVzLnJlc3VsdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSA+IDA7CiAgICAgIH0pLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjb25maXJtYXRpb25zOiBpdGVtLmNvbmZpcm1hdGlvbnMsCiAgICAgICAgICB0eXBlOiBvd25UeXBlLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICBoYXNoOiBpdGVtLmhhc2gsCiAgICAgICAgICBjb250cmFjdEFkZHJlc3M6IGl0ZW0uY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgc3RhdHVzOiBpdGVtLmJsb2NrSGFzaCAhPSBudWxsID8gMSA6IDAsCiAgICAgICAgICB2YWx1ZTogbmV3IEJpZ051bWJlcihTdHJpbmcoaXRlbS52YWx1ZSkpLmRpdmlkZWRCeShuZXcgQmlnTnVtYmVyKDEwKS5wb3coTnVtYmVyKGl0ZW0udG9rZW5EZWNpbWFsKSkpLnRvTnVtYmVyKCksCiAgICAgICAgICBhZGRyZXNzOiBpdGVtLnRvLAogICAgICAgICAgZGF0ZTogaXRlbS50aW1lU3RhbXAgKiAxMDAwLAogICAgICAgICAgZGlyZWN0aW9uOiBhZGRyZXNzLnRvTG93ZXJDYXNlKCkgPT09IGl0ZW0udG8udG9Mb3dlckNhc2UoKSA/ICdpbicgOiAnb3V0JwogICAgICAgIH07CiAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtLmRpcmVjdGlvbiA9PT0gJ2luJykgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKCFoYXNBZG1pbkZlZSkgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGFkZHJlc3MudG9Mb3dlckNhc2UoKSA9PT0gaGFzQWRtaW5GZWUuYWRkcmVzcy50b0xvd2VyQ2FzZSgpKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoaXRlbS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkgPT09IGhhc0FkbWluRmVlLmFkZHJlc3MudG9Mb3dlckNhc2UoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KTsKICAgICAgcmVzb2x2ZSh0cmFuc2FjdGlvbnMpOwogICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICByZXNvbHZlKFtdKTsKICAgIH0pOwogIH0pOwp9OwoKdmFyIHdpdGhUb2tlbiA9IGZ1bmN0aW9uIHdpdGhUb2tlbihuYW1lKSB7CiAgaWYgKCFuYW1lKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ3NlbmQ6IG5hbWUgaXMgdW5kZWZpbmVkJyk7CiAgfQoKICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoKICB2YXIgX2dldFN0YXRlMyA9IGdldFN0YXRlKCksCiAgICAgIGFkZHJlc3MgPSBfZ2V0U3RhdGUzLnVzZXIudG9rZW5zRGF0YVtuYW1lXS5hZGRyZXNzOwoKICB2YXIgX2NvbmZpZyRlcmMyMCRuYW1lID0gY29uZmlnLmVyYzIwW25hbWVdLAogICAgICBjb250cmFjdEFkZHJlc3MgPSBfY29uZmlnJGVyYzIwJG5hbWUuYWRkcmVzcywKICAgICAgZGVjaW1hbHMgPSBfY29uZmlnJGVyYzIwJG5hbWUuZGVjaW1hbHM7CiAgdmFyIHRva2VuQ29udHJhY3QgPSBuZXcgd2ViMy5ldGguQ29udHJhY3QoRVJDMjBfQUJJLCBjb250cmFjdEFkZHJlc3MsIHsKICAgIGZyb206IGFkZHJlc3MKICB9KTsKCiAgdmFyIHRvV2VpID0gZnVuY3Rpb24gdG9XZWkoYW1vdW50KSB7CiAgICByZXR1cm4gbmV3IEJpZ051bWJlcihhbW91bnQpLnRpbWVzKG5ldyBCaWdOdW1iZXIoMTApLnBvdyhkZWNpbWFscykpLnRvU3RyaW5nKDEwKTsKICB9OwoKICB2YXIgZnJvbVdlaSA9IGZ1bmN0aW9uIGZyb21XZWkod2VpKSB7CiAgICByZXR1cm4gbmV3IEJpZ051bWJlcih3ZWkpLmRpdihuZXcgQmlnTnVtYmVyKDEwKS5wb3coZGVjaW1hbHMpKTsKICB9OwoKICByZXR1cm4gewogICAgY29udHJhY3RBZGRyZXNzOiBjb250cmFjdEFkZHJlc3MsCiAgICB0b2tlbkNvbnRyYWN0OiB0b2tlbkNvbnRyYWN0LAogICAgZGVjaW1hbHM6IGRlY2ltYWxzLAogICAgdG9XZWk6IHRvV2VpLAogICAgZnJvbVdlaTogZnJvbVdlaQogIH07Cn07IC8vQAoKCnZhciBmZXRjaEZlZXMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgdmFyIF9yZWY0LAogICAgICAgIGdhc1ByaWNlLAogICAgICAgIGdhc0xpbWl0LAogICAgICAgIHNwZWVkLAogICAgICAgIF9hcmdzMyA9IGFyZ3VtZW50czsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX3JlZjQgPSBfYXJnczMubGVuZ3RoID4gMCAmJiBfYXJnczNbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzM1swXSA6IHt9LCBnYXNQcmljZSA9IF9yZWY0Lmdhc1ByaWNlLCBnYXNMaW1pdCA9IF9yZWY0Lmdhc0xpbWl0LCBzcGVlZCA9IF9yZWY0LnNwZWVkOwogICAgICAgICAgICBfY29udGV4dDMudDAgPSBnYXNQcmljZTsKCiAgICAgICAgICAgIGlmIChfY29udGV4dDMudDApIHsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIGhlbHBlcnMuZXRoVG9rZW4uZXN0aW1hdGVHYXNQcmljZSh7CiAgICAgICAgICAgICAgc3BlZWQ6IHNwZWVkCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgX2NvbnRleHQzLnQwID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBnYXNQcmljZSA9IF9jb250ZXh0My50MDsKICAgICAgICAgICAgZ2FzTGltaXQgPSBnYXNMaW1pdCB8fCBjb25zdGFudHMuZGVmYXVsdEZlZVJhdGVzLmV0aFRva2VuLmxpbWl0LnNlbmQ7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgZ2FzOiBnYXNMaW1pdCwKICAgICAgICAgICAgICBnYXNQcmljZTogZ2FzUHJpY2UKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMyk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gZmV0Y2hGZWVzKCkgewogICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIGdldFR4ID0gZnVuY3Rpb24gZ2V0VHgodHhSYXcpIHsKICByZXR1cm4gdHhSYXcudHJhbnNhY3Rpb25IYXNoOwp9OwoKdmFyIGdldFR4Um91dGVyID0gZnVuY3Rpb24gZ2V0VHhSb3V0ZXIodHhJZCwgY3VycmVuY3kpIHsKICByZXR1cm4gIi90b2tlbi8iLmNvbmNhdChjdXJyZW5jeS50b1VwcGVyQ2FzZSgpLCAiL3R4LyIpLmNvbmNhdCh0eElkKTsKfTsKCnZhciBnZXRMaW5rVG9JbmZvID0gZnVuY3Rpb24gZ2V0TGlua1RvSW5mbyh0eCkgewogIGlmICghdHgpIHsKICAgIHJldHVybjsKICB9CgogIHJldHVybiAiIi5jb25jYXQoY29uZmlnLmxpbmsuZXRoZXJzY2FuLCAiL3R4LyIpLmNvbmNhdCh0eCk7Cn07IC8vQAoKCnZhciBzZW5kVHJhbnNhY3Rpb24gPSBmdW5jdGlvbiBzZW5kVHJhbnNhY3Rpb24oX3JlZjUpIHsKICB2YXIgY29udHJhY3QgPSBfcmVmNS5jb250cmFjdCwKICAgICAgbWV0aG9kID0gX3JlZjUubWV0aG9kOwoKICB2YXIgX3JlZjYgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9LAogICAgICBhcmdzID0gX3JlZjYuYXJncywKICAgICAgX3JlZjYkcGFyYW1zID0gX3JlZjYucGFyYW1zLAogICAgICBwYXJhbXMgPSBfcmVmNiRwYXJhbXMgPT09IHZvaWQgMCA/IHt9IDogX3JlZjYkcGFyYW1zOwoKICB2YXIgY2FsbGJhY2sgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDsKICByZXR1cm4gbmV3IFByb21pc2UoIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICB2YXIgX3JlZjcgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIF9jb250cmFjdCRtZXRob2RzOwoKICAgICAgdmFyIHJlY2VpcHQ7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gKF9jb250cmFjdCRtZXRob2RzID0gY29udHJhY3QubWV0aG9kcylbbWV0aG9kXS5hcHBseShfY29udHJhY3QkbWV0aG9kcywgX3RvQ29uc3VtYWJsZUFycmF5KGFyZ3MpKS5zZW5kKHBhcmFtcykub24oJ3RyYW5zYWN0aW9uSGFzaCcsIGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKICAgICAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGhhc2gpOwogICAgICAgICAgICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZWNlaXB0ID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgcmVzb2x2ZShyZWNlaXB0KTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU0KTsKICAgIH0pKTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKF94NSwgX3g2KSB7CiAgICAgIHJldHVybiBfcmVmNy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCkpOwp9OwoKdmFyIHNlbmQgPSBmdW5jdGlvbiBzZW5kKGRhdGEpIHsKICByZXR1cm4gaGFzQWRtaW5GZWUgPyBzZW5kV2l0aEFkbWluRmVlKGRhdGEpIDogc2VuZERlZmF1bHQoZGF0YSk7Cn07IC8vQAoKCnZhciBzZW5kV2l0aEFkbWluRmVlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgIHZhciBfcmVmOCwKICAgICAgICBuYW1lLAogICAgICAgIGZyb20sCiAgICAgICAgdG8sCiAgICAgICAgYW1vdW50LAogICAgICAgIGZlZUNvbmZpZywKICAgICAgICBfd2l0aFRva2VuLAogICAgICAgIHRva2VuQ29udHJhY3QsCiAgICAgICAgdG9XZWksCiAgICAgICAgX2NvbmZpZyRvcHRzJGZlZSRlcmMsCiAgICAgICAgYWRtaW5GZWUsCiAgICAgICAgYWRtaW5GZWVBZGRyZXNzLAogICAgICAgIGFkbWluRmVlTWluVmFsdWUsCiAgICAgICAgYWRtaW5GZWVNaW4sCiAgICAgICAgZmVlRnJvbUFtb3VudCwKICAgICAgICBwYXJhbXMsCiAgICAgICAgd2FsbGV0RGF0YSwKICAgICAgICBuZXdBbW91bnQsCiAgICAgICAgY2FsbE1ldGhvZCwKICAgICAgICBfYXJnczYgPSBhcmd1bWVudHM7CgogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9yZWY4ID0gX2FyZ3M2Lmxlbmd0aCA+IDAgJiYgX2FyZ3M2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczZbMF0gOiB7fTsKICAgICAgICAgICAgbmFtZSA9IF9yZWY4Lm5hbWUsIGZyb20gPSBfcmVmOC5mcm9tLCB0byA9IF9yZWY4LnRvLCBhbW91bnQgPSBfcmVmOC5hbW91bnQsIGZlZUNvbmZpZyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfcmVmOCwgWyJuYW1lIiwgImZyb20iLCAidG8iLCAiYW1vdW50Il0pOwogICAgICAgICAgICBfd2l0aFRva2VuID0gd2l0aFRva2VuKG5hbWUpLCB0b2tlbkNvbnRyYWN0ID0gX3dpdGhUb2tlbi50b2tlbkNvbnRyYWN0LCB0b1dlaSA9IF93aXRoVG9rZW4udG9XZWk7CiAgICAgICAgICAgIF9jb25maWckb3B0cyRmZWUkZXJjID0gY29uZmlnLm9wdHMuZmVlLmVyYzIwLCBhZG1pbkZlZSA9IF9jb25maWckb3B0cyRmZWUkZXJjLmZlZSwgYWRtaW5GZWVBZGRyZXNzID0gX2NvbmZpZyRvcHRzJGZlZSRlcmMuYWRkcmVzcywgYWRtaW5GZWVNaW5WYWx1ZSA9IF9jb25maWckb3B0cyRmZWUkZXJjLm1pbjsKICAgICAgICAgICAgYWRtaW5GZWVNaW4gPSBuZXcgQmlnTnVtYmVyKGFkbWluRmVlTWluVmFsdWUpOyAvLyBmZWUgLSBmcm9tIGFtb3VudCAtIHBlcmNlbnQKCiAgICAgICAgICAgIGZlZUZyb21BbW91bnQgPSBuZXcgQmlnTnVtYmVyKGFkbWluRmVlKS5kaXZpZGVkQnkoMTAwKS5tdWx0aXBsaWVkQnkoYW1vdW50KTsKICAgICAgICAgICAgaWYgKGFkbWluRmVlTWluLmlzR3JlYXRlclRoYW4oZmVlRnJvbUFtb3VudCkpIGZlZUZyb21BbW91bnQgPSBhZG1pbkZlZU1pbjsKICAgICAgICAgICAgZmVlRnJvbUFtb3VudCA9IHRvV2VpKGZlZUZyb21BbW91bnQudG9OdW1iZXIoKSk7IC8vIEFkbWluIGZlZQoKICAgICAgICAgICAgX2NvbnRleHQ2LnQwID0gX29iamVjdFNwcmVhZDsKICAgICAgICAgICAgX2NvbnRleHQ2LnQxID0gX29iamVjdFNwcmVhZDsKICAgICAgICAgICAgX2NvbnRleHQ2LnQyID0ge307CiAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTM7CiAgICAgICAgICAgIHJldHVybiBmZXRjaEZlZXMoX29iamVjdFNwcmVhZCh7fSwgZmVlQ29uZmlnKSk7CgogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgX2NvbnRleHQ2LnQzID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0Ni50NCA9ICgwLCBfY29udGV4dDYudDEpKF9jb250ZXh0Ni50MiwgX2NvbnRleHQ2LnQzKTsKICAgICAgICAgICAgX2NvbnRleHQ2LnQ1ID0ge307CiAgICAgICAgICAgIF9jb250ZXh0Ni50NiA9IHsKICAgICAgICAgICAgICBmcm9tOiBmcm9tCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHBhcmFtcyA9ICgwLCBfY29udGV4dDYudDApKF9jb250ZXh0Ni50NCwgX2NvbnRleHQ2LnQ1LCBfY29udGV4dDYudDYpOwogICAgICAgICAgICB3YWxsZXREYXRhID0gYWN0aW9ucy5jb3JlLmdldFdhbGxldCh7CiAgICAgICAgICAgICAgYWRkcmVzczogZnJvbSwKICAgICAgICAgICAgICBjdXJyZW5jeTogbmFtZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbmV3QW1vdW50ID0gdG9XZWkoYW1vdW50KTsKICAgICAgICAgICAgY2FsbE1ldGhvZCA9IHsKICAgICAgICAgICAgICBjb250cmFjdDogdG9rZW5Db250cmFjdCwKICAgICAgICAgICAgICBtZXRob2Q6ICd0cmFuc2ZlcicKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICB2YXIgcmVjZWlwdCA9IHRva2VuQ29udHJhY3QubWV0aG9kcy50cmFuc2Zlcih0bywgbmV3QW1vdW50KS5zZW5kKHBhcmFtcykub24oJ3RyYW5zYWN0aW9uSGFzaCcsIGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgICAgICAgICB2YXIgdHhJZCA9ICIiLmNvbmNhdChjb25maWcubGluay5ldGhlcnNjYW4sICIvdHgvIikuY29uY2F0KGhhc2gpOwogICAgICAgICAgICAgICAgYWN0aW9ucy5sb2FkZXIuc2hvdyh0cnVlLCB7CiAgICAgICAgICAgICAgICAgIHR4SWQ6IHR4SWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJlY2VpcHQudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlKHJlY2VpcHQpOwogICAgICAgICAgICAgICAgaWYgKHdhbGxldERhdGEuaXNNZXRhbWFzaykgcmV0dXJuOyAvLyBTZW5kIGFkbWluIGZlZQoKICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKCAvKiNfX1BVUkVfXyovX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgICAgICAgICAgIHZhciByZWNlaXB0QWRtaW5GZWU7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW5Db250cmFjdC5tZXRob2RzLnRyYW5zZmVyKGFkbWluRmVlQWRkcmVzcywgZmVlRnJvbUFtb3VudCkuc2VuZChwYXJhbXMpLm9uKCd0cmFuc2FjdGlvbkhhc2gnLCBmdW5jdGlvbiAoaGFzaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0VSQzIwIGFkbWluIGZlZSB0eCcsIGhhc2gpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHRBZG1pbkZlZSA9IF9jb250ZXh0NS5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTUpOwogICAgICAgICAgICAgICAgfSkpKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU2KTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBzZW5kV2l0aEFkbWluRmVlKCkgewogICAgcmV0dXJuIF9yZWY5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOyAvL0AKCgp2YXIgc2VuZERlZmF1bHQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMTIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgIHZhciBfcmVmMTEsCiAgICAgICAgbmFtZSwKICAgICAgICBmcm9tLAogICAgICAgIHRvLAogICAgICAgIGFtb3VudCwKICAgICAgICBmZWVDb25maWcsCiAgICAgICAgX3dpdGhUb2tlbjIsCiAgICAgICAgdG9rZW5Db250cmFjdCwKICAgICAgICB0b1dlaSwKICAgICAgICBwYXJhbXMsCiAgICAgICAgbmV3QW1vdW50LAogICAgICAgIGNhbGxNZXRob2QsCiAgICAgICAgX2FyZ3M4ID0gYXJndW1lbnRzOwoKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfcmVmMTEgPSBfYXJnczgubGVuZ3RoID4gMCAmJiBfYXJnczhbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzOFswXSA6IHt9OwogICAgICAgICAgICBuYW1lID0gX3JlZjExLm5hbWUsIGZyb20gPSBfcmVmMTEuZnJvbSwgdG8gPSBfcmVmMTEudG8sIGFtb3VudCA9IF9yZWYxMS5hbW91bnQsIGZlZUNvbmZpZyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfcmVmMTEsIFsibmFtZSIsICJmcm9tIiwgInRvIiwgImFtb3VudCJdKTsKICAgICAgICAgICAgX3dpdGhUb2tlbjIgPSB3aXRoVG9rZW4obmFtZSksIHRva2VuQ29udHJhY3QgPSBfd2l0aFRva2VuMi50b2tlbkNvbnRyYWN0LCB0b1dlaSA9IF93aXRoVG9rZW4yLnRvV2VpOwogICAgICAgICAgICBfY29udGV4dDgudDAgPSBfb2JqZWN0U3ByZWFkOwogICAgICAgICAgICBfY29udGV4dDgudDEgPSBfb2JqZWN0U3ByZWFkOwogICAgICAgICAgICBfY29udGV4dDgudDIgPSB7fTsKICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA4OwogICAgICAgICAgICByZXR1cm4gZmV0Y2hGZWVzKF9vYmplY3RTcHJlYWQoe30sIGZlZUNvbmZpZykpOwoKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgX2NvbnRleHQ4LnQzID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0OC50NCA9ICgwLCBfY29udGV4dDgudDEpKF9jb250ZXh0OC50MiwgX2NvbnRleHQ4LnQzKTsKICAgICAgICAgICAgX2NvbnRleHQ4LnQ1ID0ge307CiAgICAgICAgICAgIF9jb250ZXh0OC50NiA9IHsKICAgICAgICAgICAgICBmcm9tOiBmcm9tCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHBhcmFtcyA9ICgwLCBfY29udGV4dDgudDApKF9jb250ZXh0OC50NCwgX2NvbnRleHQ4LnQ1LCBfY29udGV4dDgudDYpOwogICAgICAgICAgICBuZXdBbW91bnQgPSB0b1dlaShhbW91bnQpOwogICAgICAgICAgICBjYWxsTWV0aG9kID0gewogICAgICAgICAgICAgIGNvbnRyYWN0OiB0b2tlbkNvbnRyYWN0LAogICAgICAgICAgICAgIG1ldGhvZDogJ3RyYW5zZmVyJwogICAgICAgICAgICB9OyAvLyByZXR1cm4gc2VuZFRyYW5zYWN0aW9uKAogICAgICAgICAgICAvLyAgIHsgY29udHJhY3Q6IHRva2VuQ29udHJhY3QsIG1ldGhvZDogJ3RyYW5zZmVyJyB9LAogICAgICAgICAgICAvLyAgIHsgYXJnczogWyB0bywgbmV3QW1vdW50IF0sIHBhcmFtcyB9LAogICAgICAgICAgICAvLyAgIChoYXNoKSA9PiB7CiAgICAgICAgICAgIC8vICAgICBjb25zdCB0eElkID0gYCR7Y29uZmlnLmxpbmsuZXRoZXJzY2FufS90eC8ke2hhc2h9YAogICAgICAgICAgICAvLyAgICAgYWN0aW9ucy5sb2FkZXIuc2hvdyh0cnVlLCB7IHR4SWQgfSkKICAgICAgICAgICAgLy8gICB9KQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIG5ldyBQcm9taXNlKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBfcmVmMTMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgICAgIHZhciByZWNlaXB0OwogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuQ29udHJhY3QubWV0aG9kcy50cmFuc2Zlcih0bywgbmV3QW1vdW50KS5zZW5kKHBhcmFtcykub24oJ3RyYW5zYWN0aW9uSGFzaCcsIGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR4SWQgPSAiIi5jb25jYXQoY29uZmlnLmxpbmsuZXRoZXJzY2FuLCAiL3R4LyIpLmNvbmNhdChoYXNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25zLmxvYWRlci5zaG93KHRydWUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4SWQ6IHR4SWQKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkub24oJ2Vycm9yJywgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpcHQgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZWNlaXB0KTsKCiAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU3KTsKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3g3LCBfeDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMTMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KCkpKTsKCiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlOCk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gc2VuZERlZmF1bHQoKSB7CiAgICByZXR1cm4gX3JlZjEyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOyAvL0AKCgp2YXIgYXBwcm92ZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYxNSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgdmFyIF9yZWYxNCwKICAgICAgICBuYW1lLAogICAgICAgIHRvLAogICAgICAgIGFtb3VudCwKICAgICAgICBmZWVDb25maWcsCiAgICAgICAgX3dpdGhUb2tlbjMsCiAgICAgICAgdG9rZW5Db250cmFjdCwKICAgICAgICB0b1dlaSwKICAgICAgICBwYXJhbXMsCiAgICAgICAgbmV3QW1vdW50LAogICAgICAgIF9hcmdzOSA9IGFyZ3VtZW50czsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX3JlZjE0ID0gX2FyZ3M5Lmxlbmd0aCA+IDAgJiYgX2FyZ3M5WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczlbMF0gOiB7fTsKICAgICAgICAgICAgbmFtZSA9IF9yZWYxNC5uYW1lLCB0byA9IF9yZWYxNC50bywgYW1vdW50ID0gX3JlZjE0LmFtb3VudCwgZmVlQ29uZmlnID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9yZWYxNCwgWyJuYW1lIiwgInRvIiwgImFtb3VudCJdKTsKICAgICAgICAgICAgX3dpdGhUb2tlbjMgPSB3aXRoVG9rZW4obmFtZSksIHRva2VuQ29udHJhY3QgPSBfd2l0aFRva2VuMy50b2tlbkNvbnRyYWN0LCB0b1dlaSA9IF93aXRoVG9rZW4zLnRvV2VpOyAvL0AKCiAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIGZldGNoRmVlcyhfb2JqZWN0U3ByZWFkKHt9LCBmZWVDb25maWcpKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIHBhcmFtcyA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICBuZXdBbW91bnQgPSB0b1dlaShhbW91bnQpOyAvL0AKCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCBzZW5kVHJhbnNhY3Rpb24oewogICAgICAgICAgICAgIGNvbnRyYWN0OiB0b2tlbkNvbnRyYWN0LAogICAgICAgICAgICAgIG1ldGhvZDogJ2FwcHJvdmUnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBhcmdzOiBbdG8sIG5ld0Ftb3VudF0sCiAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgODoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTkpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGFwcHJvdmUoKSB7CiAgICByZXR1cm4gX3JlZjE1LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIHNldEFsbG93YW5jZUZvclRva2VuID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjE3ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKF9yZWYxNikgewogICAgdmFyIG5hbWUsIHRvLCB0YXJnZXRBbGxvd2FuY2UsIGNvbmZpZywgX3dpdGhUb2tlbjQsIHRva2VuQ29udHJhY3QsIHRvV2VpLCBfZ2V0U3RhdGU0LCBhZGRyZXNzLCBhbGxvd2FuY2UsIG5ld1RhcmdldEFsbG93YW5jZTsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIG5hbWUgPSBfcmVmMTYubmFtZSwgdG8gPSBfcmVmMTYudG8sIHRhcmdldEFsbG93YW5jZSA9IF9yZWYxNi50YXJnZXRBbGxvd2FuY2UsIGNvbmZpZyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfcmVmMTYsIFsibmFtZSIsICJ0byIsICJ0YXJnZXRBbGxvd2FuY2UiXSk7CiAgICAgICAgICAgIF93aXRoVG9rZW40ID0gd2l0aFRva2VuKG5hbWUpLCB0b2tlbkNvbnRyYWN0ID0gX3dpdGhUb2tlbjQudG9rZW5Db250cmFjdCwgdG9XZWkgPSBfd2l0aFRva2VuNC50b1dlaTsKICAgICAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgX2dldFN0YXRlNCA9IGdldFN0YXRlKCksIGFkZHJlc3MgPSBfZ2V0U3RhdGU0LnVzZXIudG9rZW5zRGF0YVtuYW1lXS5hZGRyZXNzOwogICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA2OwogICAgICAgICAgICByZXR1cm4gdG9rZW5Db250cmFjdC5tZXRob2RzLmFsbG93YW5jZShhZGRyZXNzLCB0bykuY2FsbCgpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgYWxsb3dhbmNlID0gX2NvbnRleHQxMC5zZW50OwoKICAgICAgICAgICAgaWYgKCFuZXcgQmlnTnVtYmVyKHRvV2VpKHRhcmdldEFsbG93YW5jZSkpLmlzTGVzc1RoYW5PckVxdWFsVG8oYWxsb3dhbmNlKSkgewogICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgUHJvbWlzZS5yZXNvbHZlKCkpOwoKICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgLy8gYnV0IGlmIG5vdCwgc2V0IGFsbG93YW5jZSB0byAxIGJpbGxpb24gKG9yIHJlcXVlc3RlZCB0YXJnZXQgYWxsb3dhbmNlLCBpZiBpdCdzIGJpZ2dlciB0aGFuIDEgYmlsbGlvbikKICAgICAgICAgICAgbmV3VGFyZ2V0QWxsb3dhbmNlID0gQmlnTnVtYmVyLm1heCgxZTksIHRhcmdldEFsbG93YW5jZSk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgYXBwcm92ZShfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgIHRvOiB0bywKICAgICAgICAgICAgICBhbW91bnQ6IG5ld1RhcmdldEFsbG93YW5jZQogICAgICAgICAgICB9LCBjb25maWcpKSk7CgogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUxMCk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gc2V0QWxsb3dhbmNlRm9yVG9rZW4oX3g5KSB7CiAgICByZXR1cm4gX3JlZjE3LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIGZldGNoVG9rZW5UeEluZm8gPSBmdW5jdGlvbiBmZXRjaFRva2VuVHhJbmZvKHRpY2tlciwgaGFzaCwgY2FjaGVSZXNwb25zZSkgewogIHJldHVybiBuZXcgUHJvbWlzZSggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmMTggPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEocmVzb2x2ZSkgewogICAgICB2YXIgdHhJbmZvLCB0eHMsIG91clR4OwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hUeEluZm8oaGFzaCwgY2FjaGVSZXNwb25zZSk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgdHhJbmZvID0gX2NvbnRleHQxMS5zZW50OwoKICAgICAgICAgICAgICBpZiAoIXR4SW5mby5pc0NvbnRyYWN0VHgpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDY7CiAgICAgICAgICAgICAgcmV0dXJuIGdldFRyYW5zYWN0aW9uKHR4SW5mby5zZW5kZXJBZGRyZXNzLCB0aWNrZXIpOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHR4cyA9IF9jb250ZXh0MTEuc2VudDsKICAgICAgICAgICAgICBvdXJUeCA9IHR4cy5maWx0ZXIoZnVuY3Rpb24gKHR4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHguaGFzaC50b0xvd2VyQ2FzZSgpID09PSBoYXNoLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChvdXJUeC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHR4SW5mby5hbW91bnQgPSBvdXJUeFswXS52YWx1ZTsKICAgICAgICAgICAgICAgIHR4SW5mby5hZG1pbkZlZSA9IGZhbHNlOyAvLyBTd2FwIGRvbnQgaGF2ZSBzZXJ2aWNlIGZlZQoKICAgICAgICAgICAgICAgIGlmIChvdXJUeFswXS5kaXJlY3Rpb24gPT0gImluIikgewogICAgICAgICAgICAgICAgICB0eEluZm8gPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHR4SW5mbyksIHt9LCB7CiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJBZGRyZXNzOiB0eEluZm8uc2VuZGVyQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICBzZW5kZXJBZGRyZXNzOiB0eEluZm8ucmVjZWl2ZXJBZGRyZXNzCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICByZXNvbHZlKHR4SW5mbyk7CgogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUxMSk7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeDEwKSB7CiAgICAgIHJldHVybiBfcmVmMTguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpKTsKfTsKCnZhciBmZXRjaFR4SW5mbyA9IGZ1bmN0aW9uIGZldGNoVHhJbmZvKGhhc2gsIGNhY2hlUmVzcG9uc2UpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgIHZhciBfZ2V0U3RhdGU1ID0gZ2V0U3RhdGUoKSwKICAgICAgICB0b2tlbnNEYXRhID0gX2dldFN0YXRlNS51c2VyLnRva2Vuc0RhdGE7CgogICAgdmFyIHVybCA9ICI/bW9kdWxlPXByb3h5JmFjdGlvbj1ldGhfZ2V0VHJhbnNhY3Rpb25CeUhhc2gmdHhoYXNoPSIuY29uY2F0KGhhc2gsICImYXBpa2V5PSIpLmNvbmNhdChjb25maWcuYXBpLmV0aGVyc2Nhbl9BcGlLZXkpOwogICAgcmV0dXJuIGFwaUxvb3Blci5nZXQoJ2V0aGVyc2NhbicsIHVybCwgewogICAgICBjYWNoZVJlc3BvbnNlOiBjYWNoZVJlc3BvbnNlCiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgaWYgKHJlcyAmJiByZXMucmVzdWx0KSB7CiAgICAgICAgdmFyIGFtb3VudCA9IDA7CiAgICAgICAgdmFyIHJlY2VpdmVyQWRkcmVzcyA9IHJlcy5yZXN1bHQudG87CiAgICAgICAgdmFyIGNvbnRyYWN0QWRkcmVzcyA9IHJlcy5yZXN1bHQudG87CiAgICAgICAgdmFyIHRva2VuRGVjaW1hbCA9IDE4OyAvLyDQntC/0YDQtdC00LXQu9C40Lwg0YLQvtC60LXQvSDQv9C+INCw0LTRgNC10YHRgdGDINC60L7QvdGC0YDQsNC60YLQsAoKICAgICAgICBPYmplY3Qua2V5cyh0b2tlbnNEYXRhKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIGlmICh0b2tlbnNEYXRhW2tleV0gJiYgdG9rZW5zRGF0YVtrZXldLmNvbnRyYWN0QWRkcmVzcyAmJiB0b2tlbnNEYXRhW2tleV0uY29udHJhY3RBZGRyZXNzLnRvTG93ZXJDYXNlKCkgPT0gY29udHJhY3RBZGRyZXNzLnRvTG93ZXJDYXNlKCkgJiYgdG9rZW5zRGF0YVtrZXldLmRlY2ltYWxzKSB7CiAgICAgICAgICAgIHRva2VuRGVjaW1hbCA9IHRva2Vuc0RhdGFba2V5XS5kZWNpbWFsczsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHZhciB0eERhdGEgPSBlcmMyMERlY29kZXIuZGVjb2RlRGF0YShyZXMucmVzdWx0LmlucHV0KTsKCiAgICAgICAgaWYgKHR4RGF0YSAmJiAodHhEYXRhLm5hbWUgPT09ICJ0cmFuc2ZlciIgfHwgdHhEYXRhLm1ldGhvZCA9PT0gInRyYW5zZmVyIikgJiYgdHhEYXRhLmlucHV0cyAmJiB0eERhdGEuaW5wdXRzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICByZWNlaXZlckFkZHJlc3MgPSAiMHgiLmNvbmNhdCh0eERhdGEuaW5wdXRzWzBdKTsKICAgICAgICAgIGFtb3VudCA9IG5ldyBCaWdOdW1iZXIodHhEYXRhLmlucHV0c1sxXSkuZGl2KG5ldyBCaWdOdW1iZXIoMTApLnBvdyh0b2tlbkRlY2ltYWwpKS50b1N0cmluZygpOwogICAgICAgIH0gZWxzZSB7Ly8gVGhpcyBpcyBub3QgZXJjMjAgdHJhbnNmZXIgdHggKHN3YXAgdHgpCiAgICAgICAgfQoKICAgICAgICB2YXIgX3JlcyRyZXN1bHQgPSByZXMucmVzdWx0LAogICAgICAgICAgICBmcm9tID0gX3JlcyRyZXN1bHQuZnJvbSwKICAgICAgICAgICAgZ2FzID0gX3JlcyRyZXN1bHQuZ2FzLAogICAgICAgICAgICBnYXNQcmljZSA9IF9yZXMkcmVzdWx0Lmdhc1ByaWNlLAogICAgICAgICAgICBibG9ja0hhc2ggPSBfcmVzJHJlc3VsdC5ibG9ja0hhc2g7IC8vIENhbGMgbWluZXIgZmVlLCB1c2VkIGZvciB0aGlzIHR4CgogICAgICAgIHZhciBtaW5lckZlZSA9IG5ldyBCaWdOdW1iZXIod2ViMy51dGlscy50b0JOKGdhcykudG9OdW1iZXIoKSkubXVsdGlwbGllZEJ5KHdlYjMudXRpbHMudG9CTihnYXNQcmljZSkudG9OdW1iZXIoKSkuZGl2aWRlZEJ5KDFlMTgpLnRvTnVtYmVyKCk7CiAgICAgICAgdmFyIGFkbWluRmVlID0gZmFsc2U7CgogICAgICAgIGlmIChoYXNBZG1pbkZlZSkgewogICAgICAgICAgYWRtaW5GZWUgPSBuZXcgQmlnTnVtYmVyKGhhc0FkbWluRmVlLmZlZSkuZGl2aWRlZEJ5KDEwMCkubXVsdGlwbGllZEJ5KGFtb3VudCk7CiAgICAgICAgICBpZiAobmV3IEJpZ051bWJlcihoYXNBZG1pbkZlZS5taW4pLmlzR3JlYXRlclRoYW4oYWRtaW5GZWUpKSBhZG1pbkZlZSA9IG5ldyBCaWdOdW1iZXIoaGFzQWRtaW5GZWUubWluKTsKICAgICAgICAgIGFkbWluRmVlID0gYWRtaW5GZWUudG9OdW1iZXIoKTsKICAgICAgICB9CgogICAgICAgIHJlc29sdmUoewogICAgICAgICAgYW1vdW50OiBhbW91bnQsCiAgICAgICAgICBhZnRlckJhbGFuY2U6IG51bGwsCiAgICAgICAgICByZWNlaXZlckFkZHJlc3M6IHJlY2VpdmVyQWRkcmVzcywKICAgICAgICAgIHNlbmRlckFkZHJlc3M6IGZyb20sCiAgICAgICAgICBtaW5lckZlZTogbWluZXJGZWUsCiAgICAgICAgICBtaW5lckZlZUN1cnJlbmN5OiAnRVRIJywKICAgICAgICAgIGFkbWluRmVlOiBhZG1pbkZlZSwKICAgICAgICAgIGNvbmZpcm1lZDogYmxvY2tIYXNoICE9IG51bGwsCiAgICAgICAgICBpc0NvbnRyYWN0VHg6IGNvbnRyYWN0QWRkcmVzcy50b0xvd2VyQ2FzZSgpID09PSBjb25maWcuc3dhcENvbnRyYWN0LmVyYzIwLnRvTG93ZXJDYXNlKCkKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgfQogICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICByZXNvbHZlKGZhbHNlKTsKICAgIH0pOwogIH0pOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGxvZ2luOiBsb2dpbiwKICBnZXRCYWxhbmNlOiBnZXRCYWxhbmNlLAogIGdldFRyYW5zYWN0aW9uOiBnZXRUcmFuc2FjdGlvbiwKICBzZW5kOiBzZW5kLAogIGdldFR4OiBnZXRUeCwKICBnZXRMaW5rVG9JbmZvOiBnZXRMaW5rVG9JbmZvLAogIGFwcHJvdmU6IGFwcHJvdmUsCiAgc2V0QWxsb3dhbmNlRm9yVG9rZW46IHNldEFsbG93YW5jZUZvclRva2VuLAogIGZldGNoQmFsYW5jZTogZmV0Y2hCYWxhbmNlLAogIEFkZEN1c3RvbUVSQzIwOiBBZGRDdXN0b21FUkMyMCwKICBHZXRDdXN0cm9tRVJDMjA6IEdldEN1c3Ryb21FUkMyMCwKICBmZXRjaFRva2VuVHhJbmZvOiBmZXRjaFRva2VuVHhJbmZvLAogIGZldGNoVHhJbmZvOiBmZXRjaFR4SW5mbywKICBnZXRUeFJvdXRlcjogZ2V0VHhSb3V0ZXIsCiAgd2l0aFRva2VuOiB3aXRoVG9rZW4KfTs="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/redux/actions/token.ts"],"names":["ERC20_ABI","helpers","apiLooper","constants","cacheStorageGet","cacheStorageSet","getState","actions","web3","reducers","config","BigNumber","InputDataDecoder","metamask","hasAdminFee","opts","fee","erc20","address","min","erc20Decoder","AddCustomERC20","contract","symbol","decimals","configStorage","process","env","MAINNET","tokensInfo","JSON","parse","localStorage","getItem","customERC","mainnet","testnet","setItem","stringify","GetCustromERC20","login","privateKey","contractAddress","nameContract","fullName","data","eth","accounts","privateKeyToAccount","console","info","create","wallet","add","setupContract","ethAddress","log","isMetamask","Error","isSweeped","balance","name","toLowerCase","currency","toUpperCase","currencyRate","isMnemonic","isERC20","isEnabled","isConnected","getAddress","user","setTokenAuthData","getBalance","undefined","tokensData","internalAddress","balanceInCache","setTokenBalance","amount","ERC20","Contract","methods","balanceOf","call","result","String","dividedBy","pow","toString","setTokenBalanceError","fetchBalance","getTransaction","ownAddress","ownType","Promise","resolve","warn","url","api","etherscan_ApiKey","join","get","then","res","transactions","filter","item","value","map","confirmations","type","hash","status","blockHash","Number","tokenDecimal","toNumber","to","date","timeStamp","direction","withToken","tokenContract","from","toWei","times","fromWei","wei","div","fetchFees","gasPrice","gasLimit","speed","ethToken","estimateGasPrice","defaultFeeRates","limit","send","gas","getTx","txRaw","transactionHash","getTxRouter","txId","getLinkToInfo","tx","link","etherscan","sendTransaction","method","args","params","callback","reject","on","error","receipt","sendWithAdminFee","sendDefault","feeConfig","adminFee","adminFeeAddress","adminFeeMinValue","adminFeeMin","feeFromAmount","multipliedBy","isGreaterThan","walletData","core","getWallet","newAmount","callMethod","transfer","loader","show","err","receiptAdminFee","approve","setAllowanceForToken","targetAllowance","allowance","isLessThanOrEqualTo","newTargetAllowance","max","fetchTokenTxInfo","ticker","cacheResponse","fetchTxInfo","txInfo","isContractTx","senderAddress","txs","ourTx","length","receiverAddress","Object","keys","forEach","key","txData","decodeData","input","inputs","minerFee","utils","toBN","afterBalance","minerFeeCurrency","confirmed","swapContract"],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport ERC20_ABI from 'human-standard-token-abi'\r\nimport helpers, { apiLooper, constants, cacheStorageGet, cacheStorageSet } from 'helpers'\r\nimport { getState } from 'redux/core'\r\nimport actions from 'redux/actions'\r\nimport { web3, getWeb3 } from 'helpers/web3'\r\nimport reducers from 'redux/core/reducers'\r\nimport config from 'helpers/externalConfig'\r\nimport { BigNumber } from 'bignumber.js'\r\nimport InputDataDecoder from 'ethereum-input-data-decoder'\r\n\r\nimport metamask from 'helpers/metamask'\r\n\r\n\r\n\r\nconst hasAdminFee = (\r\n  config\r\n  && config.opts\r\n  && config.opts.fee\r\n  && config.opts.fee.erc20\r\n  && config.opts.fee.erc20.fee\r\n  && config.opts.fee.erc20.address\r\n  && config.opts.fee.erc20.min\r\n) ? config.opts.fee.erc20 : false\r\n\r\nconst erc20Decoder = new InputDataDecoder(ERC20_ABI)\r\n\r\nconst AddCustomERC20 = (contract, symbol, decimals) => {\r\n  const configStorage = (process.env.MAINNET) ? 'mainnet' : 'testnet'\r\n  let tokensInfo = JSON.parse(localStorage.getItem(constants.localStorage.customERC))\r\n\r\n  if (!tokensInfo) {\r\n    tokensInfo = {\r\n      mainnet: {},\r\n      testnet: {},\r\n    }\r\n  }\r\n  tokensInfo[configStorage][contract] = {\r\n    address: contract,\r\n    symbol,\r\n    decimals,\r\n  }\r\n\r\n  localStorage.setItem(constants.localStorage.customERC, JSON.stringify(tokensInfo))\r\n}\r\n\r\nconst GetCustromERC20 = () => {\r\n  const configStorage = (process.env.MAINNET) ? 'mainnet' : 'testnet'\r\n\r\n  let tokensInfo = JSON.parse(localStorage.getItem(constants.localStorage.customERC))\r\n  if (!tokensInfo || !tokensInfo[configStorage]) return {}\r\n  return tokensInfo[configStorage]\r\n}\r\n\r\nconst login = (privateKey, contractAddress, nameContract, decimals, fullName) => {\r\n  let data\r\n  if (privateKey) {\r\n    data = web3.eth.accounts.privateKeyToAccount(privateKey)\r\n  } else {\r\n    console.info('Created account ETH Token ...')\r\n    data = web3.eth.accounts.create()\r\n    web3.eth.accounts.wallet.add(data)\r\n  }\r\n\r\n  web3.eth.accounts.wallet.add(data.privateKey)\r\n  console.info('Logged in with ETH Token', data)\r\n\r\n  setupContract(data.address, contractAddress, nameContract, decimals, fullName)\r\n}\r\n\r\n\r\nconst setupContract = (ethAddress, contractAddress, nameContract, decimals, fullName) => {\r\n  //@\r\n  console.log('setup contract', web3, web3.isMetamask)\r\n  if (!web3.eth.accounts.wallet[ethAddress]) {\r\n    throw new Error('web3 does not have given address')\r\n  }\r\n\r\n  const isSweeped = actions.eth.isSweeped()\r\n\r\n  let data = {\r\n    address: ethAddress,\r\n    balance: 0,\r\n    name: nameContract.toLowerCase(),\r\n    fullName,\r\n    currency: nameContract.toUpperCase(),\r\n    contractAddress,\r\n    decimals,\r\n    currencyRate: 1,\r\n    isMnemonic: isSweeped,\r\n    isMetamask: false,\r\n    isERC20: true,\r\n  }\r\n  if (metamask.isEnabled() && metamask.isConnected()) {\r\n    data = {\r\n      ...data,\r\n      address: metamask.getAddress(),\r\n      isMetamask: true,\r\n      //@\r\n      isConnected: true,\r\n    }\r\n  }\r\n\r\n  reducers.user.setTokenAuthData({ name: data.name, data })\r\n\r\n}\r\n\r\n\r\nconst getBalance = async (currency) => {\r\n  if (currency === undefined) {\r\n    return\r\n  }\r\n\r\n  const { user: { tokensData } } = getState()\r\n  const {\r\n    address: internalAddress,\r\n    contractAddress,\r\n    decimals,\r\n    name,\r\n  } = tokensData[currency.toLowerCase()]\r\n\r\n  const address = (metamask.isConnected()) ? metamask.getAddress() : false || internalAddress\r\n  const balanceInCache = cacheStorageGet('currencyBalances', `token_${currency}_${address}`)\r\n\r\n  if (balanceInCache !== false) {\r\n    reducers.user.setTokenBalance({\r\n      name,\r\n      amount: balanceInCache,\r\n    })\r\n    return balanceInCache\r\n  }\r\n\r\n  const ERC20 = new web3.eth.Contract(ERC20_ABI, contractAddress)\r\n\r\n  try {\r\n    const result = await ERC20.methods.balanceOf(address).call()\r\n\r\n    let amount = new BigNumber(String(result)).dividedBy(new BigNumber(String(10)).pow(decimals)).toString()\r\n    \r\n    reducers.user.setTokenBalance({ name, amount })\r\n    cacheStorageSet('currencyBalances', `token_${currency}_${address}`, amount, 60)\r\n\r\n    return amount\r\n  } catch (e) {\r\n    reducers.user.setTokenBalanceError({ name })\r\n  }\r\n}\r\n\r\n\r\nconst fetchBalance = async (address, contractAddress, decimals) => {\r\n  const ERC20 = new web3.eth.Contract(ERC20_ABI, contractAddress)\r\n  const result = await ERC20.methods.balanceOf(address).call()\r\n\r\n  const amount = new BigNumber(String(result)).dividedBy(new BigNumber(String(10)).pow(decimals)).toString()\r\n  return amount\r\n}\r\n\r\nconst getTransaction = (ownAddress, ownType) =>\r\n  new Promise((resolve) => {\r\n    const { user: { tokensData } } = getState()\r\n\r\n    if (ownType === undefined) {\r\n      console.warn('getTransaction - token type not deffined', ownAddress, ownType)\r\n      resolve([])\r\n      return\r\n    }\r\n\r\n\r\n    const { address, contractAddress } = tokensData[ownType.toLowerCase()]\r\n\r\n    console.log('currency', address, contractAddress)\r\n\r\n    const url = [\r\n      `?module=account&action=tokentx`,\r\n      `&contractaddress=${contractAddress}`,\r\n      `&address=${(ownAddress) || address}`,\r\n      `&startblock=0&endblock=99999999`,\r\n      `&sort=asc&apikey=${config.api.etherscan_ApiKey}`,\r\n    ].join('')\r\n\r\n    return apiLooper.get('etherscan', url, {\r\n      // @ToDo - may be need cache or use in memory cache\r\n      // cacheResponse: 60 * 1000\r\n    })\r\n      .then((res: any) => {\r\n        const transactions = res.result\r\n          .filter((item) => item.value > 0)\r\n          .map((item) => ({\r\n            confirmations: item.confirmations,\r\n            type: ownType.toLowerCase(),\r\n            hash: item.hash,\r\n            contractAddress: item.contractAddress,\r\n            status: item.blockHash != null ? 1 : 0,\r\n            value: new BigNumber(String(item.value)).dividedBy(new BigNumber(10).pow(Number(item.tokenDecimal))).toNumber(),\r\n            address: item.to,\r\n            date: item.timeStamp * 1000,\r\n            direction: address.toLowerCase() === item.to.toLowerCase() ? 'in' : 'out',\r\n          }))\r\n          .filter((item) => {\r\n            if (item.direction === 'in') return true\r\n            if (!hasAdminFee) return true\r\n            if (address.toLowerCase() === hasAdminFee.address.toLowerCase()) return true\r\n            if (item.address.toLowerCase() === hasAdminFee.address.toLowerCase()) return false\r\n\r\n            return true\r\n          })\r\n        resolve(transactions)\r\n      })\r\n      .catch(() => {\r\n        resolve([])\r\n      })\r\n  })\r\n\r\nconst withToken = (name) => {\r\n  if (!name) {\r\n    throw new Error('send: name is undefined')\r\n  }\r\n\r\n  name = name.toLowerCase()\r\n\r\n  const { user: { tokensData: { [name]: { address } } } } = getState()\r\n  const { [name]: { address: contractAddress, decimals } } = config.erc20\r\n\r\n  const tokenContract = new web3.eth.Contract(ERC20_ABI, contractAddress, { from: address })\r\n\r\n  const toWei: any = amount => new BigNumber(amount).times(new BigNumber(10).pow(decimals)).toString(10)\r\n  const fromWei: any = wei => new BigNumber(wei).div(new BigNumber(10).pow(decimals))\r\n\r\n  return { contractAddress, tokenContract, decimals, toWei, fromWei }\r\n}\r\n\r\n//@\r\nconst fetchFees = async ({ gasPrice, gasLimit, speed } = {}) => {\r\n  gasPrice = gasPrice || await helpers.ethToken.estimateGasPrice({ speed })\r\n  gasLimit = gasLimit || constants.defaultFeeRates.ethToken.limit.send\r\n\r\n  return {\r\n    gas: gasLimit,\r\n    gasPrice,\r\n  }\r\n}\r\n\r\nconst getTx = (txRaw) => txRaw.transactionHash\r\n\r\nconst getTxRouter = (txId, currency) => `/token/${currency.toUpperCase()}/tx/${txId}`\r\n\r\n\r\nconst getLinkToInfo = (tx) => {\r\n\r\n  if (!tx) {\r\n    return\r\n  }\r\n\r\n  return `${config.link.etherscan}/tx/${tx}`\r\n}\r\n//@\r\nconst sendTransaction = ({ contract, method }, { args, params = {} } = {}, callback) =>\r\n  new Promise(async (resolve, reject) => {\r\n    const receipt = await contract.methods[method](...args).send(params)\r\n      .on('transactionHash', (hash) => {\r\n        // eslint-disable-next-line\r\n        callback && callback(hash)\r\n      })\r\n      .catch((error) => {\r\n        reject(error)\r\n      })\r\n\r\n    resolve(receipt)\r\n  })\r\n\r\nconst send = (data) => (hasAdminFee) ? sendWithAdminFee(data) : sendDefault(data)\r\n//@\r\nconst sendWithAdminFee = async ({ name, from, to, amount, ...feeConfig } = {}) => {\r\n  const { tokenContract, toWei } = withToken(name)\r\n  const {\r\n    fee: adminFee,\r\n    address: adminFeeAddress,\r\n    min: adminFeeMinValue,\r\n  } = config.opts.fee.erc20\r\n\r\n  const adminFeeMin = new BigNumber(adminFeeMinValue)\r\n\r\n  // fee - from amount - percent\r\n\r\n  let feeFromAmount: any = new BigNumber(adminFee).dividedBy(100).multipliedBy(amount)\r\n  if (adminFeeMin.isGreaterThan(feeFromAmount)) feeFromAmount = adminFeeMin\r\n\r\n  feeFromAmount = toWei(feeFromAmount.toNumber()) // Admin fee\r\n\r\n  const params = {\r\n    //@\r\n    ... await fetchFees({ ...feeConfig }),\r\n    from,\r\n  }\r\n\r\n  const walletData = actions.core.getWallet({\r\n    address: from,\r\n    currency: name,\r\n  })\r\n\r\n  const newAmount = toWei(amount)\r\n  const callMethod = { contract: tokenContract, method: 'transfer' }\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const receipt = tokenContract.methods.transfer(to, newAmount).send(params)\r\n      .on('transactionHash', (hash) => {\r\n        const txId = `${config.link.etherscan}/tx/${hash}`\r\n        actions.loader.show(true, { txId })\r\n      })\r\n      .on('error', (err) => {\r\n        reject(err)\r\n      })\r\n\r\n    receipt.then(() => {\r\n      resolve(receipt)\r\n      if (walletData.isMetamask) return\r\n      // Send admin fee\r\n      new Promise(async () => {\r\n        const receiptAdminFee = await tokenContract.methods.transfer(adminFeeAddress, feeFromAmount).send(params)\r\n          .on('transactionHash', (hash) => {\r\n            console.log('ERC20 admin fee tx', hash)\r\n          })\r\n      })\r\n    })\r\n  })\r\n}\r\n//@\r\nconst sendDefault = async ({ name, from, to, amount, ...feeConfig } = {}) => {\r\n  const { tokenContract, toWei } = withToken(name)\r\n  const params = {\r\n    //@\r\n    ... await fetchFees({ ...feeConfig }),\r\n    from,\r\n  }\r\n\r\n  const newAmount = toWei(amount)\r\n  const callMethod = { contract: tokenContract, method: 'transfer' }\r\n\r\n  // return sendTransaction(\r\n  //   { contract: tokenContract, method: 'transfer' },\r\n  //   { args: [ to, newAmount ], params },\r\n  //   (hash) => {\r\n  //     const txId = `${config.link.etherscan}/tx/${hash}`\r\n  //     actions.loader.show(true, { txId })\r\n  //   })\r\n\r\n  return new Promise(async (resolve, reject) => {\r\n    const receipt = await tokenContract.methods.transfer(to, newAmount).send(params)\r\n      .on('transactionHash', (hash) => {\r\n        const txId = `${config.link.etherscan}/tx/${hash}`\r\n        actions.loader.show(true, { txId })\r\n      })\r\n      .on('error', (err) => {\r\n        reject(err)\r\n      })\r\n\r\n    resolve(receipt)\r\n  })\r\n}\r\n//@\r\nconst approve = async ({ name, to, amount, ...feeConfig } = {}) => {\r\n  const { tokenContract, toWei } = withToken(name)\r\n  //@\r\n  const params = await fetchFees({ ...feeConfig })\r\n\r\n  const newAmount = toWei(amount)\r\n//@\r\n  return sendTransaction(\r\n    { contract: tokenContract, method: 'approve' },\r\n    { args: [to, newAmount], params })\r\n}\r\n\r\nconst setAllowanceForToken = async ({ name, to, targetAllowance, ...config }) => {\r\n  const { tokenContract, toWei } = withToken(name)\r\n\r\n  name = name.toLowerCase()\r\n\r\n  const { user: { tokensData: { [name]: { address } } } } = getState()\r\n\r\n  const allowance = await tokenContract.methods.allowance(address, to).call()\r\n\r\n  // if there is already enough allowance, skip\r\n  if (new BigNumber(toWei(targetAllowance)).isLessThanOrEqualTo(allowance)) {\r\n    return Promise.resolve()\r\n  }\r\n  // but if not, set allowance to 1 billion (or requested target allowance, if it's bigger than 1 billion)\r\n\r\n  const newTargetAllowance = BigNumber.max(1e9, targetAllowance)\r\n\r\n  return approve({ name, to, amount: newTargetAllowance, ...config })\r\n}\r\n\r\nconst fetchTokenTxInfo = (ticker, hash, cacheResponse) => {\r\n  return new Promise(async (resolve) => {\r\n    let txInfo = await <IUniversalObj>fetchTxInfo(hash, cacheResponse)\r\n\r\n    if (txInfo.isContractTx) {\r\n      // This is tx to contract. Fetch all txs and find this tx\r\n      const txs = await <IUniversalObj>getTransaction(txInfo.senderAddress, ticker)\r\n\r\n      const ourTx = txs.filter((tx) => tx.hash.toLowerCase() === hash.toLowerCase())\r\n      if (ourTx.length) {\r\n        txInfo.amount = ourTx[0].value\r\n        txInfo.adminFee = false // Swap dont have service fee\r\n\r\n        if (ourTx[0].direction == `in`) {\r\n          txInfo = {\r\n            ...txInfo,\r\n            receiverAddress: txInfo.senderAddress,\r\n            senderAddress: txInfo.receiverAddress,\r\n          }\r\n        }\r\n      }\r\n    }\r\n    resolve(txInfo)\r\n  })\r\n}\r\n\r\nconst fetchTxInfo = (hash, cacheResponse) => new Promise((resolve) => {\r\n  const { user: { tokensData } } = getState()\r\n\r\n  const url = `?module=proxy&action=eth_getTransactionByHash&txhash=${hash}&apikey=${config.api.etherscan_ApiKey}`\r\n\r\n  return apiLooper.get('etherscan', url, {\r\n    cacheResponse,\r\n  })\r\n    .then((res: any) => {\r\n      if (res && res.result) {\r\n        let amount: number | string = 0\r\n        let receiverAddress = res.result.to\r\n\r\n        const contractAddress = res.result.to\r\n        let tokenDecimal = 18\r\n\r\n        //     \r\n        Object.keys(tokensData).forEach((key) => {\r\n          if (tokensData[key]\r\n              && tokensData[key].contractAddress\r\n              && tokensData[key].contractAddress.toLowerCase() == contractAddress.toLowerCase()\r\n              && tokensData[key].decimals\r\n          ) {\r\n            tokenDecimal = tokensData[key].decimals\r\n            return false\r\n          }\r\n        })\r\n\r\n        const txData = erc20Decoder.decodeData(res.result.input)\r\n\r\n        if (txData\r\n            && (\r\n              txData.name === `transfer`\r\n              || txData.method === `transfer`\r\n            )\r\n            && txData.inputs\r\n            && txData.inputs.length == 2\r\n        ) {\r\n          receiverAddress = `0x${txData.inputs[0]}`\r\n          amount = new BigNumber(txData.inputs[1]).div(new BigNumber(10).pow(tokenDecimal)).toString()\r\n        } else {\r\n          // This is not erc20 transfer tx (swap tx)\r\n        }\r\n\r\n        const {\r\n          from,\r\n          gas,\r\n          gasPrice,\r\n          blockHash,\r\n        } = res.result\r\n\r\n        // Calc miner fee, used for this tx\r\n        const minerFee = new BigNumber(web3.utils.toBN(gas).toNumber())\r\n          .multipliedBy(web3.utils.toBN(gasPrice).toNumber())\r\n          .dividedBy(1e18).toNumber()\r\n\r\n        let adminFee: any = false\r\n\r\n        if (hasAdminFee) {\r\n          adminFee = new BigNumber(hasAdminFee.fee).dividedBy(100).multipliedBy(amount)\r\n\r\n          if (new BigNumber(hasAdminFee.min).isGreaterThan(adminFee)) adminFee = new BigNumber(hasAdminFee.min)\r\n\r\n          adminFee = adminFee.toNumber()\r\n        }\r\n\r\n        resolve({\r\n          amount,\r\n          afterBalance: null,\r\n          receiverAddress,\r\n          senderAddress: from,\r\n          minerFee,\r\n          minerFeeCurrency: 'ETH',\r\n          adminFee,\r\n          confirmed: (blockHash != null),\r\n          isContractTx: (contractAddress.toLowerCase() === config.swapContract.erc20.toLowerCase()),\r\n        })\r\n\r\n      } else {\r\n        resolve(false)\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      console.log(err)\r\n      resolve(false)\r\n    })\r\n})\r\n\r\nexport default {\r\n  login,\r\n  getBalance,\r\n  getTransaction,\r\n  send,\r\n  getTx,\r\n  getLinkToInfo,\r\n  approve,\r\n  setAllowanceForToken,\r\n  fetchBalance,\r\n  AddCustomERC20,\r\n  GetCustromERC20,\r\n  fetchTokenTxInfo,\r\n  fetchTxInfo,\r\n  getTxRouter,\r\n  withToken,\r\n}\r\n"]}]}