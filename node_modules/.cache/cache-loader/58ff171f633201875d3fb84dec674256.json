{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\common\\utils\\coin\\btc.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\common\\utils\\coin\\btc.ts","mtime":1614851479509},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWFkT25seUVycm9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvcmVhZE9ubHlFcnJvciI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvb2JqZWN0V2l0aG91dFByb3BlcnRpZXMiOwppbXBvcnQgX3JlZ2VuZXJhdG9yUnVudGltZSBmcm9tICJAYmFiZWwvcnVudGltZS9yZWdlbmVyYXRvciI7CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgovLyBAdHMtbm9jaGVjawppbXBvcnQgYXBpTG9vcGVyIGZyb20gJy4uL2FwaUxvb3Blcic7CmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ2JpZ251bWJlci5qcyc7CmltcG9ydCAqIGFzIGJpdGNvaW4gZnJvbSAnYml0Y29pbmpzLWxpYic7CmltcG9ydCB0eXBlZm9yY2UgZnJvbSAnc3dhcC5hcHAvdXRpbC90eXBlZm9yY2UnOyAvLyBVc2UgZnJvbnQgQVBJIGNvbmZpZwoKaW1wb3J0IHsgZGVmYXVsdCBhcyBURVNUTkVUIH0gZnJvbSAnLi4vLi4vLi4vZnJvbnQvY29uZmlnL3Rlc3RuZXQvYXBpJzsKaW1wb3J0IHsgZGVmYXVsdCBhcyBNQUlOTkVUIH0gZnJvbSAnLi4vLi4vLi4vZnJvbnQvY29uZmlnL21haW5uZXQvYXBpJzsKdmFyIERVU1QgPSA1NDY7Cgp2YXIgZ2V0Qml0cGF5ID0gZnVuY3Rpb24gZ2V0Qml0cGF5KG5ldHdvcmspIHsKICByZXR1cm4gewogICAgbmFtZTogImFwaUJpdHBheSIsCiAgICBzZXJ2ZXJzOiBuZXR3b3JrID09PSAiTUFJTk5FVCIgPyBNQUlOTkVULmJpdHBheSA6IFRFU1RORVQuYml0cGF5CiAgfTsKfTsKCnZhciBnZXRDb3JlID0gZnVuY3Rpb24gZ2V0Q29yZSgpIHsKICByZXR1cm4gYml0Y29pbjsKfTsKCnZhciBnZXRCbG9ja2N5cGhlciA9IGZ1bmN0aW9uIGdldEJsb2NrY3lwaGVyKG5ldHdvcmspIHsKICByZXR1cm4gewogICAgbmFtZTogImFwaUJsb2NrY3lwaGVyIiwKICAgIHNlcnZlcnM6IG5ldHdvcmsgPT09ICJNQUlOTkVUIiA/IE1BSU5ORVQuYmxvY2tjeXBoZXIgOiBURVNUTkVULmJsb2NrY3lwaGVyCiAgfTsKfTsKCnZhciBmZXRjaEJhbGFuY2UgPSBmdW5jdGlvbiBmZXRjaEJhbGFuY2Uob3B0aW9ucykgewogIHZhciBhZGRyZXNzID0gb3B0aW9ucy5hZGRyZXNzLAogICAgICB3aXRoVW5jb25maXJtZWQgPSBvcHRpb25zLndpdGhVbmNvbmZpcm1lZCwKICAgICAgYXBpQml0cGF5ID0gb3B0aW9ucy5hcGlCaXRwYXksCiAgICAgIGNhY2hlUmVzcG9uc2UgPSBvcHRpb25zLmNhY2hlUmVzcG9uc2UsCiAgICAgIE5FVFdPUksgPSBvcHRpb25zLk5FVFdPUks7CiAgcmV0dXJuIGFwaUxvb3Blci5nZXQoYXBpQml0cGF5IHx8IGdldEJpdHBheShORVRXT1JLKSwgIi9hZGRyZXNzLyIuY29uY2F0KGFkZHJlc3MsICIvYmFsYW5jZS8iKSwgewogICAgY2FjaGVSZXNwb25zZTogY2FjaGVSZXNwb25zZSwKICAgIGNoZWNrU3RhdHVzOiBmdW5jdGlvbiBjaGVja1N0YXR1cyhhbnN3ZXIpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoYW5zd2VyICYmIGFuc3dlci5iYWxhbmNlICE9PSB1bmRlZmluZWQpIHJldHVybiB0cnVlOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1V0aWxzIC0gYnRjIC0gZmV0Y2ggYmFsYW5jZTogJywgZXJyb3IpOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgaW5RdWVyeTogewogICAgICBkZWxheTogNTAwLAogICAgICBuYW1lOiAiYml0cGF5IgogICAgfQogIH0pLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikgewogICAgdmFyIGJhbGFuY2UgPSBhbnN3ZXIuYmFsYW5jZSwKICAgICAgICB1bmNvbmZpcm1lZCA9IGFuc3dlci51bmNvbmZpcm1lZDsKCiAgICBpZiAod2l0aFVuY29uZmlybWVkKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYmFsYW5jZTogbmV3IEJpZ051bWJlcihiYWxhbmNlKS5kaXZpZGVkQnkoMWU4KS50b051bWJlcigpLAogICAgICAgIHVuY29uZmlybWVkOiBuZXcgQmlnTnVtYmVyKHVuY29uZmlybWVkKS5kaXZpZGVkQnkoMWU4KS50b051bWJlcigpCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmV3IEJpZ051bWJlcihiYWxhbmNlKS5kaXZpZGVkQnkoMWU4KS50b051bWJlcigpOwogICAgfQogIH0pOwp9OwoKdmFyIGZldGNoVHggPSBmdW5jdGlvbiBmZXRjaFR4KG9wdGlvbnMpIHsKICB2YXIgaGFzaCA9IG9wdGlvbnMuaGFzaCwKICAgICAgYXBpQml0cGF5ID0gb3B0aW9ucy5hcGlCaXRwYXksCiAgICAgIGNhY2hlUmVzcG9uc2UgPSBvcHRpb25zLmNhY2hlUmVzcG9uc2UsCiAgICAgIE5FVFdPUksgPSBvcHRpb25zLk5FVFdPUks7CiAgcmV0dXJuIGFwaUxvb3Blci5nZXQoYXBpQml0cGF5IHx8IGdldEJpdHBheShORVRXT1JLKSwgIi90eC8iLmNvbmNhdChoYXNoKSwgewogICAgY2FjaGVSZXNwb25zZTogY2FjaGVSZXNwb25zZSwKICAgIGNoZWNrU3RhdHVzOiBmdW5jdGlvbiBjaGVja1N0YXR1cyhhbnN3ZXIpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoYW5zd2VyICYmIGFuc3dlci5mZWUgIT09IHVuZGVmaW5lZCkgcmV0dXJuIHRydWU7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvKiAqLwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgaW5RdWVyeTogewogICAgICBkZWxheTogNTAwLAogICAgICBuYW1lOiAiYml0cGF5IgogICAgfQogIH0pLnRoZW4oZnVuY3Rpb24gKF9yZWYpIHsKICAgIHZhciBmZWUgPSBfcmVmLmZlZSwKICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9yZWYsIFsiZmVlIl0pOwoKICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHsKICAgICAgZmVlczogbmV3IEJpZ051bWJlcihmZWUpLmRpdmlkZWRCeSgxZTgpLnRvTnVtYmVyKCkKICAgIH0sIHJlc3QpOwogIH0pOwp9OyAvLyBAVG9EbyAtIE1ha2UgaW50ZXJmYWNlIC0gZmV0Y2hUeEluZm8g0L7QsdGJ0LDRjyDQtNC70Y8g0LLRgdC10YUg0LHQu9C+0LrRh9C10LnQvdC+0LIgLSDQvtC90LAg0LLQvtC30LLRgNCw0YjQtdGCINGB0LLQtdC00LXQvdC90YvQtSDQtNCw0L3QvdGL0LUg0L7Qv9GA0LXQtNC10LvQtdC90L3QvtCz0L4g0YLQuNC/0LAKCgp2YXIgZmV0Y2hUeEluZm8gPSBmdW5jdGlvbiBmZXRjaFR4SW5mbyhvcHRpb25zKSB7CiAgdmFyIGhhc2ggPSBvcHRpb25zLmhhc2gsCiAgICAgIGFwaUJpdHBheSA9IG9wdGlvbnMuYXBpQml0cGF5LAogICAgICBjYWNoZVJlc3BvbnNlID0gb3B0aW9ucy5jYWNoZVJlc3BvbnNlLAogICAgICBoYXNBZG1pbkZlZSA9IG9wdGlvbnMuaGFzQWRtaW5GZWUsCiAgICAgIE5FVFdPUksgPSBvcHRpb25zLk5FVFdPUks7CiAgcmV0dXJuIG5ldyBQcm9taXNlKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShjYWxsYmFjaywgdHhpbmZvUmVqZWN0KSB7CiAgICAgIHZhciBiYXNlVHhJbmZvLCB0eENvaW5zLCByZWNlaXZlckFkZHJlc3MsIGFmdGVyQmFsYW5jZSwgYWRtaW5PdXRwdXQsIGFkbWluRmVlLCBhZnRlck91dHB1dCwgc2VuZGVyQWRkcmVzcywgYW1vdW50LCB0eEluZm87CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgYmFzZVR4SW5mbyA9IGZhbHNlOyAvLyBAVG9EbyAtIG1ha2UgaW50ZXJmYWNlIGZvciBiYXNlVHhJbmZvIGFwaSBhbnN3ZXIKCiAgICAgICAgICAgICAgdHhDb2lucyA9IGZhbHNlOyAvLyBAVG9EbyAtIG1ha2UgaW50ZXJmYWNlIGZvciB0eENvaW5zIGFwaSBhbnN3ZXIKCiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDI7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgcmV0dXJuIGZldGNoVHgoewogICAgICAgICAgICAgICAgaGFzaDogaGFzaCwKICAgICAgICAgICAgICAgIGFwaUJpdHBheTogYXBpQml0cGF5LAogICAgICAgICAgICAgICAgY2FjaGVSZXNwb25zZTogY2FjaGVSZXNwb25zZSwKICAgICAgICAgICAgICAgIE5FVFdPUks6IE5FVFdPUksKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBiYXNlVHhJbmZvID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDg7CiAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgyKTsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsIGZldGNoIHR4IGluZm8nLCBfY29udGV4dC50MCk7CiAgICAgICAgICAgICAgdHhpbmZvUmVqZWN0KF9jb250ZXh0LnQwKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDEzOwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICByZXR1cm4gYXBpTG9vcGVyLmdldChhcGlCaXRwYXkgfHwgZ2V0Qml0cGF5KE5FVFdPUkspLCAiL3R4LyIuY29uY2F0KGhhc2gsICIvY29pbnMiKSwgewogICAgICAgICAgICAgICAgY2FjaGVSZXNwb25zZTogY2FjaGVSZXNwb25zZSwKCiAgICAgICAgICAgICAgICAvKiBjaGVja1N0YXR1cyAqLwogICAgICAgICAgICAgICAgaW5RdWVyeTogewogICAgICAgICAgICAgICAgICBkZWxheTogNTAwLAogICAgICAgICAgICAgICAgICBuYW1lOiAiYml0cGF5IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICB0eENvaW5zID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxOTsKICAgICAgICAgICAgICBfY29udGV4dC50MSA9IF9jb250ZXh0WyJjYXRjaCJdKDEzKTsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsdCBmZXRjaCB0eCBjb2luIGluZm8nLCBfY29udGV4dC50MSk7CiAgICAgICAgICAgICAgdHhpbmZvUmVqZWN0KF9jb250ZXh0LnQxKTsKCiAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgcmVjZWl2ZXJBZGRyZXNzID0gbnVsbDsKICAgICAgICAgICAgICBhZnRlckJhbGFuY2UgPSB0eENvaW5zICYmIHR4Q29pbnMuaW5wdXRzICYmIHR4Q29pbnMuaW5wdXRzWzFdID8gbmV3IEJpZ051bWJlcih0eENvaW5zLmlucHV0c1sxXS52YWx1ZSkuZGl2aWRlZEJ5KDFlOCkudG9OdW1iZXIoKSA6IG51bGw7CiAgICAgICAgICAgICAgYWRtaW5PdXRwdXQgPSBbXTsKICAgICAgICAgICAgICBhZG1pbkZlZSA9IGZhbHNlOwogICAgICAgICAgICAgIGFmdGVyT3V0cHV0ID0gW107CgogICAgICAgICAgICAgIGlmICghdHhDb2lucyB8fCAhdHhDb2lucy5pbnB1dHMgfHwgIXR4Q29pbnMub3V0cHV0cykgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigndHggY29pbiBpbmZvIGVtcHR5Jyk7CiAgICAgICAgICAgICAgICB0eGluZm9SZWplY3QoJ3R4IGNvaW4gaW5mbyBlbXB0eScpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc2VuZGVyQWRkcmVzcyA9IHR4Q29pbnMgJiYgdHhDb2lucy5pbnB1dHMgPyB0eENvaW5zLmlucHV0c1swXS5hZGRyZXNzIDogbnVsbDsKICAgICAgICAgICAgICBhbW91bnQgPSBuZXcgQmlnTnVtYmVyKHR4Q29pbnMub3V0cHV0c1swXS52YWx1ZSkuZGl2aWRlZEJ5KDFlOCkudG9OdW1iZXIoKTsKCiAgICAgICAgICAgICAgaWYgKGhhc0FkbWluRmVlKSB7CiAgICAgICAgICAgICAgICBhZG1pbk91dHB1dCA9IHR4Q29pbnMub3V0cHV0cy5maWx0ZXIoZnVuY3Rpb24gKG91dCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gb3V0LmFkZHJlc3MgPT09IGhhc0FkbWluRmVlLmFkZHJlc3MgJiYgIW5ldyBCaWdOdW1iZXIob3V0LnZhbHVlKS5lcShhbW91bnQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgIC8vIEBUb0RvIC0gbmVlZCBmaXgNCiAgICAgICAgICAgICAgaWYgKHR4Q29pbnMgJiYgdHhDb2lucy5vdXRwdXRzKSB7DQogICAgICAgICAgICAgICAgYWZ0ZXJPdXRwdXQgPSB0eENvaW5zLm91dHB1dHMuZmlsdGVyKCh7IGFkZHJlc3MgfSkgPT4gew0KICAgICAgICAgICAgICAgICAgcmV0dXJuICgNCiAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyAhPT0gaGFzQWRtaW5GZWUuYWRkcmVzcw0KICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgKi8KCgogICAgICAgICAgICAgIGlmIChhZnRlck91dHB1dC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGFmdGVyQmFsYW5jZSA9IG5ldyBCaWdOdW1iZXIoYWZ0ZXJPdXRwdXRbMF0udmFsdWUpLmRpdmlkZWRCeSgxZTgpLnRvTnVtYmVyKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoYWRtaW5PdXRwdXQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBhZG1pbkZlZSA9IG5ldyBCaWdOdW1iZXIoYWRtaW5PdXRwdXRbMF0udmFsdWUpLmRpdmlkZWRCeSgxZTgpLnRvTnVtYmVyKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodHhDb2lucyAmJiB0eENvaW5zLm91dHB1dHMgJiYgdHhDb2lucy5vdXRwdXRzWzBdKSB7CiAgICAgICAgICAgICAgICByZWNlaXZlckFkZHJlc3MgPSB0eENvaW5zLm91dHB1dHNbMF0uYWRkcmVzczsKICAgICAgICAgICAgICB9IC8vIEBUb0RvIC0g0JjQvdGC0LXRgNGE0LXQudGBINGN0YLQvtC5INGE0YPQvdC60YbQuNC4CgoKICAgICAgICAgICAgICB0eEluZm8gPSB7CiAgICAgICAgICAgICAgICB0eGlkOiBiYXNlVHhJbmZvLnR4aWQsCiAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudCwKICAgICAgICAgICAgICAgIGFmdGVyQmFsYW5jZTogYWZ0ZXJCYWxhbmNlLAogICAgICAgICAgICAgICAgc2VuZGVyQWRkcmVzczogc2VuZGVyQWRkcmVzcywKICAgICAgICAgICAgICAgIGNvbmZpcm1lZDogISFiYXNlVHhJbmZvLmNvbmZpcm1hdGlvbnMsCiAgICAgICAgICAgICAgICBjb25maXJtYXRpb25zOiBiYXNlVHhJbmZvLmNvbmZpcm1hdGlvbnMsCiAgICAgICAgICAgICAgICByZWNlaXZlckFkZHJlc3M6IHJlY2VpdmVyQWRkcmVzcywKICAgICAgICAgICAgICAgIG1pbmVyRmVlOiBiYXNlVHhJbmZvLmZlZXMsCiAgICAgICAgICAgICAgICBhZG1pbkZlZTogYWRtaW5GZWUsCiAgICAgICAgICAgICAgICBtaW5lckZlZUN1cnJlbmN5OiAnQlRDJywKICAgICAgICAgICAgICAgIG91dHB1dHM6IHR4Q29pbnMub3V0cHV0cy5tYXAoZnVuY3Rpb24gKG91dHB1dCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBvdXRwdXQpLCB7fSwgewogICAgICAgICAgICAgICAgICAgIGFtb3VudDogbmV3IEJpZ051bWJlcihvdXRwdXQudmFsdWUpLmRpdmlkZWRCeSgxZTgpLnRvTnVtYmVyKCkKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGlucHV0czogdHhDb2lucy5pbnB1dHMubWFwKGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpbnB1dCksIHt9LCB7CiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBuZXcgQmlnTnVtYmVyKGlucHV0LnZhbHVlKS5kaXZpZGVkQnkoMWU4KS50b051bWJlcigpCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBmZWVzOiBiYXNlVHhJbmZvLmZlZXMsCiAgICAgICAgICAgICAgICBzaXplOiBiYXNlVHhJbmZvLnNpemUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGNhbGxiYWNrKHR4SW5mbyk7CgogICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzIsIDhdLCBbMTMsIDE5XV0pOwogICAgfSkpOwoKICAgIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MikgewogICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpKTsKfTsKCi8vIEBUby1kbyAtIG1ha2UgaW50ZXJmYWNlIC0g0L7RgtCy0LXRgiDRjdGC0L7QuSDRhNGD0L3QutGG0LjQuCDQvtCx0YnQuNC5INC00LvRjyDQstGB0LUg0LHQu9C+0LrRh9C10LnQvdC+0LIKdmFyIGZldGNoVW5zcGVudHMgPSBmdW5jdGlvbiBmZXRjaFVuc3BlbnRzKG9wdGlvbnMpIHsKICB2YXIgYWRkcmVzcyA9IG9wdGlvbnMuYWRkcmVzcywKICAgICAgYXBpQml0cGF5ID0gb3B0aW9ucy5hcGlCaXRwYXksCiAgICAgIGNhY2hlUmVzcG9uc2UgPSBvcHRpb25zLmNhY2hlUmVzcG9uc2UsCiAgICAgIE5FVFdPUksgPSBvcHRpb25zLk5FVFdPUks7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIGFwaUxvb3Blci5nZXQoYXBpQml0cGF5IHx8IGdldEJpdHBheShORVRXT1JLKSwgIi9hZGRyZXNzLyIuY29uY2F0KGFkZHJlc3MsICI/dW5zcGVudD10cnVlJmxpbWl0PTEwMDAwMDAiKSwgewogICAgICBjYWNoZVJlc3BvbnNlOiBjYWNoZVJlc3BvbnNlIHx8IDUwMDAsCiAgICAgIGluUXVlcnk6IHsKICAgICAgICBkZWxheTogNTAwLAogICAgICAgIG5hbWU6ICJiaXRwYXkiCiAgICAgIH0KICAgIH0pLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikgewogICAgICByZXNvbHZlKGFuc3dlci5tYXAoZnVuY3Rpb24gKHR4SW5mbywgaW5kZXgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgYWRkcmVzczogYWRkcmVzcywKICAgICAgICAgIGFtb3VudDogbmV3IEJpZ051bWJlcih0eEluZm8udmFsdWUpLmRpdmlkZWRCeSgxZTgpLnRvTnVtYmVyKCksCiAgICAgICAgICBjb25maXJtYXRpb25zOiB0eEluZm8uY29uZmlybWF0aW9ucywKICAgICAgICAgIGhlaWdodDogdHhJbmZvLm1pbnRIZWlnaHQsCiAgICAgICAgICBzYXRvc2hpczogdHhJbmZvLnZhbHVlLAogICAgICAgICAgc2NyaXB0UHViS2V5OiB0eEluZm8uc2NyaXB0LAogICAgICAgICAgdHhpZDogdHhJbmZvLm1pbnRUeGlkLAogICAgICAgICAgdm91dDogdHhJbmZvLm1pbnRJbmRleCwKICAgICAgICAgIHNwZW50VHhpZDogdHhJbmZvLnNwZW50VHhpZAogICAgICAgIH07CiAgICAgIH0pKTsKICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCdidGMgZmV0Y2hVbnNwZW50cyBlcnJvcicsIGVycm9yKTsKICAgICAgcmVqZWN0KGVycm9yKTsKICAgIH0pOwogIH0pOwp9OwovKioNCiAqINCf0L7QtNCx0LXRgNCw0LXRgiDQv9C+0LTRhdC+0LTRj9GJ0LjQtSB1bnNwZW50cyDQtNC70Y8g0YPQutCw0LfQsNC90L3QvtC5INGB0YPQvNC80Ysg0LIg0YHQsNGC0L7RiNC4DQogKiovCgoKdmFyIHByZXBhcmVVbnNwZW50cyA9IGZ1bmN0aW9uIHByZXBhcmVVbnNwZW50cyhvcHRpb25zKSB7CiAgdmFyIE5FVFdPUksgPSBvcHRpb25zLk5FVFdPUkssCiAgICAgIGFwaUJpdHBheSA9IG9wdGlvbnMuYXBpQml0cGF5LAogICAgICBjYWNoZVJlc3BvbnNlID0gb3B0aW9ucy5jYWNoZVJlc3BvbnNlLAogICAgICBhZGRyZXNzID0gb3B0aW9ucy5hZGRyZXNzLAogICAgICBhbW91bnQgPSBvcHRpb25zLmFtb3VudDsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgdmFyIHByb2Nlc3NVbnNwZW50cyA9IGZ1bmN0aW9uIHByb2Nlc3NVbnNwZW50cyh1bnNwZW50cykgewogICAgICB2YXIgbmVlZEFtb3VudCA9IG5ldyBCaWdOdW1iZXIoYW1vdW50KS5tdWx0aXBsaWVkQnkoMWU4KS5wbHVzKERVU1QpOyAvLyDQodC90LDRh9Cw0LvQsCDQvtGC0YHQvtGA0YLQuNGA0YPQtdC8IHVuc3BlbnRzINC/0L4g0LLQvtC30YDQsNGB0YLQsNC90LjRjiDQvdC1INC/0L7RgtGA0LDRh9C10L3QvdC+0Lkg0YHQtNCw0YfQuAoKICAgICAgdmFyIHNvcnRlZFVuc3BlbnRzID0gdW5zcGVudHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKGEuc2F0b3NoaXMpLmlzRXF1YWxUbyhiLnNhdG9zaGlzKSA/IDAgOiBuZXcgQmlnTnVtYmVyKGEuc2F0b3NoaXMpLmlzR3JlYXRlclRoYW4oYi5zYXRvc2hpcykgPyAxIDogLTE7CiAgICAgIH0pOyAvLyDQn9C+0L/RgNC+0LHRg9C10Lwg0L3QsNC50YLQuCDQvtC00LjQvSDQstGL0YXQvtC0INGB0LTQsNGH0LgsINC60L7RgtC+0YDRi9C5INC/0L7QutGA0L7QtdGCINGC0YDQsNC90LfQsNC60YbQuNGOCgogICAgICB2YXIgb25lVW5zcGVudCA9IG51bGw7CiAgICAgIHNvcnRlZFVuc3BlbnRzLmZvckVhY2goZnVuY3Rpb24gKHVuc3BlbnQpIHsKICAgICAgICBpZiAob25lVW5zcGVudCA9PT0gbnVsbCAmJiBuZXcgQmlnTnVtYmVyKHVuc3BlbnQuc2F0b3NoaXMpLmlzR3JlYXRlclRoYW5PckVxdWFsVG8obmVlZEFtb3VudCkpIHsKICAgICAgICAgIG9uZVVuc3BlbnQgPSB1bnNwZW50OwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAob25lVW5zcGVudCA9PT0gbnVsbCkgewogICAgICAgIC8vINCV0YHQu9C4INC+0LTQuNC9INCy0YvRhdC+0LQg0L3QtSDQvdCw0YjQu9C4IC0g0LjRgdC/0L7Qu9GM0LfRg9C10Lwg0L/QvtC00YHRh9C40YLQsNC90L3Ri9C1IHVzZWRVbnNwZW50cwogICAgICAgIC8vINCf0L7QtNCx0LXRgNC10Lwg0LfQtNCw0YfRgywg0YHRg9C80LzRiyDQutC+0YLQvtGA0L7QuSDRhdCy0LDRgtCw0LXRgiDQtNC70Y8g0YLRgNCw0L3Qt9Cw0LrRhtC40LggKNC+0YIg0LzQtdC90YzRiNC10LPQviDQuiDQsdC+0LvRjNGI0LXQvNGDKQogICAgICAgIHZhciBjYWxjZWRBbW91bnQgPSBuZXcgQmlnTnVtYmVyKDApOwogICAgICAgIHZhciB1c2VkVW5zcGVudHMgPSBzb3J0ZWRVbnNwZW50cy5maWx0ZXIoZnVuY3Rpb24gKHVuc3BlbnQpIHsKICAgICAgICAgIGlmIChjYWxjZWRBbW91bnQuaXNHcmVhdGVyVGhhbk9yRXF1YWxUbyhuZWVkQW1vdW50KSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWxjZWRBbW91bnQgPSBjYWxjZWRBbW91bnQucGx1cyh1bnNwZW50LnNhdG9zaGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmVzb2x2ZSh1c2VkVW5zcGVudHMpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc29sdmUoW29uZVVuc3BlbnRdKTsKICAgICAgfQogICAgfTsKCiAgICBpZiAob3B0aW9ucy51bnNwZW50cykgewogICAgICBwcm9jZXNzVW5zcGVudHMob3B0aW9ucy51bnNwZW50cyk7CiAgICB9IGVsc2UgewogICAgICBmZXRjaFVuc3BlbnRzKHsKICAgICAgICBORVRXT1JLOiBORVRXT1JLLAogICAgICAgIGFkZHJlc3M6IGFkZHJlc3MsCiAgICAgICAgYXBpQml0cGF5OiBhcGlCaXRwYXksCiAgICAgICAgY2FjaGVSZXNwb25zZTogY2FjaGVSZXNwb25zZQogICAgICB9KS50aGVuKHByb2Nlc3NVbnNwZW50cylbImNhdGNoIl0oZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgfSk7CiAgICB9CiAgfSk7Cn07IC8vIEBUb0RvIC0g0LjQvdGC0LXRgNGE0LXQudGBIC0g0LLQvtC30LLRgNCw0YjQtdGCINC+0LHRitC10LrRgiB7IHR4aWQgfQoKCnZhciBicm9hZGNhc3RUeCA9IGZ1bmN0aW9uIGJyb2FkY2FzdFR4KG9wdGlvbnMpIHsKICB2YXIgdHhSYXcgPSBvcHRpb25zLnR4UmF3LAogICAgICBhcGlCaXRwYXkgPSBvcHRpb25zLmFwaUJpdHBheSwKICAgICAgYXBpQmxvY3lwZXIgPSBvcHRpb25zLmFwaUJsb2N5cGVyLAogICAgICBvbkJyb2FkY2FzdEVycm9yID0gb3B0aW9ucy5vbkJyb2FkY2FzdEVycm9yLAogICAgICBORVRXT1JLID0gb3B0aW9ucy5ORVRXT1JLOwogIHJldHVybiBuZXcgUHJvbWlzZSggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgYW5zd2VyLCBiY0Fuc3dlcjsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgYW5zd2VyID0gZmFsc2U7IC8vIEBUb0RvIC0gbWFrZSBpbnRlcmZhY2UgZm9yIGFwaSBhbnN3ZXIgCgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMTsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIGFwaUxvb3Blci5wb3N0KGFwaUJpdHBheSB8fCBnZXRCaXRwYXkoTkVUV09SSyksICIvdHgvc2VuZCIsIHsKICAgICAgICAgICAgICAgIGJvZHk6IHsKICAgICAgICAgICAgICAgICAgcmF3VHg6IHR4UmF3CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVwb3J0RXJyb3JzOiBmdW5jdGlvbiByZXBvcnRFcnJvcnMoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0JpdFBheSBicm9hZGNhc3RUeCBlcnJvcicsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaW5RdWVyeTogewogICAgICAgICAgICAgICAgICBkZWxheTogNTAwLAogICAgICAgICAgICAgICAgICBuYW1lOiAiYml0cGF5IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGFuc3dlciA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA3OwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgxKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQml0UGF5IGJyb2FkY2FzdFR4IGVycm9yJywgX2NvbnRleHQyLnQwKTsKCiAgICAgICAgICAgICAgaWYgKG9uQnJvYWRjYXN0RXJyb3IgaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgICAgICAgaWYgKG9uQnJvYWRjYXN0RXJyb3IoX2NvbnRleHQyLnQwKSkgcmVqZWN0KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBpZiAoIShhbnN3ZXIgJiYgYW5zd2VyLnR4aWQpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICAgIHR4aWQ6IGFuc3dlci50eGlkCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBpZiAoISghYW5zd2VyIHx8ICFhbnN3ZXIudHhpZCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMTU7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxODsKICAgICAgICAgICAgICByZXR1cm4gYXBpTG9vcGVyLnBvc3QoYXBpQmxvY3lwZXIgfHwgZ2V0QmxvY2tjeXBoZXIoTkVUV09SSyksICIvdHhzL3B1c2giLCB7CiAgICAgICAgICAgICAgICBib2R5OiB7CiAgICAgICAgICAgICAgICAgIHR4OiB0eFJhdwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcG9ydEVycm9yczogZnVuY3Rpb24gcmVwb3J0RXJyb3JzKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgIGlmIChlcnJvciAmJiBlcnJvci5yZXMgJiYgZXJyb3IucmVzLnJlcyAmJiBlcnJvci5yZXMucmVzLnN0YXR1c01lc3NhZ2UgJiYgZXJyb3IucmVzLnJlcy5zdGF0dXNNZXNzYWdlID09PSAiQ29uZmxpY3QiKSB7CiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCJDb25mbGljdCIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IucmVzICYmIGVycm9yLnJlcy5ib2R5ICYmIGVycm9yLnJlcy5ib2R5LmVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IucmVzLmJvZHkuZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaW5RdWVyeTogewogICAgICAgICAgICAgICAgICBkZWxheTogNTAwLAogICAgICAgICAgICAgICAgICBuYW1lOiAiYmxvY3lwZXIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgIGJjQW5zd2VyID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgIGlmIChiY0Fuc3dlciAmJiBiY0Fuc3dlci50eCAmJiBiY0Fuc3dlci50eC5oYXNoKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgdHhpZDogYmNBbnN3ZXIudHguaGFzaAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlamVjdCgiQ2FudCBkZWNvZGUgYW5zd2VyIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI1OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDIyOwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MSA9IF9jb250ZXh0MlsiY2F0Y2giXSgxNSk7CgogICAgICAgICAgICAgIGlmIChvbkJyb2FkY2FzdEVycm9yIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICAgICAgICAgIGlmIChvbkJyb2FkY2FzdEVycm9yKF9jb250ZXh0Mi50MSkpIHJlamVjdCgiIik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlamVjdCgiIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzEsIDddLCBbMTUsIDIyXV0pOwogICAgfSkpOwoKICAgIHJldHVybiBmdW5jdGlvbiAoX3gzLCBfeDQpIHsKICAgICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0oKSk7Cn07Ci8qDQogINCf0YDQvtCy0LXRgNGP0LXRgiDRgdC/0LjRgdCw0L3QuNC1INGB0L4g0YHQutGA0LjQv9GC0LAgLSDQv9C+0YHQu9C10LTQvdGP0Y8g0YLRgNCw0L3Qt9Cw0LrRhtC40Y8g0LLRi9GF0L7QtNCwDQogINCS0L7Qt9Cy0YDQsNGJ0LDQtdGCIHR4SWQsINCw0LTRgNC10YHRgSDQuCDRgdGD0LzQvNGDDQoqLwoKCnZhciBjaGVja1dpdGhkcmF3ID0gZnVuY3Rpb24gY2hlY2tXaXRoZHJhdyhvcHRpb25zKSB7CiAgdmFyIHNjcmlwdEFkZHJlc3MgPSBvcHRpb25zLnNjcmlwdEFkZHJlc3MsCiAgICAgIGFwaUJpdHBheSA9IG9wdGlvbnMuYXBpQml0cGF5LAogICAgICBORVRXT1JLID0gb3B0aW9ucy5ORVRXT1JLOwogIHZhciB1cmwgPSAiL2FkZHJlc3MvIi5jb25jYXQoc2NyaXB0QWRkcmVzcywgIi90eHMvIik7CiAgcmV0dXJuIGFwaUxvb3Blci5nZXQoYXBpQml0cGF5IHx8IGdldEJpdHBheShORVRXT1JLKSwgdXJsLCB7CiAgICBjaGVja1N0YXR1czogZnVuY3Rpb24gY2hlY2tTdGF0dXMoYW5zd2VyKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGFuc3dlciAmJiBhbnN3ZXIubGVuZ3RoICE9PSB1bmRlZmluZWQpIHJldHVybiB0cnVlOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLyogKi8KICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGluUXVlcnk6IHsKICAgICAgZGVsYXk6IDUwMCwKICAgICAgbmFtZTogImJpdHBheSIKICAgIH0KICB9KS50aGVuKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgdmFyIF9yZWY0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTModHhzKSB7CiAgICAgIHZhciBzcGVuZFR4SW5mbzsKICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKCEodHhzLmxlbmd0aCA+IDEgJiYgdHhzWzBdLm1pbnRUeGlkICYmIHR4c1swXS5zcGVudFR4aWQpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDExOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDE7CiAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0OwogICAgICAgICAgICAgIHJldHVybiBmZXRjaFR4SW5mbyh7CiAgICAgICAgICAgICAgICBoYXNoOiB0eHNbMF0uc3BlbnRUeGlkLAogICAgICAgICAgICAgICAgYXBpQml0cGF5OiBhcGlCaXRwYXkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBzcGVuZFR4SW5mbyA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICBhZGRyZXNzOiBzcGVuZFR4SW5mby5yZWNlaXZlckFkZHJlc3MsCiAgICAgICAgICAgICAgICB0eGlkOiB0eHNbMF0uc3BlbnRUeGlkLAogICAgICAgICAgICAgICAgYW1vdW50OiBuZXcgQmlnTnVtYmVyKHR4c1swXS52YWx1ZSkuZGl2aWRlZEJ5KDFlOCkudG9OdW1iZXIoKQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gODsKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMSk7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbCBjaGVjayBXaXRoZHJhdyBmb3IgJywgc2NyaXB0QWRkcmVzcywgX2NvbnRleHQzLnQwKTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMywgbnVsbCwgW1sxLCA4XV0pOwogICAgfSkpOwoKICAgIHJldHVybiBmdW5jdGlvbiAoX3g1KSB7CiAgICAgIHJldHVybiBfcmVmNC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCkpOwp9OwoKdmFyIGZldGNoVHhSYXcgPSBmdW5jdGlvbiBmZXRjaFR4UmF3KG9wdGlvbnMpIHsKICB2YXIgdHhJZCA9IG9wdGlvbnMudHhJZCwKICAgICAgY2FjaGVSZXNwb25zZSA9IG9wdGlvbnMuY2FjaGVSZXNwb25zZSwKICAgICAgYXBpQmxvY3lwZXIgPSBvcHRpb25zLmFwaUJsb2N5cGVyLAogICAgICBORVRXT1JLID0gb3B0aW9ucy5ORVRXT1JLOwogIHJldHVybiBhcGlMb29wZXIuZ2V0KGFwaUJsb2N5cGVyIHx8IGdldEJsb2NrY3lwaGVyKE5FVFdPUkspLCAiL3R4cy8iLmNvbmNhdCh0eElkLCAiP2luY2x1ZGVIZXg9dHJ1ZSIpLCB7CiAgICBjYWNoZVJlc3BvbnNlOiBjYWNoZVJlc3BvbnNlLAogICAgY2hlY2tTdGF0dXM6IGZ1bmN0aW9uIGNoZWNrU3RhdHVzKGFuc3dlcikgewogICAgICB0cnkgewogICAgICAgIGlmIChhbnN3ZXIgJiYgYW5zd2VyLmhleCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gdHJ1ZTsKICAgICAgfSBjYXRjaCAoZSkge30KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBpblF1ZXJ5OiB7CiAgICAgIGRlbGF5OiA1MDAsCiAgICAgIG5hbWU6ICJibG9jeXBlciIKICAgIH0KICB9KS50aGVuKGZ1bmN0aW9uIChfcmVmNSkgewogICAgdmFyIGhleCA9IF9yZWY1LmhleDsKICAgIHJldHVybiBoZXg7CiAgfSk7Cn07Cgp2YXIgZ2V0VHJhbnNhY3Rpb25CbG9jeXBlciA9IGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQmxvY3lwZXIob3B0aW9ucykgewogIHZhciBhZGRyZXNzID0gb3B0aW9ucy5hZGRyZXNzLAogICAgICBvd25BZGRyZXNzID0gb3B0aW9ucy5vd25BZGRyZXNzLAogICAgICBvd25UeXBlID0gb3B0aW9ucy5vd25UeXBlLAogICAgICBteVdhbGxldHMgPSBvcHRpb25zLm15V2FsbGV0cywKICAgICAgbmV0d29yayA9IG9wdGlvbnMubmV0d29yaywKICAgICAgYXBpQmxvY3lwZXIgPSBvcHRpb25zLmFwaUJsb2N5cGVyLAogICAgICBORVRXT1JLID0gb3B0aW9ucy5ORVRXT1JLOwogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgdmFyIHR5cGUgPSBvd25UeXBlIHx8ICdidGMnOwogICAgdmFyIGNoZWNrQWRkcmVzcyA9IGFkZHJlc3MgfHwgb3duQWRkcmVzczsKICAgIHZhciB1cmwgPSAiL2FkZHJzLyIuY29uY2F0KGNoZWNrQWRkcmVzcywgIi9mdWxsP3R4bGltaXQ9MTAwMDAwMCIpOwogICAgYXBpTG9vcGVyLmdldChhcGlCbG9jeXBlciB8fCBnZXRCbG9ja2N5cGhlcihORVRXT1JLKSwgdXJsLCB7CiAgICAgIGNhY2hlUmVzcG9uc2U6IDEwICogMTAwMCwKICAgICAgaW5RdWVyeTogewogICAgICAgIGRlbGF5OiA1MDAsCiAgICAgICAgbmFtZTogImJsb2N5cGVyIgogICAgICB9CiAgICB9KS50aGVuKGZ1bmN0aW9uIChhbnN3ZXIpIHsKICAgICAgaWYgKGFuc3dlciAmJiBhbnN3ZXIudHhzKSB7CiAgICAgICAgdmFyIHRyYW5zYWN0aW9ucyA9IGFuc3dlci50eHMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICB2YXIgaGFzT3VySW5wdXRzID0gaXRlbS5pbnB1dHMuZmlsdGVyKGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gaW5wdXQuYWRkcmVzc2VzWzBdID09PSBjaGVja0FkZHJlc3M7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBoYXNPdXJJbnB1dHMubGVuZ3RoID8gIm91dCIgOiAiaW4iOwogICAgICAgICAgdmFyIGlzU2VsZiA9IGRpcmVjdGlvbiA9PT0gJ291dCcgJiYgaXRlbS5vdXRwdXRzLmZpbHRlcihmdW5jdGlvbiAob3V0cHV0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50QWRkcmVzcyA9IG91dHB1dC5hZGRyZXNzZXNbMF07CiAgICAgICAgICAgIHJldHVybiBjdXJyZW50QWRkcmVzcyA9PT0gY2hlY2tBZGRyZXNzOwogICAgICAgICAgfSkubGVuZ3RoID09PSBpdGVtLm91dHB1dHMubGVuZ3RoOwogICAgICAgICAgdmFyIHZhbHVlID0gaXNTZWxmID8gaXRlbS5mZWVzIDogaXRlbS5vdXRwdXRzLmZpbHRlcihmdW5jdGlvbiAob3V0cHV0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50QWRkcmVzcyA9IG91dHB1dC5hZGRyZXNzZXNbMF07CiAgICAgICAgICAgIHJldHVybiBkaXJlY3Rpb24gPT09ICdpbicgPyBjdXJyZW50QWRkcmVzcyA9PT0gY2hlY2tBZGRyZXNzIDogY3VycmVudEFkZHJlc3MgIT09IGNoZWNrQWRkcmVzczsKICAgICAgICAgIH0pWzBdLnZhbHVlOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgaGFzaDogaXRlbS5oYXNoLAogICAgICAgICAgICBjYW5FZGl0OiBteVdhbGxldHMuaW5kZXhPZihjaGVja0FkZHJlc3MpICE9PSAtMSwKICAgICAgICAgICAgY29uZmlybWF0aW9uczogaXRlbS5jb25maXJtYXRpb25zLAogICAgICAgICAgICB2YWx1ZTogbmV3IEJpZ051bWJlcih2YWx1ZSkuZGl2aWRlZEJ5KDFlOCkudG9OdW1iZXIoKSwKICAgICAgICAgICAgZGF0ZTogRGF0ZS5wYXJzZShpdGVtLmNvbmZpcm1hdGlvbnMgPyBpdGVtLmNvbmZpcm1lZCA6IGl0ZW0ucmVjZWl2ZWQpLAogICAgICAgICAgICBkaXJlY3Rpb246IGlzU2VsZiA/ICdzZWxmJyA6IGRpcmVjdGlvbgogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICByZXNvbHZlKHRyYW5zYWN0aW9ucyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgIH0KICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBidGMgdHhzIEVycm9yJywgZSk7CiAgICAgIHJlc29sdmUoW10pOwogICAgfSk7CiAgfSk7Cn07Ci8qKiANCiAgRHJhZnQgLSDQstC30Y/RgtC+INC40Lcg0YTRgNC+0L3RgtCwLCDRgtCw0Lwg0L3QtSDQuNGB0L/QvtC70YzQt9GD0LXRgtGB0Y8NCiAg0J3QviDQvdGD0LbQvdC+INGA0LXQsNC70LjQt9C+0LLQsNGC0YwNCiAg0LjQs9C90L7RgNGLIC0g0Y/QstC90YvQtSDQvtGI0LjQsdC60LggLSDQtdGB0YLRjCDQt9Cw0LLQuNGB0LjQvNC+0YHRgtC4INC+0YIg0YTRgNC+0L3RgtCwIHNoYXJlZC9hY3Rpb25zL2J0Yw0KICDQodC40YLQsNGD0LDRhtC40Y8g0YLQsNC60LDRjyAtINC60L7Qs9C00LAgaW5zaWdodCDQvtCx0L3QvtCy0LjQuyDRgdCy0L7QtSDQsNC/0LgsINCyINCx0YvRgdGC0YDQvtC8INGA0LXQttC40LzQtSDQvdGD0LbQvdC+INCx0YvQu9C+DQogINCy0L7RgdGB0YLQsNC90LDQstC70LjQstCw0YLRjCDRhNGA0L7QvdGCIC0g0Y3RgtCwINGE0YPQvdC60YbQuNGPINC00L7Qu9C20L3QsCDQuNGB0L/QvtC70YzQt9C+0LLQsNGC0YzRgdGPINC00LvRjyDQv9C+0LvRg9GH0LXQvdC40Y8g0YHQv9C40YHQutCwDQogINCy0YHQtSDRgtGA0LDQvdC30LDQutGG0LjQuSDQvdCwINGB0YLRgNCw0L3QuNGG0LUgItCY0YHRgtC+0YDQuNGPIiwg0L3QviDQuNC3LdC30LAg0LjQt9C80LXQvdC10L3QuNC5INCyINC40YUg0LDQv9C4LCDQsdGL0YHRgtGA0LXQtSDQsdGL0LvQvg0KICDQuNGB0L/QvtC70YzQt9C+0LLQsNGC0Ywg0LHQu9C+0LrRgNC40L/QtdGAIC0g0LIg0Y3RgtC+0Lkg0YTRg9C90LrRhtC40Lgg0LXRgdGC0Ywg0L/RgNC+0LHQu9C10LzRiyDRgSDQv9C+0LvRg9GH0LXQvdC40LXQvCDQsNC00YDQtdGB0L7QsiDQv9C+0LvRg9GH0LDRgtC10LvRjy3QvtGC0L/RgNCw0LLQuNGC0LXQu9GPDQoqKi8KCgp2YXIgZ2V0VHJhbnNhY3Rpb25CaXRjb3JlID0gZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25CaXRjb3JlKG9wdGlvbnMpIHsKICB2YXIgYWRkcmVzcyA9IG9wdGlvbnMuYWRkcmVzcywKICAgICAgb3duVHlwZSA9IG9wdGlvbnMub3duVHlwZSwKICAgICAgbXlXYWxsZXRzID0gb3B0aW9ucy5teVdhbGxldHMsCiAgICAgIG5ldHdvcmsgPSBvcHRpb25zLm5ldHdvcmssCiAgICAgIGFwaUJpdHBheSA9IG9wdGlvbnMuYXBpQml0cGF5LAogICAgICBORVRXT1JLID0gb3B0aW9ucy5ORVRXT1JLOwogIHJldHVybiBuZXcgUHJvbWlzZSggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmNiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KHJlc29sdmUpIHsKICAgICAgdmFyIG15QWxsV2FsbGV0cywgX2dldFN0YXRlLCB1c2VyQWRkcmVzcywgdHlwZSwgYmxvY2tJbmZvLCB1cmw7CgogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAvLyBACiAgICAgICAgICAgICAgbXlBbGxXYWxsZXRzID0gZ2V0QWxsTXlBZGRyZXNzZXMoKTsgLy8gQAoKICAgICAgICAgICAgICBfZ2V0U3RhdGUgPSBnZXRTdGF0ZSgpLCB1c2VyQWRkcmVzcyA9IF9nZXRTdGF0ZS51c2VyLmJ0Y0RhdGEuYWRkcmVzczsgLy8gQAoKICAgICAgICAgICAgICBhZGRyZXNzID0gKF9yZWFkT25seUVycm9yKCJhZGRyZXNzIiksIGFkZHJlc3MgfHwgdXNlckFkZHJlc3MpOwogICAgICAgICAgICAgIHR5cGUgPSBvd25UeXBlIHx8ICdidGMnOyAvLyBACgogICAgICAgICAgICAgIGlmICghdHlwZWZvcmNlLmlzQ29pbkFkZHJlc3MuQlRDKGFkZHJlc3MpKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNzsKICAgICAgICAgICAgICByZXR1cm4gYXBpTG9vcGVyLmdldChhcGlCaXRwYXkgfHwgZ2V0Qml0cGF5KE5FVFdPUkspLCAiL2Jsb2NrL3RpcCIsIHsKICAgICAgICAgICAgICAgIC8qIGNhY2hlICovCgogICAgICAgICAgICAgICAgLyogcXVlcnkgKi8KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBibG9ja0luZm8gPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYmxvY2tJbmZvJywgYmxvY2tJbmZvKTsKICAgICAgICAgICAgICB1cmwgPSAiL2FkZHJlc3MvIi5jb25jYXQoYWRkcmVzcywgIi90eHMiKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgYXBpTG9vcGVyLmdldChhcGlCaXRwYXksIHVybCwgewogICAgICAgICAgICAgICAgY2hlY2tTdGF0dXM6IGZ1bmN0aW9uIGNoZWNrU3RhdHVzKGFuc3dlcikgewogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmIChhbnN3ZXIgJiYgYW5zd2VyLnR4cyAhPT0gdW5kZWZpbmVkKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIC8qICovCiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpblF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGRlbGF5OiA1MDAsCiAgICAgICAgICAgICAgICAgIG5hbWU6ICJiaXRwYXkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb25zID0gcmVzLnR4cy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IGl0ZW0udmluWzBdLmFkZHIgIT09IGFkZHJlc3MgPyAnaW4nIDogJ291dCc7CiAgICAgICAgICAgICAgICAgIHZhciBpc1NlbGYgPSBkaXJlY3Rpb24gPT09ICdvdXQnICYmIGl0ZW0udm91dC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdm91dEFkZHJCdWYgPSBCdWZmZXIuZnJvbShpdGVtLnNjcmlwdFB1YktleS5oZXgsICdoZXgnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEFkZHJlc3MgPSBiaXRjb2luLmFkZHJlc3MuZnJvbU91dHB1dFNjcmlwdCh2b3V0QWRkckJ1ZiwgbmV0d29yayk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRBZGRyZXNzID09PSBhZGRyZXNzOwogICAgICAgICAgICAgICAgICB9KS5sZW5ndGggPT09IGl0ZW0udm91dC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgICAgICAgICBoYXNoOiBpdGVtLnR4aWQsCiAgICAgICAgICAgICAgICAgICAgY2FuRWRpdDogbXlXYWxsZXRzLmluZGV4T2YoYWRkcmVzcykgIT09IC0xLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbnM6IGl0ZW0uY29uZmlybWF0aW9ucywKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaXNTZWxmID8gaXRlbS5mZWVzIDogaXRlbS52b3V0LmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHZvdXRBZGRyQnVmID0gQnVmZmVyLmZyb20oaXRlbS5zY3JpcHRQdWJLZXkuaGV4LCAnaGV4Jyk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEFkZHJlc3MgPSBiaXRjb2luLmFkZHJlc3MuZnJvbU91dHB1dFNjcmlwdCh2b3V0QWRkckJ1ZiwgbmV0d29yayk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGlyZWN0aW9uID09PSAnaW4nID8gY3VycmVudEFkZHJlc3MgPT09IGFkZHJlc3MgOiBjdXJyZW50QWRkcmVzcyAhPT0gYWRkcmVzczsKICAgICAgICAgICAgICAgICAgICB9KVswXS52YWx1ZSwKICAgICAgICAgICAgICAgICAgICBkYXRlOiBpdGVtLnRpbWUgKiAxMDAwLAogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogaXNTZWxmID8gJ3NlbGYnIDogZGlyZWN0aW9uCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJlc29sdmUodHJhbnNhY3Rpb25zKTsKICAgICAgICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU0KTsKICAgIH0pKTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKF94NikgewogICAgICByZXR1cm4gX3JlZjYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpKTsKfTsKCnZhciBlc3RpbWF0ZUZlZVJhdGVCTE9DS0NZUEhFUiA9IGZ1bmN0aW9uIGVzdGltYXRlRmVlUmF0ZUJMT0NLQ1lQSEVSKG9wdGlvbnMpIHsKICB2YXIgX29wdGlvbnMkc3BlZWQgPSBvcHRpb25zLnNwZWVkLAogICAgICBzcGVlZCA9IF9vcHRpb25zJHNwZWVkID09PSB2b2lkIDAgPyAnZmFzdCcgOiBfb3B0aW9ucyRzcGVlZCwKICAgICAgTkVUV09SSyA9IG9wdGlvbnMuTkVUV09SSzsKCiAgdmFyIF9zcGVlZCA9IGZ1bmN0aW9uICgpIHsKICAgIHN3aXRjaCAoc3BlZWQpIHsKICAgICAgY2FzZSAnZmFzdCc6CiAgICAgICAgcmV0dXJuICdoaWdoX2ZlZV9wZXJfa2InOwoKICAgICAgY2FzZSAnbm9ybWFsJzoKICAgICAgICByZXR1cm4gJ21lZGl1bV9mZWVfcGVyX2tiJzsKCiAgICAgIGNhc2UgJ3Nsb3cnOgogICAgICAgIHJldHVybiAnbG93X2ZlZV9wZXJfa2InOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gJ21lZGl1bV9mZWVfcGVyX2tiJzsKICAgIH0KICB9KCk7IC8vIDEwIG1pbnV0cyBjYWNoZQogIC8vIHF1ZXJ5IHJlcXVlc3QKCgogIHJldHVybiBhcGlMb29wZXIuZ2V0KGdldEJsb2NrY3lwaGVyKE5FVFdPUkspLCAiIiwgewogICAgY2FjaGVSZXNwb25zZTogMTAgKiA2MCAqIDEwMDAsCiAgICBjYWNoZU9uRmFpbDogdHJ1ZSwKICAgIGluUXVlcnk6IHsKICAgICAgZGVsYXk6IDUwMCwKICAgICAgbmFtZTogImJsb2N5cGVyIgogICAgfQogIH0pLnRoZW4oZnVuY3Rpb24gKGluZm8pIHsKICAgIHJldHVybiBOdW1iZXIoaW5mb1tfc3BlZWRdKTsKICB9KTsKfTsKCnZhciBlc3RpbWF0ZUZlZVJhdGVFQVJOQ09NID0gZnVuY3Rpb24gZXN0aW1hdGVGZWVSYXRlRUFSTkNPTShvcHRpb25zKSB7CiAgdmFyIF9vcHRpb25zJHNwZWVkMiA9IG9wdGlvbnMuc3BlZWQsCiAgICAgIHNwZWVkID0gX29wdGlvbnMkc3BlZWQyID09PSB2b2lkIDAgPyAnZmFzdCcgOiBfb3B0aW9ucyRzcGVlZDI7CgogIHZhciBfc3BlZWQgPSBmdW5jdGlvbiAoKSB7CiAgICBzd2l0Y2ggKHNwZWVkKSB7CiAgICAgIGNhc2UgJ2Zhc3QnOgogICAgICAgIHJldHVybiAnZmFzdGVzdEZlZSc7CgogICAgICBjYXNlICdub3JtYWwnOgogICAgICAgIHJldHVybiAnaGFsZkhvdXJGZWUnOwoKICAgICAgY2FzZSAnc2xvdyc6CiAgICAgICAgcmV0dXJuICdob3VyRmVlJzsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuICdoYWxmSG91ckZlZSc7CiAgICB9CiAgfSgpOyAvLyAxMCBtaW51dHMgY2FjaGUKICAvLyBxdWVyeSByZXF1ZXN0CiAgLy8gdXNlIGNhY2hlIGlmIGZhaWwKCgogIHJldHVybiBhcGlMb29wZXIuZ2V0KHsKICAgIG5hbWU6ICdFQVJOX0NPTScsCiAgICBzZXJ2ZXJzOiAiaHR0cHM6Ly9iaXRjb2luZmVlcy5lYXJuLmNvbS9hcGkvdjEvZmVlcy9yZWNvbW1lbmRlZCIKICB9LCAiIiwgewogICAgY2FjaGVSZXNwb25zZTogMTAgKiA2MCAqIDEwMDAsCiAgICBjYWNoZU9uRmFpbDogdHJ1ZSwKICAgIGluUXVlcnk6IHsKICAgICAgZGVsYXk6IDUwMCwKICAgICAgbmFtZTogImJsb2N5cGVyIgogICAgfQogIH0pLnRoZW4oZnVuY3Rpb24gKGZlZXMpIHsKICAgIHJldHVybiBOdW1iZXIoZmVlc1tfc3BlZWRdKSAqIDEwMjQ7CiAgfSk7Cn07Cgp2YXIgZXN0aW1hdGVGZWVSYXRlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjcgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShvcHRpb25zKSB7CiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAwOwogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBlc3RpbWF0ZUZlZVJhdGVCTE9DS0NZUEhFUihvcHRpb25zKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDUuc2VudCk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBfY29udGV4dDUucHJldiA9IDY7CiAgICAgICAgICAgIF9jb250ZXh0NS50MCA9IF9jb250ZXh0NVsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXN0aW1hdGVGZWVFcnJvcjogQkxPQ0tDWVBIRVJfQVBJICIuY29uY2F0KF9jb250ZXh0NS50MC5tZXNzYWdlLCAiLCB0cnlpbmcgRUFSTi5DT00uLi4iKSk7CiAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTE7CiAgICAgICAgICAgIHJldHVybiBlc3RpbWF0ZUZlZVJhdGVFQVJOQ09NKG9wdGlvbnMpOwoKICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDUuc2VudCk7CgogICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTUsIG51bGwsIFtbMCwgNl1dKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBlc3RpbWF0ZUZlZVJhdGUoX3g3KSB7CiAgICByZXR1cm4gX3JlZjcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgY2FsY3VsYXRlVHhTaXplID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjggPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNihvcHRpb25zKSB7CiAgICB2YXIgc3BlZWQsIF91bnNwZW50cywgYWRkcmVzcywgX29wdGlvbnMkdHhPdXQsIHR4T3V0LCBORVRXT1JLLCB1bnNwZW50cywgdHhJbiwgdHhTaXplOwoKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBzcGVlZCA9IG9wdGlvbnMuc3BlZWQsIF91bnNwZW50cyA9IG9wdGlvbnMudW5zcGVudHMsIGFkZHJlc3MgPSBvcHRpb25zLmFkZHJlc3MsIF9vcHRpb25zJHR4T3V0ID0gb3B0aW9ucy50eE91dCwgdHhPdXQgPSBfb3B0aW9ucyR0eE91dCA9PT0gdm9pZCAwID8gMiA6IF9vcHRpb25zJHR4T3V0LCBORVRXT1JLID0gb3B0aW9ucy5ORVRXT1JLOwogICAgICAgICAgICBfY29udGV4dDYudDAgPSBfdW5zcGVudHM7CgogICAgICAgICAgICBpZiAoX2NvbnRleHQ2LnQwKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA2OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDU7CiAgICAgICAgICAgIHJldHVybiBmZXRjaFVuc3BlbnRzKHsKICAgICAgICAgICAgICBhZGRyZXNzOiBhZGRyZXNzLAogICAgICAgICAgICAgIE5FVFdPUks6IE5FVFdPUksKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDYuc2VudDsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIHVuc3BlbnRzID0gX2NvbnRleHQ2LnQwOwogICAgICAgICAgICB0eEluID0gdW5zcGVudHMubGVuZ3RoOwogICAgICAgICAgICB0eFNpemUgPSB0eEluID4gMCA/IHR4SW4gKiAxNDYgKyB0eE91dCAqIDMzICsgKDE1ICsgdHhJbiAtIHR4T3V0KSA6IDIyNjsgLy8gZGVmYXVsdCB0eCBzaXplIGZvciAxIHR4SW4gYW5kIDIgdHhPdXQKCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCB0eFNpemUpOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU2KTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBjYWxjdWxhdGVUeFNpemUoX3g4KSB7CiAgICByZXR1cm4gX3JlZjguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Cgp2YXIgZXN0aW1hdGVGZWVWYWx1ZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWY5ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcob3B0aW9ucykgewogICAgdmFyIF9mZWVSYXRlLCBpblNhdG9zaGlzLCBzcGVlZCwgYWRkcmVzcywgX3R4U2l6ZSwgTkVUV09SSywgY2FsY3VsYXRlZEZlZVZhbHVlLCB0eFNpemUsIGZlZVJhdGUsIGZpbmFsRmVlVmFsdWU7CgogICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9mZWVSYXRlID0gb3B0aW9ucy5mZWVSYXRlLCBpblNhdG9zaGlzID0gb3B0aW9ucy5pblNhdG9zaGlzLCBzcGVlZCA9IG9wdGlvbnMuc3BlZWQsIGFkZHJlc3MgPSBvcHRpb25zLmFkZHJlc3MsIF90eFNpemUgPSBvcHRpb25zLnR4U2l6ZSwgTkVUV09SSyA9IG9wdGlvbnMuTkVUV09SSzsKCiAgICAgICAgICAgIGlmICghKCFfdHhTaXplICYmICFhZGRyZXNzKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FsY3VsYXRlZEZlZVZhbHVlID0gbmV3IEJpZ051bWJlcihEVVNUKS5tdWx0aXBsaWVkQnkoMWUtOCk7CiAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTg7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgX2NvbnRleHQ3LnQwID0gX3R4U2l6ZTsKCiAgICAgICAgICAgIGlmIChfY29udGV4dDcudDApIHsKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDEwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDk7CiAgICAgICAgICAgIHJldHVybiBjYWxjdWxhdGVUeFNpemUoewogICAgICAgICAgICAgIGFkZHJlc3M6IGFkZHJlc3MsCiAgICAgICAgICAgICAgc3BlZWQ6IHNwZWVkCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgX2NvbnRleHQ3LnQwID0gX2NvbnRleHQ3LnNlbnQ7CgogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgdHhTaXplID0gX2NvbnRleHQ3LnQwOwogICAgICAgICAgICBfY29udGV4dDcudDEgPSBfZmVlUmF0ZTsKCiAgICAgICAgICAgIGlmIChfY29udGV4dDcudDEpIHsKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDE2OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDE1OwogICAgICAgICAgICByZXR1cm4gZXN0aW1hdGVGZWVSYXRlKHsKICAgICAgICAgICAgICBzcGVlZDogc3BlZWQsCiAgICAgICAgICAgICAgTkVUV09SSzogTkVUV09SSwogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICBfY29udGV4dDcudDEgPSBfY29udGV4dDcuc2VudDsKCiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICBmZWVSYXRlID0gX2NvbnRleHQ3LnQxOwogICAgICAgICAgICBjYWxjdWxhdGVkRmVlVmFsdWUgPSBCaWdOdW1iZXIubWF4aW11bShEVVNULCBuZXcgQmlnTnVtYmVyKGZlZVJhdGUpLm11bHRpcGxpZWRCeSh0eFNpemUpLmRpdigxMDI0KS5kcCgwLCBCaWdOdW1iZXIuUk9VTkRfSEFMRl9FVkVOKSk7CgogICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgZmluYWxGZWVWYWx1ZSA9IGluU2F0b3NoaXMgPyBjYWxjdWxhdGVkRmVlVmFsdWUudG9TdHJpbmcoKSA6IGNhbGN1bGF0ZWRGZWVWYWx1ZS5tdWx0aXBsaWVkQnkoMWUtOCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIGZpbmFsRmVlVmFsdWUpOwoKICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU3KTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBlc3RpbWF0ZUZlZVZhbHVlKF94OSkgewogICAgcmV0dXJuIF9yZWY5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKZXhwb3J0IGRlZmF1bHQgewogIGZldGNoQmFsYW5jZTogZmV0Y2hCYWxhbmNlLAogIGZldGNoVHg6IGZldGNoVHgsCiAgZmV0Y2hUeEluZm86IGZldGNoVHhJbmZvLAogIGZldGNoVW5zcGVudHM6IGZldGNoVW5zcGVudHMsCiAgYnJvYWRjYXN0VHg6IGJyb2FkY2FzdFR4LAogIGNoZWNrV2l0aGRyYXc6IGNoZWNrV2l0aGRyYXcsCiAgZmV0Y2hUeFJhdzogZmV0Y2hUeFJhdywKICBnZXRUcmFuc2FjdGlvbkJsb2N5cGVyOiBnZXRUcmFuc2FjdGlvbkJsb2N5cGVyLAogIGVzdGltYXRlRmVlVmFsdWU6IGVzdGltYXRlRmVlVmFsdWUsCiAgZ2V0Q29yZTogZ2V0Q29yZSwKICBwcmVwYXJlVW5zcGVudHM6IHByZXBhcmVVbnNwZW50cwp9Ow=="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/common/utils/coin/btc.ts"],"names":["apiLooper","BigNumber","bitcoin","typeforce","default","TESTNET","MAINNET","DUST","getBitpay","network","name","servers","bitpay","getCore","getBlockcypher","blockcypher","fetchBalance","options","address","withUnconfirmed","apiBitpay","cacheResponse","NETWORK","get","checkStatus","answer","balance","undefined","error","console","inQuery","delay","then","unconfirmed","dividedBy","toNumber","fetchTx","hash","fee","e","rest","fees","fetchTxInfo","hasAdminFee","Promise","callback","txinfoReject","baseTxInfo","txCoins","receiverAddress","afterBalance","inputs","value","adminOutput","adminFee","afterOutput","outputs","senderAddress","amount","filter","out","eq","length","txInfo","txid","confirmed","confirmations","minerFee","minerFeeCurrency","map","output","input","size","fetchUnspents","resolve","reject","index","height","mintHeight","satoshis","scriptPubKey","script","mintTxid","vout","mintIndex","spentTxid","prepareUnspents","processUnspents","unspents","needAmount","multipliedBy","plus","sortedUnspents","sort","a","b","isEqualTo","isGreaterThan","oneUnspent","forEach","unspent","isGreaterThanOrEqualTo","calcedAmount","usedUnspents","broadcastTx","txRaw","apiBlocyper","onBroadcastError","post","body","rawTx","reportErrors","log","Function","tx","res","statusMessage","bcAnswer","checkWithdraw","scriptAddress","url","txs","spendTxInfo","fetchTxRaw","txId","hex","getTransactionBlocyper","ownAddress","ownType","myWallets","type","checkAddress","transactions","item","hasOurInputs","addresses","direction","isSelf","currentAddress","canEdit","indexOf","date","Date","parse","received","getTransactionBitcore","myAllWallets","getAllMyAddresses","getState","userAddress","user","btcData","isCoinAddress","BTC","blockInfo","vin","addr","voutAddrBuf","Buffer","from","fromOutputScript","time","estimateFeeRateBLOCKCYPHER","speed","_speed","cacheOnFail","info","Number","estimateFeeRateEARNCOM","estimateFeeRate","message","calculateTxSize","_unspents","txOut","txIn","txSize","estimateFeeValue","_feeRate","feeRate","inSatoshis","_txSize","calculatedFeeValue","maximum","div","dp","ROUND_HALF_EVEN","finalFeeValue","toString"],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport apiLooper from '../apiLooper'\r\nimport { BigNumber } from 'bignumber.js'\r\nimport * as bitcoin from 'bitcoinjs-lib'\r\nimport typeforce from 'swap.app/util/typeforce'\r\n\r\n// Use front API config\r\nimport { default as TESTNET } from '../../../front/config/testnet/api'\r\nimport { default as MAINNET } from '../../../front/config/mainnet/api'\r\n\r\nconst DUST = 546\r\n\r\nconst getBitpay = (network) => {\r\n  return {\r\n    name: `apiBitpay`,\r\n    servers: (network === `MAINNET`)\r\n      ? MAINNET.bitpay\r\n      : TESTNET.bitpay\r\n  }\r\n}\r\n\r\nconst getCore = () => {\r\n  return bitcoin\r\n}\r\n\r\n\r\nconst getBlockcypher = (network) => {\r\n  return {\r\n    name: `apiBlockcypher`,\r\n    servers: (network === `MAINNET`)\r\n      ? MAINNET.blockcypher\r\n      : TESTNET.blockcypher\r\n  }\r\n}\r\n\r\nconst fetchBalance = (options) => {\r\n  const {\r\n    address,\r\n    withUnconfirmed,\r\n    apiBitpay,\r\n    cacheResponse,\r\n    NETWORK,\r\n  } = options\r\n\r\n  return apiLooper.get(apiBitpay || getBitpay(NETWORK), `/address/${address}/balance/`, {\r\n    cacheResponse,\r\n    checkStatus: (answer) => {\r\n      try {\r\n        if (answer && answer.balance !== undefined) return true\r\n      } catch (error) {\r\n        console.error('Utils - btc - fetch balance: ', error)\r\n      }\r\n      return false\r\n    },\r\n    inQuery: {\r\n      delay: 500,\r\n      name: `bitpay`,\r\n    },\r\n  }).then((answer: any) => {\r\n    const {\r\n      balance,\r\n      unconfirmed,\r\n    } = answer\r\n    if (withUnconfirmed) {\r\n      return {\r\n        balance: new BigNumber(balance).dividedBy(1e8).toNumber(),\r\n        unconfirmed: new BigNumber(unconfirmed).dividedBy(1e8).toNumber(),\r\n      }\r\n    } else {\r\n      return new BigNumber(balance).dividedBy(1e8).toNumber()\r\n    }\r\n  })\r\n}\r\n\r\nconst fetchTx = (options) => {\r\n  const {\r\n    hash,\r\n    apiBitpay,\r\n    cacheResponse,\r\n    NETWORK,\r\n  } = options\r\n\r\n  return apiLooper.get(apiBitpay || getBitpay(NETWORK), `/tx/${hash}`, {\r\n    cacheResponse,\r\n    checkStatus: (answer) => {\r\n      try {\r\n        if (answer && answer.fee !== undefined) return true\r\n      } catch (e) { /* */ }\r\n      return false\r\n    },\r\n    inQuery: {\r\n      delay: 500,\r\n      name: `bitpay`,\r\n    },\r\n  }).then(({ fee, ...rest }) => ({\r\n      fees: new BigNumber(fee).dividedBy(1e8).toNumber(),\r\n      ...rest,\r\n    }\r\n  ))\r\n}\r\n\r\n\r\n// @ToDo - Make interface - fetchTxInfo     -      \r\nconst fetchTxInfo = (options) : any => {\r\n  const {\r\n    hash,\r\n    apiBitpay,\r\n    cacheResponse,\r\n    hasAdminFee,\r\n    NETWORK,\r\n  } = options\r\n\r\n  return new Promise(async (callback, txinfoReject) => {\r\n    let baseTxInfo: any | boolean = false // @ToDo - make interface for baseTxInfo api answer\r\n    let txCoins: any | boolean = false // @ToDo - make interface for txCoins api answer\r\n\r\n    try {\r\n      baseTxInfo = await fetchTx({\r\n        hash,\r\n        apiBitpay,\r\n        cacheResponse,\r\n        NETWORK,\r\n      })\r\n    } catch (error) {\r\n      console.error('Fail fetch tx info', error)\r\n      txinfoReject(error)\r\n      return\r\n    }\r\n    try {\r\n      txCoins = await apiLooper.get(apiBitpay || getBitpay(NETWORK), `/tx/${hash}/coins`, {\r\n        cacheResponse,\r\n        /* checkStatus */\r\n        inQuery: {\r\n          delay: 500,\r\n          name: `bitpay`,\r\n        },\r\n      })\r\n    } catch (error) {\r\n      console.error('Failt fetch tx coin info', error)\r\n      txinfoReject(error)\r\n    }\r\n\r\n    let receiverAddress = null\r\n    let afterBalance = txCoins && txCoins.inputs && txCoins.inputs[1] \r\n      ? new BigNumber(txCoins.inputs[1].value).dividedBy(1e8).toNumber() \r\n      : null\r\n    let adminOutput = []\r\n    let adminFee : number | boolean = false\r\n    let afterOutput = []\r\n\r\n    if (!txCoins || !txCoins.inputs || !txCoins.outputs) {\r\n      console.error('tx coin info empty')\r\n      txinfoReject('tx coin info empty')\r\n    }\r\n\r\n    const senderAddress = txCoins && txCoins.inputs ? txCoins.inputs[0].address : null\r\n    const amount = new BigNumber(txCoins.outputs[0].value).dividedBy(1e8).toNumber()\r\n\r\n    if (hasAdminFee) {\r\n      adminOutput = txCoins.outputs.filter((out) => {\r\n        return (\r\n          out.address === hasAdminFee.address\r\n          && !(new BigNumber(out.value).eq(amount))\r\n        )\r\n      })\r\n    }\r\n\r\n\r\n    /*\r\n    // @ToDo - need fix\r\n    if (txCoins && txCoins.outputs) {\r\n      afterOutput = txCoins.outputs.filter(({ address }) => {\r\n        return (\r\n          address !== hasAdminFee.address\r\n        )\r\n      })\r\n    }\r\n    */\r\n\r\n    if (afterOutput.length) {\r\n      afterBalance = new BigNumber(afterOutput[0].value).dividedBy(1e8).toNumber()\r\n    }\r\n\r\n    if (adminOutput.length) {\r\n      adminFee = new BigNumber(adminOutput[0].value).dividedBy(1e8).toNumber()\r\n    }\r\n\r\n    \r\n    if (txCoins && txCoins.outputs && txCoins.outputs[0]) {\r\n      receiverAddress = txCoins.outputs[0].address\r\n    }\r\n\r\n    // @ToDo -   \r\n    const txInfo = {\r\n      txid: baseTxInfo.txid,\r\n      amount,\r\n      afterBalance,\r\n      senderAddress,\r\n      confirmed: !!(baseTxInfo.confirmations),\r\n      confirmations: baseTxInfo.confirmations,\r\n      receiverAddress,\r\n      \r\n      minerFee: baseTxInfo.fees,\r\n      adminFee,\r\n      minerFeeCurrency: 'BTC',\r\n\r\n      outputs: txCoins.outputs.map((output) => ({\r\n        ...output,\r\n        amount: new BigNumber(output.value).dividedBy(1e8).toNumber(),\r\n      })),\r\n      inputs: txCoins.inputs.map((input) => ({\r\n        ...input,\r\n        amount: new BigNumber(input.value).dividedBy(1e8).toNumber(),\r\n      })),\r\n      fees: baseTxInfo.fees,\r\n      size: baseTxInfo.size,\r\n    }\r\n\r\n    callback( txInfo )\r\n  })\r\n}\r\n\r\nexport interface IBtcUnspent {\r\n  address: string,\r\n  amount: number,\r\n  confirmations: number,\r\n  height: number,\r\n  satoshis: number,\r\n  scriptPubKey: string,\r\n  txid: string,\r\n  vout: number,\r\n  spentTxid: string,\r\n}\r\n// @To-do - make interface -       \r\nconst fetchUnspents = (options): Promise<IBtcUnspent[]> => {\r\n  const {\r\n    address,\r\n    apiBitpay,\r\n    cacheResponse,\r\n    NETWORK,\r\n  } = options\r\n\r\n  return new Promise((resolve, reject) => {\r\n    apiLooper.get(\r\n      apiBitpay || getBitpay(NETWORK),\r\n      `/address/${address}?unspent=true&limit=1000000`,\r\n      {\r\n        cacheResponse: (cacheResponse || 5000),\r\n        inQuery: {\r\n          delay: 500,\r\n          name: `bitpay`,\r\n        },\r\n      }\r\n    ).then((answer: any) => {\r\n      resolve(answer.map((txInfo, index) => {\r\n        return {\r\n          address,\r\n          amount: new BigNumber(txInfo.value).dividedBy(1e8).toNumber(),\r\n          confirmations: txInfo.confirmations,\r\n          height: txInfo.mintHeight,\r\n          satoshis: txInfo.value,\r\n          scriptPubKey: txInfo.script,\r\n          txid: txInfo.mintTxid,\r\n          vout: txInfo.mintIndex,\r\n          spentTxid: txInfo.spentTxid,\r\n        }\r\n      }))\r\n    }).catch((error) => {\r\n      console.error('btc fetchUnspents error', error)\r\n      reject(error)\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n *   unspents     \r\n **/\r\ninterface IprepareUnspentsOptions {\r\n  NETWORK: any,\r\n  address?: string,\r\n  amount: number,\r\n  apiBitpay?: any,\r\n  cacheResponse?: any,\r\n  unspents?: IBtcUnspent[],\r\n}\r\n\r\nconst prepareUnspents = (options: IprepareUnspentsOptions): Promise<IBtcUnspent[]> => {\r\n  const {\r\n    NETWORK,\r\n    apiBitpay,\r\n    cacheResponse,\r\n    address,\r\n    amount,\r\n  } = options\r\n  return new Promise((resolve, reject) => {\r\n    const processUnspents = (unspents: IBtcUnspent[]) => {\r\n      const needAmount = new BigNumber(amount).multipliedBy(1e8).plus(DUST)\r\n      //   unspents     \r\n      const sortedUnspents: IBtcUnspent[] = unspents.sort((a: IBtcUnspent, b: IBtcUnspent) => {\r\n        return (new BigNumber(a.satoshis).isEqualTo(b.satoshis))\r\n          ? 0\r\n          : (new BigNumber(a.satoshis).isGreaterThan(b.satoshis))\r\n            ? 1\r\n            : -1\r\n      })\r\n      //     ,   \r\n      let oneUnspent: IBtcUnspent = null\r\n      sortedUnspents.forEach((unspent: IBtcUnspent) => {\r\n        if (oneUnspent === null\r\n          && new BigNumber(unspent.satoshis).isGreaterThanOrEqualTo(needAmount)\r\n        ) {\r\n          oneUnspent = unspent\r\n          return false\r\n        }\r\n      })\r\n      if (oneUnspent === null) {\r\n        //      -   usedUnspents\r\n        //  ,      (   )\r\n        let calcedAmount = new BigNumber(0)\r\n        const usedUnspents: IBtcUnspent[] = sortedUnspents.filter((unspent: IBtcUnspent) => {\r\n          if (calcedAmount.isGreaterThanOrEqualTo(needAmount)) {\r\n            return false\r\n          } else {\r\n            calcedAmount = calcedAmount.plus(unspent.satoshis)\r\n            return true\r\n          }\r\n        })\r\n        resolve(usedUnspents)\r\n      } else {\r\n        resolve([oneUnspent])\r\n      }\r\n    }\r\n\r\n    if (options.unspents) {\r\n      processUnspents(options.unspents)\r\n    } else {\r\n      fetchUnspents({\r\n        NETWORK,\r\n        address,\r\n        apiBitpay,\r\n        cacheResponse,\r\n      }).then(processUnspents).catch((error) => {\r\n        reject(error)\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n// @ToDo -  -   { txid }\r\nconst broadcastTx = (options): any => {\r\n  const {\r\n    txRaw,\r\n    apiBitpay,\r\n    apiBlocyper,\r\n    onBroadcastError,\r\n    NETWORK,\r\n  } = options\r\n\r\n  return new Promise(async (resolve, reject) => {\r\n    let answer : any | boolean = false // @ToDo - make interface for api answer \r\n    try {\r\n      answer = await apiLooper.post(apiBitpay || getBitpay(NETWORK), `/tx/send`, {\r\n        body: {\r\n          rawTx: txRaw,\r\n        },\r\n        reportErrors: (error) => {\r\n          console.log('BitPay broadcastTx error', error)\r\n          return true\r\n        },\r\n        inQuery: {\r\n          delay: 500,\r\n          name: `bitpay`,\r\n        },\r\n      })\r\n    } catch (bitpayError) {\r\n      console.log('BitPay broadcastTx error', bitpayError)\r\n      if (onBroadcastError instanceof Function) {\r\n        if (onBroadcastError(bitpayError)) reject()\r\n      }\r\n    }\r\n    if (answer && answer.txid) {\r\n      resolve({ txid: answer.txid })\r\n      return\r\n    }\r\n    if (!answer || !answer.txid) {\r\n      // use blockcryper\r\n      try {\r\n        const bcAnswer : any | boolean = await apiLooper.post(apiBlocyper || getBlockcypher(NETWORK), `/txs/push`, {\r\n          body: {\r\n            tx: txRaw,\r\n          },\r\n          reportErrors: (error) => {\r\n            if (error\r\n              && error.res\r\n              && error.res.res\r\n              && error.res.res.statusMessage\r\n              && error.res.res.statusMessage === `Conflict`\r\n            ) {\r\n              reject(`Conflict`)\r\n              return false\r\n            } else {\r\n              if (error\r\n                && error.res\r\n                && error.res.body\r\n                && error.res.body.error\r\n              ) {\r\n                reject(error.res.body.error)\r\n                return false\r\n              }\r\n            }\r\n            return true\r\n          },\r\n          inQuery: {\r\n            delay: 500,\r\n            name: `blocyper`,\r\n          },\r\n        })\r\n        if (bcAnswer\r\n          && bcAnswer.tx\r\n          && bcAnswer.tx.hash) {\r\n          resolve({\r\n            txid: bcAnswer.tx.hash,\r\n          })\r\n        } else {\r\n          reject(`Cant decode answer`)\r\n        }\r\n      } catch (blocyperError) {\r\n        if (onBroadcastError instanceof Function) {\r\n          if (onBroadcastError(blocyperError)) reject(``)\r\n        } else {\r\n          reject(``)\r\n        }\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n/*\r\n      -   \r\n   txId,   \r\n*/\r\nconst checkWithdraw = (options) => {\r\n  const {\r\n    scriptAddress,\r\n    apiBitpay,\r\n    NETWORK,\r\n  } = options\r\n\r\n  const url = `/address/${scriptAddress}/txs/`\r\n\r\n  return apiLooper.get(apiBitpay || getBitpay(NETWORK), url, {\r\n    checkStatus: (answer) => {\r\n      try {\r\n        if (answer && answer.length !== undefined) return true\r\n      } catch (e) { /* */ }\r\n      return false\r\n    },\r\n    inQuery: {\r\n      delay: 500,\r\n      name: `bitpay`,\r\n    },\r\n  }).then(async (txs: any) => {\r\n    // has two or more txs on script\r\n    if ((txs.length > 1)\r\n      && txs[0].mintTxid\r\n      && txs[0].spentTxid\r\n    ) {\r\n      try {\r\n        const spendTxInfo = await fetchTxInfo({\r\n          hash: txs[0].spentTxid,\r\n          apiBitpay\r\n        })\r\n        return {\r\n          address: spendTxInfo.receiverAddress,\r\n          txid: txs[0].spentTxid,\r\n          amount: new BigNumber(txs[0].value).dividedBy(1e8).toNumber(),\r\n        }\r\n      } catch (e) {\r\n        console.error('Fail check Withdraw for ', scriptAddress, e)\r\n      }\r\n    }\r\n    return false\r\n  })\r\n}\r\n\r\nconst fetchTxRaw = (options) => {\r\n  const {\r\n    txId,\r\n    cacheResponse,\r\n    apiBlocyper,\r\n    NETWORK,\r\n  } = options\r\n\r\n  return apiLooper.get(apiBlocyper || getBlockcypher(NETWORK), `/txs/${txId}?includeHex=true`, {\r\n    cacheResponse,\r\n    checkStatus: (answer) => {\r\n      try {\r\n        if (answer && answer.hex !== undefined) return true\r\n      } catch (e) {}\r\n      return false\r\n    },\r\n    inQuery: {\r\n      delay: 500,\r\n      name: `blocyper`,\r\n    },\r\n  }).then(({ hex }) => hex)\r\n}\r\n\r\n\r\nconst getTransactionBlocyper = (options) => {\r\n  const {\r\n    address,\r\n    ownAddress,\r\n    ownType,\r\n    myWallets,\r\n    network,\r\n    apiBlocyper,\r\n    NETWORK,\r\n  } = options\r\n\r\n  return new Promise((resolve) => {\r\n    const type = (ownType) || 'btc'\r\n\r\n    const checkAddress = (address || ownAddress)\r\n    const url = `/addrs/${checkAddress}/full?txlimit=1000000`\r\n\r\n    apiLooper.get(\r\n      apiBlocyper || getBlockcypher(NETWORK),\r\n      url,\r\n      {\r\n        cacheResponse: 10*1000,\r\n        inQuery: {\r\n          delay: 500,\r\n          name: `blocyper`,\r\n        },\r\n      }\r\n    ).then((answer: any) => {\r\n      if (answer\r\n        && answer.txs\r\n      ) {\r\n        const transactions = answer.txs.map((item) => {\r\n          const hasOurInputs = item.inputs.filter((input) => {\r\n            return (input.addresses[0] === checkAddress)\r\n          })\r\n          const direction = hasOurInputs.length ? `out` : `in`\r\n\r\n          const isSelf = direction === 'out'\r\n            && item.outputs.filter((output) => {\r\n                const currentAddress = output.addresses[0]\r\n\r\n                return currentAddress === checkAddress\r\n            }).length === item.outputs.length\r\n\r\n          let value = isSelf\r\n            ? item.fees\r\n            : item.outputs.filter((output) => {\r\n              \r\n              const currentAddress = output.addresses[0]\r\n\r\n              return direction === 'in'\r\n                ? (currentAddress === checkAddress)\r\n                : (currentAddress !== checkAddress)\r\n            })[0].value\r\n\r\n          return({\r\n            type,\r\n            hash: item.hash,\r\n            canEdit: (myWallets.indexOf(checkAddress) !== -1),\r\n            confirmations: item.confirmations,\r\n            value: new BigNumber(value).dividedBy(1e8).toNumber(),\r\n            date: Date.parse(\r\n              (item.confirmations)\r\n                ? item.confirmed\r\n                : item.received\r\n            ),\r\n            direction: isSelf ? 'self' : direction,\r\n          })\r\n        })\r\n\r\n        resolve(transactions)\r\n      } else {\r\n        resolve([])\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      console.error('Get btc txs Error', e)\r\n      resolve([])\r\n    })\r\n  })\r\n}\r\n\r\n/** \r\n  Draft -   ,   \r\n    \r\n   -   -     shared/actions/btc\r\n    -  insight   ,     \r\n    -       \r\n      \"\",  -    ,  \r\n    -         -\r\n**/\r\nconst getTransactionBitcore = (options) => {\r\n  const {\r\n    address,\r\n    ownType,\r\n    myWallets,\r\n    network,\r\n    apiBitpay,\r\n    NETWORK,\r\n  } = options\r\n  \r\n  return new Promise(async (resolve) => {\r\n    // @\r\n    const myAllWallets = getAllMyAddresses()\r\n    // @\r\n    let { user: { btcData: { address: userAddress } } } = getState()\r\n    // @\r\n    address = address || userAddress\r\n\r\n    const type = (ownType) || 'btc'\r\n    // @\r\n    if (!typeforce.isCoinAddress.BTC(address)) {\r\n      resolve([])\r\n    }\r\n\r\n    const blockInfo = await apiLooper.get(apiBitpay || getBitpay(NETWORK), `/block/tip`, {\r\n      /* cache */\r\n      /* query */\r\n    })\r\n    console.log('blockInfo', blockInfo)\r\n\r\n    const url = `/address/${address}/txs`\r\n\r\n    return apiLooper.get(apiBitpay, url, {\r\n      checkStatus: (answer) => {\r\n        try {\r\n          if (answer && answer.txs !== undefined) return true\r\n        } catch (e) { /* */ }\r\n        return false\r\n      },\r\n      inQuery: {\r\n        delay: 500,\r\n        name: `bitpay`,\r\n      },\r\n    }).then((res: any) => {\r\n      const transactions = res.txs.map((item) => {\r\n        const direction = item.vin[0].addr !== address ? 'in' : 'out'\r\n\r\n        const isSelf = direction === 'out'\r\n          && item.vout.filter((item) => {\r\n              const voutAddrBuf = Buffer.from(item.scriptPubKey.hex, 'hex')\r\n              const currentAddress = bitcoin.address.fromOutputScript(voutAddrBuf, network)\r\n              return currentAddress === address\r\n          }).length === item.vout.length\r\n\r\n        return({\r\n          type,\r\n          hash: item.txid,\r\n          canEdit: (myWallets.indexOf(address) !== -1),\r\n          confirmations: item.confirmations,\r\n          value: isSelf\r\n            ? item.fees\r\n            : item.vout.filter((item) => {\r\n              const voutAddrBuf = Buffer.from(item.scriptPubKey.hex, 'hex')\r\n              const currentAddress = bitcoin.address.fromOutputScript(voutAddrBuf, network)\r\n\r\n              return direction === 'in'\r\n                ? (currentAddress === address)\r\n                : (currentAddress !== address)\r\n            })[0].value,\r\n          date: item.time * 1000,\r\n          direction: isSelf ? 'self' : direction,\r\n        })\r\n      })\r\n      resolve(transactions)\r\n    }).catch((error) => {\r\n      console.error(error)\r\n      resolve([])\r\n    })\r\n  })\r\n}\r\n\r\nconst estimateFeeRateBLOCKCYPHER = (options) => {\r\n  const {\r\n    speed = 'fast',\r\n    NETWORK,\r\n  } = options\r\n\r\n  const _speed = (() => {\r\n    switch (speed) {\r\n      case 'fast':    return 'high_fee_per_kb'\r\n      case 'normal':  return 'medium_fee_per_kb'\r\n      case 'slow':    return 'low_fee_per_kb'\r\n      default:      return 'medium_fee_per_kb'\r\n    }\r\n  })()\r\n\r\n  // 10 minuts cache\r\n  // query request\r\n  return apiLooper\r\n    .get(getBlockcypher(NETWORK), ``, {\r\n      cacheResponse: 10*60*1000,\r\n      cacheOnFail: true,\r\n      inQuery: {\r\n        delay: 500,\r\n        name: `blocyper`,\r\n      },\r\n    } )\r\n    .then(info => Number(info[_speed]))\r\n}\r\n\r\nconst estimateFeeRateEARNCOM = (options) => {\r\n  const { speed = 'fast'} = options\r\n  const _speed = (() => {\r\n    switch (speed) {\r\n      case 'fast':    return 'fastestFee'\r\n      case 'normal':  return 'halfHourFee'\r\n      case 'slow':    return 'hourFee'\r\n      default:      return 'halfHourFee'\r\n    }\r\n  })()\r\n\r\n  // 10 minuts cache\r\n  // query request\r\n  // use cache if fail\r\n  return apiLooper\r\n    .get({\r\n      name: 'EARN_COM',\r\n      servers: `https://bitcoinfees.earn.com/api/v1/fees/recommended`,\r\n    }, ``, {\r\n      cacheResponse: 10*60*1000,\r\n      cacheOnFail: true,\r\n      inQuery: {\r\n        delay: 500,\r\n        name: `blocyper`,\r\n      },\r\n    } )\r\n    .then(fees => Number(fees[_speed]) * 1024)\r\n}\r\n\r\nconst estimateFeeRate = async (options) => {\r\n  try {\r\n    return await estimateFeeRateBLOCKCYPHER(options)\r\n  } catch (err) {\r\n    console.error(`EstimateFeeError: BLOCKCYPHER_API ${err.message}, trying EARN.COM...`)\r\n    return await estimateFeeRateEARNCOM(options)\r\n  }\r\n}\r\n\r\nconst calculateTxSize = async (options) => {\r\n  const {\r\n    speed,\r\n    unspents: _unspents,\r\n    address,\r\n    txOut = 2,\r\n    NETWORK,\r\n  } = options\r\n\r\n  const unspents = _unspents || await fetchUnspents({\r\n    address,\r\n    NETWORK,\r\n  })\r\n\r\n  const txIn = unspents.length\r\n\r\n  const txSize = txIn > 0\r\n    ? txIn * 146 + txOut * 33 + (15 + txIn - txOut)\r\n    : 226 // default tx size for 1 txIn and 2 txOut\r\n\r\n  return txSize\r\n}\r\n\r\nconst estimateFeeValue = async (options) => {\r\n  const {\r\n    feeRate: _feeRate,\r\n    inSatoshis,\r\n    speed,\r\n    address,\r\n    txSize: _txSize,\r\n    NETWORK,\r\n  } = options\r\n\r\n  let calculatedFeeValue\r\n\r\n  if (!_txSize && !address) {\r\n    calculatedFeeValue = new BigNumber(DUST).multipliedBy(1e-8)\r\n  } else {\r\n    const txSize = _txSize || await calculateTxSize({ address, speed })\r\n    const feeRate = _feeRate || await estimateFeeRate({ speed, NETWORK })\r\n\r\n    calculatedFeeValue = BigNumber.maximum(\r\n      DUST,\r\n      new BigNumber(feeRate)\r\n        .multipliedBy(txSize)\r\n        .div(1024)\r\n        .dp(0, BigNumber.ROUND_HALF_EVEN),\r\n    )\r\n  }\r\n\r\n  const finalFeeValue = inSatoshis\r\n    ? calculatedFeeValue.toString()\r\n    : calculatedFeeValue.multipliedBy(1e-8).toString()\r\n\r\n  return finalFeeValue\r\n}\r\n\r\nexport default {\r\n  fetchBalance,\r\n  fetchTx,\r\n  fetchTxInfo,\r\n  fetchUnspents,\r\n  broadcastTx,\r\n  checkWithdraw,\r\n  fetchTxRaw,\r\n  getTransactionBlocyper,\r\n\r\n  estimateFeeValue,\r\n  getCore,\r\n\r\n  prepareUnspents,\r\n}"]}]}