{"remainingRequest":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js??ref--9-1!C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\btc.ts","dependencies":[{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\src\\front\\shared\\redux\\actions\\btc.ts","mtime":1614852332920},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Alexei\\MultiCurrencyWallet\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eSI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCi8vIEB0cy1ub2NoZWNrCmltcG9ydCBCaWdJbnRlZ2VyIGZyb20gJ2JpZ2knOwppbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdiaWdudW1iZXIuanMnOwppbXBvcnQgKiBhcyBiaXRjb2luIGZyb20gJ2JpdGNvaW5qcy1saWInOwppbXBvcnQgKiBhcyBiaXAzOSBmcm9tICdiaXAzOSc7CmltcG9ydCBiaXRjb2luTWVzc2FnZSBmcm9tICdiaXRjb2luanMtbWVzc2FnZSc7CmltcG9ydCB7IGdldFN0YXRlIH0gZnJvbSAncmVkdXgvY29yZSc7CmltcG9ydCByZWR1Y2VycyBmcm9tICdyZWR1eC9jb3JlL3JlZHVjZXJzJzsKaW1wb3J0IHsgYnRjLCBjb25zdGFudHMgfSBmcm9tICdoZWxwZXJzJzsKaW1wb3J0IGFjdGlvbnMgZnJvbSAncmVkdXgvYWN0aW9ucyc7CmltcG9ydCB0eXBlZm9yY2UgZnJvbSAnc3dhcC5hcHAvdXRpbC90eXBlZm9yY2UnOwppbXBvcnQgY29uZmlnIGZyb20gJ2FwcC1jb25maWcnOwppbXBvcnQgKiBhcyBtbmVtb25pY1V0aWxzIGZyb20gJy4uLy4uLy4uLy4uL2NvbW1vbi91dGlscy9tbmVtb25pYyc7CmltcG9ydCB7IGRlZmF1bHQgYXMgYml0Y29pblV0aWxzIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29tbW9uL3V0aWxzL2NvaW4vYnRjJzsKdmFyIE5FVFdPUksgPSBwcm9jZXNzLmVudi5NQUlOTkVUID8gIk1BSU5ORVQiIDogIlRFU1RORVQiOwp2YXIgaGFzQWRtaW5GZWUgPSBjb25maWcgJiYgY29uZmlnLm9wdHMgJiYgY29uZmlnLm9wdHMuZmVlICYmIGNvbmZpZy5vcHRzLmZlZS5idGMgJiYgY29uZmlnLm9wdHMuZmVlLmJ0Yy5mZWUgJiYgY29uZmlnLm9wdHMuZmVlLmJ0Yy5hZGRyZXNzICYmIGNvbmZpZy5vcHRzLmZlZS5idGMubWluID8gY29uZmlnLm9wdHMuZmVlLmJ0YyA6IGZhbHNlOwoKdmFyIGdldFJhbmRvbU1uZW1vbmljV29yZHMgPSBmdW5jdGlvbiBnZXRSYW5kb21NbmVtb25pY1dvcmRzKCkgewogIHJldHVybiBiaXAzOS5nZW5lcmF0ZU1uZW1vbmljKCk7Cn07Cgp2YXIgdmFsaWRhdGVNbmVtb25pY1dvcmRzID0gZnVuY3Rpb24gdmFsaWRhdGVNbmVtb25pY1dvcmRzKG1uZW1vbmljKSB7CiAgcmV0dXJuIGJpcDM5LnZhbGlkYXRlTW5lbW9uaWMoY29udmVydE1uZW1vbmljVG9WYWxpZChtbmVtb25pYykpOwp9OwoKdmFyIHN3ZWVwVG9NbmVtb25pYyA9IGZ1bmN0aW9uIHN3ZWVwVG9NbmVtb25pYyhtbmVtb25pYywgcGF0aCkgewogIHZhciB3YWxsZXQgPSBnZXRXYWxsZXRCeVdvcmRzKG1uZW1vbmljLCBwYXRoKTsKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmJ0Y01uZW1vbmljLCB3YWxsZXQuV0lGKTsKICByZXR1cm4gd2FsbGV0LldJRjsKfTsKCnZhciBnZXRNYWluUHVibGljS2V5ID0gZnVuY3Rpb24gZ2V0TWFpblB1YmxpY0tleSgpIHsKICB2YXIgX2dldFN0YXRlID0gZ2V0U3RhdGUoKSwKICAgICAgYnRjRGF0YSA9IF9nZXRTdGF0ZS51c2VyLmJ0Y0RhdGE7CgogIHJldHVybiBidGNEYXRhLnB1YmxpY0tleS50b1N0cmluZygnSGV4Jyk7Cn07Cgp2YXIgaXNTd2VlcGVkID0gZnVuY3Rpb24gaXNTd2VlcGVkKCkgewogIHZhciBfZ2V0U3RhdGUyID0gZ2V0U3RhdGUoKSwKICAgICAgX2dldFN0YXRlMiR1c2VyID0gX2dldFN0YXRlMi51c2VyLAogICAgICBidGNEYXRhID0gX2dldFN0YXRlMiR1c2VyLmJ0Y0RhdGEsCiAgICAgIGJ0Y01uZW1vbmljRGF0YSA9IF9nZXRTdGF0ZTIkdXNlci5idGNNbmVtb25pY0RhdGE7CgogIGlmIChidGNNbmVtb25pY0RhdGEgJiYgYnRjTW5lbW9uaWNEYXRhLmFkZHJlc3MgJiYgYnRjRGF0YSAmJiBidGNEYXRhLmFkZHJlc3MgJiYgYnRjRGF0YS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkgIT09IGJ0Y01uZW1vbmljRGF0YS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkpIHJldHVybiBmYWxzZTsKICByZXR1cm4gdHJ1ZTsKfTsKCnZhciBnZXRTd2VlcEFkZHJlc3MgPSBmdW5jdGlvbiBnZXRTd2VlcEFkZHJlc3MoKSB7CiAgdmFyIF9nZXRTdGF0ZTMgPSBnZXRTdGF0ZSgpLAogICAgICBidGNNbmVtb25pY0RhdGEgPSBfZ2V0U3RhdGUzLnVzZXIuYnRjTW5lbW9uaWNEYXRhOwoKICBpZiAoYnRjTW5lbW9uaWNEYXRhICYmIGJ0Y01uZW1vbmljRGF0YS5hZGRyZXNzKSByZXR1cm4gYnRjTW5lbW9uaWNEYXRhLmFkZHJlc3M7CiAgcmV0dXJuIGZhbHNlOwp9OwoKdmFyIGNvbnZlcnRNbmVtb25pY1RvVmFsaWQgPSBmdW5jdGlvbiBjb252ZXJ0TW5lbW9uaWNUb1ZhbGlkKG1uZW1vbmljKSB7CiAgcmV0dXJuIG1uZW1vbmljVXRpbHMuY29udmVydE1uZW1vbmljVG9WYWxpZChtbmVtb25pYyk7Cn07Cgp2YXIgZ2V0V2FsbGV0QnlXb3JkcyA9IGZ1bmN0aW9uIGdldFdhbGxldEJ5V29yZHMobW5lbW9uaWMpIHsKICB2YXIgd2FsbGV0TnVtYmVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwOwogIHZhciBwYXRoID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnJzsKICByZXR1cm4gbW5lbW9uaWNVdGlscy5nZXRCdGNXYWxsZXQoYnRjLm5ldHdvcmssIG1uZW1vbmljLCB3YWxsZXROdW1iZXIsIHBhdGgpOwp9OwoKdmFyIGF1dGggPSBmdW5jdGlvbiBhdXRoKHByaXZhdGVLZXkpIHsKICBpZiAocHJpdmF0ZUtleSkgewogICAgdmFyIGhhc2ggPSBiaXRjb2luLmNyeXB0by5zaGEyNTYocHJpdmF0ZUtleSk7CiAgICB2YXIgZCA9IEJpZ0ludGVnZXIuZnJvbUJ1ZmZlcihoYXNoKTsKICAgIHZhciBrZXlQYWlyID0gYml0Y29pbi5FQ1BhaXIuZnJvbVdJRihwcml2YXRlS2V5LCBidGMubmV0d29yayk7CiAgICB2YXIgYWNjb3VudCA9IGJpdGNvaW4uRUNQYWlyLmZyb21XSUYocHJpdmF0ZUtleSwgYnRjLm5ldHdvcmspOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCgogICAgdmFyIF9iaXRjb2luJHBheW1lbnRzJHAycCA9IGJpdGNvaW4ucGF5bWVudHMucDJwa2goewogICAgICBwdWJrZXk6IGFjY291bnQucHVibGljS2V5LAogICAgICBuZXR3b3JrOiBidGMubmV0d29yawogICAgfSksCiAgICAgICAgYWRkcmVzcyA9IF9iaXRjb2luJHBheW1lbnRzJHAycC5hZGRyZXNzOwoKICAgIHZhciBwdWJsaWNLZXkgPSBhY2NvdW50LnB1YmxpY0tleTsKICAgIHJldHVybiB7CiAgICAgIGFjY291bnQ6IGFjY291bnQsCiAgICAgIGtleVBhaXI6IGtleVBhaXIsCiAgICAgIGFkZHJlc3M6IGFkZHJlc3MsCiAgICAgIHByaXZhdGVLZXk6IHByaXZhdGVLZXksCiAgICAgIHB1YmxpY0tleTogcHVibGljS2V5CiAgICB9OwogIH0KfTsKCnZhciBnZXRQcml2YXRlS2V5QnlBZGRyZXNzID0gZnVuY3Rpb24gZ2V0UHJpdmF0ZUtleUJ5QWRkcmVzcyhhZGRyZXNzKSB7CiAgdmFyIF9nZXRTdGF0ZTQgPSBnZXRTdGF0ZSgpLAogICAgICBfZ2V0U3RhdGU0JHVzZXIgPSBfZ2V0U3RhdGU0LnVzZXIsCiAgICAgIF9nZXRTdGF0ZTQkdXNlciRidGNEYSA9IF9nZXRTdGF0ZTQkdXNlci5idGNEYXRhLAogICAgICBvbGRBZGRyZXNzID0gX2dldFN0YXRlNCR1c2VyJGJ0Y0RhLmFkZHJlc3MsCiAgICAgIHByaXZhdGVLZXkgPSBfZ2V0U3RhdGU0JHVzZXIkYnRjRGEucHJpdmF0ZUtleSwKICAgICAgX2dldFN0YXRlNCR1c2VyJGJ0Y01uID0gX2dldFN0YXRlNCR1c2VyLmJ0Y01uZW1vbmljRGF0YTsKCiAgX2dldFN0YXRlNCR1c2VyJGJ0Y01uID0gX2dldFN0YXRlNCR1c2VyJGJ0Y01uID09PSB2b2lkIDAgPyB7CiAgICBhZGRyZXNzOiB1bmRlZmluZWQsCiAgICBwcml2YXRlS2V5OiB1bmRlZmluZWQKICB9IDogX2dldFN0YXRlNCR1c2VyJGJ0Y01uOwogIHZhciBtbmVtb25pY0FkZHJlc3MgPSBfZ2V0U3RhdGU0JHVzZXIkYnRjTW4uYWRkcmVzcywKICAgICAgbW5lbW9uaWNLZXkgPSBfZ2V0U3RhdGU0JHVzZXIkYnRjTW4ucHJpdmF0ZUtleTsKICBpZiAob2xkQWRkcmVzcyA9PT0gYWRkcmVzcykgcmV0dXJuIHByaXZhdGVLZXk7CiAgaWYgKG1uZW1vbmljQWRkcmVzcyA9PT0gYWRkcmVzcykgcmV0dXJuIG1uZW1vbmljS2V5Owp9OwoKdmFyIGxvZ2luID0gZnVuY3Rpb24gbG9naW4ocHJpdmF0ZUtleSkgewogIHZhciBtbmVtb25pYyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogbnVsbDsKICB2YXIgbW5lbW9uaWNLZXlzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBudWxsOwogIHZhciBzd2VlcFRvTW5lbW9uaWNSZWFkeSA9IGZhbHNlOwogIGlmIChwcml2YXRlS2V5ICYmIG1uZW1vbmljICYmIG1uZW1vbmljS2V5cyAmJiBtbmVtb25pY0tleXMuYnRjID09PSBwcml2YXRlS2V5KSBzd2VlcFRvTW5lbW9uaWNSZWFkeSA9IHRydWU7CiAgaWYgKCFwcml2YXRlS2V5ICYmIG1uZW1vbmljKSBzd2VlcFRvTW5lbW9uaWNSZWFkeSA9IHRydWU7CgogIGlmIChwcml2YXRlS2V5KSB7CiAgICB2YXIgaGFzaCA9IGJpdGNvaW4uY3J5cHRvLnNoYTI1Nihwcml2YXRlS2V5KTsKICAgIHZhciBkID0gQmlnSW50ZWdlci5mcm9tQnVmZmVyKGhhc2gpOyAvLyBrZXlQYWlyICAgICA9IGJpdGNvaW4uRUNQYWlyLmZyb21XSUYocHJpdmF0ZUtleSwgYnRjLm5ldHdvcmspCiAgfSBlbHNlIHsKICAgIGNvbnNvbGUuaW5mbygnQ3JlYXRlZCBhY2NvdW50IEJpdGNvaW4gLi4uJyk7IC8vIGtleVBhaXIgICAgID0gYml0Y29pbi5FQ1BhaXIubWFrZVJhbmRvbSh7IG5ldHdvcms6IGJ0Yy5uZXR3b3JrIH0pCiAgICAvLyBwcml2YXRlS2V5ICA9IGtleVBhaXIudG9XSUYoKQogICAgLy8gdXNlIHJhbmRvbSAxMiB3b3JkcwoKICAgIGlmICghbW5lbW9uaWMpIG1uZW1vbmljID0gYmlwMzkuZ2VuZXJhdGVNbmVtb25pYygpOwogICAgdmFyIGFjY0RhdGEgPSBnZXRXYWxsZXRCeVdvcmRzKG1uZW1vbmljKTsKICAgIGNvbnNvbGUubG9nKCdCdGMuIEdlbmVyYXRlZCB3YWxsZXQgZnJvbSByYW5kb20gMTIgd29yZHMnKTsKICAgIGNvbnNvbGUubG9nKGFjY0RhdGEpOwogICAgcHJpdmF0ZUtleSA9IGFjY0RhdGEuV0lGOwogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oY29uc3RhbnRzLnByaXZhdGVLZXlOYW1lcy5idGNNbmVtb25pYywgcHJpdmF0ZUtleSk7CiAgfQoKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjb25zdGFudHMucHJpdmF0ZUtleU5hbWVzLmJ0YywgcHJpdmF0ZUtleSk7CgogIHZhciBkYXRhID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBhdXRoKHByaXZhdGVLZXkpKSwge30sIHsKICAgIGlzTW5lbW9uaWM6IHN3ZWVwVG9NbmVtb25pY1JlYWR5LAogICAgaXNCVEM6IHRydWUKICB9KTsKCiAgd2luZG93LmdldEJ0Y0FkZHJlc3MgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZGF0YS5hZGRyZXNzOwogIH07CgogIHdpbmRvdy5nZXRCdGNEYXRhID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGRhdGE7CiAgfTsKCiAgY29uc29sZS5pbmZvKCdMb2dnZWQgaW4gd2l0aCBCaXRjb2luJywgZGF0YSk7CiAgcmVkdWNlcnMudXNlci5zZXRBdXRoRGF0YSh7CiAgICBuYW1lOiAnYnRjRGF0YScsCiAgICBkYXRhOiBkYXRhCiAgfSk7CgogIGlmICghc3dlZXBUb01uZW1vbmljUmVhZHkpIHsKICAgIC8vIEF1dGggd2l0aCBvdXIgbW5lbW9uaWMgYWNjb3VudAogICAgaWYgKG1uZW1vbmljID09PSAiLSIpIHsKICAgICAgY29uc29sZS5lcnJvcignU3dlZXAuIENhbnQgYXV0aC4gTmVlZCBuZXcgbW5lbW9uaWMgb3IgZW50ZXIgb3duIGZvciByZS1sb2dpbicpOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFtbmVtb25pY0tleXMgfHwgIW1uZW1vbmljS2V5cy5idGMpIHsKICAgICAgY29uc29sZS5lcnJvcignU3dlZXAuIENhbnQgYXV0aC4gTG9naW4ga2V5IHVuZGVmaW5lZCcpOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIG1uZW1vbmljRGF0YSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgYXV0aChtbmVtb25pY0tleXMuYnRjKSksIHt9LCB7CiAgICAgIGlzTW5lbW9uaWM6IHRydWUKICAgIH0pOwoKICAgIGNvbnNvbGUuaW5mbygnTG9nZ2VkIGluIHdpdGggQml0Y29pbiBNbmVtb25pYycsIG1uZW1vbmljRGF0YSk7CiAgICByZWR1Y2Vycy51c2VyLmFkZFdhbGxldCh7CiAgICAgIG5hbWU6ICdidGNNbmVtb25pY0RhdGEnLAogICAgICBkYXRhOiBfb2JqZWN0U3ByZWFkKHsKICAgICAgICBjdXJyZW5jeTogJ0JUQycsCiAgICAgICAgZnVsbE5hbWU6ICdCaXRjb2luIChOZXcpJywKICAgICAgICBiYWxhbmNlOiAwLAogICAgICAgIGlzQmFsYW5jZUZldGNoZWQ6IGZhbHNlLAogICAgICAgIGJhbGFuY2VFcnJvcjogbnVsbCwKICAgICAgICBpbmZvQWJvdXRDdXJyZW5jeTogbnVsbAogICAgICB9LCBtbmVtb25pY0RhdGEpCiAgICB9KTsKICAgIG5ldyBQcm9taXNlKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocmVzb2x2ZSkgewogICAgICAgIHZhciBiYWxhbmNlRGF0YTsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hCYWxhbmNlU3RhdHVzKG1uZW1vbmljRGF0YS5hZGRyZXNzKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgYmFsYW5jZURhdGEgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlRGF0YSkgewogICAgICAgICAgICAgICAgICByZWR1Y2Vycy51c2VyLnNldEF1dGhEYXRhKHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnYnRjTW5lbW9uaWNEYXRhJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGJhbGFuY2VEYXRhKSwge30sIHsKICAgICAgICAgICAgICAgICAgICAgIGlzQmFsYW5jZUZldGNoZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJlZHVjZXJzLnVzZXIuc2V0QmFsYW5jZUVycm9yKHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnYnRjTW5lbW9uaWNEYXRhJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCkpOwogIH0KCiAgcmV0dXJuIHByaXZhdGVLZXk7Cn07Cgp2YXIgZ2V0VHhSb3V0ZXIgPSBmdW5jdGlvbiBnZXRUeFJvdXRlcih0eElkKSB7CiAgcmV0dXJuICIvYnRjL3R4LyIuY29uY2F0KHR4SWQpOwp9OwoKdmFyIGdldFR4ID0gZnVuY3Rpb24gZ2V0VHgodHhSYXcpIHsKICBpZiAodHhSYXcgJiYgdHhSYXcuZ2V0SWQgLy9ACiAgJiYgdHhSYXcuZ2V0SWQgaW5zdGFuY2VvZiAnZnVuY3Rpb24nKSB7CiAgICByZXR1cm4gdHhSYXcuZ2V0SWQoKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHR4UmF3OwogIH0KfTsKCnZhciBnZXRMaW5rVG9JbmZvID0gZnVuY3Rpb24gZ2V0TGlua1RvSW5mbyh0eCkgewogIGlmICghdHgpIHsKICAgIHJldHVybjsKICB9CgogIHJldHVybiAiIi5jb25jYXQoY29uZmlnLmxpbmsuYml0cGF5LCAiL3R4LyIpLmNvbmNhdCh0eCk7Cn07Cgp2YXIgZmV0Y2hCYWxhbmNlU3RhdHVzID0gZnVuY3Rpb24gZmV0Y2hCYWxhbmNlU3RhdHVzKGFkZHJlc3MpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgIGJpdGNvaW5VdGlscy5mZXRjaEJhbGFuY2UoewogICAgICBhZGRyZXNzOiBhZGRyZXNzLAogICAgICB3aXRoVW5jb25maXJtZWQ6IHRydWUsCiAgICAgIE5FVFdPUks6IE5FVFdPUksKICAgIH0pLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikgewogICAgICAvLyBACiAgICAgIHZhciBiYWxhbmNlID0gYW5zd2VyLmJhbGFuY2UsCiAgICAgICAgICB1bmNvbmZpcm1lZCA9IGFuc3dlci51bmNvbmZpcm1lZDsKICAgICAgcmVzb2x2ZSh7CiAgICAgICAgYWRkcmVzczogYWRkcmVzcywKICAgICAgICBiYWxhbmNlOiBiYWxhbmNlLAogICAgICAgIHVuY29uZmlybWVkQmFsYW5jZTogdW5jb25maXJtZWQKICAgICAgfSk7CiAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZSkgewogICAgICByZXNvbHZlKGZhbHNlKTsKICAgIH0pOwogIH0pOwp9OwoKdmFyIGdldEJhbGFuY2UgPSBmdW5jdGlvbiBnZXRCYWxhbmNlKCkgewogIHZhciBfZ2V0U3RhdGU1ID0gZ2V0U3RhdGUoKSwKICAgICAgYWRkcmVzcyA9IF9nZXRTdGF0ZTUudXNlci5idGNEYXRhLmFkZHJlc3M7CgogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgYml0Y29pblV0aWxzLmZldGNoQmFsYW5jZSh7CiAgICAgIGFkZHJlc3M6IGFkZHJlc3MsCiAgICAgIHdpdGhVbmNvbmZpcm1lZDogdHJ1ZSwKICAgICAgTkVUV09SSzogTkVUV09SSwogICAgfSkudGhlbihmdW5jdGlvbiAoYW5zd2VyKSB7CiAgICAgIC8vIEAKICAgICAgdmFyIGJhbGFuY2UgPSBhbnN3ZXIuYmFsYW5jZSwKICAgICAgICAgIHVuY29uZmlybWVkID0gYW5zd2VyLnVuY29uZmlybWVkOwogICAgICByZWR1Y2Vycy51c2VyLnNldEJhbGFuY2UoewogICAgICAgIG5hbWU6ICdidGNEYXRhJywKICAgICAgICBhbW91bnQ6IGJhbGFuY2UsCiAgICAgICAgdW5jb25maXJtZWRCYWxhbmNlOiB1bmNvbmZpcm1lZAogICAgICB9KTsKICAgICAgcmVzb2x2ZShiYWxhbmNlKTsKICAgIH0pWyJjYXRjaCJdKGZ1bmN0aW9uIChlKSB7CiAgICAgIHJlZHVjZXJzLnVzZXIuc2V0QmFsYW5jZUVycm9yKHsKICAgICAgICBuYW1lOiAnYnRjRGF0YScKICAgICAgfSk7CiAgICAgIHJlc29sdmUoLTEpOwogICAgfSk7CiAgfSk7Cn07Cgp2YXIgZmV0Y2hCYWxhbmNlID0gZnVuY3Rpb24gZmV0Y2hCYWxhbmNlKGFkZHJlc3MpIHsKICByZXR1cm4gYml0Y29pblV0aWxzLmZldGNoQmFsYW5jZSh7CiAgICBhZGRyZXNzOiBhZGRyZXNzLAogICAgd2l0aFVuY29uZmlybWVkOiBmYWxzZSwKICAgIE5FVFdPUks6IE5FVFdPUksKICB9KTsKfTsKCnZhciBmZXRjaFR4UmF3ID0gZnVuY3Rpb24gZmV0Y2hUeFJhdyh0eElkLCBjYWNoZVJlc3BvbnNlKSB7CiAgcmV0dXJuIGJpdGNvaW5VdGlscy5mZXRjaFR4UmF3KHsKICAgIHR4SWQ6IHR4SWQsCiAgICBjYWNoZVJlc3BvbnNlOiBjYWNoZVJlc3BvbnNlLAogICAgTkVUV09SSzogTkVUV09SSwogIH0pOwp9OwoKdmFyIGZldGNoVHggPSBmdW5jdGlvbiBmZXRjaFR4KGhhc2gsIGNhY2hlUmVzcG9uc2UpIHsKICByZXR1cm4gYml0Y29pblV0aWxzLmZldGNoVHgoewogICAgaGFzaDogaGFzaCwKICAgIE5FVFdPUks6IE5FVFdPUkssCiAgICBjYWNoZVJlc3BvbnNlOiBjYWNoZVJlc3BvbnNlCiAgfSk7Cn07Cgp2YXIgZmV0Y2hUeEluZm8gPSBmdW5jdGlvbiBmZXRjaFR4SW5mbyhoYXNoLCBjYWNoZVJlc3BvbnNlKSB7CiAgcmV0dXJuIGJpdGNvaW5VdGlscy5mZXRjaFR4SW5mbyh7CiAgICBoYXNoOiBoYXNoLAogICAgTkVUV09SSzogTkVUV09SSywKICAgIGNhY2hlUmVzcG9uc2U6IGNhY2hlUmVzcG9uc2UsCiAgICBoYXNBZG1pbkZlZTogaGFzQWRtaW5GZWUKICB9KTsKfTsKCnZhciBnZXRJbnZvaWNlcyA9IGZ1bmN0aW9uIGdldEludm9pY2VzKGFkZHJlc3MpIHsKICB2YXIgX2dldFN0YXRlNiA9IGdldFN0YXRlKCksCiAgICAgIHVzZXJBZGRyZXNzID0gX2dldFN0YXRlNi51c2VyLmJ0Y0RhdGEudXNlckFkZHJlc3M7CgogIGFkZHJlc3MgPSBhZGRyZXNzIHx8IHVzZXJBZGRyZXNzOwogIHJldHVybiBhY3Rpb25zLmludm9pY2VzLmdldEludm9pY2VzKHsKICAgIGN1cnJlbmN5OiAnQlRDJywKICAgIGFkZHJlc3M6IGFkZHJlc3MKICB9KTsKfTsKCnZhciBnZXRBbGxNeUFkZHJlc3NlcyA9IGZ1bmN0aW9uIGdldEFsbE15QWRkcmVzc2VzKCkgewogIHZhciBfZ2V0U3RhdGU3ID0gZ2V0U3RhdGUoKSwKICAgICAgX2dldFN0YXRlNyR1c2VyID0gX2dldFN0YXRlNy51c2VyLAogICAgICBidGNEYXRhID0gX2dldFN0YXRlNyR1c2VyLmJ0Y0RhdGEsCiAgICAgIGJ0Y01uZW1vbmljRGF0YSA9IF9nZXRTdGF0ZTckdXNlci5idGNNbmVtb25pY0RhdGEsCiAgICAgIGJ0Y011bHRpc2lnU01TRGF0YSA9IF9nZXRTdGF0ZTckdXNlci5idGNNdWx0aXNpZ1NNU0RhdGEsCiAgICAgIGJ0Y011bHRpc2lnVXNlckRhdGEgPSBfZ2V0U3RhdGU3JHVzZXIuYnRjTXVsdGlzaWdVc2VyRGF0YSwKICAgICAgYnRjTXVsdGlzaWdHMkZBRGF0YSA9IF9nZXRTdGF0ZTckdXNlci5idGNNdWx0aXNpZ0cyRkFEYXRhLAogICAgICBidGNNdWx0aXNpZ1BpbkRhdGEgPSBfZ2V0U3RhdGU3JHVzZXIuYnRjTXVsdGlzaWdQaW5EYXRhOwoKICB2YXIgcmV0RGF0YSA9IFtdOyAvLyDQn9GA0L7QstC10YDRj9C10LwsINCx0YvQuyDQu9C4IHN3ZWVwCgogIGlmIChidGNNbmVtb25pY0RhdGEgJiYgYnRjTW5lbW9uaWNEYXRhLmFkZHJlc3MgJiYgYnRjRGF0YSAmJiBidGNEYXRhLmFkZHJlc3MgJiYgYnRjTW5lbW9uaWNEYXRhLmFkZHJlc3MgIT09IGJ0Y0RhdGEuYWRkcmVzcykgewogICAgcmV0RGF0YS5wdXNoKGJ0Y01uZW1vbmljRGF0YS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkpOwogIH0KCiAgcmV0RGF0YS5wdXNoKGJ0Y0RhdGEuYWRkcmVzcy50b0xvd2VyQ2FzZSgpKTsKICBpZiAoYnRjTXVsdGlzaWdTTVNEYXRhICYmIGJ0Y011bHRpc2lnU01TRGF0YS5hZGRyZXNzKSByZXREYXRhLnB1c2goYnRjTXVsdGlzaWdTTVNEYXRhLmFkZHJlc3MudG9Mb3dlckNhc2UoKSk7IC8vIEBUb0RvIC0gU01TIE11bHRpV2FsbGV0CgogIGlmIChidGNNdWx0aXNpZ1VzZXJEYXRhICYmIGJ0Y011bHRpc2lnVXNlckRhdGEuYWRkcmVzcykgcmV0RGF0YS5wdXNoKGJ0Y011bHRpc2lnVXNlckRhdGEuYWRkcmVzcy50b0xvd2VyQ2FzZSgpKTsKCiAgaWYgKGJ0Y011bHRpc2lnVXNlckRhdGEgJiYgYnRjTXVsdGlzaWdVc2VyRGF0YS53YWxsZXRzICYmIGJ0Y011bHRpc2lnVXNlckRhdGEud2FsbGV0cy5sZW5ndGgpIHsKICAgIGJ0Y011bHRpc2lnVXNlckRhdGEud2FsbGV0cy5tYXAoZnVuY3Rpb24gKHdhbGxldCkgewogICAgICByZXREYXRhLnB1c2god2FsbGV0LmFkZHJlc3MudG9Mb3dlckNhc2UoKSk7CiAgICB9KTsKICB9CgogIGlmIChidGNNdWx0aXNpZ1BpbkRhdGEgJiYgYnRjTXVsdGlzaWdQaW5EYXRhLmFkZHJlc3MpIHJldERhdGEucHVzaChidGNNdWx0aXNpZ1BpbkRhdGEuYWRkcmVzcy50b0xvd2VyQ2FzZSgpKTsKICByZXR1cm4gcmV0RGF0YTsKfTsKCnZhciBnZXREYXRhQnlBZGRyZXNzID0gZnVuY3Rpb24gZ2V0RGF0YUJ5QWRkcmVzcyhhZGRyZXNzKSB7CiAgdmFyIF9nZXRTdGF0ZTggPSBnZXRTdGF0ZSgpLAogICAgICBfZ2V0U3RhdGU4JHVzZXIgPSBfZ2V0U3RhdGU4LnVzZXIsCiAgICAgIGJ0Y0RhdGEgPSBfZ2V0U3RhdGU4JHVzZXIuYnRjRGF0YSwKICAgICAgYnRjTW5lbW9uaWNEYXRhID0gX2dldFN0YXRlOCR1c2VyLmJ0Y01uZW1vbmljRGF0YSwKICAgICAgYnRjTXVsdGlzaWdTTVNEYXRhID0gX2dldFN0YXRlOCR1c2VyLmJ0Y011bHRpc2lnU01TRGF0YSwKICAgICAgYnRjTXVsdGlzaWdVc2VyRGF0YSA9IF9nZXRTdGF0ZTgkdXNlci5idGNNdWx0aXNpZ1VzZXJEYXRhLAogICAgICBidGNNdWx0aXNpZ0cyRkFEYXRhID0gX2dldFN0YXRlOCR1c2VyLmJ0Y011bHRpc2lnRzJGQURhdGE7CgogIHZhciBmb3VuZGVkID0gW2J0Y0RhdGEsIGJ0Y01uZW1vbmljRGF0YSwgYnRjTXVsdGlzaWdTTVNEYXRhLCBidGNNdWx0aXNpZ1VzZXJEYXRhXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGJ0Y011bHRpc2lnVXNlckRhdGEgJiYgYnRjTXVsdGlzaWdVc2VyRGF0YS53YWxsZXRzICYmIGJ0Y011bHRpc2lnVXNlckRhdGEud2FsbGV0cy5sZW5ndGggPyBidGNNdWx0aXNpZ1VzZXJEYXRhLndhbGxldHMgOiBbXSksIFtidGNNdWx0aXNpZ0cyRkFEYXRhXSkuZmlsdGVyKGZ1bmN0aW9uIChkYXRhKSB7CiAgICByZXR1cm4gZGF0YSAmJiBkYXRhLmFkZHJlc3MgJiYgZGF0YS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkgPT09IGFkZHJlc3MudG9Mb3dlckNhc2UoKTsKICB9KTsKICByZXR1cm4gZm91bmRlZC5sZW5ndGggPyBmb3VuZGVkWzBdIDogZmFsc2U7Cn07Cgp2YXIgZ2V0VHJhbnNhY3Rpb24gPSBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbigpIHsKICB2YXIgb3duQWRkcmVzcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogIiI7CiAgdmFyIG93blR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICIiOwogIHZhciBteUFsbFdhbGxldHMgPSBnZXRBbGxNeUFkZHJlc3NlcygpOwoKICB2YXIgX2dldFN0YXRlOSA9IGdldFN0YXRlKCksCiAgICAgIHVzZXJBZGRyZXNzID0gX2dldFN0YXRlOS51c2VyLmJ0Y0RhdGEuYWRkcmVzczsKCiAgdmFyIGFkZHJlc3MgPSBvd25BZGRyZXNzIHx8IHVzZXJBZGRyZXNzOwogIHZhciB0eXBlID0gb3duVHlwZSB8fCAnYnRjJzsKCiAgaWYgKCF0eXBlZm9yY2UuaXNDb2luQWRkcmVzcy5CVEMoYWRkcmVzcykpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICByZXNvbHZlKFtdKTsKICAgIH0pOwogIH0KCiAgcmV0dXJuIGJpdGNvaW5VdGlscy5nZXRUcmFuc2FjdGlvbkJsb2N5cGVyKHsKICAgIGFkZHJlc3M6IGFkZHJlc3MsCiAgICBvd25UeXBlOiB0eXBlLAogICAgbXlXYWxsZXRzOiBteUFsbFdhbGxldHMsCiAgICBuZXR3b3JrOiBidGMubmV0d29yaywKICAgIE5FVFdPUks6IE5FVFdPUksKICB9KTsKfTsKCnZhciBhZGRyZXNzSXNDb3JyZWN0ID0gZnVuY3Rpb24gYWRkcmVzc0lzQ29ycmVjdChhZGRyZXNzKSB7CiAgdHJ5IHsKICAgIHZhciBvdXRwdXRTY3JpcHQgPSBiaXRjb2luLmFkZHJlc3MudG9PdXRwdXRTY3JpcHQoYWRkcmVzcywgYnRjLm5ldHdvcmspOwogICAgaWYgKG91dHB1dFNjcmlwdCkgcmV0dXJuIHRydWU7CiAgfSBjYXRjaCAoZSkge30KCiAgcmV0dXJuIGZhbHNlOwp9OwoKdmFyIHNlbmQgPSBmdW5jdGlvbiBzZW5kKF9yZWYyKSB7CiAgdmFyIGZyb20gPSBfcmVmMi5mcm9tLAogICAgICB0byA9IF9yZWYyLnRvLAogICAgICBhbW91bnQgPSBfcmVmMi5hbW91bnQsCiAgICAgIF9yZWYyJGZlZVZhbHVlID0gX3JlZjIuZmVlVmFsdWUsCiAgICAgIGZlZVZhbHVlID0gX3JlZjIkZmVlVmFsdWUgPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmMiRmZWVWYWx1ZSwKICAgICAgc3BlZWQgPSBfcmVmMi5zcGVlZDsKICBjb25zb2xlLmxvZygnPj4+IHNlbmQnLCBmcm9tLCB0bywgYW1vdW50LCBmZWVWYWx1ZSwgc3BlZWQpOwogIHJldHVybiBuZXcgUHJvbWlzZSggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKHJlYWR5LCByZWplY3QpIHsKICAgICAgdmFyIHByaXZhdGVLZXksIGtleVBhaXIsIGZlZUZyb21BbW91bnQsIF9jb25maWckb3B0cyRmZWUkYnRjLCBhZG1pbkZlZSwgYWRtaW5GZWVNaW5WYWx1ZSwgYWRtaW5GZWVNaW4sIHVuc3BlbnRzLCBmdW5kVmFsdWUsIHRvdGFsVW5zcGVudCwgcmVzaWR1ZSwgcHNidCwgaSwgX3Vuc3BlbnRzJGksIHR4aWQsIHZvdXQsIF9yYXdUeCwgcmF3VHgsIGJyb2FkY2FzdEFuc3dlciwgX3R4aWQ7CgogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgICAgcHJpdmF0ZUtleSA9IG51bGw7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAyOwogICAgICAgICAgICAgIHByaXZhdGVLZXkgPSBnZXRQcml2YXRlS2V5QnlBZGRyZXNzKGZyb20pOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA2OwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgyKTsKICAgICAgICAgICAgICByZWplY3QoewogICAgICAgICAgICAgICAgbWVzc2FnZTogIkZhaWwgZ2V0IGRhdGEgZm9yIHNlbmQgYWRkcmVzcyIgKyBfY29udGV4dDIudDAubWVzc2FnZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAga2V5UGFpciA9IGJpdGNvaW4uRUNQYWlyLmZyb21XSUYocHJpdmF0ZUtleSwgYnRjLm5ldHdvcmspOyAvLyBmZWUgLSBmcm9tIGFtb3VudCAtIHBlcmNlbnQKCiAgICAgICAgICAgICAgZmVlRnJvbUFtb3VudCA9IG5ldyBCaWdOdW1iZXIoMCk7CgogICAgICAgICAgICAgIGlmIChoYXNBZG1pbkZlZSkgewogICAgICAgICAgICAgICAgX2NvbmZpZyRvcHRzJGZlZSRidGMgPSBjb25maWcub3B0cy5mZWUuYnRjLCBhZG1pbkZlZSA9IF9jb25maWckb3B0cyRmZWUkYnRjLmZlZSwgYWRtaW5GZWVNaW5WYWx1ZSA9IF9jb25maWckb3B0cyRmZWUkYnRjLm1pbjsKICAgICAgICAgICAgICAgIGFkbWluRmVlTWluID0gbmV3IEJpZ051bWJlcihhZG1pbkZlZU1pblZhbHVlKTsKICAgICAgICAgICAgICAgIGZlZUZyb21BbW91bnQgPSBuZXcgQmlnTnVtYmVyKGFkbWluRmVlKS5kaXZpZGVkQnkoMTAwKS5tdWx0aXBsaWVkQnkoYW1vdW50KTsKICAgICAgICAgICAgICAgIGlmIChhZG1pbkZlZU1pbi5pc0dyZWF0ZXJUaGFuKGZlZUZyb21BbW91bnQpKSBmZWVGcm9tQW1vdW50ID0gYWRtaW5GZWVNaW47CiAgICAgICAgICAgICAgICBmZWVGcm9tQW1vdW50ID0gZmVlRnJvbUFtb3VudC5tdWx0aXBsaWVkQnkoMWU4KS5pbnRlZ2VyVmFsdWUoKTsgLy8gQWRtaW4gZmVlIGluIHNhdG9zaGkKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZlZUZyb21BbW91bnQgPSBmZWVGcm9tQW1vdW50LnRvTnVtYmVyKCk7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxNDsKICAgICAgICAgICAgICBfY29udGV4dDIudDEgPSBmZWVWYWx1ZTsKCiAgICAgICAgICAgICAgaWYgKF9jb250ZXh0Mi50MSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxOTsKICAgICAgICAgICAgICByZXR1cm4gYnRjLmVzdGltYXRlRmVlVmFsdWUoewogICAgICAgICAgICAgICAgaW5TYXRvc2hpczogdHJ1ZSwKICAgICAgICAgICAgICAgIHNwZWVkOiBzcGVlZCwKICAgICAgICAgICAgICAgIGFtb3VudDogYW1vdW50CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIF9jb250ZXh0Mi50MSA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICBmZWVWYWx1ZSA9IF9jb250ZXh0Mi50MTsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI3OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDIzOwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MiA9IF9jb250ZXh0MlsiY2F0Y2giXSgxNCk7CiAgICAgICAgICAgICAgcmVqZWN0KHsKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJGYWlsIGVzdGltYXRlIGZlZSAiICsgX2NvbnRleHQyLnQyLm1lc3NhZ2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgIHVuc3BlbnRzID0gW107CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAyODsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDMxOwogICAgICAgICAgICAgIHJldHVybiBmZXRjaFVuc3BlbnRzKGZyb20pOwoKICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICB1bnNwZW50cyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzg7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMzQ7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnQzID0gX2NvbnRleHQyWyJjYXRjaCJdKDI4KTsKICAgICAgICAgICAgICByZWplY3QoewogICAgICAgICAgICAgICAgbWVzc2FnZTogIkZhaWwgZ2V0IHVuc3BlbnRzICIgKyBfY29udGV4dDIudDMubWVzc2FnZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0MDsKICAgICAgICAgICAgICByZXR1cm4gcHJlcGFyZVVuc3BlbnRzKHsKICAgICAgICAgICAgICAgIHVuc3BlbnRzOiB1bnNwZW50cywKICAgICAgICAgICAgICAgIGFtb3VudDogYW1vdW50CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgIHVuc3BlbnRzID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgZnVuZFZhbHVlID0gbmV3IEJpZ051bWJlcihTdHJpbmcoYW1vdW50KSkubXVsdGlwbGllZEJ5KDFlOCkuaW50ZWdlclZhbHVlKCkudG9OdW1iZXIoKTsKICAgICAgICAgICAgICB0b3RhbFVuc3BlbnQgPSB1bnNwZW50cy5yZWR1Y2UoZnVuY3Rpb24gKHN1bW0sIF9yZWY0KSB7CiAgICAgICAgICAgICAgICB2YXIgc2F0b3NoaXMgPSBfcmVmNC5zYXRvc2hpczsKICAgICAgICAgICAgICAgIHJldHVybiBzdW1tICsgc2F0b3NoaXM7CiAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgICAgcmVzaWR1ZSA9IHRvdGFsVW5zcGVudCAtIGZ1bmRWYWx1ZSAtIGZlZVZhbHVlIC0gZmVlRnJvbUFtb3VudDsKICAgICAgICAgICAgICBwc2J0ID0gbmV3IGJpdGNvaW4uUHNidCh7CiAgICAgICAgICAgICAgICBuZXR3b3JrOiBidGMubmV0d29yawogICAgICAgICAgICAgIH0pOyAvLyBhZGQgbWFpbiBvdXRwdXQgZm9yIHJlY2lwaWVudAoKICAgICAgICAgICAgICBwc2J0LmFkZE91dHB1dCh7CiAgICAgICAgICAgICAgICBhZGRyZXNzOiB0bywKICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5kVmFsdWUKICAgICAgICAgICAgICB9KTsgLy8gaWYgd2UgaGF2ZSByZXNpZHVlIHdpY2ggbW9yZSB0aGVuIERVU1QgdmFsdWUKICAgICAgICAgICAgICAvLyB0aGVuIHJldHVybiB0aGlzIHZhbHVlIHRvIHRoZSBzZW5kZXIgd2FsbGV0CgogICAgICAgICAgICAgIGlmIChyZXNpZHVlID4gNTQ2KSB7CiAgICAgICAgICAgICAgICBwc2J0LmFkZE91dHB1dCh7CiAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IGZyb20sCiAgICAgICAgICAgICAgICAgIHZhbHVlOiByZXNpZHVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghaGFzQWRtaW5GZWUpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTY7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNDg7CiAgICAgICAgICAgICAgcHNidC5hZGRPdXRwdXQoewogICAgICAgICAgICAgICAgYWRkcmVzczogaGFzQWRtaW5GZWUuYWRkcmVzcywKICAgICAgICAgICAgICAgIHZhbHVlOiBmZWVGcm9tQW1vdW50CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1NjsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgNTI6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA1MjsKICAgICAgICAgICAgICBfY29udGV4dDIudDQgPSBfY29udGV4dDJbImNhdGNoIl0oNDgpOwogICAgICAgICAgICAgIHJlamVjdCh7CiAgICAgICAgICAgICAgICBtZXNzYWdlOiAiRmFpbCBhZGQgc2VydmljZSBmZWUiICsgX2NvbnRleHQyLnQ0Lm1lc3NhZ2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDU2OgogICAgICAgICAgICAgIGkgPSAwOwoKICAgICAgICAgICAgY2FzZSA1NzoKICAgICAgICAgICAgICBpZiAoIShpIDwgdW5zcGVudHMubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3NDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3Vuc3BlbnRzJGkgPSB1bnNwZW50c1tpXSwgdHhpZCA9IF91bnNwZW50cyRpLnR4aWQsIHZvdXQgPSBfdW5zcGVudHMkaS52b3V0OwogICAgICAgICAgICAgIF9yYXdUeCA9IGZhbHNlOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNjA7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2MzsKICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hUeFJhdyh0eGlkLCBmYWxzZSk7CgogICAgICAgICAgICBjYXNlIDYzOgogICAgICAgICAgICAgIF9yYXdUeCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzA7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDY2OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNjY7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnQ1ID0gX2NvbnRleHQyWyJjYXRjaCJdKDYwKTsKICAgICAgICAgICAgICByZWplY3QoewogICAgICAgICAgICAgICAgbWVzc2FnZTogIkZhaWwgZmV0Y2ggdHggcmF3ICIgKyB0eGlkICsgIigiICsgX2NvbnRleHQyLnQ1Lm1lc3NhZ2UgKyAiKSIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDcwOgogICAgICAgICAgICAgIHBzYnQuYWRkSW5wdXQoewogICAgICAgICAgICAgICAgaGFzaDogdHhpZCwKICAgICAgICAgICAgICAgIGluZGV4OiB2b3V0LAogICAgICAgICAgICAgICAgLy9ACiAgICAgICAgICAgICAgICBub25XaXRuZXNzVXR4bzogQnVmZmVyLmZyb20oX3Jhd1R4LCAnaGV4JykKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNzE6CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTc7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDc0OgogICAgICAgICAgICAgIHBzYnQuc2lnbkFsbElucHV0cyhrZXlQYWlyKTsKICAgICAgICAgICAgICBwc2J0LmZpbmFsaXplQWxsSW5wdXRzKCk7CiAgICAgICAgICAgICAgcmF3VHggPSBwc2J0LmV4dHJhY3RUcmFuc2FjdGlvbigpLnRvSGV4KCk7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA3NzsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDgwOwogICAgICAgICAgICAgIHJldHVybiBicm9hZGNhc3RUeChyYXdUeCk7CgogICAgICAgICAgICBjYXNlIDgwOgogICAgICAgICAgICAgIGJyb2FkY2FzdEFuc3dlciA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIF90eGlkID0gYnJvYWRjYXN0QW5zd2VyLnR4aWQ7CiAgICAgICAgICAgICAgcmVhZHkoX3R4aWQpOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gODg7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDg1OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gODU7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnQ2ID0gX2NvbnRleHQyWyJjYXRjaCJdKDc3KTsKICAgICAgICAgICAgICByZWplY3QoewogICAgICAgICAgICAgICAgbWVzc2FnZTogIkZhaWwgYnJvYWRjYXN0IFRYOiAiICsgX2NvbnRleHQyLnQ2CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDg4OgogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTQ7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDkwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gOTA7CiAgICAgICAgICAgICAgX2NvbnRleHQyLnQ3ID0gX2NvbnRleHQyWyJjYXRjaCJdKDApOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBY3Rpb25zIC0gYnRjIC0gc2VuZDogJywgX2NvbnRleHQyLnQ3KTsKICAgICAgICAgICAgICByZWplY3QoX2NvbnRleHQyLnQ3KTsKCiAgICAgICAgICAgIGNhc2UgOTQ6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1swLCA5MF0sIFsyLCA2XSwgWzE0LCAyM10sIFsyOCwgMzRdLCBbNDgsIDUyXSwgWzYwLCA2Nl0sIFs3NywgODVdXSk7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeDIsIF94MykgewogICAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpKTsKfTsKCnZhciBzZW5kVHJhbnNhY3Rpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmNiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKF9yZWY1KSB7CiAgICB2YXIgdG8sIGFtb3VudCwgX2dldFN0YXRlMTAsIGFkZHJlc3MsIF90eEhhc2gsIHR4SGFzaDsKCiAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgdG8gPSBfcmVmNS50bywgYW1vdW50ID0gX3JlZjUuYW1vdW50OwogICAgICAgICAgICAvLyBmcm9tIG1haW4gYnRjIHdhbGxldAogICAgICAgICAgICBfZ2V0U3RhdGUxMCA9IGdldFN0YXRlKCksIGFkZHJlc3MgPSBfZ2V0U3RhdGUxMC51c2VyLmJ0Y0RhdGEuYWRkcmVzczsKCiAgICAgICAgICAgIGlmICghZmFsc2UpIHsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZha2UgdHggLSB0dXJib3N3YXBzIGRlYnVnCiAgICAgICAgICAgIF90eEhhc2ggPSAnMTMyNDE1NGY2MDg2YjZiMTM3YmU4NzYzZjQzMDk2Y2FjZDU0NTBmOTU2MWRhMDYxMTYxNjM4ZWQ2OGNlMzljMyc7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBfdHhIYXNoKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgcmV0dXJuIHNlbmQoewogICAgICAgICAgICAgIGZyb206IGFkZHJlc3MsCiAgICAgICAgICAgICAgdG86IHRvLAogICAgICAgICAgICAgIGFtb3VudDogYW1vdW50LAogICAgICAgICAgICAgIHNwZWVkOiAnZmFzdCcKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICB0eEhhc2ggPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHR4SGFzaCk7CgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMyk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gc2VuZFRyYW5zYWN0aW9uKF94NCkgewogICAgcmV0dXJuIF9yZWY2LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwoKdmFyIHByZXBhcmVVbnNwZW50cyA9IGZ1bmN0aW9uIHByZXBhcmVVbnNwZW50cyhfcmVmNykgewogIHZhciBhbW91bnQgPSBfcmVmNy5hbW91bnQsCiAgICAgIHVuc3BlbnRzID0gX3JlZjcudW5zcGVudHM7CiAgcmV0dXJuIGJpdGNvaW5VdGlscy5wcmVwYXJlVW5zcGVudHMoewogICAgYW1vdW50OiBhbW91bnQsCiAgICB1bnNwZW50czogdW5zcGVudHMsCiAgICBORVRXT1JLOiBORVRXT1JLCiAgfSk7Cn07Cgp3aW5kb3cucHJlcGFyZVVuc3BlbnRzID0gcHJlcGFyZVVuc3BlbnRzOwoKdmFyIGZldGNoVW5zcGVudHMgPSBmdW5jdGlvbiBmZXRjaFVuc3BlbnRzKGFkZHJlc3MpIHsKICByZXR1cm4gYml0Y29pblV0aWxzLmZldGNoVW5zcGVudHMoewogICAgYWRkcmVzczogYWRkcmVzcywKICAgIE5FVFdPUks6IE5FVFdPUksKICB9KTsKfTsKCnZhciBicm9hZGNhc3RUeCA9IGZ1bmN0aW9uIGJyb2FkY2FzdFR4KHR4UmF3KSB7CiAgcmV0dXJuIGJpdGNvaW5VdGlscy5icm9hZGNhc3RUeCh7CiAgICB0eFJhdzogdHhSYXcsCiAgICBORVRXT1JLOiBORVRXT1JLCiAgfSk7Cn07Cgp2YXIgc2lnbk1lc3NhZ2UgPSBmdW5jdGlvbiBzaWduTWVzc2FnZShtZXNzYWdlLCBlbmNvZGVkUHJpdmF0ZUtleSkgewogIHZhciBrZXlQYWlyID0gYml0Y29pbi5FQ1BhaXIuZnJvbVdJRihlbmNvZGVkUHJpdmF0ZUtleSwgW2JpdGNvaW4ubmV0d29ya3MuYml0Y29pbiwgYml0Y29pbi5uZXR3b3Jrcy50ZXN0bmV0XSk7CiAgdmFyIHByaXZhdGVLZXlCdWZmID0gQnVmZmVyLmZyb20oa2V5UGFpci5wcml2YXRlS2V5KTsKICB2YXIgc2lnbmF0dXJlID0gYml0Y29pbk1lc3NhZ2Uuc2lnbihtZXNzYWdlLCBwcml2YXRlS2V5QnVmZiwga2V5UGFpci5jb21wcmVzc2VkKTsKICByZXR1cm4gc2lnbmF0dXJlLnRvU3RyaW5nKCdiYXNlNjQnKTsKfTsKCnZhciBnZXRSZXB1dGF0aW9uID0gZnVuY3Rpb24gZ2V0UmVwdXRhdGlvbigpIHsKICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDApOwp9OwoKdmFyIGNoZWNrV2l0aGRyYXcgPSBmdW5jdGlvbiBjaGVja1dpdGhkcmF3KHNjcmlwdEFkZHJlc3MpIHsKICByZXR1cm4gYml0Y29pblV0aWxzLmNoZWNrV2l0aGRyYXcoewogICAgc2NyaXB0QWRkcmVzczogc2NyaXB0QWRkcmVzcywKICAgIE5FVFdPUks6IE5FVFdPUksKICB9KTsKfTsKCmV4cG9ydCBkZWZhdWx0IHsKICBsb2dpbjogbG9naW4sCiAgY2hlY2tXaXRoZHJhdzogY2hlY2tXaXRoZHJhdywKICBnZXRCYWxhbmNlOiBnZXRCYWxhbmNlLAogIGdldFRyYW5zYWN0aW9uOiBnZXRUcmFuc2FjdGlvbiwKICBzZW5kOiBzZW5kLAogIHNlbmRUcmFuc2FjdGlvbjogc2VuZFRyYW5zYWN0aW9uLAogIGZldGNoVW5zcGVudHM6IGZldGNoVW5zcGVudHMsCiAgYnJvYWRjYXN0VHg6IGJyb2FkY2FzdFR4LAogIGZldGNoVHg6IGZldGNoVHgsCiAgZmV0Y2hUeEluZm86IGZldGNoVHhJbmZvLAogIGZldGNoQmFsYW5jZTogZmV0Y2hCYWxhbmNlLAogIHNpZ25NZXNzYWdlOiBzaWduTWVzc2FnZSwKICBnZXRSZXB1dGF0aW9uOiBnZXRSZXB1dGF0aW9uLAogIGdldFR4OiBnZXRUeCwKICBnZXRMaW5rVG9JbmZvOiBnZXRMaW5rVG9JbmZvLAogIGdldEludm9pY2VzOiBnZXRJbnZvaWNlcywKICBnZXRXYWxsZXRCeVdvcmRzOiBnZXRXYWxsZXRCeVdvcmRzLAogIGdldFJhbmRvbU1uZW1vbmljV29yZHM6IGdldFJhbmRvbU1uZW1vbmljV29yZHMsCiAgdmFsaWRhdGVNbmVtb25pY1dvcmRzOiB2YWxpZGF0ZU1uZW1vbmljV29yZHMsCiAgc3dlZXBUb01uZW1vbmljOiBzd2VlcFRvTW5lbW9uaWMsCiAgaXNTd2VlcGVkOiBpc1N3ZWVwZWQsCiAgZ2V0U3dlZXBBZGRyZXNzOiBnZXRTd2VlcEFkZHJlc3MsCiAgZ2V0QWxsTXlBZGRyZXNzZXM6IGdldEFsbE15QWRkcmVzc2VzLAogIGdldERhdGFCeUFkZHJlc3M6IGdldERhdGFCeUFkZHJlc3MsCiAgZ2V0TWFpblB1YmxpY0tleTogZ2V0TWFpblB1YmxpY0tleSwKICBnZXRUeFJvdXRlcjogZ2V0VHhSb3V0ZXIsCiAgZmV0Y2hUeFJhdzogZmV0Y2hUeFJhdywKICBhZGRyZXNzSXNDb3JyZWN0OiBhZGRyZXNzSXNDb3JyZWN0LAogIGNvbnZlcnRNbmVtb25pY1RvVmFsaWQ6IGNvbnZlcnRNbmVtb25pY1RvVmFsaWQsCiAgcHJlcGFyZVVuc3BlbnRzOiBwcmVwYXJlVW5zcGVudHMKfTs="},{"version":3,"sources":["C:/Users/Alexei/MultiCurrencyWallet/src/front/shared/redux/actions/btc.ts"],"names":["BigInteger","BigNumber","bitcoin","bip39","bitcoinMessage","getState","reducers","btc","constants","actions","typeforce","config","mnemonicUtils","default","bitcoinUtils","NETWORK","process","env","MAINNET","hasAdminFee","opts","fee","address","min","getRandomMnemonicWords","generateMnemonic","validateMnemonicWords","mnemonic","validateMnemonic","convertMnemonicToValid","sweepToMnemonic","path","wallet","getWalletByWords","localStorage","setItem","privateKeyNames","btcMnemonic","WIF","getMainPublicKey","btcData","user","publicKey","toString","isSweeped","btcMnemonicData","toLowerCase","getSweepAddress","walletNumber","getBtcWallet","network","auth","privateKey","hash","crypto","sha256","d","fromBuffer","keyPair","ECPair","fromWIF","account","payments","p2pkh","pubkey","getPrivateKeyByAddress","oldAddress","undefined","mnemonicAddress","mnemonicKey","login","mnemonicKeys","sweepToMnemonicReady","console","info","accData","log","data","isMnemonic","isBTC","window","getBtcAddress","getBtcData","setAuthData","name","error","mnemonicData","addWallet","currency","fullName","balance","isBalanceFetched","balanceError","infoAboutCurrency","Promise","resolve","fetchBalanceStatus","balanceData","setBalanceError","getTxRouter","txId","getTx","txRaw","getId","getLinkToInfo","tx","link","bitpay","fetchBalance","withUnconfirmed","then","answer","unconfirmed","unconfirmedBalance","e","getBalance","setBalance","amount","fetchTxRaw","cacheResponse","fetchTx","fetchTxInfo","getInvoices","userAddress","invoices","getAllMyAddresses","btcMultisigSMSData","btcMultisigUserData","btcMultisigG2FAData","btcMultisigPinData","retData","push","wallets","length","map","getDataByAddress","founded","filter","getTransaction","ownAddress","ownType","myAllWallets","type","isCoinAddress","BTC","getTransactionBlocyper","myWallets","addressIsCorrect","outputScript","toOutputScript","send","from","to","feeValue","speed","ready","reject","message","feeFromAmount","adminFee","adminFeeMinValue","adminFeeMin","dividedBy","multipliedBy","isGreaterThan","integerValue","toNumber","estimateFeeValue","inSatoshis","unspents","fetchUnspents","prepareUnspents","fundValue","String","totalUnspent","reduce","summ","satoshis","residue","psbt","Psbt","addOutput","value","i","txid","vout","rawTx","addInput","index","nonWitnessUtxo","Buffer","signAllInputs","finalizeAllInputs","extractTransaction","toHex","broadcastTx","broadcastAnswer","sendTransaction","txHash","signMessage","encodedPrivateKey","networks","testnet","privateKeyBuff","signature","sign","compressed","getReputation","checkWithdraw","scriptAddress"],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport BigInteger from 'bigi'\r\n\r\nimport { BigNumber } from 'bignumber.js'\r\nimport * as bitcoin from 'bitcoinjs-lib'\r\nimport * as bip32 from 'bip32'\r\nimport * as bip39 from 'bip39'\r\n\r\nimport bitcoinMessage from 'bitcoinjs-message'\r\nimport { getState } from 'redux/core'\r\nimport reducers from 'redux/core/reducers'\r\nimport { btc, apiLooper, constants, api } from 'helpers'\r\nimport actions from 'redux/actions'\r\nimport typeforce from 'swap.app/util/typeforce'\r\nimport config from 'app-config'\r\n\r\nimport { localisePrefix } from 'helpers/locale'\r\n\r\nimport * as mnemonicUtils from '../../../../common/utils/mnemonic'\r\n\r\nimport { default as bitcoinUtils } from '../../../../common/utils/coin/btc'\r\n\r\n\r\nconst NETWORK = (process.env.MAINNET) ? `MAINNET` : `TESTNET`\r\n\r\n\r\nconst hasAdminFee = (config\r\n  && config.opts\r\n  && config.opts.fee\r\n  && config.opts.fee.btc\r\n  && config.opts.fee.btc.fee\r\n  && config.opts.fee.btc.address\r\n  && config.opts.fee.btc.min\r\n) ? config.opts.fee.btc : false\r\n\r\nconst getRandomMnemonicWords = () => bip39.generateMnemonic()\r\nconst validateMnemonicWords = (mnemonic) => bip39.validateMnemonic(convertMnemonicToValid(mnemonic))\r\n\r\n\r\nconst sweepToMnemonic = (mnemonic, path) => {\r\n  const wallet = getWalletByWords(mnemonic, path)\r\n  localStorage.setItem(constants.privateKeyNames.btcMnemonic, wallet.WIF)\r\n  return wallet.WIF\r\n}\r\n\r\nconst getMainPublicKey = () => {\r\n  const {\r\n    user: {\r\n      btcData,\r\n    },\r\n  } = getState()\r\n\r\n  return btcData.publicKey.toString('Hex')\r\n}\r\n\r\nconst isSweeped = () => {\r\n  const {\r\n    user: {\r\n      btcData,\r\n      btcMnemonicData,\r\n    },\r\n  } = getState()\r\n\r\n  if (btcMnemonicData\r\n    && btcMnemonicData.address\r\n    && btcData\r\n    && btcData.address\r\n    && btcData.address.toLowerCase() !== btcMnemonicData.address.toLowerCase()\r\n  ) return false\r\n\r\n  return true\r\n}\r\n\r\nconst getSweepAddress = () => {\r\n  const {\r\n    user: {\r\n      btcMnemonicData,\r\n    },\r\n  } = getState()\r\n\r\n  if (btcMnemonicData && btcMnemonicData.address) return btcMnemonicData.address\r\n  return false\r\n}\r\n\r\nconst convertMnemonicToValid = (mnemonic) => mnemonicUtils.convertMnemonicToValid(mnemonic)\r\n\r\nconst getWalletByWords = (mnemonic: string, walletNumber: number = 0, path: string = '') => {\r\n  return mnemonicUtils.getBtcWallet(btc.network, mnemonic, walletNumber, path)\r\n}\r\n\r\nconst auth = (privateKey) => {\r\n  if (privateKey) {\r\n    const hash = bitcoin.crypto.sha256(privateKey)\r\n    const d = BigInteger.fromBuffer(hash)\r\n\r\n    const keyPair = bitcoin.ECPair.fromWIF(privateKey, btc.network)\r\n\r\n    const account = bitcoin.ECPair.fromWIF(privateKey, btc.network) // eslint-disable-line\r\n    const { address } = bitcoin.payments.p2pkh({ pubkey: account.publicKey, network: btc.network })\r\n    const { publicKey } = account\r\n\r\n    return {\r\n      account,\r\n      keyPair,\r\n      address,\r\n      privateKey,\r\n      publicKey,\r\n    }\r\n  }\r\n}\r\n\r\nconst getPrivateKeyByAddress = (address) => {\r\n  const {\r\n    user: {\r\n      btcData: {\r\n        address: oldAddress,\r\n        privateKey,\r\n      },\r\n      btcMnemonicData: {\r\n        address: mnemonicAddress,\r\n        privateKey: mnemonicKey,\r\n      } = {\r\n        address: undefined,\r\n        privateKey: undefined,\r\n      },\r\n    },\r\n  } = getState()\r\n\r\n  if (oldAddress === address) return privateKey\r\n  if (mnemonicAddress === address) return mnemonicKey\r\n}\r\n\r\nconst login = (privateKey, mnemonic = null, mnemonicKeys = null) => {\r\n  let sweepToMnemonicReady = false\r\n\r\n  if (privateKey\r\n    && mnemonic\r\n    && mnemonicKeys\r\n    && mnemonicKeys.btc === privateKey\r\n  ) sweepToMnemonicReady = true\r\n\r\n  if (!privateKey && mnemonic) sweepToMnemonicReady = true\r\n\r\n  if (privateKey) {\r\n    const hash = bitcoin.crypto.sha256(privateKey)\r\n    const d = BigInteger.fromBuffer(hash)\r\n\r\n    // keyPair     = bitcoin.ECPair.fromWIF(privateKey, btc.network)\r\n  }\r\n  else {\r\n    console.info('Created account Bitcoin ...')\r\n    // keyPair     = bitcoin.ECPair.makeRandom({ network: btc.network })\r\n    // privateKey  = keyPair.toWIF()\r\n    // use random 12 words\r\n    if (!mnemonic) mnemonic = bip39.generateMnemonic()\r\n\r\n    const accData = getWalletByWords(mnemonic)\r\n    console.log('Btc. Generated wallet from random 12 words')\r\n    console.log(accData)\r\n    privateKey = accData.WIF\r\n    localStorage.setItem(constants.privateKeyNames.btcMnemonic, privateKey)\r\n  }\r\n\r\n  localStorage.setItem(constants.privateKeyNames.btc, privateKey)\r\n\r\n  const data = {\r\n    ...auth(privateKey),\r\n    isMnemonic: sweepToMnemonicReady,\r\n    isBTC: true,\r\n  }\r\n\r\n  window.getBtcAddress = () => data.address\r\n  window.getBtcData = () => data\r\n\r\n  console.info('Logged in with Bitcoin', data)\r\n  reducers.user.setAuthData({ name: 'btcData', data })\r\n  if (!sweepToMnemonicReady) {\r\n    // Auth with our mnemonic account\r\n    if (mnemonic === `-`) {\r\n      console.error('Sweep. Cant auth. Need new mnemonic or enter own for re-login')\r\n      return\r\n    }\r\n\r\n    if (!mnemonicKeys\r\n      || !mnemonicKeys.btc\r\n    ) {\r\n      console.error('Sweep. Cant auth. Login key undefined')\r\n      return\r\n    }\r\n\r\n    const mnemonicData = {\r\n      ...auth(mnemonicKeys.btc),\r\n      isMnemonic: true,\r\n    }\r\n    console.info('Logged in with Bitcoin Mnemonic', mnemonicData)\r\n    reducers.user.addWallet({\r\n      name: 'btcMnemonicData',\r\n      data: {\r\n        currency: 'BTC',\r\n        fullName: 'Bitcoin (New)',\r\n        balance: 0,\r\n        isBalanceFetched: false,\r\n        balanceError: null,\r\n        infoAboutCurrency: null,\r\n        ...mnemonicData,\r\n      },\r\n    })\r\n    new Promise(async (resolve) => {\r\n      const balanceData = await fetchBalanceStatus(mnemonicData.address)\r\n      if (balanceData) {\r\n        reducers.user.setAuthData({\r\n          name: 'btcMnemonicData',\r\n          data: {\r\n            //@\r\n            ...balanceData,\r\n            isBalanceFetched: true,\r\n          },\r\n        })\r\n      } else {\r\n        reducers.user.setBalanceError({ name: 'btcMnemonicData' })\r\n      }\r\n      resolve(true)\r\n    })\r\n  }\r\n\r\n  return privateKey\r\n}\r\n\r\n\r\nconst getTxRouter = (txId) => `/btc/tx/${txId}`\r\n\r\nconst getTx = (txRaw) => {\r\n  if (txRaw\r\n    && txRaw.getId\r\n    //@\r\n    && txRaw.getId instanceof 'function'\r\n  ) {\r\n    return txRaw.getId()\r\n  } else {\r\n    return txRaw\r\n  }\r\n}\r\n\r\n\r\nconst getLinkToInfo = (tx) => {\r\n\r\n  if (!tx) {\r\n    return\r\n  }\r\n\r\n  return `${config.link.bitpay}/tx/${tx}`\r\n}\r\n\r\nconst fetchBalanceStatus = (address) => {\r\n  return new Promise((resolve) => {\r\n    bitcoinUtils.fetchBalance({\r\n      address,\r\n      withUnconfirmed: true,\r\n      NETWORK,\r\n    }).then((answer) => {\r\n      // @\r\n      const { balance, unconfirmed } = answer\r\n      resolve({\r\n        address,\r\n        balance: balance,\r\n        unconfirmedBalance: unconfirmed,\r\n      })\r\n    }).catch((e) => {\r\n      resolve(false)\r\n    })\r\n  })\r\n}\r\n\r\nconst getBalance = () => {\r\n  const {\r\n    user: {\r\n      btcData: {\r\n        address,\r\n      },\r\n    },\r\n  } = getState()\r\n\r\n  return new Promise((resolve) => {\r\n    bitcoinUtils.fetchBalance({\r\n      address,\r\n      withUnconfirmed: true,\r\n      NETWORK,\r\n    }).then((answer) => {\r\n      // @\r\n      const { balance, unconfirmed } = answer\r\n      reducers.user.setBalance({\r\n        name: 'btcData',\r\n        amount: balance,\r\n        unconfirmedBalance: unconfirmed,\r\n      })\r\n      resolve(balance)\r\n    }).catch((e) => {\r\n      reducers.user.setBalanceError({ name: 'btcData' })\r\n      resolve(-1)\r\n    })\r\n  })\r\n}\r\n\r\n\r\nconst fetchBalance = (address) => bitcoinUtils.fetchBalance({\r\n  address,\r\n  withUnconfirmed: false,\r\n  NETWORK,\r\n})\r\n\r\n\r\nconst fetchTxRaw = (txId, cacheResponse) => bitcoinUtils.fetchTxRaw({\r\n  txId,\r\n  cacheResponse,\r\n  NETWORK,\r\n})\r\n\r\nconst fetchTx = (hash, cacheResponse) => bitcoinUtils.fetchTx({\r\n  hash,\r\n  NETWORK,\r\n  cacheResponse,\r\n})\r\n\r\nconst fetchTxInfo = (hash, cacheResponse) => bitcoinUtils.fetchTxInfo({\r\n  hash,\r\n  NETWORK,\r\n  cacheResponse,\r\n  hasAdminFee,\r\n})\r\n\r\n\r\nconst getInvoices = (address) => {\r\n  const { user: { btcData: { userAddress } } } = getState()\r\n\r\n  address = address || userAddress\r\n\r\n  return actions.invoices.getInvoices({\r\n    currency: 'BTC',\r\n    address,\r\n  })\r\n}\r\n\r\nconst getAllMyAddresses = () => {\r\n  const {\r\n    user: {\r\n      btcData,\r\n      btcMnemonicData,\r\n      btcMultisigSMSData,\r\n      btcMultisigUserData,\r\n      btcMultisigG2FAData,\r\n      btcMultisigPinData,\r\n    },\r\n  } = getState()\r\n\r\n  const retData = []\r\n  // ,   sweep\r\n  if (btcMnemonicData\r\n    && btcMnemonicData.address\r\n    && btcData\r\n    && btcData.address\r\n    && btcMnemonicData.address !== btcData.address\r\n  ) {\r\n    retData.push(btcMnemonicData.address.toLowerCase())\r\n  }\r\n\r\n  retData.push(btcData.address.toLowerCase())\r\n\r\n  if (btcMultisigSMSData && btcMultisigSMSData.address) retData.push(btcMultisigSMSData.address.toLowerCase())\r\n  // @ToDo - SMS MultiWallet\r\n\r\n  if (btcMultisigUserData && btcMultisigUserData.address) retData.push(btcMultisigUserData.address.toLowerCase())\r\n  if (btcMultisigUserData && btcMultisigUserData.wallets && btcMultisigUserData.wallets.length) {\r\n    btcMultisigUserData.wallets.map((wallet) => {\r\n      retData.push(wallet.address.toLowerCase())\r\n    })\r\n  }\r\n\r\n  if (btcMultisigPinData && btcMultisigPinData.address) retData.push(btcMultisigPinData.address.toLowerCase())\r\n\r\n  return retData\r\n}\r\n\r\nconst getDataByAddress = (address) => {\r\n  const {\r\n    user: {\r\n      btcData,\r\n      btcMnemonicData,\r\n      btcMultisigSMSData,\r\n      btcMultisigUserData,\r\n      btcMultisigG2FAData,\r\n    },\r\n  } = getState()\r\n\r\n  const founded = [\r\n    btcData,\r\n    btcMnemonicData,\r\n    btcMultisigSMSData,\r\n    btcMultisigUserData,\r\n    ...(\r\n      btcMultisigUserData\r\n      && btcMultisigUserData.wallets\r\n      && btcMultisigUserData.wallets.length\r\n    )\r\n      ? btcMultisigUserData.wallets\r\n      : [],\r\n    btcMultisigG2FAData,\r\n  ].filter(data => data && data.address && data.address.toLowerCase() === address.toLowerCase())\r\n\r\n  return (founded.length) ? founded[0] : false\r\n}\r\n\r\nconst getTransaction = (ownAddress: string = ``, ownType: string = ``) => {\r\n  const myAllWallets = getAllMyAddresses()\r\n\r\n  let { user: { btcData: { address: userAddress } } } = getState()\r\n  const address = ownAddress || userAddress\r\n\r\n  const type = (ownType) || 'btc'\r\n\r\n  if (!typeforce.isCoinAddress.BTC(address)) {\r\n    return new Promise((resolve) => { resolve([]) })\r\n  }\r\n  return bitcoinUtils.getTransactionBlocyper({\r\n    address,\r\n    ownType: type,\r\n    myWallets: myAllWallets,\r\n    network: btc.network,\r\n    NETWORK,\r\n  })\r\n}\r\n\r\nconst addressIsCorrect = (address) => {\r\n  try {\r\n    let outputScript = bitcoin.address.toOutputScript(address, btc.network)\r\n    if (outputScript) return true\r\n  } catch (e) {}\r\n  return false\r\n}\r\n\r\n\r\nconst send = ({ from, to, amount, feeValue = null, speed }) => {\r\n  console.log('>>> send', from, to, amount, feeValue, speed)\r\n  return new Promise(async (ready, reject) => {\r\n    try {\r\n      let privateKey = null\r\n      try {\r\n        privateKey = getPrivateKeyByAddress(from)\r\n      } catch (ePrivateKey) {\r\n        reject({ message: `Fail get data for send address` + ePrivateKey.message })\r\n        return\r\n      }\r\n\r\n      const keyPair = bitcoin.ECPair.fromWIF(privateKey, btc.network)\r\n\r\n      // fee - from amount - percent\r\n      let feeFromAmount: number | BigNumber = new BigNumber(0)\r\n\r\n      if (hasAdminFee) {\r\n        const {\r\n          fee: adminFee,\r\n          min: adminFeeMinValue,\r\n        } = config.opts.fee.btc\r\n\r\n        const adminFeeMin = new BigNumber(adminFeeMinValue)\r\n\r\n        feeFromAmount = new BigNumber(adminFee).dividedBy(100).multipliedBy(amount)\r\n        if (adminFeeMin.isGreaterThan(feeFromAmount)) feeFromAmount = adminFeeMin\r\n\r\n        feeFromAmount = feeFromAmount.multipliedBy(1e8).integerValue() // Admin fee in satoshi\r\n      }\r\n      feeFromAmount = feeFromAmount.toNumber()\r\n\r\n      try {\r\n        feeValue = feeValue || await btc.estimateFeeValue({ inSatoshis: true, speed, amount})\r\n      } catch (eFee) {\r\n        reject({ message: `Fail estimate fee ` + eFee.message })\r\n        return\r\n      }\r\n\r\n      let unspents = []\r\n      try {\r\n        unspents = await fetchUnspents(from)\r\n      } catch (eUnspents) {\r\n        reject({ message: `Fail get unspents `+ eUnspents.message})\r\n        return\r\n      }\r\n      unspents = await prepareUnspents({ unspents, amount })\r\n      const fundValue = new BigNumber(String(amount)).multipliedBy(1e8).integerValue().toNumber()\r\n      const totalUnspent = unspents.reduce((summ, { satoshis }) => summ + satoshis, 0)\r\n      const residue = totalUnspent - fundValue - feeValue - feeFromAmount\r\n      const psbt = new bitcoin.Psbt({ network: btc.network })\r\n\r\n      // add main output for recipient\r\n      psbt.addOutput({\r\n        address: to,\r\n        value: fundValue,\r\n      })\r\n      // if we have residue wich more then DUST value\r\n      // then return this value to the sender wallet\r\n      if (residue > 546) {\r\n        psbt.addOutput({\r\n          address: from,\r\n          value: residue\r\n        })\r\n      }\r\n\r\n      if (hasAdminFee) {\r\n        try {\r\n          psbt.addOutput({\r\n            address: hasAdminFee.address,\r\n            value: feeFromAmount,\r\n          })\r\n        } catch (eAdminFee) {\r\n          reject({ message: `Fail add service fee` + eAdminFee.message })\r\n          return\r\n        }\r\n      }\r\n\r\n      for (let i = 0; i < unspents.length; i++) {\r\n        const { txid, vout } = unspents[i]\r\n        let rawTx = false\r\n\r\n        try {\r\n          rawTx = await fetchTxRaw(txid, false)\r\n        } catch (eFetchTxRaw) {\r\n          reject({ message: `Fail fetch tx raw `+ txid + `(`+eFetchTxRaw.message+`)` })\r\n          return\r\n        }\r\n\r\n        psbt.addInput({\r\n          hash: txid,\r\n          index: vout,\r\n          //@\r\n          nonWitnessUtxo: Buffer.from(rawTx, 'hex'),\r\n        })\r\n      }\r\n\r\n      psbt.signAllInputs(keyPair)\r\n      psbt.finalizeAllInputs()\r\n\r\n      const rawTx = psbt.extractTransaction().toHex();\r\n\r\n      try {\r\n        const broadcastAnswer = await broadcastTx(rawTx)\r\n\r\n        const { txid } = broadcastAnswer\r\n        ready(txid)\r\n      } catch (eBroadcast) {\r\n        reject({ message: `Fail broadcast TX: `+eBroadcast })\r\n      }\r\n    } catch (error) {\r\n      console.log('Actions - btc - send: ', error)\r\n      reject(error)\r\n    }\r\n  })\r\n}\r\n\r\nconst sendTransaction = async ({ to, amount }) => {\r\n  // from main btc wallet\r\n\r\n  const { user: { btcData: { address } } } = getState()\r\n\r\n  if (false) { // fake tx - turboswaps debug\r\n    const txHash = '1324154f6086b6b137be8763f43096cacd5450f9561da061161638ed68ce39c3'\r\n    return txHash\r\n  }\r\n\r\n  const txHash = await send({\r\n    from: address,\r\n    to,\r\n    amount,\r\n    speed: 'fast',\r\n  })\r\n\r\n  return txHash\r\n}\r\n\r\nconst prepareUnspents = ({ amount, unspents }) => bitcoinUtils.prepareUnspents({\r\n  amount,\r\n  unspents,\r\n  NETWORK,\r\n})\r\n\r\nwindow.prepareUnspents = prepareUnspents\r\nconst fetchUnspents = (address) => bitcoinUtils.fetchUnspents({\r\n  address,\r\n  NETWORK,\r\n})\r\n\r\nconst broadcastTx = (txRaw) => bitcoinUtils.broadcastTx({\r\n  txRaw,\r\n  NETWORK,\r\n})\r\n\r\nconst signMessage = (message, encodedPrivateKey) => {\r\n  const keyPair = bitcoin.ECPair.fromWIF(encodedPrivateKey, [bitcoin.networks.bitcoin, bitcoin.networks.testnet])\r\n  const privateKeyBuff = Buffer.from(keyPair.privateKey)\r\n\r\n  const signature = bitcoinMessage.sign(message, privateKeyBuff, keyPair.compressed)\r\n\r\n  return signature.toString('base64')\r\n}\r\n\r\nconst getReputation = () => Promise.resolve(0)\r\n\r\nconst checkWithdraw = (scriptAddress) => bitcoinUtils.checkWithdraw({\r\n  scriptAddress,\r\n  NETWORK,\r\n})\r\n\r\n\r\nexport default {\r\n  login,\r\n  checkWithdraw,\r\n  getBalance,\r\n  getTransaction,\r\n  send,\r\n  sendTransaction,\r\n  fetchUnspents,\r\n  broadcastTx,\r\n  fetchTx,\r\n  fetchTxInfo,\r\n  fetchBalance,\r\n  signMessage,\r\n  getReputation,\r\n  getTx,\r\n  getLinkToInfo,\r\n  getInvoices,\r\n  getWalletByWords,\r\n  getRandomMnemonicWords,\r\n  validateMnemonicWords,\r\n  sweepToMnemonic,\r\n  isSweeped,\r\n  getSweepAddress,\r\n  getAllMyAddresses,\r\n  getDataByAddress,\r\n  getMainPublicKey,\r\n  getTxRouter,\r\n  fetchTxRaw,\r\n  addressIsCorrect,\r\n  convertMnemonicToValid,\r\n  prepareUnspents,\r\n}\r\n"]}]}