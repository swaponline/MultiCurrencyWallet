---
status: planned
depends_on: []
wave: 1
skills: [code-writing]
verify: bash
reviewers: [code-reviewer]
---

# Task 1: Update MCW bridge client isMetaMask flag

## Required Skills

Before starting, load:
- `/skill:code-writing` — [~/.claude/skills/code-writing/SKILL.md](~/.claude/skills/code-writing/SKILL.md)

## Description

Change the `isMetaMask` flag from `false` to `true` in the wallet apps bridge client provider. This single-line change enables dApp libraries (like web3-react and wallet connection modals) to recognize the bridge provider as MetaMask-compatible, which is essential for proper UI rendering and wallet type detection.

Currently, the bridge provider sets `isMetaMask: false`, which causes dApps to display only generic "Injected" wallet options instead of recognizing it as MetaMask. By setting this flag to `true`, the bridge provider will be properly identified by wallet selection interfaces, improving user experience when accessing dApps through MCW's Apps page.

This change is part of the broader auto-connect feature for apps-bridge, working in conjunction with unifactory-side changes to enable seamless wallet connection when dApps are loaded in iframe context.

## What to do

1. Checkout the branch `issue-5268-apps-layout` in the MCW repository
2. Locate line 111 in `src/front/client/wallet-apps-bridge-client.js`
3. Change `isMetaMask: false` to `isMetaMask: true`
4. Commit the change to the branch with a descriptive commit message
5. Verify the change using the verification command

## Acceptance Criteria

- [ ] **AC-T1:** File `src/front/client/wallet-apps-bridge-client.js` on branch `issue-5268-apps-layout` has `isMetaMask: true` on line 111 (carry-forward from tech-spec AC-T1)
- [ ] AC2: Verification command `git show issue-5268-apps-layout:src/front/client/wallet-apps-bridge-client.js | grep 'isMetaMask: true'` returns a match
- [ ] AC3: No other lines changed in the file (only the `isMetaMask` flag)
- [ ] AC4: Commit message clearly describes the change and references the feature
- [ ] AC5: Change is on the correct branch (`issue-5268-apps-layout`, not `master`)

## Context Files

**Always (feature-specific):**
- [user-spec.md](../user-spec.md)
- [tech-spec.md](../tech-spec.md)
- [decisions.md](../decisions.md)

**Always (project context):**
- [project.md](/root/MultiCurrencyWallet/.claude/skills/project-knowledge/references/project.md)
- [architecture.md](/root/MultiCurrencyWallet/.claude/skills/project-knowledge/references/architecture.md)

**By task relevance:**
- [patterns.md](/root/MultiCurrencyWallet/.claude/skills/project-knowledge/references/patterns.md) — Git workflow and commit conventions

**Code files:**
- [src/front/client/wallet-apps-bridge-client.js](/root/MultiCurrencyWallet/src/front/client/wallet-apps-bridge-client.js) — Bridge client IIFE, line 111 contains the `isMetaMask` flag

## Verification Steps

1. Run verification command: `git show issue-5268-apps-layout:src/front/client/wallet-apps-bridge-client.js | grep 'isMetaMask: true'`
2. Expected result: Command returns a match showing the line with `isMetaMask: true`
3. Check git diff to confirm only one line changed: `git diff master..issue-5268-apps-layout src/front/client/wallet-apps-bridge-client.js`
4. Expected result: Diff shows only the change from `isMetaMask: false` to `isMetaMask: true`

## Details

**Files to modify:**
- `src/front/client/wallet-apps-bridge-client.js` (line 111) — Change `isMetaMask: false` to `isMetaMask: true`

**Current state:**
The bridge client is an IIFE (Immediately Invoked Function Expression) that creates a provider object mimicking the MetaMask `window.ethereum` API. Line 111 currently sets `isMetaMask: false`, which was the original conservative approach to avoid confusion with actual MetaMask. However, for proper dApp integration, this flag needs to be `true` so that wallet selection libraries recognize the bridge provider as MetaMask-compatible.

**What to change:**
Line 111: From `isMetaMask: false,` to `isMetaMask: true,`

**Dependencies:**
- Branch `issue-5268-apps-layout` must exist and be checked out
- No package dependencies for this change
- This task is independent (Wave 1) and can be done in parallel with unifactory tasks

**Technical context:**
The `isMetaMask` flag is a standard property that wallet connection libraries check to determine the wallet type. Many dApp wallet modals (including unifactory's WalletModal) use this flag to show MetaMask-specific UI or enable MetaMask connector options. The bridge also sets `isSwapWalletAppsBridge: true` for explicit bridge detection when needed.

**Why this matters:**
When the bridge provider is injected into an iframe, dApp libraries like web3-react check `window.ethereum.isMetaMask` to determine how to display wallet options. With `isMetaMask: false`, the dApp only shows generic "Injected" option. With `isMetaMask: true`, the dApp recognizes it as MetaMask and provides better UX.

**Edge cases:**
- None for this change — it's a single boolean flag with no conditional logic
- The change is backward compatible — the `isSwapWalletAppsBridge` flag remains for explicit bridge detection
- No impact on standalone mode (bridge only activates in iframe context with URL parameter)

**Commit message guidance:**
Reference the feature and explain the purpose clearly. Example: "feat(bridge): set isMetaMask flag to true for dApp compatibility - Enables wallet selection libraries to recognize bridge provider as MetaMask-compatible - Part of apps-bridge-autoconnect feature"

## Reviewers

- **code-reviewer** → `logs/working/task-1/code-reviewer-{round}.json`

## Post-completion

- [ ] Write brief report to decisions.md following template (Summary: 1-3 sentences, review links to JSON files, no finding tables or dumps)
- [ ] If deviated from spec — describe deviation and reason
- [ ] Update user-spec/tech-spec if anything changed (unlikely for this single-line change)
- [ ] Note: Verify Task 7 (MCW bridge unit tests) includes test coverage for `isMetaMask: true` flag to satisfy AC-T1 validation
