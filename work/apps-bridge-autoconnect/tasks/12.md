---
status: planned
depends_on: [10, 11]
wave: final
skills: [post-deploy-qa]
reviewers: []
---

# Task 12: Post-deploy verification

## Required Skills

Перед выполнением задачи загрузи:
- `/skill:post-deploy-qa` — [skills/post-deploy-qa/SKILL.md](~/.claude/skills/post-deploy-qa/SKILL.md)

## Description

Verify that the apps-bridge auto-connect feature works correctly in the live production environment after both MCW and unifactory deployments are complete. This is the final quality gate before marking the feature complete.

The task ensures that:
1. Auto-connect works on the production wallet URL (swaponline.github.io/#/apps)
2. Standalone dApp mode still works correctly (dex.onout.org without iframe)
3. Runtime events (network switch, disconnect) propagate correctly between wallet and dApp
4. No console errors or regressions introduced by the feature

This verification happens on real production URLs, not PR previews or local builds. We test all critical user flows from the user-spec acceptance criteria in the live environment.

## What to do

1. Test auto-connect happy path on production wallet
2. Verify standalone dApp mode (without iframe) still works
3. Test network switch propagation from wallet to dApp
4. Test disconnect propagation from wallet to dApp
5. Check browser console for errors in all scenarios
6. Document any issues found in the GitHub issue comments


## Acceptance Criteria

- [ ] AC1: Opening `https://swaponline.github.io/#/apps` → clicking Onout DEX → DEX shows connected wallet address without any modal dialogs
- [ ] AC2: Wallet balance in DEX matches the ETH balance shown in MCW wallet
- [ ] AC3: Opening `https://dex.onout.org` directly (standalone mode) shows standard wallet selection modal
- [ ] AC4: Switching network in MCW (e.g., ETH → BSC) updates the network shown in DEX iframe
- [ ] AC5: Disconnecting MetaMask in MCW causes DEX to show "Connect Wallet" button
- [ ] AC6: No console errors in any of the above scenarios
- [ ] AC7: All findings documented in GitHub issue if any problems discovered

## Context Files

**Feature context:**
- [user-spec.md](../user-spec.md)
- [tech-spec.md](../tech-spec.md)
- [decisions.md](../decisions.md)

**Project knowledge:**
- [project.md](/root/MultiCurrencyWallet/.claude/skills/project-knowledge/references/project.md)
- [architecture.md](/root/MultiCurrencyWallet/.claude/skills/project-knowledge/references/architecture.md)
- [deployment.md](/root/MultiCurrencyWallet/.claude/skills/project-knowledge/references/deployment.md)

## Verification Steps

**Test 1: Auto-connect happy path**
1. Open https://swaponline.github.io/#/apps in a browser
2. Ensure MetaMask is connected in the wallet (if not, connect it first)
3. Click on "Onout DEX" app card
4. Wait for iframe to load
5. Expected: DEX shows connected address immediately, no wallet selection modal appears, balance visible

**Test 2: Standalone mode**
1. Open https://dex.onout.org directly (new tab, not via iframe)
2. Expected: Standard wallet selection modal appears, dApp works normally as before

**Test 3: Network switch propagation**
1. Open wallet at https://swaponline.github.io/#/apps → click Onout DEX
2. Wait for auto-connect (address visible in DEX)
3. Switch network in MCW wallet (e.g., from Ethereum to BSC)
4. Expected: DEX updates to show BSC network, no errors

**Test 4: Disconnect propagation**
1. Open wallet at https://swaponline.github.io/#/apps → click Onout DEX
2. Wait for auto-connect (address visible in DEX)
3. Disconnect MetaMask in MCW wallet
4. Expected: DEX shows "Connect Wallet" button, address disappears

**Test 5: Console errors check**
1. Open browser DevTools → Console tab
2. Repeat tests 1-4 while monitoring console
3. Expected: No red errors related to bridge, wallet connection, or postMessage

**Test 6: Document issues**
1. If any test fails or produces errors, take screenshots
2. Document the issue in GitHub issue comments with reproduction steps
3. Expected: All findings clearly described for follow-up

## Details

**Prerequisites:**
- Task 10 (MCW deployment) must be complete — swaponline.github.io has updated bridge client
- Task 11 (unifactory deployment) must be complete — dex.onout.org has bridge loading logic

**Production URLs:**
- Wallet: https://swaponline.github.io/#/apps
- DEX standalone: https://dex.onout.org
- DEX in iframe: Accessed via wallet Apps page, URL includes `?walletBridge=swaponline` parameter

**What to check in browser DevTools:**
- **Console tab:** Look for errors related to `postMessage`, `bridge`, `ethereum`, or wallet connection
- **Network tab:** Verify `wallet-apps-bridge-client.js` loads successfully from swaponline.github.io
- **Application → localStorage:** Check for wallet state (if needed for debugging)

**Common issues to watch for:**
- Bridge client fails to load (CORS, 404)
- Handshake timeout (bridge READY message not received)
- Auto-connect doesn't trigger (modal shows instead)
- Network switch doesn't propagate (chainId mismatch)
- Disconnect event not handled (address remains visible after disconnect)

**How to test with MetaMask:**
- Ensure you have MetaMask browser extension installed
- In MCW wallet, connect MetaMask via the Connect Wallet button
- Verify MetaMask shows connected status in wallet UI before opening Apps page

**Documentation:**
- If issues found, add comment to GitHub issue #5268 with:
  - Browser version (Chrome/Firefox/Safari)
  - Reproduction steps (numbered list)
  - Screenshot of error (if applicable)
  - Console logs (copy relevant errors)

**Edge cases:**
- Test with MetaMask locked — should fallback to wallet modal
- Test with no MetaMask installed — should fallback to wallet modal
- Test switching between multiple apps in Apps page — verify each iframe gets separate bridge instance

## Reviewers

No automated reviewers for post-deploy verification task. User performs manual testing and confirms results.

## Post-completion

- [ ] Записать краткий отчёт в decisions.md (Summary: все тесты пройдены / найдены проблемы [список])
- [ ] Если найдены баги — создать follow-up GitHub issues для исправления
- [ ] Обновить GitHub issue #5268 финальным статусом (все проверки пройдены / требуются доработки)
