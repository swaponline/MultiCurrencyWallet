---
status: planned
depends_on: [5]
wave: 6
skills: ["code-writing"]
verify: bash
reviewers: ["code-reviewer", "security-auditor", "test-reviewer"]
---

# Task 9: Send Transaction UI

## Required Skills

Before starting, load:
- `/skill:code-writing` — [~/.claude/skills/code-writing/SKILL.md](~/.claude/skills/code-writing/SKILL.md)

## Description

Implement send transaction screen with address input validation (EIP-55 checksum warning for lowercase ETH addresses), amount entry, fee tier selector, confirmation dialog with biometric prompt, duplicate submission prevention (disable button during broadcast), and result display.

## What to do

1. Create SendScreen composable with address input, amount input, fee selector
2. Implement address validation: BTC P2PKH format, ETH checksummed (EIP-55), show warning for lowercase ETH addresses
3. Implement amount validation: > 0, ≤ balance
4. Implement fee tier selector: Fast / Normal / Slow (show estimated time and fee amount)
5. Create SendViewModel with state machine: Idle → Building → Confirming → Submitting → Success/Error
6. Implement duplicate submission prevention: disable Send button when state = Submitting
7. Create ConfirmationDialog: show recipient, amount, fee, total; biometric prompt on confirm
8. Implement broadcastTransaction() in ViewModel: call BtcManager or EvmManager
9. Show result: tx hash on success, error message on failure
10. Write unit tests for validation logic and state machine

## TDD Anchor

tests/9_test.kt:
- testAddressValidationBtc — valid P2PKH → passes, invalid → error
- testAddressValidationEth — checksummed → passes, lowercase → warning, invalid → error
- testAmountValidation — 0 → error, > balance → error, valid → passes
- testDuplicateSubmissionPrevention — tap Send → button disabled until broadcast completes
- testStateMachine — Idle → Building → Confirming → Submitting → Success

## Acceptance Criteria

- [ ] All unit tests pass
- [ ] Implementation matches tech-spec requirements
- [ ] No security vulnerabilities introduced
- [ ] Code follows Android best practices

## Context Files

- [user-spec.md](../user-spec.md)
- [tech-spec.md](../tech-spec.md)
- [src/core/swap.app/util/typeforce.ts](../../src/core/swap.app/util/typeforce.ts)

## Verification Steps

1. Run: `cd android && ./gradlew test`
2. Expected: All tests pass
3. Verify implementation matches requirements from tech-spec

## Details

See tech-spec for complete implementation details for this task.

## Reviewers

- **code-reviewer** → `logs/working/task-9/code-reviewer-{round}.json`
- **security-auditor** → `logs/working/task-9/security-auditor-{round}.json`
- **test-reviewer** → `logs/working/task-9/test-reviewer-{round}.json`

## Post-completion

- [ ] Write report to decisions.md (include all review rounds with links)
- [ ] If deviated from spec — describe deviation and reason
- [ ] Update user-spec/tech-spec if anything changed
