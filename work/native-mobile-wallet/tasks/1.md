---
status: done
depends_on: []
wave: 1
skills: ["infrastructure-setup"]
verify: bash
reviewers: ["code-reviewer", "security-auditor", "infrastructure-reviewer"]
---

# Task 1: Android Project Setup

## Required Skills

Before starting, load:
- `/skill:infrastructure-setup` — [~/.claude/skills/infrastructure-setup/SKILL.md](~/.claude/skills/infrastructure-setup/SKILL.md)


## Description

Create multi-module Android Gradle project in android/ directory with all 9 modules (:app, :core:crypto, :core:storage, :core:auth, :core:network, :core:btc, :core:evm, :feature:dapp-browser, :feature:walletconnect). Configure Hilt DI, Jetpack Compose, all dependencies from tech-spec Dependencies section, GitHub Actions CI workflow, and network_security_config.xml with cleartextTrafficPermitted=false.

This is a new standalone Android project (not modifying the existing React web wallet). The android/ directory will be created at the root level of the MultiCurrencyWallet repository.

## What to do

1. Create android/ directory structure with all 9 Gradle modules
2. Set up root build.gradle.kts with Kotlin plugin, Hilt, Compose BOM
3. Configure settings.gradle.kts to include all modules
4. Create app/build.gradle.kts with applicationId, Compose dependencies, Hilt
5. Create core module build.gradle files (crypto, storage, auth, network, btc, evm)
6. Create feature module build.gradle files (dapp-browser, walletconnect)
7. Add all dependencies from tech-spec: bitcoinj 0.16.3, web3j 4.10.3, OkHttp, Retrofit, Moshi, WalletConnect, Hilt, BiometricPrompt, ML Kit, Firebase Crashlytics, jbcrypt, Navigation Compose
8. Create AndroidManifest.xml with INTERNET, CAMERA permissions
9. Create network_security_config.xml with cleartextTrafficPermitted=false, reference from manifest
10. Create GitHub Actions workflow for assembleDebug and test
11. Add gradle.properties with Android build config
12. Create .gitignore for Android artifacts

## Acceptance Criteria

- [ ] ./gradlew assembleDebug succeeds
- [ ] All 9 modules defined in settings.gradle.kts
- [ ] network_security_config.xml present with cleartextTrafficPermitted=false
- [ ] AndroidManifest.xml references network security config
- [ ] All dependencies from tech-spec added to appropriate modules
- [ ] Hilt configured in app module
- [ ] GitHub Actions workflow created
- [ ] .gitignore covers Android artifacts


## Context Files

- [user-spec.md](../user-spec.md)
- [tech-spec.md](../tech-spec.md)

## Verification Steps

1. Run: cd android && ./gradlew assembleDebug
2. Expected: Build succeeds, app-debug.apk produced in app/build/outputs/apk/debug/
3. Verify: network_security_config.xml exists in app/src/main/res/xml/
4. Verify: grep 'android:networkSecurityConfig' app/src/main/AndroidManifest.xml returns match

## Details

**Module structure:**
- android/app/ — Single-activity Compose UI
- android/core/crypto/ — BIP39/BIP44 key derivation (Java library, no Android dependencies)
- android/core/storage/ — EncryptedSharedPreferences wrapper
- android/core/auth/ — BiometricPrompt + app password
- android/core/network/ — OkHttp + Retrofit + API failover
- android/core/btc/ — Bitcoin operations (bitcoinj)
- android/core/evm/ — EVM operations (web3j)
- android/feature/dapp-browser/ — WebView + window.ethereum provider
- android/feature/walletconnect/ — WalletConnect v2 SDK integration

**Dependencies (extract versions from tech-spec Dependencies section):**
- org.bitcoinj:bitcoinj-core:0.16.3
- org.web3j:core:4.10.3
- com.squareup.okhttp3:okhttp:4.12.0
- com.squareup.retrofit2:retrofit:2.9.0, converter-moshi:2.9.0
- com.squareup.moshi:moshi-kotlin:1.15.0
- com.walletconnect:android-core:1.31.0, sign:2.28.0
- com.google.dagger:hilt-android:2.50
- androidx.biometric:biometric:1.1.0
- com.google.mlkit:barcode-scanning:17.2.0
- androidx.camera:camera-camera2:1.3.1
- com.google.firebase:firebase-crashlytics:18.6.0
- org.mindrot:jbcrypt:0.4
- androidx.navigation:navigation-compose:2.7.6
- Compose BOM: androidx.compose:compose-bom:2024.02.00

**network_security_config.xml:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <base-config cleartextTrafficPermitted="false" />
</network-security-config>
```

**AndroidManifest.xml additions:**
- android:networkSecurityConfig="@xml/network_security_config"
- INTERNET permission
- CAMERA permission (for QR scanner)

**gradle.properties:**
- android.useAndroidX=true
- android.enableJetifier=true
- org.gradle.jvmargs=-Xmx4096m (large heap for bitcoinj/web3j)

**minSdk:** 26 (Android 8.0)
**targetSdk:** 34
**compileSdk:** 34

**CI workflow:** .github/workflows/android-ci.yml
- Trigger on push to android/ paths
- Jobs: assembleDebug, test (unit tests)

## Reviewers

- **code-reviewer** → `logs/working/task-1/code-reviewer-{round}.json`
- **security-auditor** → `logs/working/task-1/security-auditor-{round}.json`
- **infrastructure-reviewer** → `logs/working/task-1/infrastructure-reviewer-{round}.json`


## Post-completion

- [ ] Write report to decisions.md (include all review rounds with links)
- [ ] If deviated from spec — describe deviation and reason
- [ ] Update user-spec/tech-spec if anything changed
