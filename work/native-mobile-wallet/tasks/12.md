---
status: planned
depends_on: [6, 7]
wave: 7
skills: ["code-writing"]
verify: bash
reviewers: ["code-reviewer", "test-reviewer"]
---

# Task 12: Transaction History

## Required Skills

Before starting, load:
- `/skill:code-writing` — [~/.claude/skills/code-writing/SKILL.md](~/.claude/skills/code-writing/SKILL.md)

## Description

Implement tx history fetching and display using Blockcypher (BTC) and Etherscan (EVM) APIs. Parse transaction direction and merge data sources. Depends on Tasks 6 and 7 for core module structure.

## What to do

1. Add fetchTransactionHistory(address) to BtcManager — call Blockcypher API
2. Add fetchTransactionHistory(address, chain) to EvmManager — call Etherscan API
3. Parse BTC tx: determine direction (IN/OUT/SELF), amount, fee, confirmations
4. Parse EVM tx: determine direction, decode contract interactions (ERC20 transfers)
5. Create HistoryScreen with LazyColumn displaying TransactionRecord items
6. Implement pull-to-refresh for history
7. Display: tx hash (truncated), direction icon, amount, timestamp, confirmations
8. Tap tx → show details (full hash, block, fee, counterparty address)
9. Write unit tests for response parsing with real API fixtures

## TDD Anchor

tests/12_test.kt:
- testParseBtcTransaction — Blockcypher response → TransactionRecord with correct direction/amount
- testParseEvmTransaction — Etherscan response → TransactionRecord
- testDetermineDirectionIn — tx to my address → IN
- testDetermineDirectionOut — tx from my address → OUT
- testDetermineDirectionSelf — tx from my address to my address → SELF

## Acceptance Criteria

- [ ] All unit tests pass
- [ ] Implementation matches tech-spec requirements
- [ ] No security vulnerabilities introduced
- [ ] Code follows Android best practices

## Context Files

- [user-spec.md](../user-spec.md)
- [tech-spec.md](../tech-spec.md)
- [src/common/utils/coin/btc.ts](../../src/common/utils/coin/btc.ts)
- [src/front/shared/redux/actions/ethLikeAction.ts](../../src/front/shared/redux/actions/ethLikeAction.ts)

## Verification Steps

1. Run: `cd android && ./gradlew test`
2. Expected: All tests pass
3. Verify implementation matches requirements from tech-spec

## Details

See tech-spec for complete implementation details for this task.

## Reviewers

- **code-reviewer** → `logs/working/task-12/code-reviewer-{round}.json`
- **test-reviewer** → `logs/working/task-12/test-reviewer-{round}.json`

## Post-completion

- [ ] Write report to decisions.md (include all review rounds with links)
- [ ] If deviated from spec — describe deviation and reason
- [ ] Update user-spec/tech-spec if anything changed
